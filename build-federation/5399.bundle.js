/*! For license information please see 5399.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkciqo=self.webpackChunkciqo||[]).push([[5399],{25399:function(t,e,n){n.r(e),n.d(e,{CameraProjections:function(){return i},IfcComponent:function(){return c},IfcViewerAPI:function(){return ol},NavigationModes:function(){return r},dimension:function(){return l}});var r,i,a=n(54288),s=n(43045),o=n(54314),u=n(55248);!function(t){t[t.Orbit=0]="Orbit",t[t.FirstPerson=1]="FirstPerson",t[t.Plan=2]="Plan"}(r||(r={})),function(t){t[t.Perspective=0]="Perspective",t[t.Orthographic=1]="Orthographic"}(i||(i={}));var l,c=function(){function t(e){(0,o.Z)(this,t),e.addComponent(this)}return(0,u.Z)(t,[{key:"update",value:function(t){}}]),t}();!function(t){t.x="x",t.y="y",t.z="z"}(l||(l={}));var h=n(39544),f=n(58618),d=n(21324),p=n(56289),m=n(61193),v=n(89873),g=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r,i,a,s,u,l){var c;return(0,o.Z)(this,n),(c=e.call(this,t)).arrowBoundingBox=new p.Mesh,c.isVisible=!0,c.enabled=!0,c.edgesActive=!0,c.isPlan=!1,c.removeFromScene=function(){c.helper.removeFromParent(),c.arrowBoundingBox.removeFromParent(),c.arrowBoundingBox.geometry.dispose(),c.arrowBoundingBox=void 0,c.planeMesh.geometry.dispose(),c.planeMesh.geometry=void 0,c.controls.removeFromParent(),c.controls.dispose(),c.edges.dispose(),c.helper.removeFromParent()},c.planeSize=u,c.context=t,c.plane=new p.Plane,c.planeMesh=c.getPlaneMesh(),c.normal=i,c.origin=r,c.helper=c.createHelper(),c.controls=c.newTransformControls(),c.setupEvents(a,s),c.plane.setFromNormalAndCoplanarPoint(i,r),c.edges=new v.K(c.plane),c.edgesActive=l,c}return(0,u.Z)(n,[{key:"active",get:function(){return this.enabled},set:function(t){this.enabled=t;var e=this.context.getClippingPlanes();if(this.edges.visible=t,t)e.push(this.plane);else{var n=e.indexOf(this.plane);n>=0&&e.splice(n)}}},{key:"visible",get:function(){return this.isVisible},set:function(t){this.isVisible=t,this.controls.visible=t,this.helper.visible=t,this.edges.visible=t}},{key:"dispose",value:function(){n.planeMaterial&&(n.planeMaterial.dispose(),n.planeMaterial=null,n.planeMaterial=n.getPlaneMaterial()),n.hiddenMaterial&&(n.hiddenMaterial.dispose(),n.hiddenMaterial=null,n.hiddenMaterial=n.getHiddenMaterial()),this.removeFromScene(),this.edges.disposeStylesAndHelpers(),this.edges=null,this.context=null}},{key:"newTransformControls",value:function(){var t=this.context.getCamera(),e=this.context.getDomElement(),n=new m.Ys(t,e);return this.initializeControls(n),this.context.getScene().add(n),this.context.renderer.postProduction.excludedItems.add(n),n}},{key:"initializeControls",value:function(t){t.attach(this.helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.children[0].children[0].add(this.arrowBoundingBox)}},{key:"createArrowBoundingBox",value:function(){this.arrowBoundingBox.geometry=new p.CylinderGeometry(.18,.18,1.2),this.arrowBoundingBox.material=n.hiddenMaterial,this.arrowBoundingBox.rotateX(Math.PI/2),this.arrowBoundingBox.updateMatrix(),this.arrowBoundingBox.geometry.applyMatrix4(this.arrowBoundingBox.matrix)}},{key:"setupEvents",value:function(t,e){var n=this;this.controls.addEventListener("change",(function(){n.enabled&&(n.plane.setFromNormalAndCoplanarPoint(n.normal,n.helper.position),n.edgesActive&&n.edges.updateEdges())})),this.controls.addEventListener("dragging-changed",(function(r){n.enabled&&(n.isVisible=!r.value,n.context.toggleCameraControls(n.isVisible),r.value?t():e())})),this.context.ifcCamera.currentNavMode.onChangeProjection.on((function(t){n.controls.camera=t}))}},{key:"createHelper",value:function(){var t=new p.Object3D;return t.lookAt(this.normal),t.position.copy(this.origin),this.context.getScene().add(t),t.add(this.planeMesh),this.context.renderer.postProduction.excludedItems.add(t),t}},{key:"getPlaneMesh",value:function(){var t=new p.PlaneGeometry(this.planeSize,this.planeSize,1);return new p.Mesh(t,n.planeMaterial)}}],[{key:"getPlaneMaterial",value:function(){return new p.MeshBasicMaterial({color:16776960,side:p.DoubleSide,transparent:!0,opacity:.2})}},{key:"getHiddenMaterial",value:function(){return new p.MeshBasicMaterial({visible:!1})}}]),n}(c);g.planeMaterial=g.getPlaneMaterial(),g.hiddenMaterial=g.getHiddenMaterial();var E=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r){var i;return(0,o.Z)(this,n),(i=e.call(this,t)).orthogonalY=!0,i.toleranceOrthogonalY=.7,i.planeSize=5,i.createPlane=function(){if(i.enabled){var t=i.context.castRayIfc();t&&(i.createPlaneFromIntersection(t),i.intersection=void 0)}},i.createFromNormalAndCoplanarPoint=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=new g(i.context,e,t,i.activateDragging,i.deactivateDragging,i.planeSize,i.edgesEnabled);return r.isPlan=n,i.planes.push(r),i.context.addClippingPlane(r.plane),i.updateMaterials(),r},i.deletePlane=function(t){var e=t;if(!e){if(!i.enabled)return;e=i.pickPlane()}if(e){var n=i.planes.indexOf(e);-1!==n&&(e.removeFromScene(),i.planes.splice(n,1),i.context.removeClippingPlane(e.plane),i.updateMaterials(),i.context.renderer.postProduction.update())}},i.deleteAllPlanes=function(){for(;i.planes.length>0;)i.deletePlane(i.planes[0])},i.pickPlane=function(){var t=i.planes.map((function(t){return t.planeMesh})),e=i.planes.map((function(t){return t.arrowBoundingBox})),n=i.context.castRay([].concat((0,h.Z)(t),(0,h.Z)(e)));return n.length>0?i.planes.find((function(t){return t.planeMesh===n[0].object||t.arrowBoundingBox===n[0].object?t:null})):null},i.createPlaneFromIntersection=function(t){var e,n=t.point.distanceTo(new p.Vector3(0,0,0)),r=null===(e=t.face)||void 0===e?void 0:e.normal;if(n&&r){var a=(new p.Matrix3).getNormalMatrix(t.object.matrixWorld),s=r.clone().applyMatrix3(a).normalize();i.normalizePlaneDirectionY(s);var o=i.newPlane(t,s.negate());i.planes.push(o),i.context.addClippingPlane(o.plane),i.updateMaterials()}},i.activateDragging=function(){i.dragging=!0,i.context.renderer.postProduction.visible=!1},i.deactivateDragging=function(){i.dragging=!1,i.context.renderer.postProduction.visible=!0},i.updateMaterials=function(){var t=i.context.getClippingPlanes();i.context.items.ifcModels.forEach((function(e){Array.isArray(e.material)?e.material.forEach((function(e){return e.clippingPlanes=t})):e.material.clippingPlanes=t})),Object.values(i.ifc.loader.ifcManager.subsets.getAllSubsets()).forEach((function(e){var n=e.mesh;n.material&&i.updateMaterial(n,t),n.userData.wireframe&&i.updateMaterial(n.userData.wireframe,t)}))},i.context=t,i.ifc=r,i.enabled=!1,i.edgesEnabled=!0,i.dragging=!1,i.planes=[],i}return(0,u.Z)(n,[{key:"active",get:function(){return this.enabled},set:function(t){this.enabled=t,this.planes.forEach((function(e){e.isPlan||(e.visible=t,e.active=t)})),this.updateMaterials(),this.context.renderer.postProduction.visible=!0}},{key:"edgesActive",get:function(){return this.edgesEnabled},set:function(t){this.edgesEnabled=t,this.planes.forEach((function(e){e.edgesActive=t}))}},{key:"toggle",value:function(){this.active=!this.active}},{key:"dispose",value:function(){this.planes.forEach((function(t){return t.dispose()})),this.planes.length=0,this.context=null,this.ifc=null}},{key:"normalizePlaneDirectionY",value:function(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}},{key:"newPlane",value:function(t,e){return new g(this.context,t.point,e,this.activateDragging,this.deactivateDragging,this.planeSize,this.edgesEnabled)}},{key:"updateMaterial",value:function(t,e){Array.isArray(t.material)?t.material.forEach((function(t){t.clippingPlanes=e})):t.material.clippingPlanes=e}}]),n}(c);new p.Vector3,new p.Vector3,new p.Vector3;function I(t){t.removeFromParent(),t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach((function(t){return t.dispose()})):t.material.dispose()),t.children&&t.children.length&&t.children.forEach((function(t){return I(t)})),t.children.length=0}var T,y=function(){function t(e,n){(0,o.Z)(this,t),this.IFC=e,this.context=n,this.existMessage="The specified fill already exists",this.fills={}}return(0,u.Z)(t,[{key:"dispose",value:function(){Object.values(this.fills).forEach((function(t){return I(t)})),this.fills=null}},{key:"create",value:function(t,e,n,r){if(void 0!==this.fills[t])throw new Error(this.existMessage);r.clippingPlanes=this.context.getClippingPlanes();var i=this.context.items.ifcModels.find((function(t){return t.modelID===e}));if(!i)throw new Error("The requested model to fill was not found.");this.setupMaterial(r);var a=this.getSubset(e,n,r,t);return a?(this.context.items.pickableIfcModels.push(a),a.position.copy(i.position),a.rotation.copy(i.rotation),this.context.getScene().add(a),this.fills[t]=a,a):null}},{key:"createFromMesh",value:function(t,e){if(void 0!==this.fills[t])throw new Error(this.existMessage);var n=this.context.getClippingPlanes();Array.isArray(e.material)?e.material.forEach((function(t){t.clippingPlanes=n})):e.material.clippingPlanes=n,this.fills[t]=e}},{key:"delete",value:function(t){var e=this.fills[t];delete this.fills[t],this.context.scene.removeModel(e),e.geometry.dispose()}},{key:"setupMaterial",value:function(t){t.clippingPlanes=this.context.getClippingPlanes(),t.side=p.BackSide,t.polygonOffset=!0,t.polygonOffsetFactor=-1,t.polygonOffsetUnits=1}},{key:"getSubset",value:function(t,e,n,r){return this.IFC.loader.ifcManager.createSubset({modelID:t,ids:e,scene:this.context.getScene(),removePrevious:!0,material:n,applyBVH:!0,customID:r})}}]),t}(),C=n(78041);!function(t){t.LENGTHUNIT="LENGTHUNIT",t.AREAUNIT="AREAUNIT",t.VOLUMEUNIT="VOLUMEUNIT"}(T||(T={}));var x={MILLI:.001,CENTI:.01,DECI:.1,NONE:1,DECA:10,HECTO:100,KILO:1e3},A=function(){function t(e){(0,o.Z)(this,t),this.allUnits={},this.ifc=e}return(0,u.Z)(t,[{key:"dispose",value:function(){this.allUnits=null,this.ifc=null}},{key:"getUnits",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.allUnits[e]){t.next=3;break}return t.next=3,this.getUnitsOfModel(e);case 3:return t.abrupt("return",this.allUnits[e][n]);case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getUnitsOfModel",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.allUnits[e]={},t.next=3,this.ifc.getAllItemsOfType(e,C.IFCUNITASSIGNMENT,!1);case 3:return n=t.sent,r=n[0],t.next=7,this.ifc.getProperties(e,r,!1,!0);case 7:i=t.sent,s=i.Units,Object.values(T).forEach((function(t){var n=s.find((function(e){return e.UnitType&&e.UnitType.value===t}));if(n){var r,i=n.Prefix;r=null===i||void 0===i?x.NONE:x[i.value],o.allUnits[e][t]=r}}));case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),F=function(){function t(e,n,r){(0,o.Z)(this,t),this.ifc=e,this.context=n,this.clipper=r,this.planLists={},this.active=!1,this.defaultSectionOffset=1.5,this.defaultCameraOffset=30,this.storeys=[],this.floorPlanViewCached=!1,this.previousCamera=new p.Vector3,this.previousTarget=new p.Vector3,this.previousProjection=i.Perspective,this.sectionFill=new p.Mesh}return(0,u.Z)(t,[{key:"dispose",value:function(){I(this.sectionFill),this.sectionFill=null,this.storeys=null,this.planLists=null}},{key:"getAll",value:function(t){var e=this.planLists[t];if(!e)throw new Error("The requested model doesn't have floor plans generated");return Object.keys(e)}},{key:"create",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.modelID,r=e.name,i=e.ortho||!0,void 0===this.planLists[n]&&(this.planLists[n]={}),s=this.planLists[n],o=e.expressID,!s[o]){t.next=7;break}return t.abrupt("return");case 7:return s[o]={modelID:n,name:r,ortho:i,expressID:o},t.next=10,this.createClippingPlane(e,s[o]);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"goTo",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=s.length>2&&void 0!==s[2]&&s[2],(null===(i=this.currentPlan)||void 0===i?void 0:i.modelID)!==e||this.currentPlan.name!==n){t.next=3;break}return t.abrupt("return");case 3:if(this.storeCameraPosition(),this.hidePreviousClippingPlane(),this.getCurrentPlan(e,n),this.activateCurrentPlan(),this.active){t.next=11;break}return t.next=10,this.moveCameraTo2DPlanPosition(r);case 10:this.active=!0;case 11:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"exitPlanView",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=n.length>0&&void 0!==n[0]&&n[0],this.active){t.next=3;break}return t.abrupt("return");case 3:return this.active=!1,this.cacheFloorplanView(),this.context.ifcCamera.setNavigationMode(r.Orbit),this.context.ifcCamera.projection=this.previousProjection,this.currentPlan&&this.currentPlan.plane&&(this.currentPlan.plane.active=!1),this.currentPlan=void 0,t.next=11,this.context.ifcCamera.cameraControls.setLookAt(this.previousCamera.x,this.previousCamera.y,this.previousCamera.z,this.previousTarget.x,this.previousTarget.y,this.previousTarget.z,e);case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"computeAllPlanViews",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u,l,c,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getCurrentStoreys(e);case 2:return t.next=4,this.ifc.units.getUnits(e,T.LENGTHUNIT);case 4:return r=t.sent,t.next=7,this.getSiteCoords(e);case 7:return i=t.sent,t.next=10,this.getTransformHeight(e);case 10:s=t.sent,o=this.storeys[e],u=0;case 13:if(!(u<o.length)){t.next=23;break}if(!o[u]){t.next=20;break}return l=(null===(n=o[u].Elevation)||void 0===n?void 0:n.value)||0,c=(l+i[2])*r+s,h=o[u].expressID,t.next=20,this.create({modelID:e,name:this.getFloorplanName(o[u]),point:new p.Vector3(0,c+this.defaultSectionOffset,0),normal:new p.Vector3(0,-1,0),rotation:0,ortho:!0,expressID:h});case 20:u++,t.next=13;break;case 23:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"storeCameraPosition",value:function(){this.active?this.cacheFloorplanView():this.store3dCameraPosition()}},{key:"createClippingPlane",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.normal||!e.point){t.next=9;break}return r=e.normal,i=e.point,(s=this.clipper.createFromNormalAndCoplanarPoint(r,i,!0)).visible=!1,s.active=!1,n.plane=s,t.next=8,s.edges.updateEdges();case 8:s.edges.visible=!1;case 9:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getTransformHeight",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ifc.loader.ifcManager.ifcAPI.GetCoordinationMatrix(e);case 2:return n=t.sent,t.abrupt("return",n[13]);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getCurrentStoreys",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.storeys[e]){t.next=4;break}return t.next=3,this.ifc.getAllItemsOfType(e,C.IFCBUILDINGSTOREY,!0);case 3:this.storeys[e]=t.sent;case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSiteCoords",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getBuilding(e);case 2:return n=t.sent,r=n.ObjectPlacement.PlacementRelTo.RelativePlacement.Location,t.abrupt("return",r.Coordinates.map((function(t){return t.value})));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getBuilding",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ifc.getAllItemsOfType(e,C.IFCBUILDING,!1);case 2:return n=t.sent,r=n[0],t.abrupt("return",this.ifc.getProperties(e,r,!1,!0));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"cacheFloorplanView",value:function(){this.floorPlanViewCached=!0,this.context.ifcCamera.cameraControls.saveState()}},{key:"moveCameraTo2DPlanPosition",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.floorPlanViewCached){t.next=5;break}return t.next=3,this.context.ifcCamera.cameraControls.reset(e);case 3:t.next=7;break;case 5:return t.next=7,this.context.ifcCamera.cameraControls.setLookAt(0,100,0,0,0,0,e);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"activateCurrentPlan",value:function(){if(!this.currentPlan)throw new Error("Current plan is not defined.");this.currentPlan.plane&&(this.currentPlan.plane.active=!0),this.context.ifcCamera.setNavigationMode(r.Plan),this.context.ifcCamera.projection=this.currentPlan.ortho?i.Orthographic:i.Perspective}},{key:"store3dCameraPosition",value:function(){this.context.getCamera().getWorldPosition(this.previousCamera),this.context.ifcCamera.cameraControls.getTarget(this.previousTarget),this.previousProjection=this.context.ifcCamera.projection}},{key:"getCurrentPlan",value:function(t,e){if(void 0===this.planLists[t])throw new Error("The specified plan is undefined!");var n=this.planLists[t];if(void 0===n[e])throw new Error("The specified plan is undefined!");if(!n[e])throw new Error("The specified plan name does not exist!");this.currentPlan=n[e]}},{key:"hidePreviousClippingPlane",value:function(){var t,e=null===(t=this.currentPlan)||void 0===t?void 0:t.plane;e&&(e.active=!1)}},{key:"getFloorplanName",value:function(t){var e,n,r,i;return(null===(n=null===(e=null===t||void 0===t?void 0:t.Name)||void 0===e?void 0:e.value)||void 0===n?void 0:n.length)?t.Name.value:(null===(i=null===(r=null===t||void 0===t?void 0:t.LongName)||void 0===r?void 0:r.value)||void 0===i?void 0:i.length)?t.LongName.value:t.GlobalId.value}}]),t}(),_=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).context=t,r}return(0,u.Z)(n,[{key:"dispose",value:function(){this.grid&&I(this.grid),this.grid=null}},{key:"setGrid",value:function(t,e,n,r){this.grid&&(this.grid.parent&&this.grid.removeFromParent(),this.grid.geometry.dispose()),this.grid=new p.GridHelper(t,e,n,r),this.grid.renderOrder=0,this.context.getScene().add(this.grid),this.context.renderer.postProduction.excludedItems.add(this.grid)}}]),n}(c),P=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).context=t,r}return(0,u.Z)(n,[{key:"dispose",value:function(){this.axes&&I(this.axes),this.axes=null}},{key:"setAxes",value:function(t){this.axes&&(this.axes.parent&&this.axes.removeFromParent(),this.axes.geometry.dispose()),this.axes=new p.AxesHelper(t),this.axes.material.depthTest=!1,this.axes.renderOrder=2,this.context.getScene().add(this.axes),this.context.renderer.postProduction.excludedItems.add(this.axes)}}]),n}(c),S=n(64081),R=n(73246),O=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.createElement("div");return(0,o.Z)(this,n),(t=e.call(this)).element=r,t.element.style.position="absolute",t.element.style.userSelect="none",t.element.setAttribute("draggable",!1),t.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))})),t}return(0,u.Z)(n,[{key:"copy",value:function(t,e){return(0,S.Z)((0,R.Z)(n.prototype),"copy",this).call(this,t,e),this.element=t.element.cloneNode(!0),this}}]),n}(p.Object3D);O.prototype.isCSS2DObject=!0;var w=new p.Vector3,M=new p.Matrix4,N=new p.Matrix4,L=new p.Vector3,b=new p.Vector3,k=(0,u.Z)((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o.Z)(this,t);var n,r,i,a,s=this,u={objects:new WeakMap},l=void 0!==e.element?e.element:document.createElement("div");function c(t,e,n){if(t.isCSS2DObject){t.onBeforeRender(s,e,n),w.setFromMatrixPosition(t.matrixWorld),w.applyMatrix4(N);var r=t.element;/apple/i.test(navigator.vendor)?r.style.transform="translate(-50%,-50%) translate("+Math.round(w.x*i+i)+"px,"+Math.round(-w.y*a+a)+"px)":r.style.transform="translate(-50%,-50%) translate("+(w.x*i+i)+"px,"+(-w.y*a+a)+"px)",r.style.display=t.visible&&w.z>=-1&&w.z<=1?"":"none";var o={distanceToCameraSquared:h(n,t)};u.objects.set(t,o),r.parentNode!==l&&l.appendChild(r),t.onAfterRender(s,e,n)}for(var f=0,d=t.children.length;f<d;f++)c(t.children[f],e,n)}function h(t,e){return L.setFromMatrixPosition(t.matrixWorld),b.setFromMatrixPosition(e.matrixWorld),L.distanceToSquared(b)}function f(t){var e=[];return t.traverse((function(t){t.isCSS2DObject&&e.push(t)})),e}function d(t){for(var e=f(t).sort((function(t,e){return u.objects.get(t).distanceToCameraSquared-u.objects.get(e).distanceToCameraSquared})),n=e.length,r=0,i=e.length;r<i;r++)e[r].element.style.zIndex=n-r}l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:n,height:r}},this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),M.copy(e.matrixWorldInverse),N.multiplyMatrices(e.projectionMatrix,M),c(t,t,e),d(t)},this.setSize=function(t,e){i=(n=t)/2,a=(r=e)/2,l.style.width=t+"px",l.style.height=e+"px"}})),D=function(){function t(e,n,r,i,a,s,u,l){var c=this;(0,o.Z)(this,t),this.root=new p.Group,this.endpointMeshes=[],this.scale=new p.Vector3(1,1,1),this.boundingSize=.05,this.context=e,this.labelClassName=u,this.start=n,this.end=r,this.scale=l,this.lineMaterial=i,this.endpointMaterial=a,this.length=this.getLength(),this.center=this.getCenter(),this.axis=(new p.BufferGeometry).setFromPoints([n,r]),this.line=new p.Line(this.axis,this.lineMaterial),this.root.add(this.line),this.endpoint=s,this.addEndpointMeshes(),this.textLabel=this.newText(),this.root.renderOrder=2,this.context.getScene().add(this.root),this.camera=this.context.getCamera(),this.context.ifcCamera.onChange.on((function(){return c.rescaleObjectsToCameraPosition()})),this.rescaleObjectsToCameraPosition()}return(0,u.Z)(t,[{key:"dispose",value:function(){this.removeFromScene(),this.context=null,I(this.root),this.root=null,I(this.line),this.line=null,this.endpointMeshes.forEach((function(t){return I(t)})),this.endpointMeshes.length=0,this.axis.dispose(),this.axis=null,this.endpoint.dispose(),this.endpoint=null,this.textLabel.removeFromParent(),this.textLabel.element.remove(),this.textLabel=null,this.lineMaterial.dispose(),this.lineMaterial=null,this.endpointMaterial.dispose(),this.endpointMaterial=null,this.boundingMesh&&(I(this.boundingMesh),this.boundingMesh=null)}},{key:"boundingBox",get:function(){return this.boundingMesh}},{key:"text",get:function(){return this.textLabel}},{key:"dimensionColor",set:function(t){this.endpointMaterial.color=t,this.lineMaterial.color=t}},{key:"visibility",set:function(t){this.root.visible=t,this.textLabel.visible=t}},{key:"endpointGeometry",set:function(t){var e=this;this.endpointMeshes.forEach((function(t){return e.root.remove(t)})),this.endpointMeshes=[],this.endpoint=t,this.addEndpointMeshes()}},{key:"endpointScale",set:function(t){this.scale=t,this.endpointMeshes.forEach((function(e){return e.scale.set(t.x,t.y,t.z)}))}},{key:"endPoint",set:function(t){if(this.end=t,this.axis){var e=this.axis.attributes.position;e&&(e.setXYZ(1,t.x,t.y,t.z),e.needsUpdate=!0,this.endpointMeshes[1].position.set(t.x,t.y,t.z),this.endpointMeshes[1].lookAt(this.start),this.endpointMeshes[0].lookAt(this.end),this.length=this.getLength(),this.textLabel.element.textContent=this.getTextContent(),this.center=this.getCenter(),this.textLabel.position.set(this.center.x,this.center.y,this.center.z),this.line.computeLineDistances())}}},{key:"removeFromScene",value:function(){this.context.getScene().remove(this.root),this.root.remove(this.textLabel)}},{key:"createBoundingBox",value:function(){this.boundingMesh=this.newBoundingBox(),this.setupBoundingBox(this.end)}},{key:"rescaleObjectsToCameraPosition",value:function(){var e=this;this.endpointMeshes.forEach((function(n){return e.rescaleMesh(n,t.scaleFactor)})),this.boundingMesh&&this.rescaleMesh(this.boundingMesh,this.boundingSize,!0,!0,!1)}},{key:"rescaleMesh",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=(new p.Vector3).subVectors(t.position,this.camera.position).length();a*=e;var s=n?a:1,o=r?a:1,u=i?a:1;t.scale.set(s,o,u)}},{key:"addEndpointMeshes",value:function(){this.newEndpointMesh(this.start,this.end),this.newEndpointMesh(this.end,this.start)}},{key:"newEndpointMesh",value:function(t,e){var n=new p.Mesh(this.endpoint,this.endpointMaterial);n.position.set(t.x,t.y,t.z),n.scale.set(this.scale.x,this.scale.y,this.scale.z),n.lookAt(e),this.endpointMeshes.push(n),this.root.add(n)}},{key:"newText",value:function(){var t=document.createElement("div");t.className=this.labelClassName,t.textContent=this.getTextContent();var e=new O(t);return e.position.set(this.center.x,this.center.y,this.center.z),this.root.add(e),e}},{key:"getTextContent",value:function(){return"".concat(this.length/t.scale," ").concat(t.units)}},{key:"newBoundingBox",value:function(){var t=new p.BoxGeometry(1,1,this.length);return new p.Mesh(t)}},{key:"setupBoundingBox",value:function(t){this.boundingMesh&&(this.boundingMesh.position.set(this.center.x,this.center.y,this.center.z),this.boundingMesh.lookAt(t),this.boundingMesh.visible=!1,this.root.add(this.boundingMesh))}},{key:"getLength",value:function(){return parseFloat(this.start.distanceTo(this.end).toFixed(2))}},{key:"getCenter",value:function(){var t=this.end.clone().sub(this.start),e=.5*t.length();return t=t.normalize().multiplyScalar(e),this.start.clone().add(t)}}]),t}();D.scaleFactor=.1,D.scale=1,D.units="m";var U=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;(0,o.Z)(this,n),(r=e.call(this,t)).dimensions=[],r.labelClassName="ifcjs-dimension-label",r.previewClassName="ifcjs-dimension-preview",r.enabled=!1,r.preview=!1,r.dragging=!1,r.snapDistance=.25,r.baseScale=new p.Vector3(1,1,1),r.lineMaterial=new p.LineDashedMaterial({color:0,linewidth:2,depthTest:!1,dashSize:.2,gapSize:.2}),r.endpointsMaterial=new p.MeshBasicMaterial({color:0,depthTest:!1}),r.startPoint=new p.Vector3,r.endPoint=new p.Vector3,r.context=t,r.endpoint=n.getDefaultEndpointGeometry();var i=document.createElement("div");return i.className=r.previewClassName,r.previewElement=new O(i),r.previewElement.visible=!1,r}return(0,u.Z)(n,[{key:"dispose",value:function(){this.context=null,this.dimensions.forEach((function(t){return t.dispose()})),this.dimensions=null,this.currentDimension=null,this.endpoint.dispose(),this.endpoint=null,this.previewElement.removeFromParent(),this.previewElement.element.remove(),this.previewElement=null}},{key:"update",value:function(t){if(this.enabled&&this.preview){var e=this.context.castRayIfc();if(this.previewElement.visible=!!e,!e)return;this.previewElement.visible=!0;var n=this.getClosestVertex(e);if(this.previewElement.visible=!!n,!n)return;this.previewElement.position.set(n.x,n.y,n.z),this.dragging&&this.drawInProcess()}}},{key:"setArrow",value:function(t,e){this.endpoint=n.getDefaultEndpointGeometry(t,e)}},{key:"setPreviewElement",value:function(t){this.previewElement=new O(t)}},{key:"active",get:function(){return this.enabled},set:function(t){this.enabled=t,this.dimensions.forEach((function(e){e.visibility=t}))}},{key:"previewActive",get:function(){return this.preview},set:function(t){this.preview=t;var e=this.context.getScene();this.preview?e.add(this.previewElement):e.remove(this.previewElement)}},{key:"previewObject",get:function(){return this.previewElement}},{key:"dimensionsColor",set:function(t){this.endpointsMaterial.color=t,this.lineMaterial.color=t}},{key:"dimensionsWidth",set:function(t){this.lineMaterial.linewidth=t}},{key:"endpointGeometry",set:function(t){this.dimensions.forEach((function(e){e.endpointGeometry=t}))}},{key:"endpointScaleFactor",set:function(t){D.scaleFactor=t}},{key:"endpointScale",set:function(t){this.baseScale=t,this.dimensions.forEach((function(e){e.endpointScale=t}))}},{key:"create",value:function(){this.enabled&&(this.dragging?this.drawEnd():this.drawStart())}},{key:"createInPlane",value:function(t){this.enabled&&(this.dragging?this.drawEnd():this.drawStartInPlane(t))}},{key:"delete",value:function(){if(this.enabled&&0!==this.dimensions.length){var t=this.getBoundingBoxes(),e=this.context.castRay(t);if(0!==e.length){var n=this.dimensions.find((function(t){return t.boundingBox===e[0].object}));if(n){var r=this.dimensions.indexOf(n);this.dimensions.splice(r,1),n.removeFromScene()}}}}},{key:"deleteAll",value:function(){this.dimensions.forEach((function(t){t.removeFromScene()})),this.dimensions=[]}},{key:"cancelDrawing",value:function(){var t;this.currentDimension&&(this.dragging=!1,null===(t=this.currentDimension)||void 0===t||t.removeFromScene(),this.currentDimension=void 0)}},{key:"drawStart",value:function(){this.dragging=!0;var t=this.context.castRayIfc();if(t){var e=this.getClosestVertex(t);e&&(this.startPoint=e)}}},{key:"drawStartInPlane",value:function(t){this.dragging=!0;var e=this.context.castRay([t]);!e||e.length<1||(this.startPoint=e[0].point)}},{key:"drawInProcess",value:function(){var t=this.context.castRayIfc();if(t){var e=this.getClosestVertex(t);e&&(this.endPoint=e,this.currentDimension||(this.currentDimension=this.drawDimension()),this.currentDimension.endPoint=this.endPoint)}}},{key:"drawEnd",value:function(){this.currentDimension&&(this.currentDimension.createBoundingBox(),this.dimensions.push(this.currentDimension),this.currentDimension=void 0,this.dragging=!1)}},{key:"getDimensionsLines",get:function(){return this.dimensions}},{key:"drawDimension",value:function(){return new D(this.context,this.startPoint,this.endPoint,this.lineMaterial,this.endpointsMaterial,this.endpoint,this.labelClassName,this.baseScale)}},{key:"getBoundingBoxes",value:function(){return this.dimensions.map((function(t){return t.boundingBox})).filter((function(t){return void 0!==t}))}},{key:"getClosestVertex",value:function(t){var e=this,n=new p.Vector3,r=!1,i=Number.MAX_SAFE_INTEGER,a=this.getVertices(t);return null===a||void 0===a||a.forEach((function(a){if(a){var s=t.point.distanceTo(a);s>i||s>e.snapDistance||(r=!0,n=a,i=t.point.distanceTo(a))}})),r?n:t.point}},{key:"getVertices",value:function(t){var e=t.object;if(!t.face||!e)return null;var n=e.geometry;return[this.getVertex(t.face.a,n),this.getVertex(t.face.b,n),this.getVertex(t.face.c,n)]}},{key:"getVertex",value:function(t,e){if(void 0===t)return null;var n=e.attributes.position;return new p.Vector3(n.getX(t),n.getY(t),n.getZ(t))}}],[{key:"getDefaultEndpointGeometry",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.02,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.05,n=new p.ConeGeometry(e,t);return n.translate(0,-t/2,0),n.rotateX(-Math.PI/2),n}}]),n}(c),Z=function(){function t(e){(0,o.Z)(this,t),this.context=e,this.threshold=30,this.edges={}}return(0,u.Z)(t,[{key:"dispose",value:function(){Object.values(this.edges).forEach((function(t){I(t.edges),Array.isArray(t.originalMaterials)?t.originalMaterials.forEach((function(t){return t.dispose()})):t.originalMaterials.dispose(),t.baseMaterial&&t.baseMaterial.dispose()})),this.edges=null}},{key:"getAll",value:function(){return Object.keys(this.edges)}},{key:"get",value:function(t){return this.edges[t]}},{key:"create",value:function(t,e,n,r){var i=this.context.items.ifcModels.find((function(t){return t.modelID===e}));i&&this.createFromMesh(t,i,n,r)}},{key:"createFromSubset",value:function(t,e,n,r){this.createFromMesh(t,e,n,r)}},{key:"createFromMesh",value:function(t,e,n,r){var i=this.context.getClippingPlanes();n.clippingPlanes=i,r&&(r.clippingPlanes=i),this.setupModelMaterials(e);var a=new p.EdgesGeometry(e.geometry,this.threshold);n.clippingPlanes=this.context.getClippingPlanes(),this.edges[t]={edges:new p.LineSegments(a,n),originalMaterials:e.material,baseMaterial:r,model:e,active:!1}}},{key:"toggle",value:function(t,e){var n=this.edges[t];if(n){if(void 0===e&&(e=!n.active),n.active=e,e){var r=n.model.position,i=n.model.rotation;return n.edges.position.set(r.x,r.y,r.z),n.edges.rotation.set(i.x,i.y,i.z),n.baseMaterial&&(n.model.material=n.baseMaterial),void this.context.getScene().add(n.edges)}n.baseMaterial&&(n.model.material=n.originalMaterials),n.edges.removeFromParent()}}},{key:"setupModelMaterials",value:function(e){Array.isArray(e.material)?e.material.forEach((function(e){return t.setupModelMaterial(e)})):t.setupModelMaterial(e.material)}}],[{key:"setupModelMaterial",value:function(t){t.polygonOffset=!0,t.polygonOffsetFactor=1,t.polygonOffsetUnits=1}}]),t}(),B=n(96090),G=n(26663),Y=n(30070),V=n(2721),z=n(63931),H=n(17548),X="IfcManager is null!",W=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(){var t;return(0,o.Z)(this,n),(t=e.apply(this,arguments)).modelID=n.modelIdCounter++,t.ifcManager=null,t.mesh=(0,B.Z)(t),t}return(0,u.Z)(n,[{key:"setIFCManager",value:function(t){this.ifcManager=t}},{key:"setWasmPath",value:function(t){if(null===this.ifcManager)throw new Error(X);this.ifcManager.setWasmPath(t)}},{key:"close",value:function(t){if(null===this.ifcManager)throw new Error(X);this.ifcManager.close(this.modelID,t)}},{key:"getExpressId",value:function(t,e){if(null===this.ifcManager)throw new Error(X);return this.ifcManager.getExpressId(t,e)}},{key:"getAllItemsOfType",value:function(t,e){if(null===this.ifcManager)throw new Error(X);return this.ifcManager.getAllItemsOfType(this.modelID,t,e)}},{key:"getItemProperties",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===this.ifcManager)throw new Error(X);return this.ifcManager.getItemProperties(this.modelID,t,e)}},{key:"getPropertySets",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===this.ifcManager)throw new Error(X);return this.ifcManager.getPropertySets(this.modelID,t,e)}},{key:"getTypeProperties",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===this.ifcManager)throw new Error(X);return this.ifcManager.getTypeProperties(this.modelID,t,e)}},{key:"getIfcType",value:function(t){if(null===this.ifcManager)throw new Error(X);return this.ifcManager.getIfcType(this.modelID,t)}},{key:"getSpatialStructure",value:function(){if(null===this.ifcManager)throw new Error(X);return this.ifcManager.getSpatialStructure(this.modelID)}},{key:"getSubset",value:function(t){if(null===this.ifcManager)throw new Error(X);return this.ifcManager.getSubset(this.modelID,t)}},{key:"removeSubset",value:function(t,e){if(null===this.ifcManager)throw new Error(X);this.ifcManager.removeSubset(this.modelID,t,e)}},{key:"createSubset",value:function(t){if(null===this.ifcManager)throw new Error(X);var e=(0,z.Z)((0,z.Z)({},t),{},{modelID:this.modelID});return this.ifcManager.createSubset(e)}}],[{key:"dispose",value:function(){n.modelIdCounter=0}}]),n}(p.Mesh);W.modelIdCounter=0;var Q,j,q=function(){function t(e,n){var r;(0,o.Z)(this,t),this.state=e,this.BVH=n,this.loadedModels=0,this.optionalCategories=(r={},(0,V.Z)(r,C.IFCSPACE,!0),(0,V.Z)(r,C.IFCOPENINGELEMENT,!1),r),this.geometriesByMaterials={},this.loadingState={total:0,current:0,step:.1},this.currentWebIfcID=-1,this.currentModelID=-1}return(0,u.Z)(t,[{key:"setupOptionalCategories",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.optionalCategories=e;case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"parse",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==this.state.api.wasmModule){t.next=3;break}return t.next=3,this.state.api.Init();case 3:return t.next=5,this.newIfcModel(e);case 5:if(this.loadedModels++,!n){t.next=9;break}return t.next=9,this.state.api.SetGeometryTransformation(this.currentWebIfcID,n);case 9:return t.abrupt("return",this.loadAllGeometry(this.currentWebIfcID));case 10:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getAndClearErrors",value:function(t){}},{key:"notifyProgress",value:function(t,e){this.state.onProgress&&this.state.onProgress({loaded:t,total:e})}},{key:"newIfcModel",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Uint8Array(e),t.next=3,this.state.api.OpenModel(n,this.state.webIfcSettings);case 3:this.currentWebIfcID=t.sent,this.currentModelID=this.state.useJSON?this.loadedModels:this.currentWebIfcID,this.state.models[this.currentModelID]={modelID:this.currentModelID,mesh:{},types:{},jsonData:{}};case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadAllGeometry",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.addOptionalCategories(e),t.next=3,this.initializeLoadingState(e);case 3:return this.state.api.StreamAllMeshes(e,(function(t){o.updateLoadingState(),o.streamMesh(e,t)})),this.notifyLoadingEnded(),n=[],r=[],Object.keys(this.geometriesByMaterials).forEach((function(t){var e=o.geometriesByMaterials[t].geometries,i=(0,H.qf)(e);r.push(o.geometriesByMaterials[t].material),n.push(i)})),i=(0,H.qf)(n,!0),this.cleanUpGeometryMemory(n),this.BVH&&this.BVH.applyThreeMeshBVH(i),s=new W(i,r),this.state.models[this.currentModelID].mesh=s,t.abrupt("return",s);case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"initializeLoadingState",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.state.api.GetLineIDsWithType(e,C.IFCPRODUCTDEFINITIONSHAPE);case 2:n=t.sent,this.loadingState.total=n.size(),this.loadingState.current=0,this.loadingState.step=.1;case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"notifyLoadingEnded",value:function(){this.notifyProgress(this.loadingState.total,this.loadingState.total)}},{key:"updateLoadingState",value:function(){if(Math.min(this.loadingState.current++,this.loadingState.total)/this.loadingState.total>=this.loadingState.step){var t=Math.ceil(this.loadingState.total*this.loadingState.step);this.notifyProgress(t,this.loadingState.total),this.loadingState.step+=.1}}},{key:"addOptionalCategories",value:function(t){var e=this,n=[];for(var r in this.optionalCategories)if(this.optionalCategories.hasOwnProperty(r)){var i=parseInt(r);this.optionalCategories[i]&&n.push(i)}this.state.api.StreamAllMeshesWithTypes(this.currentWebIfcID,n,(function(n){e.streamMesh(t,n)}))}},{key:"streamMesh",value:function(t,e){for(var n=e.geometries,r=n.size(),i=0;i<r;i++){var a=n.get(i),s=this.getPlacedGeometry(t,e.expressID,a),o=s.geometry.applyMatrix4(s.matrix);this.storeGeometryByMaterial(a.color,o)}}},{key:"getPlacedGeometry",value:function(t,e,n){var r=this.getBufferGeometry(t,e,n),i=new p.Mesh(r);return i.matrix=this.getMeshMatrix(n.flatTransformation),i.matrixAutoUpdate=!1,i}},{key:"getBufferGeometry",value:function(t,e,n){var r=this.state.api.GetGeometry(t,n.geometryExpressID),i=this.state.api.GetVertexArray(r.GetVertexData(),r.GetVertexDataSize()),a=this.state.api.GetIndexArray(r.GetIndexData(),r.GetIndexDataSize()),s=this.ifcGeometryToBuffer(e,i,a);return r.delete(),s}},{key:"storeGeometryByMaterial",value:function(t,e){var n="".concat(t.x).concat(t.y).concat(t.z).concat(t.w);if(this.geometriesByMaterials[n])this.geometriesByMaterials[n].geometries.push(e);else{var r=new p.Color(t.x,t.y,t.z),i=new p.MeshLambertMaterial({color:r,side:p.DoubleSide});i.transparent=1!==t.w,i.transparent&&(i.opacity=t.w),this.geometriesByMaterials[n]={material:i,geometries:[e]}}}},{key:"getMeshMatrix",value:function(t){var e=new p.Matrix4;return e.fromArray(t),e}},{key:"ifcGeometryToBuffer",value:function(t,e,n){for(var r=new p.BufferGeometry,i=new Float32Array(e.length/2),a=new Float32Array(e.length/2),s=new Uint32Array(e.length/6),o=0;o<e.length;o+=6)i[o/2]=e[o],i[o/2+1]=e[o+1],i[o/2+2]=e[o+2],a[o/2]=e[o+3],a[o/2+1]=e[o+4],a[o/2+2]=e[o+5],s[o/6]=t;return r.setAttribute("position",new p.BufferAttribute(i,3)),r.setAttribute("normal",new p.BufferAttribute(a,3)),r.setAttribute("expressID",new p.BufferAttribute(s,1)),r.setIndex(new p.BufferAttribute(n,1)),r}},{key:"cleanUpGeometryMemory",value:function(t){var e=this;t.forEach((function(t){return t.dispose()})),Object.keys(this.geometriesByMaterials).forEach((function(t){var n=e.geometriesByMaterials[t];n.geometries.forEach((function(t){return t.dispose()})),n.geometries=[],n.material=null})),this.geometriesByMaterials={}}}]),t}(),K=function(){function t(e){(0,o.Z)(this,t),this.state=e,this.map={}}return(0,u.Z)(t,[{key:"generateGeometryIndexMap",value:function(t){if(!this.map[t]){var e,n=this.getGeometry(t),r=this.newItemsMap(t,n),i=(0,Y.Z)(n.groups);try{for(i.s();!(e=i.n()).done;){var a=e.value;this.fillItemsWithGroupInfo(a,n,r)}}catch(s){i.e(s)}finally{i.f()}}}},{key:"getSubsetID",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"DEFAULT",r=t,i=e?e.uuid:"DEFAULT";return"".concat(r," - ").concat(i," - ").concat(n)}},{key:"dispose",value:function(){Object.values(this.map).forEach((function(t){t.indexCache=null,t.map=null})),this.map=null}},{key:"getGeometry",value:function(t){var e=this.state.models[t].mesh.geometry;if(!e)throw new Error("Model without geometry.");if(!e.index)throw new Error("Geometry must be indexed");return e}},{key:"newItemsMap",value:function(t,e){var n=e.index.array;return this.map[t]={indexCache:n.slice(0,e.index.array.length),map:new Map},this.map[t]}},{key:"fillItemsWithGroupInfo",value:function(t,e,n){for(var r=-1,i=t.materialIndex,a=t.start,s=a+t.count-1,o=-1,u=-1,l=a;l<=s;l++){var c=e.index.array[l],h=e.attributes.expressID.array[c];if(-1===r&&(r=h,o=l),l===s){this.getMaterialStore(n.map,h,i).push(o,s);break}if(r!==h)u=l-1,this.getMaterialStore(n.map,r,i).push(o,u),r=h,o=l}}},{key:"getMaterialStore",value:function(t,e,n){void 0===t.get(e)&&t.set(e,{});var r=t.get(e);if(void 0===r)throw new Error("Geometry map generation error");return void 0===r[n]&&(r[n]=[]),r[n]}}]),t}(),J=function(){function t(){(0,o.Z)(this,t)}return(0,u.Z)(t,null,[{key:"getAllIndicesOfGroup",value:function(e,n,r,i){var a,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=[],u=(0,Y.Z)(n);try{for(u.s();!(a=u.n()).done;){var l=a.value,c=i.map.get(l);if(c){var h=c[r];h&&t.getIndexChunk(h,o,r,i,s)}}}catch(f){u.e(f)}finally{u.f()}return o}},{key:"getIndexChunk",value:function(t,e,n,r,i){for(var a=t.length/2,s=0;s<a;s++)for(var o=2*s,u=t[o],l=t[o+1],c=u;c<=l;c++)i?e.push(r.indexCache[c]):(e[n]||(e[n]=[]),e[n].push(r.indexCache[c]))}}]),t}(),$=function(){function t(e,n,r,i){(0,o.Z)(this,t),this.state=e,this.items=n,this.subsets=r,this.BVH=i,this.tempIndex=[]}return(0,u.Z)(t,[{key:"createSubset",value:function(t,e){var n=this;this.items.map[t.modelID]||this.items.generateGeometryIndexMap(t.modelID),this.subsets[e]||this.initializeSubset(t,e),this.filterIndices(t,e),this.constructSubsetByMaterial(t,e),t.ids.forEach((function(t){return n.subsets[e].ids.add(t)})),this.subsets[e].mesh.geometry.setIndex(this.tempIndex),this.tempIndex.length=0;var r=this.subsets[e].mesh;return t.applyBVH&&this.BVH.applyThreeMeshBVH(r.geometry),t.scene&&t.scene.add(r),this.subsets[e].mesh}},{key:"dispose",value:function(){this.tempIndex=[]}},{key:"initializeSubset",value:function(t,e){var n=this.state.models[t.modelID].mesh,r=new p.BufferGeometry;this.initializeSubsetAttributes(r,n),t.material||this.initializeSubsetGroups(r,n);var i=new p.Mesh(r,t.material||n.material);i.modelID=t.modelID;var a=Boolean(t.applyBVH);this.subsets[e]={ids:new Set,mesh:i,bvh:a},n.add(i)}},{key:"initializeSubsetAttributes",value:function(t,e){t.setAttribute("position",e.geometry.attributes.position),t.setAttribute("normal",e.geometry.attributes.normal),t.setAttribute("expressID",e.geometry.attributes.expressID),t.setIndex([])}},{key:"initializeSubsetGroups",value:function(t,e){t.groups=JSON.parse(JSON.stringify(e.geometry.groups)),this.resetGroups(t)}},{key:"filterIndices",value:function(t,e){var n=this.subsets[e].mesh.geometry;if(t.removePrevious)return n.setIndex([]),void this.resetGroups(n);var r=n.index.array,i=this.subsets[e].ids;t.ids=t.ids.filter((function(t){return!i.has(t)})),this.tempIndex=Array.from(r)}},{key:"constructSubsetByMaterial",value:function(t,e){for(var n=this.state.models[t.modelID].mesh,r={count:0},i=0;i<n.geometry.groups.length;i++)this.insertNewIndices(t,e,i,r)}},{key:"insertNewIndices",value:function(t,e,n,r){var i=this,a=this.items.map[t.modelID],s=J.getAllIndicesOfGroup(t.modelID,t.ids,n,a);t.material?s.forEach((function(t){return i.tempIndex.push(t)})):this.insertIndicesAtGroup(e,s,n,r)}},{key:"insertIndicesAtGroup",value:function(t,e,n,r){var i=this.getCurrentGroup(t,n);i.start+=r.count;var a=i.start+i.count;if(r.count+=e.length,e.length>0){var s=a,o=this.tempIndex.slice(0,s),u=this.tempIndex.slice(s);this.tempIndex=Array.prototype.concat.apply([],[o,e,u]),i.count+=e.length}}},{key:"getCurrentGroup",value:function(t,e){return this.subsets[t].mesh.geometry.groups[e]}},{key:"resetGroups",value:function(t){t.groups.forEach((function(t){t.start=0,t.count=0}))}}]),t}(),tt=function(){function t(e,n){(0,o.Z)(this,t),this.subsets={},this.state=e,this.items=new K(e),this.BVH=n,this.subsetCreator=new $(e,this.items,this.subsets,this.BVH)}return(0,u.Z)(t,[{key:"getAllSubsets",value:function(){return this.subsets}},{key:"getSubset",value:function(t,e,n){var r=this.getSubsetID(t,e,n);return this.subsets[r].mesh}},{key:"removeSubset",value:function(t,e,n){var r=this.getSubsetID(t,e,n),i=this.subsets[r];i&&(i.mesh.parent&&i.mesh.removeFromParent(),i.mesh.geometry.attributes={},i.mesh.geometry.index=null,i.mesh.geometry.dispose(),i.mesh.geometry=null,delete this.subsets[r])}},{key:"createSubset",value:function(t){var e=this.getSubsetID(t.modelID,t.material,t.customID);return this.subsetCreator.createSubset(t,e)}},{key:"removeFromSubset",value:function(t,e,n,r){var i=this.getSubsetID(t,r,n);if(this.subsets[i]){var a=this.subsets[i].ids;return e.forEach((function(t){a.has(t)&&a.delete(t)})),this.createSubset({modelID:t,removePrevious:!0,material:r,customID:n,applyBVH:this.subsets[i].bvh,ids:Array.from(a),scene:this.subsets[i].mesh.parent})}}},{key:"clearSubset",value:function(t,e,n){var r=this.getSubsetID(t,n,e);this.subsets[r]&&(this.subsets[r].ids.clear(),this.getSubset(t,n,e).geometry.setIndex([]))}},{key:"dispose",value:function(){this.items.dispose(),this.subsetCreator.dispose(),Object.values(this.subsets).forEach((function(t){t.ids=null,t.mesh.removeFromParent();var e=t.mesh.material;Array.isArray(e)?e.forEach((function(t){return t.dispose()})):e.dispose(),t.mesh.geometry.index=null,t.mesh.geometry.dispose();var n=t.mesh.geometry;n.disposeBoundsTree&&n.disposeBoundsTree(),t.mesh=null})),this.subsets=null}},{key:"getSubsetID",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"DEFAULT",r=t,i=e?e.uuid:"DEFAULT";return"".concat(r," - ").concat(i," - ").concat(n)}}]),t}(),et={aggregates:{name:C.IFCRELAGGREGATES,relating:"RelatingObject",related:"RelatedObjects",key:"children"},spatial:{name:C.IFCRELCONTAINEDINSPATIALSTRUCTURE,relating:"RelatingStructure",related:"RelatedElements",key:"children"},psets:{name:C.IFCRELDEFINESBYPROPERTIES,relating:"RelatingPropertyDefinition",related:"RelatedObjects",key:"hasPsets"},materials:{name:C.IFCRELASSOCIATESMATERIAL,relating:"RelatingMaterial",related:"RelatedObjects",key:"hasMaterial"},type:{name:C.IFCRELDEFINESBYTYPE,relating:"RelatingType",related:"RelatedObjects",key:"hasType"}},nt=function(){function t(e){(0,o.Z)(this,t),this.state=e}return(0,u.Z)(t,[{key:"getPropertySets",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],t.next=3,this.getProperty(e,n,r,et.psets);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getTypeProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],t.next=3,this.getProperty(e,n,r,et.type);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getMaterialsProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],t.next=3,this.getProperty(e,n,r,et.materials);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getSpatialNode",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r,i){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getChildren(e,n,r,et.aggregates,i);case 2:return t.next=4,this.getChildren(e,n,r,et.spatial,i);case 4:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i){return t.apply(this,arguments)}}()},{key:"getChildren",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r,i,s){var o,u,l,c,h,f,d;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!=(o=r[n.expressID])){t.next=3;break}return t.abrupt("return");case 3:u=i.key,l=[],c=0;case 6:if(!(c<o.length)){t.next=20;break}if(h=o[c],f=this.newNode(e,h),!s){t.next=14;break}return t.next=12,this.getItemProperties(e,f.expressID);case 12:d=t.sent,f=(0,z.Z)((0,z.Z)({},d),f);case 14:return t.next=16,this.getSpatialNode(e,f,r,s);case 16:l.push(f);case 17:c++,t.next=6;break;case 20:n[u]=l;case 21:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i,a){return t.apply(this,arguments)}}()},{key:"newNode",value:function(t,e){return{expressID:e,type:this.getNodeType(t,e),children:[]}}},{key:"getSpatialTreeChunks",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},t.next=3,this.getChunks(e,n,et.aggregates);case 3:return t.next=5,this.getChunks(e,n,et.spatial);case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"saveChunk",value:function(t,e,n){var r=n[e.relating].value,i=n[e.related].map((function(t){return t.value}));void 0==t[r]?t[r]=i:t[r]=t[r].concat(i)}},{key:"getRelated",value:function(t,e,n){var r=t[e.relating];if(!r)return console.warn("The object with ID ".concat(t.expressID," has a broken reference."));Array.isArray(r)?r.forEach((function(t){return n.push(t.value)})):n.push(r.value)}},{key:"getProperty",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.length>2&&void 0!==r[2]&&r[2],r.length>3?r[3]:void 0;case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getChunks",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getItemProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r.length>2&&void 0!==r[2]&&r[2];case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getNodeType",value:function(t,e){}}],[{key:"isRelated",value:function(t,e,n){var r=e[n.related];return Array.isArray(r)?r.map((function(t){return t.value})).includes(t):r.value===t}},{key:"newIfcProject",value:function(t){return{expressID:t,type:"IFCPROJECT",children:[]}}}]),t}(),rt={103090709:"IFCPROJECT",4097777520:"IFCSITE",4031249490:"IFCBUILDING",3124254112:"IFCBUILDINGSTOREY",3856911033:"IFCSPACE",1674181508:"IFCANNOTATION",25142252:"IFCCONTROLLER",32344328:"IFCBOILER",76236018:"IFCLAMP",90941305:"IFCPUMP",177149247:"IFCAIRTERMINALBOX",182646315:"IFCFLOWINSTRUMENT",263784265:"IFCFURNISHINGELEMENT",264262732:"IFCELECTRICGENERATOR",277319702:"IFCAUDIOVISUALAPPLIANCE",310824031:"IFCPIPEFITTING",331165859:"IFCSTAIR",342316401:"IFCDUCTFITTING",377706215:"IFCMECHANICALFASTENER",395920057:"IFCDOOR",402227799:"IFCELECTRICMOTOR",413509423:"IFCSYSTEMFURNITUREELEMENT",484807127:"IFCEVAPORATOR",486154966:"IFCWINDOWSTANDARDCASE",629592764:"IFCLIGHTFIXTURE",630975310:"IFCUNITARYCONTROLELEMENT",635142910:"IFCCABLECARRIERFITTING",639361253:"IFCCOIL",647756555:"IFCFASTENER",707683696:"IFCFLOWSTORAGEDEVICE",738039164:"IFCPROTECTIVEDEVICE",753842376:"IFCBEAM",812556717:"IFCTANK",819412036:"IFCFILTER",843113511:"IFCCOLUMN",862014818:"IFCELECTRICDISTRIBUTIONBOARD",900683007:"IFCFOOTING",905975707:"IFCCOLUMNSTANDARDCASE",926996030:"IFCVOIDINGFEATURE",979691226:"IFCREINFORCINGBAR",987401354:"IFCFLOWSEGMENT",1003880860:"IFCELECTRICTIMECONTROL",1051757585:"IFCCABLEFITTING",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1073191201:"IFCMEMBER",1095909175:"IFCBUILDINGELEMENTPROXY",1156407060:"IFCPLATESTANDARDCASE",1162798199:"IFCSWITCHINGDEVICE",1329646415:"IFCSHADINGDEVICE",1335981549:"IFCDISCRETEACCESSORY",1360408905:"IFCDUCTSILENCER",1404847402:"IFCSTACKTERMINAL",1426591983:"IFCFIRESUPPRESSIONTERMINAL",1437502449:"IFCMEDICALDEVICE",1509553395:"IFCFURNITURE",1529196076:"IFCSLAB",1620046519:"IFCTRANSPORTELEMENT",1634111441:"IFCAIRTERMINAL",1658829314:"IFCENERGYCONVERSIONDEVICE",1677625105:"IFCCIVILELEMENT",1687234759:"IFCPILE",1904799276:"IFCELECTRICAPPLIANCE",1911478936:"IFCMEMBERSTANDARDCASE",1945004755:"IFCDISTRIBUTIONELEMENT",1973544240:"IFCCOVERING",1999602285:"IFCSPACEHEATER",2016517767:"IFCROOF",2056796094:"IFCAIRTOAIRHEATRECOVERY",2058353004:"IFCFLOWCONTROLLER",2068733104:"IFCHUMIDIFIER",2176052936:"IFCJUNCTIONBOX",2188021234:"IFCFLOWMETER",2223149337:"IFCFLOWTERMINAL",2262370178:"IFCRAILING",2272882330:"IFCCONDENSER",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",2320036040:"IFCREINFORCINGMESH",2347447852:"IFCTENDONANCHOR",2391383451:"IFCVIBRATIONISOLATOR",2391406946:"IFCWALL",2474470126:"IFCMOTORCONNECTION",2769231204:"IFCVIRTUALELEMENT",2814081492:"IFCENGINE",2906023776:"IFCBEAMSTANDARDCASE",2938176219:"IFCBURNER",2979338954:"IFCBUILDINGELEMENTPART",3024970846:"IFCRAMP",3026737570:"IFCTUBEBUNDLE",3027962421:"IFCSLABSTANDARDCASE",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",3053780830:"IFCSANITARYTERMINAL",3079942009:"IFCOPENINGSTANDARDCASE",3087945054:"IFCALARM",3101698114:"IFCSURFACEFEATURE",3127900445:"IFCSLABELEMENTEDCASE",3132237377:"IFCFLOWMOVINGDEVICE",3171933400:"IFCPLATE",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",3242481149:"IFCDOORSTANDARDCASE",3283111854:"IFCRAMPFLIGHT",3296154744:"IFCCHIMNEY",3304561284:"IFCWINDOW",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",3319311131:"IFCHEATEXCHANGER",3415622556:"IFCFAN",3420628829:"IFCSOLARDEVICE",3493046030:"IFCGEOGRAPHICELEMENT",3495092785:"IFCCURTAINWALL",3508470533:"IFCFLOWTREATMENTDEVICE",3512223829:"IFCWALLSTANDARDCASE",3518393246:"IFCDUCTSEGMENT",3571504051:"IFCCOMPRESSOR",3588315303:"IFCOPENINGELEMENT",3612865200:"IFCPIPESEGMENT",3640358203:"IFCCOOLINGTOWER",3651124850:"IFCPROJECTIONELEMENT",3694346114:"IFCOUTLET",3747195512:"IFCEVAPORATIVECOOLER",3758799889:"IFCCABLECARRIERSEGMENT",3824725483:"IFCTENDON",3825984169:"IFCTRANSFORMER",3902619387:"IFCCHILLER",4074379575:"IFCDAMPER",4086658281:"IFCSENSOR",4123344466:"IFCELEMENTASSEMBLY",4136498852:"IFCCOOLEDBEAM",4156078855:"IFCWALLELEMENTEDCASE",4175244083:"IFCINTERCEPTOR",4207607924:"IFCVALVE",4217484030:"IFCCABLESEGMENT",4237592921:"IFCWASTETERMINAL",4252922144:"IFCSTAIRFLIGHT",4278956645:"IFCFLOWFITTING",4288193352:"IFCACTUATOR",4292641817:"IFCUNITARYEQUIPMENT",3009204131:"IFCGRID"},it=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,u.Z)(n,[{key:"getItemProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],t.abrupt("return",this.state.api.GetLine(e,n,r));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getSpatialStructure",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,r){var i,s,o,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSpatialTreeChunks(e);case 2:return i=t.sent,t.next=5,this.state.api.GetLineIDsWithType(e,C.IFCPROJECT);case 5:return s=t.sent,o=s.get(0),u=n.newIfcProject(o),t.next=10,this.getSpatialNode(e,u,i,r);case 10:return t.abrupt("return",u);case 11:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getAllItemsOfType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){var i,s,o,u,l;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=[],t.next=3,this.state.api.GetLineIDsWithType(e,n);case 3:for(s=t.sent,o=0;o<s.size();o++)i.push(s.get(o));if(r){t.next=7;break}return t.abrupt("return",i);case 7:u=[],l=0;case 9:if(!(l<i.length)){t.next=18;break}return t.t0=u,t.next=13,this.state.api.GetLine(e,i[l]);case 13:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 15:l++,t.next=9;break;case 18:return t.abrupt("return",u);case 19:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getProperty",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s,o,u,l=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],i=l.length>3?l[3]:void 0,t.next=4,this.getAllRelatedItemsOfType(e,n,i);case 4:s=t.sent,o=[],u=0;case 7:if(!(u<s.length)){t.next=16;break}return t.t0=o,t.next=11,this.state.api.GetLine(e,s[u],r);case 11:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 13:u++,t.next=7;break;case 16:return t.abrupt("return",o);case 17:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getNodeType",value:function(t,e){var n=this.state.models[t].types[e];return rt[n]}},{key:"getChunks",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){var i,s,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.state.api.GetLineIDsWithType(e,r.name);case 2:i=t.sent,s=0;case 4:if(!(s<i.size())){t.next=12;break}return t.next=7,this.state.api.GetLine(e,i.get(s),!1);case 7:o=t.sent,this.saveChunk(n,r,o);case 9:s++,t.next=4;break;case 12:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getAllRelatedItemsOfType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){var i,s,o,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.state.api.GetLineIDsWithType(e,r.name);case 2:i=t.sent,s=[],o=0;case 5:if(!(o<i.size())){t.next=14;break}return t.next=8,this.state.api.GetLine(e,i.get(o));case 8:u=t.sent,nt.isRelated(n,u,r)&&this.getRelated(u,r,s);case 11:o++,t.next=5;break;case 14:return t.abrupt("return",s);case 15:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()}]),n}(nt),at={3821786052:"IFCACTIONREQUEST",2296667514:"IFCACTOR",3630933823:"IFCACTORROLE",4288193352:"IFCACTUATOR",2874132201:"IFCACTUATORTYPE",618182010:"IFCADDRESS",1635779807:"IFCADVANCEDBREP",2603310189:"IFCADVANCEDBREPWITHVOIDS",3406155212:"IFCADVANCEDFACE",1634111441:"IFCAIRTERMINAL",177149247:"IFCAIRTERMINALBOX",1411407467:"IFCAIRTERMINALBOXTYPE",3352864051:"IFCAIRTERMINALTYPE",2056796094:"IFCAIRTOAIRHEATRECOVERY",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3087945054:"IFCALARM",3001207471:"IFCALARMTYPE",325726236:"IFCALIGNMENT",749761778:"IFCALIGNMENT2DHORIZONTAL",3199563722:"IFCALIGNMENT2DHORIZONTALSEGMENT",2483840362:"IFCALIGNMENT2DSEGMENT",3379348081:"IFCALIGNMENT2DVERSEGCIRCULARARC",3239324667:"IFCALIGNMENT2DVERSEGLINE",4263986512:"IFCALIGNMENT2DVERSEGPARABOLICARC",53199957:"IFCALIGNMENT2DVERTICAL",2029264950:"IFCALIGNMENT2DVERTICALSEGMENT",3512275521:"IFCALIGNMENTCURVE",1674181508:"IFCANNOTATION",669184980:"IFCANNOTATIONFILLAREA",639542469:"IFCAPPLICATION",411424972:"IFCAPPLIEDVALUE",130549933:"IFCAPPROVAL",3869604511:"IFCAPPROVALRELATIONSHIP",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",1310608509:"IFCARBITRARYOPENPROFILEDEF",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",3460190687:"IFCASSET",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",277319702:"IFCAUDIOVISUALAPPLIANCE",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4261334040:"IFCAXIS1PLACEMENT",3125803723:"IFCAXIS2PLACEMENT2D",2740243338:"IFCAXIS2PLACEMENT3D",1967976161:"IFCBSPLINECURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",167062518:"IFCBSPLINESURFACEWITHKNOTS",753842376:"IFCBEAM",2906023776:"IFCBEAMSTANDARDCASE",819618141:"IFCBEAMTYPE",4196446775:"IFCBEARING",3649138523:"IFCBEARINGTYPE",616511568:"IFCBLOBTEXTURE",1334484129:"IFCBLOCK",32344328:"IFCBOILER",231477066:"IFCBOILERTYPE",3649129432:"IFCBOOLEANCLIPPINGRESULT",2736907675:"IFCBOOLEANRESULT",4037036970:"IFCBOUNDARYCONDITION",1136057603:"IFCBOUNDARYCURVE",1560379544:"IFCBOUNDARYEDGECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1387855156:"IFCBOUNDARYNODECONDITION",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1260505505:"IFCBOUNDEDCURVE",4182860854:"IFCBOUNDEDSURFACE",2581212453:"IFCBOUNDINGBOX",2713105998:"IFCBOXEDHALFSPACE",644574406:"IFCBRIDGE",963979645:"IFCBRIDGEPART",4031249490:"IFCBUILDING",3299480353:"IFCBUILDINGELEMENT",2979338954:"IFCBUILDINGELEMENTPART",39481116:"IFCBUILDINGELEMENTPARTTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1950629157:"IFCBUILDINGELEMENTTYPE",3124254112:"IFCBUILDINGSTOREY",1177604601:"IFCBUILDINGSYSTEM",2938176219:"IFCBURNER",2188180465:"IFCBURNERTYPE",2898889636:"IFCCSHAPEPROFILEDEF",635142910:"IFCCABLECARRIERFITTING",395041908:"IFCCABLECARRIERFITTINGTYPE",3758799889:"IFCCABLECARRIERSEGMENT",3293546465:"IFCCABLECARRIERSEGMENTTYPE",1051757585:"IFCCABLEFITTING",2674252688:"IFCCABLEFITTINGTYPE",4217484030:"IFCCABLESEGMENT",1285652485:"IFCCABLESEGMENTTYPE",3999819293:"IFCCAISSONFOUNDATION",3203706013:"IFCCAISSONFOUNDATIONTYPE",1123145078:"IFCCARTESIANPOINT",574549367:"IFCCARTESIANPOINTLIST",1675464909:"IFCCARTESIANPOINTLIST2D",2059837836:"IFCCARTESIANPOINTLIST3D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3150382593:"IFCCENTERLINEPROFILEDEF",3902619387:"IFCCHILLER",2951183804:"IFCCHILLERTYPE",3296154744:"IFCCHIMNEY",2197970202:"IFCCHIMNEYTYPE",2611217952:"IFCCIRCLE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",1383045692:"IFCCIRCLEPROFILEDEF",1062206242:"IFCCIRCULARARCSEGMENT2D",1677625105:"IFCCIVILELEMENT",3893394355:"IFCCIVILELEMENTTYPE",747523909:"IFCCLASSIFICATION",647927063:"IFCCLASSIFICATIONREFERENCE",2205249479:"IFCCLOSEDSHELL",639361253:"IFCCOIL",2301859152:"IFCCOILTYPE",776857604:"IFCCOLOURRGB",3285139300:"IFCCOLOURRGBLIST",3264961684:"IFCCOLOURSPECIFICATION",843113511:"IFCCOLUMN",905975707:"IFCCOLUMNSTANDARDCASE",300633059:"IFCCOLUMNTYPE",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",2542286263:"IFCCOMPLEXPROPERTY",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3732776249:"IFCCOMPOSITECURVE",15328376:"IFCCOMPOSITECURVEONSURFACE",2485617015:"IFCCOMPOSITECURVESEGMENT",1485152156:"IFCCOMPOSITEPROFILEDEF",3571504051:"IFCCOMPRESSOR",3850581409:"IFCCOMPRESSORTYPE",2272882330:"IFCCONDENSER",2816379211:"IFCCONDENSERTYPE",2510884976:"IFCCONIC",370225590:"IFCCONNECTEDFACESET",1981873012:"IFCCONNECTIONCURVEGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",45288368:"IFCCONNECTIONPOINTECCENTRICITY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",1959218052:"IFCCONSTRAINT",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",2559216714:"IFCCONSTRUCTIONRESOURCE",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",3419103109:"IFCCONTEXT",3050246964:"IFCCONTEXTDEPENDENTUNIT",3293443760:"IFCCONTROL",25142252:"IFCCONTROLLER",578613899:"IFCCONTROLLERTYPE",2889183280:"IFCCONVERSIONBASEDUNIT",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",4136498852:"IFCCOOLEDBEAM",335055490:"IFCCOOLEDBEAMTYPE",3640358203:"IFCCOOLINGTOWER",2954562838:"IFCCOOLINGTOWERTYPE",1785450214:"IFCCOORDINATEOPERATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",3895139033:"IFCCOSTITEM",1419761937:"IFCCOSTSCHEDULE",602808272:"IFCCOSTVALUE",1973544240:"IFCCOVERING",1916426348:"IFCCOVERINGTYPE",3295246426:"IFCCREWRESOURCE",1815067380:"IFCCREWRESOURCETYPE",2506170314:"IFCCSGPRIMITIVE3D",2147822146:"IFCCSGSOLID",539742890:"IFCCURRENCYRELATIONSHIP",3495092785:"IFCCURTAINWALL",1457835157:"IFCCURTAINWALLTYPE",2601014836:"IFCCURVE",2827736869:"IFCCURVEBOUNDEDPLANE",2629017746:"IFCCURVEBOUNDEDSURFACE",1186437898:"IFCCURVESEGMENT2D",3800577675:"IFCCURVESTYLE",1105321065:"IFCCURVESTYLEFONT",2367409068:"IFCCURVESTYLEFONTANDSCALING",3510044353:"IFCCURVESTYLEFONTPATTERN",1213902940:"IFCCYLINDRICALSURFACE",4074379575:"IFCDAMPER",3961806047:"IFCDAMPERTYPE",3426335179:"IFCDEEPFOUNDATION",1306400036:"IFCDEEPFOUNDATIONTYPE",3632507154:"IFCDERIVEDPROFILEDEF",1765591967:"IFCDERIVEDUNIT",1045800335:"IFCDERIVEDUNITELEMENT",2949456006:"IFCDIMENSIONALEXPONENTS",32440307:"IFCDIRECTION",1335981549:"IFCDISCRETEACCESSORY",2635815018:"IFCDISCRETEACCESSORYTYPE",1945343521:"IFCDISTANCEEXPRESSION",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",562808652:"IFCDISTRIBUTIONCIRCUIT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1945004755:"IFCDISTRIBUTIONELEMENT",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3041715199:"IFCDISTRIBUTIONPORT",3205830791:"IFCDISTRIBUTIONSYSTEM",1154170062:"IFCDOCUMENTINFORMATION",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",3732053477:"IFCDOCUMENTREFERENCE",395920057:"IFCDOOR",2963535650:"IFCDOORLININGPROPERTIES",1714330368:"IFCDOORPANELPROPERTIES",3242481149:"IFCDOORSTANDARDCASE",526551008:"IFCDOORSTYLE",2323601079:"IFCDOORTYPE",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",342316401:"IFCDUCTFITTING",869906466:"IFCDUCTFITTINGTYPE",3518393246:"IFCDUCTSEGMENT",3760055223:"IFCDUCTSEGMENTTYPE",1360408905:"IFCDUCTSILENCER",2030761528:"IFCDUCTSILENCERTYPE",3900360178:"IFCEDGE",476780140:"IFCEDGECURVE",1472233963:"IFCEDGELOOP",1904799276:"IFCELECTRICAPPLIANCE",663422040:"IFCELECTRICAPPLIANCETYPE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",264262732:"IFCELECTRICGENERATOR",1534661035:"IFCELECTRICGENERATORTYPE",402227799:"IFCELECTRICMOTOR",1217240411:"IFCELECTRICMOTORTYPE",1003880860:"IFCELECTRICTIMECONTROL",712377611:"IFCELECTRICTIMECONTROLTYPE",1758889154:"IFCELEMENT",4123344466:"IFCELEMENTASSEMBLY",2397081782:"IFCELEMENTASSEMBLYTYPE",1623761950:"IFCELEMENTCOMPONENT",2590856083:"IFCELEMENTCOMPONENTTYPE",1883228015:"IFCELEMENTQUANTITY",339256511:"IFCELEMENTTYPE",2777663545:"IFCELEMENTARYSURFACE",1704287377:"IFCELLIPSE",2835456948:"IFCELLIPSEPROFILEDEF",1658829314:"IFCENERGYCONVERSIONDEVICE",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",2814081492:"IFCENGINE",132023988:"IFCENGINETYPE",3747195512:"IFCEVAPORATIVECOOLER",3174744832:"IFCEVAPORATIVECOOLERTYPE",484807127:"IFCEVAPORATOR",3390157468:"IFCEVAPORATORTYPE",4148101412:"IFCEVENT",211053100:"IFCEVENTTIME",4024345920:"IFCEVENTTYPE",297599258:"IFCEXTENDEDPROPERTIES",4294318154:"IFCEXTERNALINFORMATION",3200245327:"IFCEXTERNALREFERENCE",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",1209101575:"IFCEXTERNALSPATIALELEMENT",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",477187591:"IFCEXTRUDEDAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",2556980723:"IFCFACE",2047409740:"IFCFACEBASEDSURFACEMODEL",1809719519:"IFCFACEBOUND",803316827:"IFCFACEOUTERBOUND",3008276851:"IFCFACESURFACE",807026263:"IFCFACETEDBREP",3737207727:"IFCFACETEDBREPWITHVOIDS",24185140:"IFCFACILITY",1310830890:"IFCFACILITYPART",4219587988:"IFCFAILURECONNECTIONCONDITION",3415622556:"IFCFAN",346874300:"IFCFANTYPE",647756555:"IFCFASTENER",2489546625:"IFCFASTENERTYPE",2827207264:"IFCFEATUREELEMENT",2143335405:"IFCFEATUREELEMENTADDITION",1287392070:"IFCFEATUREELEMENTSUBTRACTION",738692330:"IFCFILLAREASTYLE",374418227:"IFCFILLAREASTYLEHATCHING",315944413:"IFCFILLAREASTYLETILES",819412036:"IFCFILTER",1810631287:"IFCFILTERTYPE",1426591983:"IFCFIRESUPPRESSIONTERMINAL",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2058353004:"IFCFLOWCONTROLLER",3907093117:"IFCFLOWCONTROLLERTYPE",4278956645:"IFCFLOWFITTING",3198132628:"IFCFLOWFITTINGTYPE",182646315:"IFCFLOWINSTRUMENT",4037862832:"IFCFLOWINSTRUMENTTYPE",2188021234:"IFCFLOWMETER",3815607619:"IFCFLOWMETERTYPE",3132237377:"IFCFLOWMOVINGDEVICE",1482959167:"IFCFLOWMOVINGDEVICETYPE",987401354:"IFCFLOWSEGMENT",1834744321:"IFCFLOWSEGMENTTYPE",707683696:"IFCFLOWSTORAGEDEVICE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",2223149337:"IFCFLOWTERMINAL",2297155007:"IFCFLOWTERMINALTYPE",3508470533:"IFCFLOWTREATMENTDEVICE",3009222698:"IFCFLOWTREATMENTDEVICETYPE",900683007:"IFCFOOTING",1893162501:"IFCFOOTINGTYPE",263784265:"IFCFURNISHINGELEMENT",4238390223:"IFCFURNISHINGELEMENTTYPE",1509553395:"IFCFURNITURE",1268542332:"IFCFURNITURETYPE",3493046030:"IFCGEOGRAPHICELEMENT",4095422895:"IFCGEOGRAPHICELEMENTTYPE",987898635:"IFCGEOMETRICCURVESET",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",3590301190:"IFCGEOMETRICSET",3009204131:"IFCGRID",852622518:"IFCGRIDAXIS",178086475:"IFCGRIDPLACEMENT",2706460486:"IFCGROUP",812098782:"IFCHALFSPACESOLID",3319311131:"IFCHEATEXCHANGER",1251058090:"IFCHEATEXCHANGERTYPE",2068733104:"IFCHUMIDIFIER",1806887404:"IFCHUMIDIFIERTYPE",1484403080:"IFCISHAPEPROFILEDEF",3905492369:"IFCIMAGETEXTURE",3570813810:"IFCINDEXEDCOLOURMAP",2571569899:"IFCINDEXEDPOLYCURVE",178912537:"IFCINDEXEDPOLYGONALFACE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",1437953363:"IFCINDEXEDTEXTUREMAP",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",4175244083:"IFCINTERCEPTOR",3946677679:"IFCINTERCEPTORTYPE",3113134337:"IFCINTERSECTIONCURVE",2391368822:"IFCINVENTORY",3741457305:"IFCIRREGULARTIMESERIES",3020489413:"IFCIRREGULARTIMESERIESVALUE",2176052936:"IFCJUNCTIONBOX",4288270099:"IFCJUNCTIONBOXTYPE",572779678:"IFCLSHAPEPROFILEDEF",3827777499:"IFCLABORRESOURCE",428585644:"IFCLABORRESOURCETYPE",1585845231:"IFCLAGTIME",76236018:"IFCLAMP",1051575348:"IFCLAMPTYPE",2655187982:"IFCLIBRARYINFORMATION",3452421091:"IFCLIBRARYREFERENCE",4162380809:"IFCLIGHTDISTRIBUTIONDATA",629592764:"IFCLIGHTFIXTURE",1161773419:"IFCLIGHTFIXTURETYPE",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",1402838566:"IFCLIGHTSOURCE",125510826:"IFCLIGHTSOURCEAMBIENT",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",1520743889:"IFCLIGHTSOURCEPOSITIONAL",3422422726:"IFCLIGHTSOURCESPOT",1281925730:"IFCLINE",3092502836:"IFCLINESEGMENT2D",388784114:"IFCLINEARPLACEMENT",1154579445:"IFCLINEARPOSITIONINGELEMENT",2624227202:"IFCLOCALPLACEMENT",1008929658:"IFCLOOP",1425443689:"IFCMANIFOLDSOLIDBREP",3057273783:"IFCMAPCONVERSION",2347385850:"IFCMAPPEDITEM",1838606355:"IFCMATERIAL",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",3708119e3:"IFCMATERIALCONSTITUENT",2852063980:"IFCMATERIALCONSTITUENTSET",760658860:"IFCMATERIALDEFINITION",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",248100487:"IFCMATERIALLAYER",3303938423:"IFCMATERIALLAYERSET",1303795690:"IFCMATERIALLAYERSETUSAGE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",2199411900:"IFCMATERIALLIST",2235152071:"IFCMATERIALPROFILE",164193824:"IFCMATERIALPROFILESET",3079605661:"IFCMATERIALPROFILESETUSAGE",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",552965576:"IFCMATERIALPROFILEWITHOFFSETS",3265635763:"IFCMATERIALPROPERTIES",853536259:"IFCMATERIALRELATIONSHIP",1507914824:"IFCMATERIALUSAGEDEFINITION",2597039031:"IFCMEASUREWITHUNIT",377706215:"IFCMECHANICALFASTENER",2108223431:"IFCMECHANICALFASTENERTYPE",1437502449:"IFCMEDICALDEVICE",1114901282:"IFCMEDICALDEVICETYPE",1073191201:"IFCMEMBER",1911478936:"IFCMEMBERSTANDARDCASE",3181161470:"IFCMEMBERTYPE",3368373690:"IFCMETRIC",2998442950:"IFCMIRROREDPROFILEDEF",2706619895:"IFCMONETARYUNIT",2474470126:"IFCMOTORCONNECTION",977012517:"IFCMOTORCONNECTIONTYPE",1918398963:"IFCNAMEDUNIT",3888040117:"IFCOBJECT",219451334:"IFCOBJECTDEFINITION",3701648758:"IFCOBJECTPLACEMENT",2251480897:"IFCOBJECTIVE",4143007308:"IFCOCCUPANT",590820931:"IFCOFFSETCURVE",3388369263:"IFCOFFSETCURVE2D",3505215534:"IFCOFFSETCURVE3D",2485787929:"IFCOFFSETCURVEBYDISTANCES",2665983363:"IFCOPENSHELL",3588315303:"IFCOPENINGELEMENT",3079942009:"IFCOPENINGSTANDARDCASE",4251960020:"IFCORGANIZATION",1411181986:"IFCORGANIZATIONRELATIONSHIP",643959842:"IFCORIENTATIONEXPRESSION",1029017970:"IFCORIENTEDEDGE",144952367:"IFCOUTERBOUNDARYCURVE",3694346114:"IFCOUTLET",2837617999:"IFCOUTLETTYPE",1207048766:"IFCOWNERHISTORY",2529465313:"IFCPARAMETERIZEDPROFILEDEF",2519244187:"IFCPATH",1682466193:"IFCPCURVE",2382730787:"IFCPERFORMANCEHISTORY",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3327091369:"IFCPERMIT",2077209135:"IFCPERSON",101040310:"IFCPERSONANDORGANIZATION",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2483315170:"IFCPHYSICALQUANTITY",2226359599:"IFCPHYSICALSIMPLEQUANTITY",1687234759:"IFCPILE",1158309216:"IFCPILETYPE",310824031:"IFCPIPEFITTING",804291784:"IFCPIPEFITTINGTYPE",3612865200:"IFCPIPESEGMENT",4231323485:"IFCPIPESEGMENTTYPE",597895409:"IFCPIXELTEXTURE",2004835150:"IFCPLACEMENT",603570806:"IFCPLANARBOX",1663979128:"IFCPLANAREXTENT",220341763:"IFCPLANE",3171933400:"IFCPLATE",1156407060:"IFCPLATESTANDARDCASE",4017108033:"IFCPLATETYPE",2067069095:"IFCPOINT",4022376103:"IFCPOINTONCURVE",1423911732:"IFCPOINTONSURFACE",2924175390:"IFCPOLYLOOP",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2839578677:"IFCPOLYGONALFACESET",3724593414:"IFCPOLYLINE",3740093272:"IFCPORT",1946335990:"IFCPOSITIONINGELEMENT",3355820592:"IFCPOSTALADDRESS",759155922:"IFCPREDEFINEDCOLOUR",2559016684:"IFCPREDEFINEDCURVEFONT",3727388367:"IFCPREDEFINEDITEM",3778827333:"IFCPREDEFINEDPROPERTIES",3967405729:"IFCPREDEFINEDPROPERTYSET",1775413392:"IFCPREDEFINEDTEXTFONT",677532197:"IFCPRESENTATIONITEM",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",3119450353:"IFCPRESENTATIONSTYLE",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",2744685151:"IFCPROCEDURE",569719735:"IFCPROCEDURETYPE",2945172077:"IFCPROCESS",4208778838:"IFCPRODUCT",673634403:"IFCPRODUCTDEFINITIONSHAPE",2095639259:"IFCPRODUCTREPRESENTATION",3958567839:"IFCPROFILEDEF",2802850158:"IFCPROFILEPROPERTIES",103090709:"IFCPROJECT",653396225:"IFCPROJECTLIBRARY",2904328755:"IFCPROJECTORDER",3843373140:"IFCPROJECTEDCRS",3651124850:"IFCPROJECTIONELEMENT",2598011224:"IFCPROPERTY",986844984:"IFCPROPERTYABSTRACTION",871118103:"IFCPROPERTYBOUNDEDVALUE",1680319473:"IFCPROPERTYDEFINITION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",4166981789:"IFCPROPERTYENUMERATEDVALUE",3710013099:"IFCPROPERTYENUMERATION",2752243245:"IFCPROPERTYLISTVALUE",941946838:"IFCPROPERTYREFERENCEVALUE",1451395588:"IFCPROPERTYSET",3357820518:"IFCPROPERTYSETDEFINITION",492091185:"IFCPROPERTYSETTEMPLATE",3650150729:"IFCPROPERTYSINGLEVALUE",110355661:"IFCPROPERTYTABLEVALUE",3521284610:"IFCPROPERTYTEMPLATE",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",738039164:"IFCPROTECTIVEDEVICE",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3219374653:"IFCPROXY",90941305:"IFCPUMP",2250791053:"IFCPUMPTYPE",2044713172:"IFCQUANTITYAREA",2093928680:"IFCQUANTITYCOUNT",931644368:"IFCQUANTITYLENGTH",2090586900:"IFCQUANTITYSET",3252649465:"IFCQUANTITYTIME",2405470396:"IFCQUANTITYVOLUME",825690147:"IFCQUANTITYWEIGHT",2262370178:"IFCRAILING",2893384427:"IFCRAILINGTYPE",3024970846:"IFCRAMP",3283111854:"IFCRAMPFLIGHT",2324767716:"IFCRAMPFLIGHTTYPE",1469900589:"IFCRAMPTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3615266464:"IFCRECTANGLEPROFILEDEF",2798486643:"IFCRECTANGULARPYRAMID",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",3915482550:"IFCRECURRENCEPATTERN",2433181523:"IFCREFERENCE",4021432810:"IFCREFERENT",3413951693:"IFCREGULARTIMESERIES",1580146022:"IFCREINFORCEMENTBARPROPERTIES",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",979691226:"IFCREINFORCINGBAR",2572171363:"IFCREINFORCINGBARTYPE",3027567501:"IFCREINFORCINGELEMENT",964333572:"IFCREINFORCINGELEMENTTYPE",2320036040:"IFCREINFORCINGMESH",2310774935:"IFCREINFORCINGMESHTYPE",160246688:"IFCRELAGGREGATES",3939117080:"IFCRELASSIGNS",1683148259:"IFCRELASSIGNSTOACTOR",2495723537:"IFCRELASSIGNSTOCONTROL",1307041759:"IFCRELASSIGNSTOGROUP",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",4278684876:"IFCRELASSIGNSTOPROCESS",2857406711:"IFCRELASSIGNSTOPRODUCT",205026976:"IFCRELASSIGNSTORESOURCE",1865459582:"IFCRELASSOCIATES",4095574036:"IFCRELASSOCIATESAPPROVAL",919958153:"IFCRELASSOCIATESCLASSIFICATION",2728634034:"IFCRELASSOCIATESCONSTRAINT",982818633:"IFCRELASSOCIATESDOCUMENT",3840914261:"IFCRELASSOCIATESLIBRARY",2655215786:"IFCRELASSOCIATESMATERIAL",826625072:"IFCRELCONNECTS",1204542856:"IFCRELCONNECTSELEMENTS",3945020480:"IFCRELCONNECTSPATHELEMENTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3190031847:"IFCRELCONNECTSPORTS",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",504942748:"IFCRELCONNECTSWITHECCENTRICITY",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",886880790:"IFCRELCOVERSBLDGELEMENTS",2802773753:"IFCRELCOVERSSPACES",2565941209:"IFCRELDECLARES",2551354335:"IFCRELDECOMPOSES",693640335:"IFCRELDEFINES",1462361463:"IFCRELDEFINESBYOBJECT",4186316022:"IFCRELDEFINESBYPROPERTIES",307848117:"IFCRELDEFINESBYTEMPLATE",781010003:"IFCRELDEFINESBYTYPE",3940055652:"IFCRELFILLSELEMENT",279856033:"IFCRELFLOWCONTROLELEMENTS",427948657:"IFCRELINTERFERESELEMENTS",3268803585:"IFCRELNESTS",1441486842:"IFCRELPOSITIONS",750771296:"IFCRELPROJECTSELEMENT",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",4122056220:"IFCRELSEQUENCE",366585022:"IFCRELSERVICESBUILDINGS",3451746338:"IFCRELSPACEBOUNDARY",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",1401173127:"IFCRELVOIDSELEMENT",478536968:"IFCRELATIONSHIP",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1076942058:"IFCREPRESENTATION",3377609919:"IFCREPRESENTATIONCONTEXT",3008791417:"IFCREPRESENTATIONITEM",1660063152:"IFCREPRESENTATIONMAP",2914609552:"IFCRESOURCE",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2439245199:"IFCRESOURCELEVELRELATIONSHIP",1042787934:"IFCRESOURCETIME",1856042241:"IFCREVOLVEDAREASOLID",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",4158566097:"IFCRIGHTCIRCULARCONE",3626867408:"IFCRIGHTCIRCULARCYLINDER",2016517767:"IFCROOF",2781568857:"IFCROOFTYPE",2341007311:"IFCROOT",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",448429030:"IFCSIUNIT",3053780830:"IFCSANITARYTERMINAL",1768891740:"IFCSANITARYTERMINALTYPE",1054537805:"IFCSCHEDULINGTIME",2157484638:"IFCSEAMCURVE",2042790032:"IFCSECTIONPROPERTIES",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",1862484736:"IFCSECTIONEDSOLID",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1509187699:"IFCSECTIONEDSPINE",4086658281:"IFCSENSOR",1783015770:"IFCSENSORTYPE",1329646415:"IFCSHADINGDEVICE",4074543187:"IFCSHADINGDEVICETYPE",867548509:"IFCSHAPEASPECT",3982875396:"IFCSHAPEMODEL",4240577450:"IFCSHAPEREPRESENTATION",4124623270:"IFCSHELLBASEDSURFACEMODEL",3692461612:"IFCSIMPLEPROPERTY",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",4097777520:"IFCSITE",1529196076:"IFCSLAB",3127900445:"IFCSLABELEMENTEDCASE",3027962421:"IFCSLABSTANDARDCASE",2533589738:"IFCSLABTYPE",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",3420628829:"IFCSOLARDEVICE",1072016465:"IFCSOLARDEVICETYPE",723233188:"IFCSOLIDMODEL",3856911033:"IFCSPACE",1999602285:"IFCSPACEHEATER",1305183839:"IFCSPACEHEATERTYPE",3812236995:"IFCSPACETYPE",1412071761:"IFCSPATIALELEMENT",710998568:"IFCSPATIALELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",463610769:"IFCSPATIALZONE",2481509218:"IFCSPATIALZONETYPE",451544542:"IFCSPHERE",4015995234:"IFCSPHERICALSURFACE",1404847402:"IFCSTACKTERMINAL",3112655638:"IFCSTACKTERMINALTYPE",331165859:"IFCSTAIR",4252922144:"IFCSTAIRFLIGHT",1039846685:"IFCSTAIRFLIGHTTYPE",338393293:"IFCSTAIRTYPE",682877961:"IFCSTRUCTURALACTION",3544373492:"IFCSTRUCTURALACTIVITY",2515109513:"IFCSTRUCTURALANALYSISMODEL",1179482911:"IFCSTRUCTURALCONNECTION",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",1004757350:"IFCSTRUCTURALCURVEACTION",4243806635:"IFCSTRUCTURALCURVECONNECTION",214636428:"IFCSTRUCTURALCURVEMEMBER",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",2757150158:"IFCSTRUCTURALCURVEREACTION",3136571912:"IFCSTRUCTURALITEM",1807405624:"IFCSTRUCTURALLINEARACTION",2162789131:"IFCSTRUCTURALLOAD",385403989:"IFCSTRUCTURALLOADCASE",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1252848954:"IFCSTRUCTURALLOADGROUP",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",609421318:"IFCSTRUCTURALLOADORRESULT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",2525727697:"IFCSTRUCTURALLOADSTATIC",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",530289379:"IFCSTRUCTURALMEMBER",1621171031:"IFCSTRUCTURALPLANARACTION",2082059205:"IFCSTRUCTURALPOINTACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",1235345126:"IFCSTRUCTURALPOINTREACTION",3689010777:"IFCSTRUCTURALREACTION",2986769608:"IFCSTRUCTURALRESULTGROUP",3657597509:"IFCSTRUCTURALSURFACEACTION",1975003073:"IFCSTRUCTURALSURFACECONNECTION",3979015343:"IFCSTRUCTURALSURFACEMEMBER",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",603775116:"IFCSTRUCTURALSURFACEREACTION",2830218821:"IFCSTYLEMODEL",3958052878:"IFCSTYLEDITEM",3049322572:"IFCSTYLEDREPRESENTATION",148013059:"IFCSUBCONTRACTRESOURCE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",2233826070:"IFCSUBEDGE",2513912981:"IFCSURFACE",699246055:"IFCSURFACECURVE",2028607225:"IFCSURFACECURVESWEPTAREASOLID",3101698114:"IFCSURFACEFEATURE",2809605785:"IFCSURFACEOFLINEAREXTRUSION",4124788165:"IFCSURFACEOFREVOLUTION",2934153892:"IFCSURFACEREINFORCEMENTAREA",1300840506:"IFCSURFACESTYLE",3303107099:"IFCSURFACESTYLELIGHTING",1607154358:"IFCSURFACESTYLEREFRACTION",1878645084:"IFCSURFACESTYLERENDERING",846575682:"IFCSURFACESTYLESHADING",1351298697:"IFCSURFACESTYLEWITHTEXTURES",626085974:"IFCSURFACETEXTURE",2247615214:"IFCSWEPTAREASOLID",1260650574:"IFCSWEPTDISKSOLID",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",230924584:"IFCSWEPTSURFACE",1162798199:"IFCSWITCHINGDEVICE",2315554128:"IFCSWITCHINGDEVICETYPE",2254336722:"IFCSYSTEM",413509423:"IFCSYSTEMFURNITUREELEMENT",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",3071757647:"IFCTSHAPEPROFILEDEF",985171141:"IFCTABLE",2043862942:"IFCTABLECOLUMN",531007025:"IFCTABLEROW",812556717:"IFCTANK",5716631:"IFCTANKTYPE",3473067441:"IFCTASK",1549132990:"IFCTASKTIME",2771591690:"IFCTASKTIMERECURRING",3206491090:"IFCTASKTYPE",912023232:"IFCTELECOMADDRESS",3824725483:"IFCTENDON",2347447852:"IFCTENDONANCHOR",3081323446:"IFCTENDONANCHORTYPE",3663046924:"IFCTENDONCONDUIT",2281632017:"IFCTENDONCONDUITTYPE",2415094496:"IFCTENDONTYPE",2387106220:"IFCTESSELLATEDFACESET",901063453:"IFCTESSELLATEDITEM",4282788508:"IFCTEXTLITERAL",3124975700:"IFCTEXTLITERALWITHEXTENT",1447204868:"IFCTEXTSTYLE",1983826977:"IFCTEXTSTYLEFONTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1640371178:"IFCTEXTSTYLETEXTMODEL",280115917:"IFCTEXTURECOORDINATE",1742049831:"IFCTEXTURECOORDINATEGENERATOR",2552916305:"IFCTEXTUREMAP",1210645708:"IFCTEXTUREVERTEX",3611470254:"IFCTEXTUREVERTEXLIST",1199560280:"IFCTIMEPERIOD",3101149627:"IFCTIMESERIES",581633288:"IFCTIMESERIESVALUE",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",1735638870:"IFCTOPOLOGYREPRESENTATION",1935646853:"IFCTOROIDALSURFACE",3825984169:"IFCTRANSFORMER",1692211062:"IFCTRANSFORMERTYPE",2595432518:"IFCTRANSITIONCURVESEGMENT2D",1620046519:"IFCTRANSPORTELEMENT",2097647324:"IFCTRANSPORTELEMENTTYPE",2715220739:"IFCTRAPEZIUMPROFILEDEF",2916149573:"IFCTRIANGULATEDFACESET",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3593883385:"IFCTRIMMEDCURVE",3026737570:"IFCTUBEBUNDLE",1600972822:"IFCTUBEBUNDLETYPE",1628702193:"IFCTYPEOBJECT",3736923433:"IFCTYPEPROCESS",2347495698:"IFCTYPEPRODUCT",3698973494:"IFCTYPERESOURCE",427810014:"IFCUSHAPEPROFILEDEF",180925521:"IFCUNITASSIGNMENT",630975310:"IFCUNITARYCONTROLELEMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",4292641817:"IFCUNITARYEQUIPMENT",1911125066:"IFCUNITARYEQUIPMENTTYPE",4207607924:"IFCVALVE",728799441:"IFCVALVETYPE",1417489154:"IFCVECTOR",2799835756:"IFCVERTEX",2759199220:"IFCVERTEXLOOP",1907098498:"IFCVERTEXPOINT",1530820697:"IFCVIBRATIONDAMPER",3956297820:"IFCVIBRATIONDAMPERTYPE",2391383451:"IFCVIBRATIONISOLATOR",3313531582:"IFCVIBRATIONISOLATORTYPE",2769231204:"IFCVIRTUALELEMENT",891718957:"IFCVIRTUALGRIDINTERSECTION",926996030:"IFCVOIDINGFEATURE",2391406946:"IFCWALL",4156078855:"IFCWALLELEMENTEDCASE",3512223829:"IFCWALLSTANDARDCASE",1898987631:"IFCWALLTYPE",4237592921:"IFCWASTETERMINAL",1133259667:"IFCWASTETERMINALTYPE",3304561284:"IFCWINDOW",336235671:"IFCWINDOWLININGPROPERTIES",512836454:"IFCWINDOWPANELPROPERTIES",486154966:"IFCWINDOWSTANDARDCASE",1299126871:"IFCWINDOWSTYLE",4009809668:"IFCWINDOWTYPE",4088093105:"IFCWORKCALENDAR",1028945134:"IFCWORKCONTROL",4218914973:"IFCWORKPLAN",3342526732:"IFCWORKSCHEDULE",1236880293:"IFCWORKTIME",2543172580:"IFCZSHAPEPROFILEDEF",1033361043:"IFCZONE"},st=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,u.Z)(n,[{key:"getItemProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.length>2&&void 0!==r[2]&&r[2],t.abrupt("return",(0,z.Z)({},this.state.models[e].jsonData[n]));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getSpatialStructure",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,r){var i,s,o,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSpatialTreeChunks(e);case 2:return i=t.sent,t.next=5,this.getAllItemsOfType(e,C.IFCPROJECT,!1);case 5:return s=t.sent,o=s[0],u=n.newIfcProject(o),t.next=10,this.getSpatialNode(e,u,i,r);case 10:return t.abrupt("return",(0,z.Z)({},u));case 11:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getAllItemsOfType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){var i,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.state.models[e].jsonData,s=at[n]){t.next=4;break}throw new Error("Type not found: ".concat(n));case 4:return t.abrupt("return",this.filterItemsByType(i,s,r));case 5:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getProperty",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s,o,u=this,l=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],i=l.length>3?l[3]:void 0,t.next=4,this.getAllRelatedItemsOfType(e,n,i);case 4:return s=t.sent,o=this.getItemsByID(e,s),r&&o.forEach((function(t){return u.getReferencesRecursively(e,t)})),t.abrupt("return",o);case 8:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getNodeType",value:function(t,e){return this.state.models[t].jsonData[e].type}},{key:"getChunks",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){var i=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAllItemsOfType(e,r.name,!0);case 2:t.sent.forEach((function(t){i.saveChunk(n,r,t)}));case 4:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"filterItemsByType",value:function(t,e,n){var r=[];return Object.keys(t).forEach((function(i){var a=parseInt(i);t[a].type.toUpperCase()===e&&r.push(n?(0,z.Z)({},t[a]):a)})),r}},{key:"getAllRelatedItemsOfType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,r,i){var s,o,u=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAllItemsOfType(e,i.name,!0);case 2:return s=t.sent,o=[],s.forEach((function(t){n.isRelated(r,t,i)&&u.getRelated(t,i,o)})),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getItemsByID",value:function(t,e){var n=this.state.models[t].jsonData,r=[];return e.forEach((function(t){return r.push((0,z.Z)({},n[t]))})),r}},{key:"getReferencesRecursively",value:function(t,e){if(void 0!=e)for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];this.getJSONItem(t,e,i)}}},{key:"getJSONItem",value:function(t,e,n){if(Array.isArray(e[n]))return this.getMultipleJSONItems(t,e,n);e[n]&&5===e[n].type&&(e[n]=this.getItemsByID(t,[e[n].value])[0],this.getReferencesRecursively(t,e[n]))}},{key:"getMultipleJSONItems",value:function(t,e,n){var r=this;e[n]=e[n].map((function(e){return 5===e.type&&(e=r.getItemsByID(t,[e.value])[0],r.getReferencesRecursively(t,e)),e}))}}]),n}(nt),ot=function(){function t(e){(0,o.Z)(this,t),this.state=e,this.webIfcProps=new it(e),this.jsonProps=new st(e),this.currentProps=this.webIfcProps}return(0,u.Z)(t,[{key:"getExpressId",value:function(t,e){if(!t.index)throw new Error("Geometry does not have index information.");var n=t.index.array;return t.attributes.expressID.getX(n[3*e])}},{key:"getItemProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],this.updateCurrentProps(),t.abrupt("return",this.currentProps.getItemProperties(e,n,r));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getAllItemsOfType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateCurrentProps(),t.abrupt("return",this.currentProps.getAllItemsOfType(e,n,r));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getPropertySets",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],this.updateCurrentProps(),t.abrupt("return",this.currentProps.getPropertySets(e,n,r));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getTypeProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],this.updateCurrentProps(),t.abrupt("return",this.currentProps.getTypeProperties(e,n,r));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getMaterialsProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],this.updateCurrentProps(),t.abrupt("return",this.currentProps.getMaterialsProperties(e,n,r));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getSpatialStructure",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.updateCurrentProps(),!this.state.useJSON&&n&&console.warn("Including properties in getSpatialStructure with the JSON workflow disabled can lead to poor performance."),t.next=4,this.currentProps.getSpatialStructure(e,n);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"updateCurrentProps",value:function(){this.currentProps=this.state.useJSON?this.jsonProps:this.webIfcProps}}]),t}(),ut=function(){function t(e){(0,o.Z)(this,t),this.state=e,this.state=e}return(0,u.Z)(t,[{key:"getAllTypes",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=(0,a.Z)().keys(this.state.models);case 1:if((t.t1=t.t0()).done){t.next=10;break}if(n=t.t1.value,!this.state.models.hasOwnProperty(n)){t.next=8;break}if(r=this.state.models[n].types,0!=Object.keys(r).length){t.next=8;break}return t.next=8,this.getAllTypesOfModel(parseInt(n),e);case 8:t.next=1;break;case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getAllTypesOfModel",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s,o,u,l,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r={},i=Object.keys(rt).map((function(t){return parseInt(t)})),s=0;case 3:if(!(s<i.length)){t.next=13;break}return o=i[s],t.next=7,this.state.api.GetLineIDsWithType(e,o);case 7:for(u=t.sent,l=u.size(),c=0;c<l;c++)r[u.get(c)]=o;case 10:s++,t.next=3;break;case 13:if(!this.state.worker.active||!n){t.next=16;break}return t.next=16,n.workerState.updateModelStateTypes(e,r);case 16:this.state.models[e].types=r;case 17:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),lt=function(){function t(){(0,o.Z)(this,t)}return(0,u.Z)(t,[{key:"initializeMeshBVH",value:function(t,e,n){this.computeBoundsTree=t,this.disposeBoundsTree=e,this.acceleratedRaycast=n,this.setupThreeMeshBVH()}},{key:"applyThreeMeshBVH",value:function(t){this.computeBoundsTree&&t.computeBoundsTree()}},{key:"setupThreeMeshBVH",value:function(){this.computeBoundsTree&&this.disposeBoundsTree&&this.acceleratedRaycast&&(p.BufferGeometry.prototype.computeBoundsTree=this.computeBoundsTree,p.BufferGeometry.prototype.disposeBoundsTree=this.disposeBoundsTree,p.Mesh.prototype.raycast=this.acceleratedRaycast)}}]),t}();!function(t){t.updateStateUseJson="updateStateUseJson",t.updateStateWebIfcSettings="updateStateWebIfcSettings",t.updateModelStateTypes="updateModelStateTypes",t.updateModelStateJsonData="updateModelStateJsonData",t.loadJsonDataFromWorker="loadJsonDataFromWorker",t.dispose="dispose",t.Close="Close",t.DisposeWebIfc="DisposeWebIfc",t.Init="Init",t.OpenModel="OpenModel",t.CreateModel="CreateModel",t.ExportFileAsIFC="ExportFileAsIFC",t.GetGeometry="GetGeometry",t.GetLine="GetLine",t.GetAndClearErrors="GetAndClearErrors",t.WriteLine="WriteLine",t.FlattenLine="FlattenLine",t.GetRawLineData="GetRawLineData",t.WriteRawLineData="WriteRawLineData",t.GetLineIDsWithType="GetLineIDsWithType",t.GetAllLines="GetAllLines",t.SetGeometryTransformation="SetGeometryTransformation",t.GetCoordinationMatrix="GetCoordinationMatrix",t.GetVertexArray="GetVertexArray",t.GetIndexArray="GetIndexArray",t.getSubArray="getSubArray",t.CloseModel="CloseModel",t.StreamAllMeshes="StreamAllMeshes",t.StreamAllMeshesWithTypes="StreamAllMeshesWithTypes",t.IsModelOpen="IsModelOpen",t.LoadAllGeometry="LoadAllGeometry",t.GetFlatMesh="GetFlatMesh",t.SetWasmPath="SetWasmPath",t.parse="parse",t.setupOptionalCategories="setupOptionalCategories",t.getExpressId="getExpressId",t.initializeProperties="initializeProperties",t.getAllItemsOfType="getAllItemsOfType",t.getItemProperties="getItemProperties",t.getMaterialsProperties="getMaterialsProperties",t.getPropertySets="getPropertySets",t.getSpatialStructure="getSpatialStructure",t.getTypeProperties="getTypeProperties"}(Q||(Q={})),function(t){t.workerState="workerState",t.webIfc="webIfc",t.properties="properties",t.parser="parser"}(j||(j={}));var ct,ht=function(){function t(e){var n=this;(0,o.Z)(this,t),this._data={},this._size=e.size,Object.keys(e).filter((function(t){return-1===t.indexOf("size")})).map((function(t){return parseInt(t)})).forEach((function(t){return n._data[t]=e[t]}))}return(0,u.Z)(t,[{key:"size",value:function(){return this._size}},{key:"get",value:function(t){return this._data[t]}}]),t}(),ft=function(){function t(e){(0,o.Z)(this,t),this._GetVertexData=e.GetVertexData,this._GetVertexDataSize=e.GetVertexDataSize,this._GetIndexData=e.GetIndexData,this._GetIndexDataSize=e.GetIndexDataSize}return(0,u.Z)(t,[{key:"GetVertexData",value:function(){return this._GetVertexData}},{key:"GetVertexDataSize",value:function(){return this._GetVertexDataSize}},{key:"GetIndexData",value:function(){return this._GetIndexData}},{key:"GetIndexDataSize",value:function(){return this._GetIndexDataSize}}]),t}(),dt=(0,u.Z)((function t(e,n){(0,o.Z)(this,t),this.expressID=n.expressID,this.geometries=e.reconstructVector(n.geometries)})),pt=function(){function t(e,n){var r=this;(0,o.Z)(this,t),this._data={},this._size=n.size,Object.keys(n).filter((function(t){return-1===t.indexOf("size")})).map((function(t){return parseInt(t)})).forEach((function(t){return r._data[t]=e.reconstructFlatMesh(n[t])}))}return(0,u.Z)(t,[{key:"size",value:function(){return this._size}},{key:"get",value:function(t){return this._data[t]}}]),t}(),mt=(0,u.Z)((function t(e){(0,o.Z)(this,t),this.color=[e.color.r,e.color.g,e.color.b],this.opacity=e.opacity,this.transparent=e.transparent})),vt=function(){function t(){(0,o.Z)(this,t)}return(0,u.Z)(t,null,[{key:"new",value:function(t){return new p.MeshLambertMaterial({color:new p.Color(t.color[0],t.color[1],t.color[2]),opacity:t.opacity,transparent:t.transparent,side:p.DoubleSide})}}]),t}(),gt=(0,u.Z)((function t(e){var n,r,i,a;(0,o.Z)(this,t),this.position=(null===(n=e.attributes.position)||void 0===n?void 0:n.array)||[],this.normal=(null===(r=e.attributes.normal)||void 0===r?void 0:r.array)||[],this.expressID=(null===(i=e.attributes.expressID)||void 0===i?void 0:i.array)||[],this.index=(null===(a=e.index)||void 0===a?void 0:a.array)||[],this.groups=e.groups})),Et=function(){function t(){(0,o.Z)(this,t)}return(0,u.Z)(t,null,[{key:"new",value:function(e){var n=new p.BufferGeometry;return t.set(n,"expressID",new Uint32Array(e.expressID),1),t.set(n,"position",new Float32Array(e.position),3),t.set(n,"normal",new Float32Array(e.normal),3),n.setIndex(Array.from(e.index)),n.groups=e.groups,n}},{key:"set",value:function(t,e,n,r){n.length>0&&t.setAttribute(e,new p.BufferAttribute(n,r))}}]),t}(),It=(0,u.Z)((function t(e){var n=this;(0,o.Z)(this,t),this.materials=[],this.modelID=e.modelID,this.geometry=new gt(e.geometry),Array.isArray(e.material)?e.material.forEach((function(t){n.materials.push(new mt(t))})):this.materials.push(new mt(e.material))})),Tt=function(){function t(){(0,o.Z)(this,t)}return(0,u.Z)(t,null,[{key:"new",value:function(e){var n=new W;return n.modelID=e.modelID,n.geometry=Et.new(e.geometry),t.getMaterials(e,n),n}},{key:"getMaterials",value:function(t,e){e.material=[];var n=e.material;t.materials.forEach((function(t){n.push(vt.new(t))}))}}]),t}(),yt=function(){function t(){(0,o.Z)(this,t)}return(0,u.Z)(t,[{key:"serializeVector",value:function(t){for(var e=t.size(),n={size:e},r=0;r<e;r++)n[r]=t.get(r);return n}},{key:"reconstructVector",value:function(t){return new ht(t)}},{key:"serializeIfcGeometry",value:function(t){return{GetVertexData:t.GetVertexData(),GetVertexDataSize:t.GetVertexDataSize(),GetIndexData:t.GetIndexData(),GetIndexDataSize:t.GetIndexDataSize()}}},{key:"reconstructIfcGeometry",value:function(t){return new ft(t)}},{key:"serializeFlatMesh",value:function(t){return{expressID:t.expressID,geometries:this.serializeVector(t.geometries)}}},{key:"reconstructFlatMesh",value:function(t){return new dt(this,t)}},{key:"serializeFlatMeshVector",value:function(t){for(var e=t.size(),n={size:e},r=0;r<e;r++){var i=t.get(r);n[r]=this.serializeFlatMesh(i)}return n}},{key:"reconstructFlatMeshVector",value:function(t){return new pt(this,t)}},{key:"serializeIfcModel",value:function(t){return new It(t)}},{key:"reconstructIfcModel",value:function(t){return Tt.new(t)}}]),t}(),Ct=function(){function t(e){(0,o.Z)(this,t),this.handler=e,this.API=j.properties}return(0,u.Z)(t,[{key:"getExpressId",value:function(t,e){if(!t.index)throw new Error("Geometry does not have index information.");var n=t.index.array;return t.attributes.expressID.getX(n[3*e])}},{key:"getAllItemsOfType",value:function(t,e,n){return this.handler.request(this.API,Q.getAllItemsOfType,{modelID:t,type:e,verbose:n})}},{key:"getItemProperties",value:function(t,e,n){return this.handler.request(this.API,Q.getItemProperties,{modelID:t,elementID:e,recursive:n})}},{key:"getMaterialsProperties",value:function(t,e,n){return this.handler.request(this.API,Q.getMaterialsProperties,{modelID:t,elementID:e,recursive:n})}},{key:"getPropertySets",value:function(t,e,n){return this.handler.request(this.API,Q.getPropertySets,{modelID:t,elementID:e,recursive:n})}},{key:"getTypeProperties",value:function(t,e,n){return this.handler.request(this.API,Q.getTypeProperties,{modelID:t,elementID:e,recursive:n})}},{key:"getSpatialStructure",value:function(t,e){return this.handler.request(this.API,Q.getSpatialStructure,{modelID:t,includeProperties:e})}}]),t}(),xt=function(){function t(e,n){(0,o.Z)(this,t),this.handler=e,this.serializer=n,this.API=j.webIfc}return(0,u.Z)(t,[{key:"Init",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.wasmModule=!0,t.abrupt("return",this.handler.request(this.API,Q.Init));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"OpenModel",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.OpenModel,{data:e,settings:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"CreateModel",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.CreateModel,{settings:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"ExportFileAsIFC",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.ExportFileAsIFC,{modelID:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"GetGeometry",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.serializeHandlers[this.handler.requestID]=function(t){return r.serializer.reconstructIfcGeometry(t)},t.abrupt("return",this.handler.request(this.API,Q.GetGeometry,{modelID:e,geometryExpressID:n}));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"GetLine",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.GetLine,{modelID:e,expressID:n,flatten:r}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"GetAndClearErrors",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.serializeHandlers[this.handler.requestID]=function(t){return n.serializer.reconstructVector(t)},t.abrupt("return",this.handler.request(this.API,Q.GetAndClearErrors,{modelID:e}));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"WriteLine",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.WriteLine,{modelID:e,lineObject:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"FlattenLine",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.FlattenLine,{modelID:e,line:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"GetRawLineData",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.GetRawLineData,{modelID:e,expressID:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"WriteRawLineData",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.WriteRawLineData,{modelID:e,data:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"GetLineIDsWithType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.serializeHandlers[this.handler.requestID]=function(t){return r.serializer.reconstructVector(t)},t.abrupt("return",this.handler.request(this.API,Q.GetLineIDsWithType,{modelID:e,type:n}));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"GetAllLines",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.serializeHandlers[this.handler.requestID]=function(t){return n.serializer.reconstructVector(t)},t.abrupt("return",this.handler.request(this.API,Q.GetAllLines,{modelID:e}));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"SetGeometryTransformation",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.SetGeometryTransformation,{modelID:e,transformationMatrix:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"GetCoordinationMatrix",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.GetCoordinationMatrix,{modelID:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"GetVertexArray",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.GetVertexArray,{ptr:e,size:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"GetIndexArray",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.GetIndexArray,{ptr:e,size:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getSubArray",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.getSubArray,{heap:e,startPtr:n,sizeBytes:r}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"CloseModel",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.CloseModel,{modelID:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"StreamAllMeshes",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.callbackHandlers[this.handler.requestID]={action:n,serializer:this.serializer.reconstructFlatMesh},t.abrupt("return",this.handler.request(this.API,Q.StreamAllMeshes,{modelID:e}));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"StreamAllMeshesWithTypes",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.callbackHandlers[this.handler.requestID]={action:r,serializer:this.serializer.reconstructFlatMesh},t.abrupt("return",this.handler.request(this.API,Q.StreamAllMeshesWithTypes,{modelID:e,types:n}));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"IsModelOpen",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.IsModelOpen,{modelID:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"LoadAllGeometry",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.serializeHandlers[this.handler.requestID]=function(t){return n.serializer.reconstructFlatMeshVector(t)},t.abrupt("return",this.handler.request(this.API,Q.LoadAllGeometry,{modelID:e}));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"GetFlatMesh",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.serializeHandlers[this.handler.requestID]=function(t){return r.serializer.reconstructFlatMesh(t)},t.abrupt("return",this.handler.request(this.API,Q.GetFlatMesh,{modelID:e,expressID:n}));case 2:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"SetWasmPath",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.SetWasmPath,{path:e}));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),At=function(){function t(e){(0,o.Z)(this,t),this.handler=e,this.API=j.workerState,this.state=this.handler.state}return(0,u.Z)(t,[{key:"updateStateUseJson",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.state.useJSON,t.abrupt("return",this.handler.request(this.API,Q.updateStateUseJson,{useJson:e}));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updateStateWebIfcSettings",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.state.webIfcSettings,t.abrupt("return",this.handler.request(this.API,Q.updateStateWebIfcSettings,{webIfcSettings:e}));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updateModelStateTypes",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.updateModelStateTypes,{modelID:e,types:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"updateModelStateJsonData",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.updateModelStateJsonData,{modelID:e,jsonData:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"loadJsonDataFromWorker",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.handler.request(this.API,Q.loadJsonDataFromWorker,{modelID:e,path:n}));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}();!function(t){t[t.transferIfcModel=0]="transferIfcModel",t[t.transferIndividualItems=1]="transferIndividualItems"}(ct||(ct={}));var Ft=function(){function t(){(0,o.Z)(this,t)}return(0,u.Z)(t,[{key:"save",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(n,r){var i,s=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.openOrCreateDB(r),this.createSchema(i,r),e.abrupt("return",new Promise((function(t,e){i.onsuccess=function(){return s.saveItem(n,i,r,t)}})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(n){var r,i=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.openOrCreateDB(n),e.abrupt("return",new Promise((function(t,e){r.onsuccess=function(){return i.loadItem(r,n,t)}})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSchema",value:function(t,e){t.onupgradeneeded=function(){t.result.createObjectStore(e.toString(),{keyPath:"id"})}}},{key:"saveItem",value:function(e,n,r,i){var a=t.getDBItems(n,r),s=a.db,o=a.tx,u=a.store;e.id=r,u.put(e),o.oncomplete=function(){return t.closeDB(s,o,i)}}},{key:"loadItem",value:function(e,n,r){var i=t.getDBItems(e,n),a=i.db,s=i.tx,o=i.store.get(n),u=function(){delete o.result.id,r(o.result)};s.oncomplete=function(){return t.closeDB(a,s,u)}}}],[{key:"getDBItems",value:function(t,e){var n=t.result,r=n.transaction(e.toString(),"readwrite"),i=r.objectStore(e.toString());return{db:n,tx:r,store:i}}},{key:"openOrCreateDB",value:function(t){return indexedDB.open(t.toString(),1)}},{key:"closeDB",value:function(t,e,n){t.close(),n("success")}}]),t}(),_t=function(){function t(e,n,r,i){var a;(0,o.Z)(this,t),this.handler=e,this.serializer=n,this.BVH=r,this.IDB=i,this.optionalCategories=(a={},(0,V.Z)(a,C.IFCSPACE,!0),(0,V.Z)(a,C.IFCOPENINGELEMENT,!1),a),this.API=j.parser}return(0,u.Z)(t,[{key:"setupOptionalCategories",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.optionalCategories=e,t.abrupt("return",this.handler.request(this.API,Q.setupOptionalCategories,{config:e}));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"parse",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.handler.onprogressHandlers[this.handler.requestID]=function(t){r.handler.state.onProgress&&r.handler.state.onProgress(t)},this.handler.serializeHandlers[this.handler.requestID]=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.updateState(e.modelID),t.abrupt("return",r.getModel());case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.abrupt("return",this.handler.request(this.API,Q.parse,{buffer:e,coordinationMatrix:n}));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getAndClearErrors",value:function(t){}},{key:"updateState",value:function(t){this.handler.state.models[t]={modelID:t,mesh:{},types:{},jsonData:{}}}},{key:"getModel",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.IDB.load(ct.transferIfcModel);case 2:return e=t.sent,n=this.serializer.reconstructIfcModel(e),this.BVH.applyThreeMeshBVH(n.geometry),this.handler.state.models[n.modelID].mesh=n,t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),Pt=function(){function t(e,n){var r=this;(0,o.Z)(this,t),this.state=e,this.BVH=n,this.requestID=0,this.rejectHandlers={},this.resolveHandlers={},this.serializeHandlers={},this.callbackHandlers={},this.onprogressHandlers={},this.serializer=new yt,this.IDB=new Ft,this.workerPath=this.state.worker.path,this.ifcWorker=new Worker(this.workerPath),this.ifcWorker.onmessage=function(t){return r.handleResponse(t)},this.properties=new Ct(this),this.parser=new _t(this,this.serializer,this.BVH,this.IDB),this.webIfc=new xt(this,this.serializer),this.workerState=new At(this)}return(0,u.Z)(t,[{key:"request",value:function(t,e,n){var r=this,i={worker:t,action:e,args:n,id:this.requestID,result:void 0,onProgress:!1};return new Promise((function(t,e){r.resolveHandlers[r.requestID]=t,r.rejectHandlers[r.requestID]=e,r.requestID++,r.ifcWorker.postMessage(i)}))}},{key:"terminate",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.request(j.workerState,Q.dispose);case 2:return t.next=4,this.request(j.webIfc,Q.DisposeWebIfc);case 4:this.ifcWorker.terminate();case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"Close",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.request(j.webIfc,Q.Close);case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"handleResponse",value:function(t){var e=t.data;e.onProgress?this.resolveOnProgress(e):(this.callHandlers(e),delete this.resolveHandlers[e.id],delete this.rejectHandlers[e.id],delete this.onprogressHandlers[e.id])}},{key:"callHandlers",value:function(t){try{this.resolveSerializations(t),this.resolveCallbacks(t),this.resolveHandlers[t.id](t.result)}catch(e){this.rejectHandlers[t.id](e)}}},{key:"resolveOnProgress",value:function(t){this.onprogressHandlers[t.id]&&(t.result=this.onprogressHandlers[t.id](t.result))}},{key:"resolveSerializations",value:function(t){this.serializeHandlers[t.id]&&(t.result=this.serializeHandlers[t.id](t.result),delete this.serializeHandlers[t.id])}},{key:"resolveCallbacks",value:function(t){if(this.callbackHandlers[t.id]){var e=t.result;this.callbackHandlers[t.id].serializer&&(e=this.callbackHandlers[t.id].serializer(t.result)),this.callbackHandlers[t.id].action(e)}}}]),t}(),St=function(){function t(e){(0,o.Z)(this,t),this.state=e}return(0,u.Z)(t,[{key:"dispose",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Object.keys(this.state.models).forEach((function(t){var n=e.state.models[parseInt(t,10)];n.mesh.removeFromParent();var r=n.mesh.geometry;r.disposeBoundsTree&&r.disposeBoundsTree(),r.dispose(),Array.isArray(n.mesh.material)?n.mesh.material.forEach((function(t){return t.dispose()})):n.mesh.material.dispose(),n.mesh=null,n.types=null,n.jsonData=null})),this.state.api=null,this.state.models=null;case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),Rt=function(){function t(e){(0,o.Z)(this,t),this.state=e,this.map={}}return(0,u.Z)(t,[{key:"getMapping",value:function(){this.map=this.reverseElementMapping(at)}},{key:"releaseMapping",value:function(){this.map={}}},{key:"reverseElementMapping",value:function(t){var e={};return Object.keys(t).forEach((function(n){e[t[n]]=n})),e}},{key:"isA",value:function(t,e){var n=!1;return e?(at[t.type]===e.toUpperCase()&&(n=!0),n):at[t.type]}},{key:"byId",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.state.api.GetLine(e,n));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"idsByType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.getMapping(),t.next=3,this.state.api.GetLineIDsWithType(e,Number(this.map[n.toUpperCase()]));case 3:return r=t.sent,this.releaseMapping(),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"byType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.idsByType(e,n);case 2:if(null===(r=t.sent)){t.next=17;break}this.getMapping(),i=[],s=0;case 7:if(!(s<r.size())){t.next=15;break}return t.next=10,this.byId(e,r.get(s));case 10:o=t.sent,i.push(o);case 12:s++,t.next=7;break;case 15:return this.releaseMapping(),t.abrupt("return",i);case 17:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),Ot=function(){function t(e){(0,o.Z)(this,t),this.state=e,this.isLoaded=!1,this.workPlans={},this.workSchedules={},this.workCalendars={},this.workTimes={},this.recurrencePatterns={},this.timePeriods={},this.tasks={},this.taskTimes={},this.lagTimes={},this.sequences={},this.utils=new Rt(this.state)}return(0,u.Z)(t,[{key:"load",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadTasks(e);case 2:return t.next=4,this.loadWorkSchedules(e);case 4:return t.next=6,this.loadWorkCalendars(e);case 6:return t.next=8,this.loadWorkTimes(e);case 8:return t.next=10,this.loadTimePeriods(e);case 10:this.isLoaded=!0;case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadWorkSchedules",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcWorkSchedule");case 2:for(n=t.sent,r=0;r<n.length;r++)i=n[r],this.workSchedules[i.expressID]={Id:i.expressID,Name:i.Name.value,Description:i.Description?i.Description.value:"",Creators:[],CreationDate:i.CreationDate?i.CreationDate.value:"",StartTime:i.StartTime?i.StartTime.value:"",FinishTime:i.FinishTime?i.FinishTime.value:"",TotalFloat:i.TotalFloat?i.TotalFloat.value:"",RelatedObjects:[]};this.loadWorkScheduleRelatedObjects(e);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadWorkScheduleRelatedObjects",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcRelAssignsToControl");case 2:n=t.sent,r=0;case 4:if(!(r<n.length)){t.next=14;break}return i=n[r],t.next=8,this.utils.byId(e,i.RelatingControl.value);case 8:if(s=t.sent,o=i.RelatedObjects,this.utils.isA(s,"IfcWorkSchedule"))for(u=0;u<o.length;u++)this.workSchedules[s.expressID].RelatedObjects.push(o[u].value);case 11:r++,t.next=4;break;case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadTasks",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcTask");case 2:n=t.sent,r=0;case 4:if(!(r<n.length)){t.next=33;break}if(i=n[r],t.t0=i.expressID,t.t1=i.Name?i.Name.value:"",t.t2=i.PredefinedType?i.PredefinedType.value:"",!i.TaskTime){t.next=15;break}return t.next=12,this.utils.byId(e,i.TaskTime.value);case 12:t.t3=t.sent,t.next=16;break;case 15:t.t3="";case 16:t.t4=t.t3,t.t5=i.Identification?i.Identification.value:"",t.t6=i.IsMilestone?i.IsMilestone.value:"",t.t7=[],t.t8=[],t.t9=[],t.t10=[],t.t11=[],t.t12=[],t.t13=[],t.t14=[],t.t15=[],t.t16=[],this.tasks[i.expressID]={Id:t.t0,Name:t.t1,PredefinedType:t.t2,TaskTime:t.t4,Identification:t.t5,IsMilestone:t.t6,IsPredecessorTo:t.t7,IsSucessorFrom:t.t8,Inputs:t.t9,Resources:t.t10,Outputs:t.t11,Controls:t.t12,Nests:t.t13,IsNestedBy:t.t14,OperatesOn:t.t15,HasAssignmentsWorkCalendars:t.t16};case 30:r++,t.next=4;break;case 33:return t.next=35,this.loadTaskSequence(e);case 35:return t.next=37,this.loadTaskOutputs(e);case 37:return t.next=39,this.loadTaskNesting(e);case 39:return t.next=41,this.loadTaskOperations(e);case 41:return t.next=43,this.loadAssignementsWorkCalendar(e);case 43:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadTaskSequence",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.idsByType(e,"IfcRelSequence");case 2:n=t.sent,r=0;case 4:if(!(r<n.size())){t.next=17;break}if(0===(i=n.get(r))){t.next=14;break}return t.next=9,this.utils.byId(e,i);case 9:s=t.sent,o=s.RelatedProcess.value,u=s.RelatingProcess.value,this.tasks[u].IsPredecessorTo.push(s.expressID),this.tasks[o].IsSucessorFrom.push(s.expressID);case 14:r++,t.next=4;break;case 17:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadTaskOutputs",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcRelAssignsToProduct");case 2:n=t.sent,r=0;case 4:if(!(r<n.length)){t.next=17;break}return i=n[r],t.next=8,this.utils.byId(e,i.RelatedObjects[0].value);case 8:if(s=t.sent,!this.utils.isA(s,"IfcTask")){t.next=14;break}return t.next=12,this.utils.byId(e,i.RelatingProduct.value);case 12:o=t.sent,this.tasks[s.expressID].Outputs.push(o.expressID);case 14:r++,t.next=4;break;case 17:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadTaskNesting",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcRelNests");case 2:n=t.sent,r=0;case 4:if(!(r<n.length)){t.next=13;break}return i=n[r],t.next=8,this.utils.byId(e,i.RelatingObject.value);case 8:if(s=t.sent,this.utils.isA(s,"IfcTask"))for(o=i.RelatedObjects,u=0;u<o.length;u++)this.tasks[s.expressID].IsNestedBy.push(o[u].value),this.tasks[o[u].value].Nests.push(s.expressID);case 10:r++,t.next=4;break;case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadTaskOperations",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcRelAssignsToProcess");case 2:n=t.sent,r=0;case 4:if(!(r<n.length)){t.next=13;break}return i=n[r],t.next=8,this.utils.byId(e,i.RelatingProcess.value);case 8:if(s=t.sent,this.utils.isA(s,"IfcTask"))for(o=i.RelatedObjects,u=0;u<o.length;u++)this.tasks[s.expressID].OperatesOn.push(o[u].value);case 10:r++,t.next=4;break;case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadAssignementsWorkCalendar",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcRelAssignsToControl");case 2:n=t.sent,r=0;case 4:if(!(r<n.length)){t.next=13;break}return i=n[r],t.next=8,this.utils.byId(e,i.RelatingControl.value);case 8:if(s=t.sent,this.utils.isA(s,"IfcWorkCalendar"))for(o=i.RelatedObjects,u=0;u<o.length;u++)this.tasks[o[u].value].HasAssignmentsWorkCalendars.push(s.expressID);case 10:r++,t.next=4;break;case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadWorkCalendars",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcWorkCalendar");case 2:for(n=t.sent,r=0;r<n.length;r++)i=n[r],s={Id:i.expressID,Name:i.Name?i.Name.value:"",Description:i.Description?i.Description.value:"",WorkingTimes:i.WorkingTimes?i.WorkingTimes:[],ExceptionTimes:i.ExceptionTimes?i.ExceptionTimes:[]},this.workCalendars[i.expressID]=s;case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadWorkTimes",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcWorkTime");case 2:n=t.sent,r=0;case 4:if(!(r<n.length)){t.next=22;break}if(i=n[r],t.t0=i.Name?i.Name.value:"",!i.RecurrencePattern){t.next=13;break}return t.next=10,this.utils.byId(e,i.RecurrencePattern.value);case 10:t.t1=t.sent,t.next=14;break;case 13:t.t1="";case 14:t.t2=t.t1,t.t3=i.Start?new Date(i.Start.value):"",t.t4=i.Finish?new Date(i.Finish.value):"",s={Name:t.t0,RecurrencePattern:t.t2,Start:t.t3,Finish:t.t4},this.workTimes[i.expressID]=s;case 19:r++,t.next=4;break;case 22:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadTimePeriods",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.utils.byType(e,"IfcTimePeriod");case 2:for(n=t.sent,r=0;r<n.length;r++)i=n[r],s={StartTime:i.StartTime?new Date(i.StartTime.value):"",EndTime:i.EndTime?new Date(i.EndTime.value):""},this.timePeriods[i.expressID]=s;case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),wt=function(){function t(){(0,o.Z)(this,t),this.state={models:[],api:new C.IfcAPI,useJSON:!1,worker:{active:!1,path:""}},this.BVH=new lt,this.typesMap=at,this.parser=new q(this.state,this.BVH),this.subsets=new tt(this.state,this.BVH),this.utils=new Rt(this.state),this.sequenceData=new Ot(this.state),this.properties=new ot(this.state),this.types=new ut(this.state),this.cleaner=new St(this.state)}return(0,u.Z)(t,[{key:"ifcAPI",get:function(){return this.state.api}},{key:"parse",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.parser.parse(e,null===(n=this.state.coordinationMatrix)||void 0===n?void 0:n.toArray());case 2:return(r=t.sent).setIFCManager(this),t.next=6,this.types.getAllTypes(this.worker);case 6:return t.abrupt("return",r);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setWasmPath",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.state.api.SetWasmPath(e),this.state.wasmPath=e;case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setupThreeMeshBVH",value:function(t,e,n){this.BVH.initializeMeshBVH(t,e,n)}},{key:"setOnProgress",value:function(t){this.state.onProgress=t}},{key:"setupCoordinationMatrix",value:function(t){this.state.coordinationMatrix=t}},{key:"clearCoordinationMatrix",value:function(){delete this.state.coordinationMatrix}},{key:"applyWebIfcConfig",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.webIfcSettings=e,!this.state.worker.active||!this.worker){t.next=4;break}return t.next=4,this.worker.workerState.updateStateWebIfcSettings();case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"useWebWorkers",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.worker.active!==e){t.next=2;break}return t.abrupt("return");case 2:if(this.state.api=null,!e){t.next=16;break}if(n){t.next=6;break}throw new Error("You must provide a path to the web worker.");case 6:return this.state.worker.active=e,this.state.worker.path=n,t.next=10,this.initializeWorkers();case 10:if(!(r=this.state.wasmPath)){t.next=14;break}return t.next=14,this.setWasmPath(r);case 14:t.next=17;break;case 16:this.state.api=new C.IfcAPI;case 17:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"useJSONData",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n,r=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=!(r.length>0&&void 0!==r[0])||r[0],this.state.useJSON=e,!e){t.next=5;break}return t.next=5,null===(n=this.worker)||void 0===n?void 0:n.workerState.updateStateUseJson();case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addModelJSONData",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.state.models[e]){t.next=3;break}throw new Error("The specified model for the JSON data does not exist");case 3:if(!this.state.worker.active){t.next=8;break}return t.next=6,null===(r=this.worker)||void 0===r?void 0:r.workerState.updateModelStateJsonData(e,n);case 6:t.next=9;break;case 8:i.jsonData=n;case 9:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"loadJsonDataFromWorker",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.state.worker.active){t.next=3;break}return t.next=3,null===(r=this.worker)||void 0===r?void 0:r.workerState.loadJsonDataFromWorker(e,n);case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"close",value:function(t,e){this.state.api.CloseModel(t),e&&e.remove(this.state.models[t].mesh),delete this.state.models[t]}},{key:"getExpressId",value:function(t,e){return this.properties.getExpressId(t,e)}},{key:"getAllItemsOfType",value:function(t,e,n){return this.properties.getAllItemsOfType(t,e,n)}},{key:"getItemProperties",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.properties.getItemProperties(t,e,n)}},{key:"getPropertySets",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.properties.getPropertySets(t,e,n)}},{key:"getTypeProperties",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.properties.getTypeProperties(t,e,n)}},{key:"getMaterialsProperties",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.properties.getMaterialsProperties(t,e,n)}},{key:"getIfcType",value:function(t,e){var n=this.state.models[t].types[e];return rt[n]}},{key:"getSpatialStructure",value:function(t,e){return this.properties.getSpatialStructure(t,e)}},{key:"getSubset",value:function(t,e,n){return this.subsets.getSubset(t,e,n)}},{key:"removeSubset",value:function(t,e,n){this.subsets.removeSubset(t,e,n)}},{key:"createSubset",value:function(t){return this.subsets.createSubset(t)}},{key:"removeFromSubset",value:function(t,e,n,r){return this.subsets.removeFromSubset(t,e,n,r)}},{key:"clearSubset",value:function(t,e,n){return this.subsets.clearSubset(t,e,n)}},{key:"isA",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.utils.isA(e,n));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getSequenceData",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sequenceData.load(e);case 2:return t.abrupt("return",this.sequenceData);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"byType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.utils.byType(e,n));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"byId",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.utils.byId(e,n));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"idsByType",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.utils.idsByType(e,n));case 1:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"dispose",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return W.dispose(),t.next=3,this.cleaner.dispose();case 3:if(this.subsets.dispose(),!this.worker||!this.state.worker.active){t.next=7;break}return t.next=7,this.worker.terminate();case 7:this.state=null;case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"disposeMemory",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.state.worker.active){t.next=5;break}return t.next=3,null===(e=this.worker)||void 0===e?void 0:e.Close();case 3:t.next=8;break;case 5:this.state.api.Close(),this.state.api=null,this.state.api=new C.IfcAPI;case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getAndClearErrors",value:function(t){return this.parser.getAndClearErrors(t)}},{key:"initializeWorkers",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.worker=new Pt(this.state,this.BVH),this.state.api=this.worker.webIfc,this.properties=this.worker.properties,t.next=5,this.worker.parser.setupOptionalCategories(this.parser.optionalCategories);case 5:return this.parser=this.worker.parser,t.next=8,this.worker.workerState.updateStateUseJson();case 8:return t.next=10,this.worker.workerState.updateStateWebIfcSettings();case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),Mt=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).ifcManager=new wt,r}return(0,u.Z)(n,[{key:"load",value:function(t,e,n,r){var i=this,o=new p.FileLoader(i.manager);this.onProgress=n,o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(t,function(){var n=(0,s.Z)((0,a.Z)().mark((function n(s){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,"string"!=typeof s){n.next=3;break}throw new Error("IFC files must be given as a buffer!");case 3:return n.t0=e,n.next=6,i.parse(s);case 6:n.t1=n.sent,(0,n.t0)(n.t1),n.next=14;break;case 10:n.prev=10,n.t2=n.catch(0),r?r(n.t2):console.error(n.t2),i.manager.itemError(t);case 14:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(t){return n.apply(this,arguments)}}(),n,r)}},{key:"parse",value:function(t){return this.ifcManager.parse(t)}}]),n}(p.Loader),Nt=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r,i){var u;return(0,o.Z)(this,n),(u=e.call(this,t)).context=t,u.meshes=new Set,u.fastRemovePrevious=!1,u.renderOrder=0,u.modelIDs=new Set,u.selectedFaces={},u.pick=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,l,c=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=c.length>1&&void 0!==c[1]&&c[1],r=!(c.length>2&&void 0!==c[2])||c[2],s=e.object,void 0!==e.faceIndex&&!(null===(i=u.selectedFaces[s.modelID])||void 0===i?void 0:i.has(e.faceIndex))){t.next=5;break}return t.abrupt("return",null);case 5:if(void 0!==(o=u.loader.ifcManager.getExpressId(s.geometry,e.faceIndex))){t.next=8;break}return t.abrupt("return",null);case 8:if(r&&(u.fastRemovePrevious?(u.toggleVisibility(!1),u.modelIDs.clear(),u.selectedFaces={}):u.unpick()),u.selectedFaces[s.modelID]||(u.selectedFaces[s.modelID]=new Set),u.selectedFaces[s.modelID].add(e.faceIndex),u.modelIDs.add(s.modelID),(l=u.newSelection(s.modelID,[o],r)).position.copy(s.position),l.rotation.copy(s.rotation),l.scale.copy(s.scale),l.visible=!0,l.renderOrder=u.renderOrder,!n){t.next=21;break}return t.next=21,u.focusSelection(l);case 21:return t.abrupt("return",{modelID:s.modelID,id:o});case 22:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),u.pickByID=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s,o,l=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=l.length>2&&void 0!==l[2]&&l[2],i=!(l.length>3&&void 0!==l[3])||l[3],s=u.context.items.ifcModels.find((function(t){return t.modelID===e}))){t.next=5;break}return t.abrupt("return");case 5:if(i&&u.modelIDs.clear(),u.modelIDs.add(e),(o=u.newSelection(e,n,i)).visible=!0,o.position.copy(s.position),o.rotation.copy(s.rotation),o.scale.copy(s.scale),o.renderOrder=u.renderOrder,!r){t.next=16;break}return t.next=16,u.focusSelection(o);case 16:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),u.newSelection=function(t,e,n){var r=u.loader.ifcManager.createSubset({scene:u.scene,modelID:t,ids:e,removePrevious:n,material:u.material});return r&&(u.meshes.add(r),u.context.renderer.postProduction.excludedItems.add(r)),r},u.scene=t.getScene(),u.loader=r,i&&(u.material=i),u}return(0,u.Z)(n,[{key:"dispose",value:function(){var t;this.meshes.forEach((function(t){t.removeFromParent(),t.geometry.dispose()})),null===(t=this.material)||void 0===t||t.dispose(),this.meshes=null,this.material=null,this.scene=null,this.loader=null,this.context=null}},{key:"unpick",value:function(){var t,e=(0,Y.Z)(this.modelIDs);try{for(e.s();!(t=e.n()).done;){var n=t.value;this.loader.ifcManager.removeSubset(n,this.material)}}catch(r){e.e(r)}finally{e.f()}this.modelIDs.clear(),this.meshes.clear(),this.selectedFaces={}}},{key:"toggleVisibility",value:function(t){this.meshes.forEach((function(e){return e.visible=t}))}},{key:"focusSelection",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.context.renderer.postProduction.active,this.context.renderer.postProduction.active=!1,t.next=4,this.context.ifcCamera.targetItem(e);case 4:this.context.renderer.postProduction.active=n;case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),n}(c),Lt=function(){function t(e,n){(0,o.Z)(this,t),this.context=e,this.ifc=n,this.userDataField="ifcjsFadedModel",this.defSelectMat=this.initializeDefMaterial(16724991,.3),this.defPreselectMat=this.initializeDefMaterial(16733695,.5),this.defHighlightMat=this.initializeDefMaterial(15658734,.05),this.preselection=new Nt(e,this.ifc.loader,this.defPreselectMat),this.preselection.fastRemovePrevious=!0,this.selection=new Nt(e,this.ifc.loader,this.defSelectMat),this.highlight=new Nt(e,this.ifc.loader),this.highlight.renderOrder=-1}return(0,u.Z)(t,[{key:"dispose",value:function(){var t,e,n;null===(t=this.defPreselectMat)||void 0===t||t.dispose(),this.defHighlightMat=null,null===(e=this.defSelectMat)||void 0===e||e.dispose(),this.defSelectMat=null,null===(n=this.defHighlightMat)||void 0===n||n.dispose(),this.defHighlightMat=null,this.preselection.dispose(),this.preselection=null,this.selection.dispose(),this.selection=null,this.highlight.dispose(),this.highlight=null}},{key:"prePickIfcItem",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.context.castRayIfc()){t.next=4;break}return this.preselection.toggleVisibility(!1),t.abrupt("return");case 4:return t.next=6,this.preselection.pick(e);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"pickIfcItem",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n,r,i,s=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]&&s[0],n=!(s.length>1&&void 0!==s[1])||s[1],r=this.context.castRayIfc()){t.next=5;break}return t.abrupt("return",null);case 5:return t.next=7,this.selection.pick(r,e,n);case 7:if(null!=(i=t.sent)&&null!=i.modelID&&null!=i.id){t.next=10;break}return t.abrupt("return",null);case 10:return t.abrupt("return",i);case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"highlightIfcItem",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n,r,i,s=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]&&s[0],n=!(s.length>1&&void 0!==s[1])||s[1],r=this.context.castRayIfc()){t.next=5;break}return t.abrupt("return",null);case 5:return this.fadeAwayModels(),t.next=8,this.highlight.pick(r,e,n);case 8:if(null!=(i=t.sent)&&null!=i.modelID&&null!=i.id){t.next=11;break}return t.abrupt("return",null);case 11:return t.abrupt("return",i);case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"pickIfcItemsByID",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i=!(s.length>3&&void 0!==s[3])||s[3],t.next=4,this.selection.pickByID(e,n,r,i);case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"prepickIfcItemsByID",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i=!(s.length>3&&void 0!==s[3])||s[3],t.next=4,this.preselection.pickByID(e,n,r,i);case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"highlightIfcItemsByID",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i,s=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>2&&void 0!==s[2]&&s[2],i=!(s.length>3&&void 0!==s[3])||s[3],this.fadeAwayModels(),t.next=5,this.highlight.pickByID(e,n,r,i);case 5:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"unpickIfcItems",value:function(){this.selection.unpick()}},{key:"unPrepickIfcItems",value:function(){this.preselection.unpick()}},{key:"unHighlightIfcItems",value:function(){var t=this;this.context.items.ifcModels.forEach((function(e){return t.unHighlightItem(e)})),this.highlight.unpick(),this.context.renderer.postProduction.active&&(this.context.renderer.postProduction.visible=!0)}},{key:"unHighlightItem",value:function(t){var e=t.userData[this.userDataField];e&&e.parent&&(e.parent.add(t),e.removeFromParent())}},{key:"fadeAwayModels",value:function(){var t=this;this.context.items.ifcModels.forEach((function(e){if(!e.userData[t.userDataField]){var n=new p.Mesh(e.geometry,t.defHighlightMat);e.userData[t.userDataField]=n,t.context.renderer.postProduction.excludedItems.add(n)}if(e.parent){var r=e.userData[t.userDataField];r.position.copy(e.position),r.rotation.copy(e.rotation),r.scale.copy(e.scale),e.parent.add(r),e.removeFromParent()}}))}},{key:"initializeDefMaterial",value:function(t,e){var n=this.context.getClippingPlanes();return new p.MeshLambertMaterial({color:t,opacity:e,transparent:!0,depthTest:!1,side:p.DoubleSide,clippingPlanes:n})}}]),t}(),bt=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,3940055652,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),kt=function(){function t(e,n){(0,o.Z)(this,t),this.context=e,this.loader=n}return(0,u.Z)(t,[{key:"dispose",value:function(){this.context=null,this.loader=null,this.webIfc=null}},{key:"serializeAllProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){var i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.webIfc=this.loader.ifcManager.ifcAPI,e){t.next=3;break}throw new Error("The requested model was not found.");case 3:return i=[],t.next=6,this.getPropertiesAsBlobs(e.modelID,i,n,r);case 6:return t.abrupt("return",i);case 7:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"getPropertiesAsBlobs",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r,i){var s,o,u,l,c,h,f,d;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getAllGeometriesIDs(e);case 2:return s=t.sent,t.next=5,this.initializePropertiesObject(e);case 5:return o=t.sent,t.next=8,this.webIfc.GetAllLines(e);case 8:u=t.sent,l=u.size(),c=.1,h=0,f=0;case 13:if(!(f<l)){t.next=24;break}if(d=u.get(f),s.has(d)){t.next=19;break}return t.next=18,this.getItemProperty(e,d,o);case 18:h++;case 19:r&&h>r&&(n.push(new Blob([JSON.stringify(o)],{type:"application/json"})),o={},h=0),i&&f/l>c&&(i(f,l),c+=.1);case 21:f++,t.next=13;break;case 24:n.push(new Blob([JSON.stringify(o)],{type:"application/json"}));case 25:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i){return t.apply(this,arguments)}}()},{key:"getItemProperty",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){var i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.webIfc.GetLine(e,n);case 3:(i=t.sent).type&&(i.type=this.loader.ifcManager.typesMap[i.type]),this.formatItemProperties(i),r[n]=i,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.log("There was a problem getting the properties of the item with ID ".concat(n));case 12:case"end":return t.stop()}}),t,this,[[0,9]])})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"formatItemProperties",value:function(t){Object.keys(t).forEach((function(e){var n=t[e];n&&void 0!==n.value?t[e]=n.value:Array.isArray(n)&&(t[e]=n.map((function(t){return t&&t.value?t.value:t})))}))}},{key:"initializePropertiesObject",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.webIfc.GetCoordinationMatrix(e);case 2:return t.t0=t.sent,t.next=5,this.getBuildingHeight(e);case 5:return t.t1=t.sent,t.abrupt("return",{coordinationMatrix:t.t0,globalHeight:t.t1});case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getBuildingHeight",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getBuilding(e);case 2:return n=t.sent,i=n.ObjectPlacement.PlacementRelTo,r=i?i.RelativePlacement.Location:n.ObjectPlacement.RelativePlacement.Location,s=r.Coordinates.map((function(t){return t.value})),t.abrupt("return",s[2]);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getBuilding",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.loader.ifcManager,t.next=3,n.getAllItemsOfType(e,C.IFCBUILDING,!1);case 3:return r=t.sent,i=r[0],t.abrupt("return",n.getItemProperties(e,i,!0));case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getAllGeometriesIDs",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u,l;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new Set,r=Array.from(bt),i=0;case 3:if(!(i<r.length)){t.next=13;break}return s=r[i],t.next=7,this.webIfc.GetLineIDsWithType(e,s);case 7:for(o=t.sent,u=o.size(),l=0;l<u;l++)n.add(o.get(l));case 10:i++,t.next=3;break;case 13:return t.abrupt("return",n);case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),Dt=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).context=t,r.loader=new Mt,r.setupThreeMeshBVH(),r.selector=new Lt(t,(0,B.Z)(r)),r.units=new A((0,B.Z)(r)),r.properties=new kt(t,r.loader),r}return(0,u.Z)(n,[{key:"dispose",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.context=null,this.selector.dispose(),this.selector=null,this.units.dispose(),this.units=null,this.properties.dispose(),this.properties=null,t.next=9,this.loader.ifcManager.dispose();case 9:this.loader=null;case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"loadIfc",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=s.length>1&&void 0!==s[1]&&s[1],r=s.length>2?s[2]:void 0,i=URL.createObjectURL(e),t.abrupt("return",this.loadIfcUrl(i,n,void 0,r));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadIfcUrl",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u,l,c,h,f,d=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=d.length>1&&void 0!==d[1]&&d[1],r=d.length>2?d[2]:void 0,i=d.length>3?d[3]:void 0,t.prev=3,s=Boolean(0===this.context.items.ifcModels.length),o=this.loader.ifcManager.state.webIfcSettings,u=(null===o||void 0===o?void 0:o.USE_FAST_BOOLS)||!0,l=(null===o||void 0===o?void 0:o.COORDINATE_TO_ORIGIN)||!1,t.next=10,this.loader.ifcManager.applyWebIfcConfig({COORDINATE_TO_ORIGIN:s&&l,USE_FAST_BOOLS:u});case 10:return t.next=12,this.loader.loadAsync(e,r);case 12:if(c=t.sent,this.addIfcModel(c),!s||!l){t.next=20;break}return t.next=17,this.loader.ifcManager.ifcAPI.GetCoordinationMatrix(c.modelID);case 17:h=t.sent,f=(new p.Matrix4).fromArray(h),this.loader.ifcManager.setupCoordinationMatrix(f);case 20:return n&&this.context.fitToFrame(),t.abrupt("return",c);case 24:return t.prev=24,t.t0=t.catch(3),console.error("Error loading IFC."),console.error(t.t0),i&&i(t.t0),t.abrupt("return",null);case 30:case"end":return t.stop()}}),t,this,[[3,24]])})));return function(e){return t.apply(this,arguments)}}()},{key:"setWasmPath",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loader.ifcManager.setWasmPath(e);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"applyWebIfcConfig",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loader.ifcManager.applyWebIfcConfig(e);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSpatialStructure",value:function(t,e){return this.loader.ifcManager.getSpatialStructure(t,e)}},{key:"getProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r,i){var s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e&&null!=n){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,this.loader.ifcManager.getItemProperties(e,n,i);case 4:if(s=t.sent,!r){t.next=15;break}return t.next=8,this.loader.ifcManager.getPropertySets(e,n,i);case 8:return s.psets=t.sent,t.next=11,this.loader.ifcManager.getMaterialsProperties(e,n,i);case 11:return s.mats=t.sent,t.next=14,this.loader.ifcManager.getTypeProperties(e,n,i);case 14:s.type=t.sent;case 15:return t.abrupt("return",s);case 16:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i){return t.apply(this,arguments)}}()},{key:"getModelID",value:function(){var t=this.context.castRayIfc();if(!t)return null;var e=t.object;return e&&void 0!==e.modelID&&null!==e.modelID?e.modelID:null}},{key:"getAllItemsOfType",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.loader.ifcManager.getAllItemsOfType(t,e,n)}},{key:"prePickIfcItem",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.selector.prePickIfcItem();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"pickIfcItem",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]&&n[0],t.abrupt("return",this.selector.pickIfcItem(e));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"highlightIfcItem",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]&&n[0],t.abrupt("return",this.selector.highlightIfcItem(e));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"pickIfcItemsByID",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],t.next=3,this.selector.pickIfcItemsByID(e,n,r);case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"prepickIfcItemsByID",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],t.next=3,this.selector.prepickIfcItemsByID(e,n,r);case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"highlightIfcItemsByID",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r,i=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]&&i[2],t.next=3,this.selector.highlightIfcItemsByID(e,n,r);case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"unpickIfcItems",value:function(){this.selector.unpickIfcItems()}},{key:"unPrepickIfcItems",value:function(){this.selector.unPrepickIfcItems()}},{key:"unHighlightIfcItems",value:function(){this.selector.unHighlightIfcItems()}},{key:"addIfcModel",value:function(t){this.context.items.ifcModels.push(t),this.context.items.pickableIfcModels.push(t),this.context.getScene().add(t)}},{key:"setupThreeMeshBVH",value:function(){this.loader.ifcManager.setupThreeMeshBVH(G.computeBoundsTree,G.disposeBoundsTree,G.acceleratedRaycast)}}]),n}(c),Ut=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r){var i;return(0,o.Z)(this,n),(i=e.call(this,t)).onDBChooserSuccess=function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,s,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e[0].link);case 2:return n=t.sent,t.next=5,n.text();case 5:r=t.sent,s=new Blob([r],{type:"text/plain"}),o=new File([s],"ifcFile"),i.loader.loadIfc(o);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i.getOptions=function(){return{success:i.onDBChooserSuccess,cancel:i.onDBChooserCancel,linkType:"direct",multiselect:!1,extensions:[".ifc"],folderselect:!1}},i.loader=r,i.counter=0,i}return(0,u.Z)(n,[{key:"initializeAPI",value:function(){var t=document.createElement("script");t.type="text/javascript",t.src="https://www.dropbox.com/static/api/2/dropins.js",t.id="dropboxjs",t.setAttribute("data-app-key","iej3z16hhyca35a"),document.getElementsByTagName("head")[0].appendChild(t)}},{key:"loadDropboxIfc",value:function(){this.openDropboxChooser(this.getOptions())}},{key:"openDropboxChooser",value:function(t){var e=this;try{if(Dropbox)return Dropbox.choose(this.getOptions()),clearTimeout(this.tid)}catch(n){if(this.counter++>9)return this.errorOnConnection();this.tid=setTimeout((function(){return e.openDropboxChooser(t)}),2e3)}return null}},{key:"errorOnConnection",value:function(){console.error("Error: could not communicate with dropbox"),clearTimeout(this.tid)}},{key:"onDBChooserCancel",value:function(t){console.log("Canceled!")}}]),n}(c),Zt=1,Bt=2,Gt=4,Yt=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768});function Vt(t){return t.isPerspectiveCamera}function zt(t){return t.isOrthographicCamera}var Ht=2*Math.PI,Xt=Math.PI/2,Wt=1e-5;function Qt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wt;return Math.abs(t)<e}function jt(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Wt;return Qt(t-e,n)}function qt(t,e){return Math.round(t/e)*e}function Kt(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Jt(t){return Math.abs(t)<Number.MAX_VALUE?t:t*(1/0)}function $t(t,e){e.set(0,0),t.forEach((function(t){e.x+=t.clientX,e.y+=t.clientY})),e.x/=t.length,e.y/=t.length}function te(t,e){return!!zt(t)&&(console.warn("".concat(e," is not supported in OrthographicCamera")),!0)}function ee(t){return t.invert?t.invert():t.inverse(),t}var ne,re,ie,ae,se,oe,ue,le,ce,he,fe,de,pe,me,ve,ge,Ee,Ie,Te,ye,Ce,xe,Ae=function(){function t(){(0,o.Z)(this,t),this._listeners={}}return(0,u.Z)(t,[{key:"addEventListener",value:function(t,e){var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}},{key:"hasEventListener",value:function(t,e){var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}},{key:"removeEventListener",value:function(t,e){var n=this._listeners[t];if(void 0!==n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}}},{key:"removeAllEventListeners",value:function(t){t?Array.isArray(this._listeners[t])&&(this._listeners[t].length=0):this._listeners={}}},{key:"dispatchEvent",value:function(t){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t)}}}]),t}(),Fe=1/8,_e="undefined"!==typeof window,Pe=_e&&/Mac/.test(navigator.platform),Se=!(_e&&"PointerEvent"in window),Re=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r){var i;(0,o.Z)(this,n),(i=e.call(this)).minPolarAngle=0,i.maxPolarAngle=Math.PI,i.minAzimuthAngle=-1/0,i.maxAzimuthAngle=1/0,i.minDistance=0,i.maxDistance=1/0,i.infinityDolly=!1,i.minZoom=.01,i.maxZoom=1/0,i.dampingFactor=.05,i.draggingDampingFactor=.25,i.azimuthRotateSpeed=1,i.polarRotateSpeed=1,i.dollySpeed=1,i.truckSpeed=2,i.dollyToCursor=!1,i.dragToOffset=!1,i.verticalDragToForward=!1,i.boundaryFriction=0,i.restThreshold=.01,i.colliderMeshes=[],i.cancel=function(){},i._enabled=!0,i._state=Yt.NONE,i._viewport=null,i._affectOffset=!1,i._dollyControlAmount=0,i._hasRested=!0,i._boundaryEnclosesCamera=!1,i._needsUpdate=!0,i._updatedLastTime=!1,i._elementRect=new DOMRect,i._activePointers=[],i._truckInternal=function(t,e,n){if(Vt(i._camera)){var r=oe.copy(i._camera.position).sub(i._target),a=i._camera.getEffectiveFOV()*ne.MathUtils.DEG2RAD,s=r.length()*Math.tan(.5*a),o=i.truckSpeed*t*s/i._elementRect.height,u=i.truckSpeed*e*s/i._elementRect.height;i.verticalDragToForward?(n?i.setFocalOffset(i._focalOffsetEnd.x+o,i._focalOffsetEnd.y,i._focalOffsetEnd.z,!0):i.truck(o,0,!0),i.forward(-u,!0)):n?i.setFocalOffset(i._focalOffsetEnd.x+o,i._focalOffsetEnd.y+u,i._focalOffsetEnd.z,!0):i.truck(o,u,!0)}else if(zt(i._camera)){var l=i._camera,c=t*(l.right-l.left)/l.zoom/i._elementRect.width,h=e*(l.top-l.bottom)/l.zoom/i._elementRect.height;n?i.setFocalOffset(i._focalOffsetEnd.x+c,i._focalOffsetEnd.y+h,i._focalOffsetEnd.z,!0):i.truck(c,h,!0)}},i._rotateInternal=function(t,e){var n=Ht*i.azimuthRotateSpeed*t/i._elementRect.height,r=Ht*i.polarRotateSpeed*e/i._elementRect.height;i.rotate(n,r,!0)},i._dollyInternal=function(t,e,n){var r=Math.pow(.95,-t*i.dollySpeed),a=i._sphericalEnd.radius*r,s=i._sphericalEnd.radius,o=s*(t>=0?-1:1);i.dollyTo(a),i.infinityDolly&&(a<i.minDistance||i.maxDistance===i.minDistance)&&(i._camera.getWorldDirection(oe),i._targetEnd.add(oe.normalize().multiplyScalar(o)),i._target.add(oe.normalize().multiplyScalar(o))),i.dollyToCursor&&(i._dollyControlAmount+=i._sphericalEnd.radius-s,i.infinityDolly&&(a<i.minDistance||i.maxDistance===i.minDistance)&&(i._dollyControlAmount-=o),i._dollyControlCoord.set(e,n))},i._zoomInternal=function(t,e,n){var r=Math.pow(.95,t*i.dollySpeed),a=i._zoomEnd;i.zoomTo(i._zoom*r),i.dollyToCursor&&(i._dollyControlAmount+=i._zoomEnd-a,i._dollyControlCoord.set(e,n))},"undefined"===typeof ne&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),i._camera=t,i._yAxisUpSpace=(new ne.Quaternion).setFromUnitVectors(i._camera.up,ie),i._yAxisUpSpaceInverse=ee(i._yAxisUpSpace.clone()),i._state=Yt.NONE,i._target=new ne.Vector3,i._targetEnd=i._target.clone(),i._focalOffset=new ne.Vector3,i._focalOffsetEnd=i._focalOffset.clone(),i._spherical=(new ne.Spherical).setFromVector3(oe.copy(i._camera.position).applyQuaternion(i._yAxisUpSpace)),i._sphericalEnd=i._spherical.clone(),i._zoom=i._camera.zoom,i._zoomEnd=i._zoom,i._nearPlaneCorners=[new ne.Vector3,new ne.Vector3,new ne.Vector3,new ne.Vector3],i._updateNearPlaneCorners(),i._boundary=new ne.Box3(new ne.Vector3(-1/0,-1/0,-1/0),new ne.Vector3(1/0,1/0,1/0)),i._target0=i._target.clone(),i._position0=i._camera.position.clone(),i._zoom0=i._zoom,i._focalOffset0=i._focalOffset.clone(),i._dollyControlAmount=0,i._dollyControlCoord=new ne.Vector2,i.mouseButtons={left:Yt.ROTATE,middle:Yt.DOLLY,right:Yt.TRUCK,wheel:Vt(i._camera)?Yt.DOLLY:zt(i._camera)?Yt.ZOOM:Yt.NONE},i.touches={one:Yt.TOUCH_ROTATE,two:Vt(i._camera)?Yt.TOUCH_DOLLY_TRUCK:zt(i._camera)?Yt.TOUCH_ZOOM_TRUCK:Yt.NONE,three:Yt.TOUCH_TRUCK};var a=new ne.Vector2,s=new ne.Vector2,u=new ne.Vector2,l=function(t){if(i._enabled&&i._domElement){var e={pointerId:t.pointerId,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0};i._activePointers.push(e),i._domElement.ownerDocument.removeEventListener("pointermove",f,{passive:!1}),i._domElement.ownerDocument.removeEventListener("pointerup",m),i._domElement.ownerDocument.addEventListener("pointermove",f,{passive:!1}),i._domElement.ownerDocument.addEventListener("pointerup",m),y(t)}},c=function(t){if(i._enabled&&i._domElement){var e={pointerId:0,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0};i._activePointers.push(e),i._domElement.ownerDocument.removeEventListener("mousemove",d),i._domElement.ownerDocument.removeEventListener("mouseup",v),i._domElement.ownerDocument.addEventListener("mousemove",d),i._domElement.ownerDocument.addEventListener("mouseup",v),y(t)}},h=function(t){i._enabled&&i._domElement&&(t.preventDefault(),Array.prototype.forEach.call(t.changedTouches,(function(t){var e={pointerId:t.identifier,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0};i._activePointers.push(e)})),i._domElement.ownerDocument.removeEventListener("touchmove",p,{passive:!1}),i._domElement.ownerDocument.removeEventListener("touchend",g),i._domElement.ownerDocument.addEventListener("touchmove",p,{passive:!1}),i._domElement.ownerDocument.addEventListener("touchend",g),y(t))},f=function(t){t.cancelable&&t.preventDefault();var e=t.pointerId,n=i._findPointerById(e);if(n){if(n.clientX=t.clientX,n.clientY=t.clientY,n.deltaX=t.movementX,n.deltaY=t.movementY,"touch"===t.pointerType)switch(i._activePointers.length){case 1:i._state=i.touches.one;break;case 2:i._state=i.touches.two;break;case 3:i._state=i.touches.three}else i._state=0,(t.buttons&Zt)===Zt&&(i._state=i._state|i.mouseButtons.left),(t.buttons&Gt)===Gt&&(i._state=i._state|i.mouseButtons.middle),(t.buttons&Bt)===Bt&&(i._state=i._state|i.mouseButtons.right);C()}},d=function(t){var e=i._findPointerById(0);e&&(e.clientX=t.clientX,e.clientY=t.clientY,e.deltaX=t.movementX,e.deltaY=t.movementY,i._state=0,(t.buttons&Zt)===Zt&&(i._state=i._state|i.mouseButtons.left),(t.buttons&Gt)===Gt&&(i._state=i._state|i.mouseButtons.middle),(t.buttons&Bt)===Bt&&(i._state=i._state|i.mouseButtons.right),C())},p=function(t){t.cancelable&&t.preventDefault(),Array.prototype.forEach.call(t.changedTouches,(function(t){var e=t.identifier,n=i._findPointerById(e);n&&(n.clientX=t.clientX,n.clientY=t.clientY)})),C()},m=function(t){var e=t.pointerId,n=i._findPointerById(e);if(n&&i._activePointers.splice(i._activePointers.indexOf(n),1),"touch"===t.pointerType)switch(i._activePointers.length){case 0:i._state=Yt.NONE;break;case 1:i._state=i.touches.one;break;case 2:i._state=i.touches.two;break;case 3:i._state=i.touches.three}else i._state=Yt.NONE;x()},v=function(){var t=i._findPointerById(0);t&&i._activePointers.splice(i._activePointers.indexOf(t),1),i._state=Yt.NONE,x()},g=function(t){switch(Array.prototype.forEach.call(t.changedTouches,(function(t){var e=t.identifier,n=i._findPointerById(e);n&&i._activePointers.splice(i._activePointers.indexOf(n),1)})),i._activePointers.length){case 0:i._state=Yt.NONE;break;case 1:i._state=i.touches.one;break;case 2:i._state=i.touches.two;break;case 3:i._state=i.touches.three}x()},E=-1,I=function(t){if(i._enabled&&i.mouseButtons.wheel!==Yt.NONE){if(t.preventDefault(),i.dollyToCursor||i.mouseButtons.wheel===Yt.ROTATE||i.mouseButtons.wheel===Yt.TRUCK){var e=performance.now();E-e<1e3&&i._getClientRect(i._elementRect),E=e}var n=Pe?-1:-3,r=1===t.deltaMode?t.deltaY/n:t.deltaY/(10*n),a=i.dollyToCursor?(t.clientX-i._elementRect.x)/i._elementRect.width*2-1:0,s=i.dollyToCursor?(t.clientY-i._elementRect.y)/i._elementRect.height*-2+1:0;switch(i.mouseButtons.wheel){case Yt.ROTATE:i._rotateInternal(t.deltaX,t.deltaY);break;case Yt.TRUCK:i._truckInternal(t.deltaX,t.deltaY,!1);break;case Yt.OFFSET:i._truckInternal(t.deltaX,t.deltaY,!0);break;case Yt.DOLLY:i._dollyInternal(-r,a,s);break;case Yt.ZOOM:i._zoomInternal(-r,a,s)}i.dispatchEvent({type:"control"})}},T=function(t){i._enabled&&t.preventDefault()},y=function(t){if(i._enabled){if($t(i._activePointers,se),i._getClientRect(i._elementRect),a.copy(se),s.copy(se),i._activePointers.length>=2){var e=se.x-i._activePointers[1].clientX,n=se.y-i._activePointers[1].clientY,r=Math.sqrt(e*e+n*n);u.set(0,r);var o=.5*(i._activePointers[0].clientX+i._activePointers[1].clientX),l=.5*(i._activePointers[0].clientY+i._activePointers[1].clientY);s.set(o,l)}if("touches"in t||"pointerType"in t&&"touch"===t.pointerType)switch(i._activePointers.length){case 1:i._state=i.touches.one;break;case 2:i._state=i.touches.two;break;case 3:i._state=i.touches.three}else i._state=0,(t.buttons&Zt)===Zt&&(i._state=i._state|i.mouseButtons.left),(t.buttons&Gt)===Gt&&(i._state=i._state|i.mouseButtons.middle),(t.buttons&Bt)===Bt&&(i._state=i._state|i.mouseButtons.right);i.dispatchEvent({type:"controlstart"})}},C=function(){if(i._enabled){$t(i._activePointers,se);var t=i._domElement&&document.pointerLockElement===i._domElement,e=t?-i._activePointers[0].deltaX:s.x-se.x,n=t?-i._activePointers[0].deltaY:s.y-se.y;if(s.copy(se),(i._state&Yt.ROTATE)!==Yt.ROTATE&&(i._state&Yt.TOUCH_ROTATE)!==Yt.TOUCH_ROTATE&&(i._state&Yt.TOUCH_DOLLY_ROTATE)!==Yt.TOUCH_DOLLY_ROTATE&&(i._state&Yt.TOUCH_ZOOM_ROTATE)!==Yt.TOUCH_ZOOM_ROTATE||i._rotateInternal(e,n),(i._state&Yt.DOLLY)===Yt.DOLLY||(i._state&Yt.ZOOM)===Yt.ZOOM){var r=i.dollyToCursor?(a.x-i._elementRect.x)/i._elementRect.width*2-1:0,o=i.dollyToCursor?(a.y-i._elementRect.y)/i._elementRect.height*-2+1:0;(i._state&Yt.DOLLY)===Yt.DOLLY?i._dollyInternal(n*Fe,r,o):i._zoomInternal(n*Fe,r,o)}if((i._state&Yt.TOUCH_DOLLY)===Yt.TOUCH_DOLLY||(i._state&Yt.TOUCH_ZOOM)===Yt.TOUCH_ZOOM||(i._state&Yt.TOUCH_DOLLY_TRUCK)===Yt.TOUCH_DOLLY_TRUCK||(i._state&Yt.TOUCH_ZOOM_TRUCK)===Yt.TOUCH_ZOOM_TRUCK||(i._state&Yt.TOUCH_DOLLY_OFFSET)===Yt.TOUCH_DOLLY_OFFSET||(i._state&Yt.TOUCH_ZOOM_OFFSET)===Yt.TOUCH_ZOOM_OFFSET||(i._state&Yt.TOUCH_DOLLY_ROTATE)===Yt.TOUCH_DOLLY_ROTATE||(i._state&Yt.TOUCH_ZOOM_ROTATE)===Yt.TOUCH_ZOOM_ROTATE){var l=se.x-i._activePointers[1].clientX,c=se.y-i._activePointers[1].clientY,h=Math.sqrt(l*l+c*c),f=u.y-h;u.set(0,h);var d=i.dollyToCursor?(s.x-i._elementRect.x)/i._elementRect.width*2-1:0,p=i.dollyToCursor?(s.y-i._elementRect.y)/i._elementRect.height*-2+1:0;(i._state&Yt.TOUCH_DOLLY)===Yt.TOUCH_DOLLY||(i._state&Yt.TOUCH_DOLLY_ROTATE)===Yt.TOUCH_DOLLY_ROTATE||(i._state&Yt.TOUCH_DOLLY_TRUCK)===Yt.TOUCH_DOLLY_TRUCK||(i._state&Yt.TOUCH_DOLLY_OFFSET)===Yt.TOUCH_DOLLY_OFFSET?i._dollyInternal(f*Fe,d,p):i._zoomInternal(f*Fe,d,p)}(i._state&Yt.TRUCK)!==Yt.TRUCK&&(i._state&Yt.TOUCH_TRUCK)!==Yt.TOUCH_TRUCK&&(i._state&Yt.TOUCH_DOLLY_TRUCK)!==Yt.TOUCH_DOLLY_TRUCK&&(i._state&Yt.TOUCH_ZOOM_TRUCK)!==Yt.TOUCH_ZOOM_TRUCK||i._truckInternal(e,n,!1),(i._state&Yt.OFFSET)!==Yt.OFFSET&&(i._state&Yt.TOUCH_OFFSET)!==Yt.TOUCH_OFFSET&&(i._state&Yt.TOUCH_DOLLY_OFFSET)!==Yt.TOUCH_DOLLY_OFFSET&&(i._state&Yt.TOUCH_ZOOM_OFFSET)!==Yt.TOUCH_ZOOM_OFFSET||i._truckInternal(e,n,!0),i.dispatchEvent({type:"control"})}},x=function(){$t(i._activePointers,se),s.copy(se),0===i._activePointers.length&&i._domElement&&(i._domElement.ownerDocument.removeEventListener("pointermove",f,{passive:!1}),i._domElement.ownerDocument.removeEventListener("pointerup",m),i._domElement.ownerDocument.removeEventListener("touchmove",p,{passive:!1}),i._domElement.ownerDocument.removeEventListener("touchend",g),i.dispatchEvent({type:"controlend"}))};return i._addAllEventListeners=function(t){i._domElement=t,i._domElement.style.touchAction="none",i._domElement.style.userSelect="none",i._domElement.style.webkitUserSelect="none",i._domElement.addEventListener("pointerdown",l),Se&&i._domElement.addEventListener("mousedown",c),Se&&i._domElement.addEventListener("touchstart",h),i._domElement.addEventListener("pointercancel",m),i._domElement.addEventListener("wheel",I,{passive:!1}),i._domElement.addEventListener("contextmenu",T)},i._removeAllEventListeners=function(){i._domElement&&(i._domElement.removeEventListener("pointerdown",l),i._domElement.removeEventListener("mousedown",c),i._domElement.removeEventListener("touchstart",h),i._domElement.removeEventListener("pointercancel",m),i._domElement.removeEventListener("wheel",I,{passive:!1}),i._domElement.removeEventListener("contextmenu",T),i._domElement.ownerDocument.removeEventListener("pointermove",f,{passive:!1}),i._domElement.ownerDocument.removeEventListener("mousemove",d),i._domElement.ownerDocument.removeEventListener("touchmove",p,{passive:!1}),i._domElement.ownerDocument.removeEventListener("pointerup",m),i._domElement.ownerDocument.removeEventListener("mouseup",v),i._domElement.ownerDocument.removeEventListener("touchend",g))},i.cancel=function(){i._state!==Yt.NONE&&(i._state=Yt.NONE,i._activePointers.length=0,x())},r&&i.connect(r),i.update(0),i}return(0,u.Z)(n,[{key:"camera",get:function(){return this._camera},set:function(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._domElement&&(this._enabled=t,t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}},{key:"active",get:function(){return!this._hasRested}},{key:"currentAction",get:function(){return this._state}},{key:"distance",get:function(){return this._spherical.radius},set:function(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}},{key:"azimuthAngle",get:function(){return this._spherical.theta},set:function(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}},{key:"polarAngle",get:function(){return this._spherical.phi},set:function(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}},{key:"boundaryEnclosesCamera",get:function(){return this._boundaryEnclosesCamera},set:function(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}},{key:"addEventListener",value:function(t,e){(0,S.Z)((0,R.Z)(n.prototype),"addEventListener",this).call(this,t,e)}},{key:"removeEventListener",value:function(t,e){(0,S.Z)((0,R.Z)(n.prototype),"removeEventListener",this).call(this,t,e)}},{key:"rotate",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,n)}},{key:"rotateAzimuthTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.rotateTo(t,this._sphericalEnd.phi,e)}},{key:"rotatePolarTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.rotateTo(this._sphericalEnd.theta,t,e)}},{key:"rotateTo",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=ne.MathUtils.clamp(t,this.minAzimuthAngle,this.maxAzimuthAngle),i=ne.MathUtils.clamp(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=i,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,n||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);var a=!n||jt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&jt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}},{key:"dolly",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.dollyTo(this._sphericalEnd.radius-t,e)}},{key:"dollyTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._sphericalEnd.radius,r=ne.MathUtils.clamp(t,this.minDistance,this.maxDistance),i=this.colliderMeshes.length>=1;if(i){var a=this._collisionTest(),s=jt(a,this._spherical.radius),o=n>r;if(!o&&s)return Promise.resolve();this._sphericalEnd.radius=Math.min(r,a)}else this._sphericalEnd.radius=r;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);var u=!e||jt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}},{key:"zoom",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.zoomTo(this._zoomEnd+t,e)}},{key:"zoomTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._zoomEnd=ne.MathUtils.clamp(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);var n=!e||jt(this._zoom,this._zoomEnd,this.restThreshold);return this._createOnRestPromise(n)}},{key:"pan",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,n)}},{key:"truck",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._camera.updateMatrix(),ce.setFromMatrixColumn(this._camera.matrix,0),he.setFromMatrixColumn(this._camera.matrix,1),ce.multiplyScalar(t),he.multiplyScalar(-e);var r=oe.copy(ce).add(he),i=ue.copy(this._targetEnd).add(r);return this.moveTo(i.x,i.y,i.z,n)}},{key:"forward",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];oe.setFromMatrixColumn(this._camera.matrix,0),oe.crossVectors(this._camera.up,oe),oe.multiplyScalar(t);var n=ue.copy(this._targetEnd).add(oe);return this.moveTo(n.x,n.y,n.z,e)}},{key:"moveTo",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=oe.set(t,e,n).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,i,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);var a=!r||jt(this._target.x,this._targetEnd.x,this.restThreshold)&&jt(this._target.y,this._targetEnd.y,this.restThreshold)&&jt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}},{key:"fitToBox",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.cover,i=void 0!==r&&r,a=n.paddingLeft,s=void 0===a?0:a,o=n.paddingRight,u=void 0===o?0:o,l=n.paddingBottom,c=void 0===l?0:l,h=n.paddingTop,f=void 0===h?0:h,d=[],p=t.isBox3?ge.copy(t):ge.setFromObject(t);p.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());var m=qt(this._sphericalEnd.theta,Xt),v=qt(this._sphericalEnd.phi,Xt);d.push(this.rotateTo(m,v,e));var g=oe.setFromSpherical(this._sphericalEnd).normalize(),E=Te.setFromUnitVectors(g,ae),I=jt(Math.abs(g.y),1);I&&E.multiply(ye.setFromAxisAngle(ie,m)),E.multiply(this._yAxisUpSpaceInverse);var T=Ee.makeEmpty();ue.copy(p.min).applyQuaternion(E),T.expandByPoint(ue),ue.copy(p.min).setX(p.max.x).applyQuaternion(E),T.expandByPoint(ue),ue.copy(p.min).setY(p.max.y).applyQuaternion(E),T.expandByPoint(ue),ue.copy(p.max).setZ(p.min.z).applyQuaternion(E),T.expandByPoint(ue),ue.copy(p.min).setZ(p.max.z).applyQuaternion(E),T.expandByPoint(ue),ue.copy(p.max).setY(p.min.y).applyQuaternion(E),T.expandByPoint(ue),ue.copy(p.max).setX(p.min.x).applyQuaternion(E),T.expandByPoint(ue),ue.copy(p.max).applyQuaternion(E),T.expandByPoint(ue),T.min.x-=s,T.min.y-=c,T.max.x+=u,T.max.y+=f,E.setFromUnitVectors(ae,g),I&&E.premultiply(ye.invert()),E.premultiply(this._yAxisUpSpace);var y=T.getSize(oe),C=T.getCenter(ue).applyQuaternion(E);if(Vt(this._camera)){var x=this.getDistanceToFitBox(y.x,y.y,y.z,i);d.push(this.moveTo(C.x,C.y,C.z,e)),d.push(this.dollyTo(x,e)),d.push(this.setFocalOffset(0,0,0,e))}else if(zt(this._camera)){var A=this._camera,F=A.right-A.left,_=A.top-A.bottom,P=i?Math.max(F/y.x,_/y.y):Math.min(F/y.x,_/y.y);d.push(this.moveTo(C.x,C.y,C.z,e)),d.push(this.zoomTo(P,e)),d.push(this.setFocalOffset(0,0,0,e))}return Promise.all(d)}},{key:"fitToSphere",value:function(t,e){var n=[],r=t instanceof ne.Sphere?Ie.copy(t):function(t,e){var n=e,r=n.center;ge.makeEmpty(),t.traverseVisible((function(t){t.isMesh&&ge.expandByObject(t)})),ge.getCenter(r);var i=0;return t.traverseVisible((function(t){if(t.isMesh){var e=t,n=e.geometry.clone();if(n.applyMatrix4(e.matrixWorld),n.isBufferGeometry)for(var a=n.attributes.position,s=0,o=a.count;s<o;s++)oe.fromBufferAttribute(a,s),i=Math.max(i,r.distanceToSquared(oe));else for(var u=n.attributes.position,l=new ne.Vector3,c=0,h=u.count;c<h;c++)l.fromBufferAttribute(u,c),i=Math.max(i,r.distanceToSquared(l))}})),n.radius=Math.sqrt(i),n}(t,Ie);if(n.push(this.moveTo(r.center.x,r.center.y,r.center.z,e)),Vt(this._camera)){var i=this.getDistanceToFitSphere(r.radius);n.push(this.dollyTo(i,e))}else if(zt(this._camera)){var a=this._camera.right-this._camera.left,s=this._camera.top-this._camera.bottom,o=2*r.radius,u=Math.min(a/o,s/o);n.push(this.zoomTo(u,e))}return n.push(this.setFocalOffset(0,0,0,e)),Promise.all(n)}},{key:"setLookAt",value:function(t,e,n,r,i,a){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=ue.set(r,i,a),u=oe.set(t,e,n);this._targetEnd.copy(o),this._sphericalEnd.setFromVector3(u.sub(o).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));var l=!s||jt(this._target.x,this._targetEnd.x,this.restThreshold)&&jt(this._target.y,this._targetEnd.y,this.restThreshold)&&jt(this._target.z,this._targetEnd.z,this.restThreshold)&&jt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&jt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&jt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(l)}},{key:"lerpLookAt",value:function(t,e,n,r,i,a,s,o,u,l,c,h,f){var d=arguments.length>13&&void 0!==arguments[13]&&arguments[13],p=oe.set(r,i,a),m=ue.set(t,e,n);me.setFromVector3(m.sub(p).applyQuaternion(this._yAxisUpSpace));var v=le.set(l,c,h),g=ue.set(s,o,u);ve.setFromVector3(g.sub(v).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(v,f));var E=ve.theta-me.theta,I=ve.phi-me.phi,T=ve.radius-me.radius;this._sphericalEnd.set(me.radius+T*f,me.phi+I*f,me.theta+E*f),this.normalizeRotations(),this._needsUpdate=!0,d||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));var y=!d||jt(this._target.x,this._targetEnd.x,this.restThreshold)&&jt(this._target.y,this._targetEnd.y,this.restThreshold)&&jt(this._target.z,this._targetEnd.z,this.restThreshold)&&jt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&jt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&jt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(y)}},{key:"setPosition",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.setLookAt(t,e,n,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}},{key:"setTarget",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.getPosition(oe),a=this.setLookAt(i.x,i.y,i.z,t,e,n,r);return this._sphericalEnd.phi=ne.MathUtils.clamp(this.polarAngle,this.minPolarAngle,this.maxPolarAngle),a}},{key:"setFocalOffset",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._focalOffsetEnd.set(t,e,n),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd),this._affectOffset=!Qt(t)||!Qt(e)||!Qt(n);var i=!r||jt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&jt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&jt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}},{key:"setOrbitPoint",value:function(t,e,n){this._camera.updateMatrixWorld(),ce.setFromMatrixColumn(this._camera.matrixWorldInverse,0),he.setFromMatrixColumn(this._camera.matrixWorldInverse,1),fe.setFromMatrixColumn(this._camera.matrixWorldInverse,2);var r=oe.set(t,e,n),i=r.distanceTo(this._camera.position),a=r.sub(this._camera.position);ce.multiplyScalar(a.x),he.multiplyScalar(a.y),fe.multiplyScalar(a.z),oe.copy(ce).add(he).add(fe),oe.z=oe.z+i,this.dollyTo(i,!1),this.setFocalOffset(-oe.x,oe.y,-oe.z,!1),this.moveTo(t,e,n,!1)}},{key:"setBoundary",value:function(t){if(!t)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}},{key:"setViewport",value:function(t,e,n,r){null!==t?(this._viewport=this._viewport||new ne.Vector4,"number"===typeof t?this._viewport.set(t,e,n,r):this._viewport.copy(t)):this._viewport=null}},{key:"getDistanceToFitBox",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(te(this._camera,"getDistanceToFitBox"))return this._spherical.radius;var i=t/e,a=this._camera.getEffectiveFOV()*ne.MathUtils.DEG2RAD,s=this._camera.aspect,o=(r?i>s:i<s)?e:t/s;return.5*o/Math.tan(.5*a)+.5*n}},{key:"getDistanceToFitSphere",value:function(t){if(te(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;var e=this._camera.getEffectiveFOV()*ne.MathUtils.DEG2RAD,n=2*Math.atan(Math.tan(.5*e)*this._camera.aspect),r=1<this._camera.aspect?e:n;return t/Math.sin(.5*r)}},{key:"getTarget",value:function(t){return(t&&t.isVector3?t:new ne.Vector3).copy(this._targetEnd)}},{key:"getPosition",value:function(t){return(t&&t.isVector3?t:new ne.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)}},{key:"getFocalOffset",value:function(t){return(t&&t.isVector3?t:new ne.Vector3).copy(this._focalOffsetEnd)}},{key:"normalizeRotations",value:function(){this._sphericalEnd.theta=this._sphericalEnd.theta%Ht,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Ht),this._spherical.theta+=Ht*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Ht)}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}},{key:"saveState",value:function(){this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}},{key:"updateCameraUp",value:function(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,ie),ee(this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace))}},{key:"update",value:function(t){var e=this._state===Yt.NONE?this.dampingFactor:this.draggingDampingFactor,n=Math.min(e*t*60,1),r=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,a=this._sphericalEnd.radius-this._spherical.radius,s=de.subVectors(this._targetEnd,this._target),o=pe.subVectors(this._focalOffsetEnd,this._focalOffset);if(Qt(r)&&Qt(i)&&Qt(a)&&Qt(s.x)&&Qt(s.y)&&Qt(s.z)&&Qt(o.x)&&Qt(o.y)&&Qt(o.z)?(this._spherical.copy(this._sphericalEnd),this._target.copy(this._targetEnd),this._focalOffset.copy(this._focalOffsetEnd)):(this._spherical.set(this._spherical.radius+a*n,this._spherical.phi+i*n,this._spherical.theta+r*n),this._target.add(s.multiplyScalar(n)),this._focalOffset.add(o.multiplyScalar(n)),this._needsUpdate=!0),0!==this._dollyControlAmount){if(Vt(this._camera)){var u=this._camera,l=oe.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),c=ue.copy(l).cross(u.up).normalize();0===c.lengthSq()&&(c.x=1);var h=le.crossVectors(c,l),f=this._sphericalEnd.radius*Math.tan(u.getEffectiveFOV()*ne.MathUtils.DEG2RAD*.5),d=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,p=oe.copy(this._targetEnd).add(c.multiplyScalar(this._dollyControlCoord.x*f*u.aspect)).add(h.multiplyScalar(this._dollyControlCoord.y*f));this._targetEnd.lerp(p,d)}else if(zt(this._camera)){var m=this._camera,v=oe.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(m.near+m.far)/(m.near-m.far)).unproject(m),g=ue.set(0,0,-1).applyQuaternion(m.quaternion),E=le.copy(v).add(g.multiplyScalar(-v.dot(m.up))),I=-(this._zoom-this._dollyControlAmount-this._zoomEnd)/this._zoom,T=oe.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),y=this._targetEnd.dot(T);this._targetEnd.lerp(E,I);var C=this._targetEnd.dot(T),x=T.multiplyScalar(C-y);this._targetEnd.sub(x)}this._target.copy(this._targetEnd),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._dollyControlAmount=0}var A=this._zoomEnd-this._zoom;this._zoom+=A*n,this._camera.zoom!==this._zoom&&(Qt(A)&&(this._zoom=this._zoomEnd),this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);var F=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,F),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),this._affectOffset&&(this._camera.updateMatrixWorld(),ce.setFromMatrixColumn(this._camera.matrix,0),he.setFromMatrixColumn(this._camera.matrix,1),fe.setFromMatrixColumn(this._camera.matrix,2),ce.multiplyScalar(this._focalOffset.x),he.multiplyScalar(-this._focalOffset.y),fe.multiplyScalar(this._focalOffset.z),oe.copy(ce).add(he).add(fe),this._camera.position.add(oe)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),oe.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);var _=this._needsUpdate;return _&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):_?(this.dispatchEvent({type:"update"}),Qt(r,this.restThreshold)&&Qt(i,this.restThreshold)&&Qt(a,this.restThreshold)&&Qt(s.x,this.restThreshold)&&Qt(s.y,this.restThreshold)&&Qt(s.z,this.restThreshold)&&Qt(o.x,this.restThreshold)&&Qt(o.y,this.restThreshold)&&Qt(o.z,this.restThreshold)&&Qt(A,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!_&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=_,this._needsUpdate=!1,_}},{key:"toJSON",value:function(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Kt(this.maxDistance),minZoom:this.minZoom,maxZoom:Kt(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Kt(this.maxPolarAngle),minAzimuthAngle:Kt(this.minAzimuthAngle),maxAzimuthAngle:Kt(this.maxAzimuthAngle),dampingFactor:this.dampingFactor,draggingDampingFactor:this.draggingDampingFactor,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:oe.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}},{key:"fromJSON",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=JSON.parse(t),r=oe.fromArray(n.position);this.enabled=n.enabled,this.minDistance=n.minDistance,this.maxDistance=Jt(n.maxDistance),this.minZoom=n.minZoom,this.maxZoom=Jt(n.maxZoom),this.minPolarAngle=n.minPolarAngle,this.maxPolarAngle=Jt(n.maxPolarAngle),this.minAzimuthAngle=Jt(n.minAzimuthAngle),this.maxAzimuthAngle=Jt(n.maxAzimuthAngle),this.dampingFactor=n.dampingFactor,this.draggingDampingFactor=n.draggingDampingFactor,this.dollySpeed=n.dollySpeed,this.truckSpeed=n.truckSpeed,this.dollyToCursor=n.dollyToCursor,this.verticalDragToForward=n.verticalDragToForward,this._target0.fromArray(n.target0),this._position0.fromArray(n.position0),this._zoom0=n.zoom0,this._focalOffset0.fromArray(n.focalOffset0),this.moveTo(n.target[0],n.target[1],n.target[2],e),me.setFromVector3(r.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(me.theta,me.phi,e),this.zoomTo(n.zoom,e),this.setFocalOffset(n.focalOffset[0],n.focalOffset[1],n.focalOffset[2],e),this._needsUpdate=!0}},{key:"connect",value:function(t){this._domElement?console.warn("camera-controls is already connected."):(t.setAttribute("data-camera-controls-version","1.38.1"),this._addAllEventListeners(t))}},{key:"disconnect",value:function(){this._removeAllEventListeners(),this._domElement=void 0}},{key:"dispose",value:function(){this.disconnect(),this._domElement&&"setAttribute"in this._domElement&&this._domElement.removeAttribute("data-camera-controls-version")}},{key:"_findPointerById",value:function(t){var e=null;return this._activePointers.some((function(n){return n.pointerId===t&&(e=n,!0)})),e}},{key:"_encloseToBoundary",value:function(t,e,n){var r=e.lengthSq();if(0===r)return t;var i=ue.copy(e).add(t),a=this._boundary.clampPoint(i,le).sub(i),s=a.lengthSq();if(0===s)return t.add(e);if(s===r)return t;if(0===n)return t.add(e).add(a);var o=1+n*s/e.dot(a);return t.add(ue.copy(e).multiplyScalar(o)).add(a.multiplyScalar(1-n))}},{key:"_updateNearPlaneCorners",value:function(){if(Vt(this._camera)){var t=this._camera,e=t.near,n=t.getEffectiveFOV()*ne.MathUtils.DEG2RAD,r=Math.tan(.5*n)*e,i=r*t.aspect;this._nearPlaneCorners[0].set(-i,-r,0),this._nearPlaneCorners[1].set(i,-r,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(-i,r,0)}else if(zt(this._camera)){var a=this._camera,s=1/a.zoom,o=a.left*s,u=a.right*s,l=a.top*s,c=a.bottom*s;this._nearPlaneCorners[0].set(o,l,0),this._nearPlaneCorners[1].set(u,l,0),this._nearPlaneCorners[2].set(u,c,0),this._nearPlaneCorners[3].set(o,c,0)}}},{key:"_collisionTest",value:function(){var t=1/0;if(!(this.colliderMeshes.length>=1))return t;if(te(this._camera,"_collisionTest"))return t;var e=oe.setFromSpherical(this._spherical).divideScalar(this._spherical.radius);Ce.lookAt(re,e,this._camera.up);for(var n=0;n<4;n++){var r=ue.copy(this._nearPlaneCorners[n]);r.applyMatrix4(Ce);var i=le.addVectors(this._target,r);xe.set(i,e),xe.far=this._spherical.radius+1;var a=xe.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<t&&(t=a[0].distance)}return t}},{key:"_getClientRect",value:function(t){if(this._domElement){var e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}}},{key:"_createOnRestPromise",value:function(t){var e=this;return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((function(t){e.addEventListener("rest",(function n(){e.removeEventListener("rest",n),t()}))})))}},{key:"_addAllEventListeners",value:function(t){}},{key:"_removeAllEventListeners",value:function(){}}],[{key:"install",value:function(t){ne=t.THREE,re=Object.freeze(new ne.Vector3(0,0,0)),ie=Object.freeze(new ne.Vector3(0,1,0)),ae=Object.freeze(new ne.Vector3(0,0,1)),se=new ne.Vector2,oe=new ne.Vector3,ue=new ne.Vector3,le=new ne.Vector3,ce=new ne.Vector3,he=new ne.Vector3,fe=new ne.Vector3,de=new ne.Vector3,pe=new ne.Vector3,me=new ne.Spherical,ve=new ne.Spherical,ge=new ne.Box3,Ee=new ne.Box3,Ie=new ne.Sphere,Te=new ne.Quaternion,ye=new ne.Quaternion,Ce=new ne.Matrix4,xe=new ne.Raycaster}},{key:"ACTION",get:function(){return Yt}}]),n}(Ae);var Oe=function(){function t(){var e=this;(0,o.Z)(this,t),this.handlers=[],this.trigger=function(t){e.handlers.slice(0).forEach((function(e){return e(t)}))}}return(0,u.Z)(t,[{key:"on",value:function(t){this.handlers.push(t)}},{key:"off",value:function(t){this.handlers=this.handlers.filter((function(e){return e!==t}))}},{key:"expose",value:function(){return this}}]),t}(),we=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,i){var a;return(0,o.Z)(this,n),(a=e.call(this,t)).ifcCamera=i,a.mode=r.FirstPerson,a.enabled=!1,a.onChange=new Oe,a.onChangeProjection=new Oe,a}return(0,u.Z)(n,[{key:"toggle",value:function(t){if(this.enabled=t,t){if(this.ifcCamera.projection!==i.Perspective)return void this.ifcCamera.setNavigationMode(r.Orbit);this.setupFirstPersonCamera()}}},{key:"setupFirstPersonCamera",value:function(){var t=this.ifcCamera.cameraControls,e=new p.Vector3;t.camera.getWorldPosition(e);var n=new p.Vector3;t.distance--,t.camera.getWorldPosition(n),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(n.x,n.y,n.z),this.ifcCamera.cameraControls.truckSpeed=50,t.mouseButtons.wheel=Re.ACTION.DOLLY,t.touches.two=Re.ACTION.TOUCH_ZOOM_TRUCK}},{key:"fitModelToFrame",value:function(){}}]),n}(c),Me=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,i){var a;return(0,o.Z)(this,n),(a=e.call(this,t)).context=t,a.ifcCamera=i,a.enabled=!0,a.mode=r.Orbit,a.onChange=new Oe,a.onUnlock=new Oe,a.onChangeProjection=new Oe,a.activateOrbitControls(),a}return(0,u.Z)(n,[{key:"target",get:function(){var t=new p.Vector3;return this.ifcCamera.cameraControls.getTarget(t),t}},{key:"toggle",value:function(t){this.enabled=t,t&&this.activateOrbitControls()}},{key:"fitModelToFrame",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n,r,i,s,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:return e=this.context.getScene(),n=(new p.Box3).setFromObject(e.children[e.children.length-1]),r=new p.Vector3,n.getSize(r),i=new p.Vector3,n.getCenter(i),.5,s=.5*Math.max(r.x,r.y,r.z),o=new p.Sphere(i,s),t.next=13,this.ifcCamera.cameraControls.fitToSphere(o,!0);case 13:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"activateOrbitControls",value:function(){var t=this.ifcCamera.cameraControls;t.minDistance=1,t.maxDistance=300,this.ifcCamera.cameraControls.truckSpeed=2}}]),n}(c),Ne=function(){function t(e,n){(0,o.Z)(this,t),this.context=e,this.previousDistance=-1,this.cameras=n,this.currentCamera=n.perspectiveCamera,this.currentProjection=i.Perspective}return(0,u.Z)(t,[{key:"activeCamera",get:function(){return this.currentCamera}},{key:"projection",get:function(){return this.currentProjection},set:function(t){this.projection!==t&&(t===i.Orthographic?this.setOrthoCamera():this.setPerspectiveCamera())}},{key:"setOrthoCamera",value:function(){if(this.cameras.currentNavMode.mode!==r.FirstPerson){this.previousDistance=this.cameras.cameraControls.distance,this.cameras.cameraControls.distance=200;var t=this.getDims(),e=t.width,n=t.height;this.setupOrthoCamera(n,e),this.currentCamera=this.cameras.orthographicCamera,this.currentProjection=i.Orthographic}}},{key:"getDims",value:function(){var t=new p.Vector3;this.cameras.perspectiveCamera.getWorldDirection(t);var e=new p.Vector3;this.cameras.cameraControls.getTarget(e);var n=e.clone().sub(this.cameras.perspectiveCamera.position).dot(t),r=this.context.getDimensions(),i=r.x/r.y,a=this.cameras.perspectiveCamera.fov,s=2*n*Math.atan(a*(Math.PI/180)/2);return{width:s*i,height:s}}},{key:"setupOrthoCamera",value:function(t,e){this.cameras.cameraControls.mouseButtons.wheel=Re.ACTION.ZOOM,this.cameras.orthographicCamera.zoom=1,this.cameras.orthographicCamera.left=e/-2,this.cameras.orthographicCamera.right=e/2,this.cameras.orthographicCamera.top=t/2,this.cameras.orthographicCamera.bottom=t/-2,this.cameras.orthographicCamera.updateProjectionMatrix(),this.cameras.orthographicCamera.position.copy(this.cameras.perspectiveCamera.position),this.cameras.orthographicCamera.quaternion.copy(this.cameras.perspectiveCamera.quaternion),this.cameras.cameraControls.camera=this.cameras.orthographicCamera}},{key:"setPerspectiveCamera",value:function(){this.cameras.cameraControls.mouseButtons.wheel=Re.ACTION.DOLLY,this.cameras.perspectiveCamera.position.copy(this.cameras.orthographicCamera.position),this.cameras.perspectiveCamera.quaternion.copy(this.cameras.orthographicCamera.quaternion),this.cameras.perspectiveCamera.updateProjectionMatrix(),this.cameras.cameraControls.camera=this.cameras.perspectiveCamera,this.cameras.cameraControls.mouseButtons.wheel=Re.ACTION.DOLLY,this.currentCamera=this.cameras.perspectiveCamera,this.currentProjection=i.Perspective,this.cameras.cameraControls.distance=this.previousDistance,this.cameras.cameraControls.zoomTo(1)}}]),t}(),Le=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,i){var a;return(0,o.Z)(this,n),(a=e.call(this,t)).context=t,a.ifcCamera=i,a.mode=r.Plan,a.enabled=!1,a.onChange=new Oe,a.onChangeProjection=new Oe,a.defaultAzimuthSpeed=i.cameraControls.azimuthRotateSpeed,a.defaultPolarSpeed=i.cameraControls.polarRotateSpeed,a}return(0,u.Z)(n,[{key:"toggle",value:function(t){this.enabled=t;var e=this.ifcCamera.cameraControls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,e.mouseButtons.left=Re.ACTION.ROTATE}},{key:"fitModelToFrame",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){var e,n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.enabled){t.next=2;break}return t.abrupt("return");case 2:return e=this.context.getScene(),console.log(e),n=(new p.Box3).setFromObject(e.children[0]),t.next=7,this.ifcCamera.cameraControls.fitToBox(n,!1);case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),n}(c),be={MOUSE:p.MOUSE,Vector2:p.Vector2,Vector3:p.Vector3,Vector4:p.Vector4,Quaternion:p.Quaternion,Matrix4:p.Matrix4,Spherical:p.Spherical,Box3:p.Box3,Sphere:p.Sphere,Raycaster:p.Raycaster,MathUtils:{DEG2RAD:p.MathUtils.DEG2RAD,clamp:p.MathUtils.clamp}},ke=50,De=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var i,a;(0,o.Z)(this,n),(a=e.call(this,t)).onChange=new Oe,a.onChangeProjection=new Oe,a.previousUserInput={},a.context=t;var s=a.context.getDimensions(),u=s.x/s.y;return a.perspectiveCamera=new p.PerspectiveCamera(45,u,1,2e3),a.orthographicCamera=new p.OrthographicCamera(ke*u/-2,ke*u/2,25,-25,.1,1e3),a.setupCameras(),Re.install({THREE:be}),a.cameraControls=new Re(a.perspectiveCamera,t.getDomElement()),a.navMode=(i={},(0,V.Z)(i,r.Orbit,new Me(a.context,(0,B.Z)(a))),(0,V.Z)(i,r.FirstPerson,new we(a.context,(0,B.Z)(a))),(0,V.Z)(i,r.Plan,new Le(a.context,(0,B.Z)(a))),i),a.currentNavMode=a.navMode[r.Orbit],a.currentNavMode.toggle(!0,{preventTargetAdjustment:!0}),Object.values(a.navMode).forEach((function(t){t.onChange.on(a.onChange.trigger),t.onChangeProjection.on(a.onChangeProjection.trigger)})),a.projectionManager=new Ne(t,(0,B.Z)(a)),a.setupControls(),a}return(0,u.Z)(n,[{key:"dispose",value:function(){this.perspectiveCamera.removeFromParent(),this.perspectiveCamera=null,this.orthographicCamera.removeFromParent(),this.orthographicCamera=null,this.cameraControls.dispose(),this.cameraControls=null,this.navMode=null,this.context=null,this.projectionManager=null}},{key:"projection",get:function(){return this.projectionManager.projection},set:function(t){this.projectionManager.projection=t}},{key:"controls",get:function(){return this.cameraControls}},{key:"activeCamera",get:function(){return this.projectionManager.activeCamera}},{key:"update",value:function(t){(0,S.Z)((0,R.Z)(n.prototype),"update",this).call(this,t),this.cameraControls.enabled&&this.cameraControls.update(t)}},{key:"updateAspect",value:function(t){t||(t=this.context.getDimensions()),this.perspectiveCamera.aspect=t.x/t.y,this.perspectiveCamera.updateProjectionMatrix(),this.setOrthoCameraAspect(t)}},{key:"submitOnChange",value:function(t){this.onChange.on(t)}},{key:"setNavigationMode",value:function(t){this.currentNavMode.mode!==t&&(this.currentNavMode.toggle(!1),this.currentNavMode=this.navMode[t],this.currentNavMode.toggle(!0))}},{key:"toggleCameraControls",value:function(t){this.cameraControls.enabled=t}},{key:"toggleProjection",value:function(){var t=this.projection===i.Orthographic;this.projection=t?i.Perspective:i.Orthographic,this.onChangeProjection.trigger(this.activeCamera)}},{key:"targetItem",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.context.getCenter(e),t.next=3,this.cameraControls.moveTo(n.x,n.y,n.z,!0);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"toggleUserInput",value:function(t){if(console.log(this.previousUserInput),t){if(0===Object.keys(this.previousUserInput).length)return;this.cameraControls.mouseButtons.left=this.previousUserInput.left,this.cameraControls.mouseButtons.right=this.previousUserInput.right,this.cameraControls.mouseButtons.middle=this.previousUserInput.middle,this.cameraControls.mouseButtons.wheel=this.previousUserInput.wheel}else this.previousUserInput.left=this.cameraControls.mouseButtons.left,this.previousUserInput.right=this.cameraControls.mouseButtons.right,this.previousUserInput.middle=this.cameraControls.mouseButtons.middle,this.previousUserInput.wheel=this.cameraControls.mouseButtons.wheel,this.cameraControls.mouseButtons.left=0,this.cameraControls.mouseButtons.right=0,this.cameraControls.mouseButtons.middle=0,this.cameraControls.mouseButtons.wheel=0}},{key:"setOrthoCameraAspect",value:function(t){var e=t.x/t.y;this.orthographicCamera.left=-50*e/2,this.orthographicCamera.right=ke*e/2,this.orthographicCamera.top=25,this.orthographicCamera.bottom=-25,this.orthographicCamera.updateProjectionMatrix()}},{key:"setupCameras",value:function(){this.setCameraPositionAndTarget(this.perspectiveCamera)}},{key:"setCameraPositionAndTarget",value:function(t){t.position.z=10,t.position.y=10,t.position.x=10,t.lookAt(new p.Vector3(0,0,0))}},{key:"setupControls",value:function(){this.cameraControls.dampingFactor=.2,this.cameraControls.dollyToCursor=!0,this.cameraControls.infinityDolly=!0,this.cameraControls.setTarget(0,0,0)}}]),n}(c),Ue=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).context=t,r.raycaster=new p.Raycaster,r}return(0,u.Z)(n,[{key:"dispose",value:function(){this.raycaster=null,this.context=null}},{key:"castRay",value:function(t){var e=this.context.getCamera();return this.raycaster.setFromCamera(this.context.mouse.position,e),this.raycaster.intersectObjects(t)}},{key:"castRayIfc",value:function(){var t=this.castRay(this.context.items.pickableIfcModels),e=this.filterClippingPlanes(t);return e.length>0?e[0]:null}},{key:"filterClippingPlanes",value:function(t){var e=this.context.getClippingPlanes();return t.length<=0||!e||(null===e||void 0===e?void 0:e.length)<=0?t:t.filter((function(t){return e.every((function(e){return e.distanceToPoint(t.point)>0}))}))}}]),n}(c),Ze={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"},Be=function(){function t(){(0,o.Z)(this,t),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}return(0,u.Z)(t,[{key:"setSize",value:function(){}},{key:"render",value:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}]),t}(),Ge=new p.OrthographicCamera(-1,1,1,-1,0,1),Ye=new p.BufferGeometry;Ye.setAttribute("position",new p.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),Ye.setAttribute("uv",new p.Float32BufferAttribute([0,2,0,0,2,0],2));var Ve=function(){function t(e){(0,o.Z)(this,t),this._mesh=new p.Mesh(Ye,e)}return(0,u.Z)(t,[{key:"dispose",value:function(){this._mesh.geometry.dispose()}},{key:"render",value:function(t){t.render(this._mesh,Ge)}},{key:"material",get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}]),t}(),ze=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r){var i;return(0,o.Z)(this,n),(i=e.call(this)).textureID=void 0!==r?r:"tDiffuse",t instanceof p.ShaderMaterial?(i.uniforms=t.uniforms,i.material=t):t&&(i.uniforms=p.UniformsUtils.clone(t.uniforms),i.material=new p.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:i.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),i.fsQuad=new Ve(i.material),i}return(0,u.Z)(n,[{key:"render",value:function(t,e,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}]),n}(Be),He=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r){var i;return(0,o.Z)(this,n),(i=e.call(this)).scene=t,i.camera=r,i.clear=!0,i.needsSwap=!1,i.inverse=!1,i}return(0,u.Z)(n,[{key:"render",value:function(t,e,n){var r,i,a=t.getContext(),s=t.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(r=0,i=1):(r=1,i=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),s.buffers.stencil.setFunc(a.ALWAYS,r,4294967295),s.buffers.stencil.setClear(i),s.buffers.stencil.setLocked(!0),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(a.EQUAL,1,4294967295),s.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),s.buffers.stencil.setLocked(!0)}}]),n}(Be),Xe=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(){var t;return(0,o.Z)(this,n),(t=e.call(this)).needsSwap=!1,t}return(0,u.Z)(n,[{key:"render",value:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}]),n}(Be),We=function(){function t(e,n){if((0,o.Z)(this,t),this.renderer=e,void 0===n){var r={minFilter:p.LinearFilter,magFilter:p.LinearFilter,format:p.RGBAFormat},i=e.getSize(new p.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(n=new p.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===Ze&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===ze&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new ze(Ze),this.clock=new p.Clock}return(0,u.Z)(t,[{key:"swapBuffers",value:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}},{key:"addPass",value:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"insertPass",value:function(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"removePass",value:function(t){var e=this.passes.indexOf(t);-1!==e&&this.passes.splice(e,1)}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}},{key:"render",value:function(t){void 0===t&&(t=this.clock.getDelta());for(var e=this.renderer.getRenderTarget(),n=!1,r=0,i=this.passes.length;r<i;r++){var a=this.passes[r];if(!1!==a.enabled){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),a.render(this.renderer,this.writeBuffer,this.readBuffer,t,n),a.needsSwap){if(n){var s=this.renderer.getContext(),o=this.renderer.state.buffers.stencil;o.setFunc(s.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.setFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==He&&(a instanceof He?n=!0:a instanceof Xe&&(n=!1))}}this.renderer.setRenderTarget(e)}},{key:"reset",value:function(t){if(void 0===t){var e=this.renderer.getSize(new p.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}},{key:"setSize",value:function(t,e){this._width=t,this._height=e;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(n,r)}},{key:"setPixelRatio",value:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}]),t}(),Qe=(new p.OrthographicCamera(-1,1,1,-1,0,1),new p.BufferGeometry);Qe.setAttribute("position",new p.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),Qe.setAttribute("uv",new p.Float32BufferAttribute([0,2,0,0,2,0],2));var je=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r,i,a,s){var u;return(0,o.Z)(this,n),(u=e.call(this)).scene=t,u.camera=r,u.overrideMaterial=i,u.clearColor=a,u.clearAlpha=void 0!==s?s:0,u.clear=!0,u.clearDepth=!1,u.needsSwap=!1,u._oldClearColor=new p.Color,u}return(0,u.Z)(n,[{key:"render",value:function(t,e,n){var r,i,a=t.autoClear;t.autoClear=!1,void 0!==this.overrideMaterial&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(t.getClearColor(this._oldClearColor),r=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=i),t.autoClear=a}}]),n}(Be),qe={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new p.Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new p.Matrix4},cameraInverseProjectionMatrix:{value:new p.Matrix4},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\t#if DIFFUSE_TEXTURE == 1\n\t\tuniform sampler2D tDiffuse;\n\t\t#endif\n\n\t\tuniform sampler2D tDepth;\n\n\t\t#if NORMAL_TEXTURE == 1\n\t\tuniform sampler2D tNormal;\n\t\t#endif\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float scale;\n\t\tuniform float intensity;\n\t\tuniform float bias;\n\t\tuniform float kernelRadius;\n\t\tuniform float minResolution;\n\t\tuniform vec2 size;\n\t\tuniform float randomSeed;\n\n\t\t// RGBA depth\n\n\t\t#include <packing>\n\n\t\tvec4 getDefaultColor( const in vec2 screenPosition ) {\n\t\t\t#if DIFFUSE_TEXTURE == 1\n\t\t\treturn texture2D( tDiffuse, vUv );\n\t\t\t#else\n\t\t\treturn vec4( 1.0 );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {\n\t\t\t#if NORMAL_TEXTURE == 1\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\t\t\t#else\n\t\t\treturn normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat scaleDividedByCameraFar;\n\t\tfloat minResolutionMultipliedByCameraFar;\n\n\t\tfloat getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n\t\t\tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n\t\t\tfloat viewDistance = length( viewDelta );\n\t\t\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n\n\t\t\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );\n\t\t}\n\n\t\t// moving costly divides into consts\n\t\tconst float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n\t\tconst float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n\t\tfloat getAmbientOcclusion( const in vec3 centerViewPosition ) {\n\t\t\t// precompute some variables require in getOcclusion.\n\t\t\tscaleDividedByCameraFar = scale / cameraFar;\n\t\t\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;\n\t\t\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );\n\n\t\t\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n\t\t\tfloat angle = rand( vUv + randomSeed ) * PI2;\n\t\t\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;\n\t\t\tvec2 radiusStep = radius;\n\n\t\t\tfloat occlusionSum = 0.0;\n\t\t\tfloat weightSum = 0.0;\n\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n\t\t\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;\n\t\t\t\tradius += radiusStep;\n\t\t\t\tangle += ANGLE_STEP;\n\n\t\t\t\tfloat sampleDepth = getDepth( sampleUv );\n\t\t\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfloat sampleViewZ = getViewZ( sampleDepth );\n\t\t\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );\n\t\t\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n\t\t\t\tweightSum += 1.0;\n\t\t\t}\n\n\t\t\tif( weightSum == 0.0 ) discard;\n\n\t\t\treturn occlusionSum * ( intensity / weightSum );\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat centerDepth = getDepth( vUv );\n\t\t\tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = getViewZ( centerDepth );\n\t\t\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );\n\n\t\t\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n\n\t\t\tgl_FragColor = getDefaultColor( vUv );\n\t\t\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;\n\t\t}"},Ke={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new p.Vector2(512,512)},sampleUvOffsets:{value:[new p.Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:"\n\n\t\t#include <common>\n\n\t\tuniform vec2 size;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tvInvSize = 1.0 / size;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <packing>\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform float depthCutoff;\n\n\t\tuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\n\t\tuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tif( depth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = -getViewZ( depth );\n\t\t\tbool rBreak = false, lBreak = false;\n\n\t\t\tfloat weightSum = sampleWeights[0];\n\t\t\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\n\n\t\t\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n\t\t\t\tfloat sampleWeight = sampleWeights[i];\n\t\t\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\n\n\t\t\t\tvec2 sampleUv = vUv + sampleUvOffset;\n\t\t\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\n\n\t\t\t\tif( ! rBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t\tsampleUv = vUv - sampleUvOffset;\n\t\t\t\tviewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\n\n\t\t\t\tif( ! lBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = diffuseSum / weightSum;\n\t\t}"},Je={createSampleWeights:function(t,e){for(var n=[],r=0;r<=t;r++)n.push($e(r,e));return n},createSampleOffsets:function(t,e){for(var n=[],r=0;r<=t;r++)n.push(e.clone().multiplyScalar(r));return n},configure:function(t,e,n,r){t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=Je.createSampleOffsets(e,r),t.uniforms.sampleWeights.value=Je.createSampleWeights(e,n),t.needsUpdate=!0}};function $e(t,e){return Math.exp(-t*t/(e*e*2))/(Math.sqrt(2*Math.PI)*e)}var tn={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );\n\t\t\tgl_FragColor = vec4( vec3( depth ), opacity );\n\n\t\t}"},en=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r){var i,a,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new p.Vector2(256,256);return(0,o.Z)(this,n),(i=e.call(this)).scene=t,i.camera=r,i.clear=!0,i.needsSwap=!1,i.supportsDepthTextureExtension=s,i.supportsNormalTexture=u,i.originalClearColor=new p.Color,i._oldClearColor=new p.Color,i.oldClearAlpha=1,i.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},i.resolution=new p.Vector2(l.x,l.y),i.saoRenderTarget=new p.WebGLRenderTarget(i.resolution.x,i.resolution.y,{minFilter:p.LinearFilter,magFilter:p.LinearFilter,format:p.RGBAFormat}),i.blurIntermediateRenderTarget=i.saoRenderTarget.clone(),i.beautyRenderTarget=i.saoRenderTarget.clone(),i.normalRenderTarget=new p.WebGLRenderTarget(i.resolution.x,i.resolution.y,{minFilter:p.NearestFilter,magFilter:p.NearestFilter,format:p.RGBAFormat}),i.depthRenderTarget=i.normalRenderTarget.clone(),i.supportsDepthTextureExtension&&((a=new p.DepthTexture).type=p.UnsignedShortType,i.beautyRenderTarget.depthTexture=a,i.beautyRenderTarget.depthBuffer=!0),i.depthMaterial=new p.MeshDepthMaterial,i.depthMaterial.depthPacking=p.RGBADepthPacking,i.depthMaterial.blending=p.NoBlending,i.normalMaterial=new p.MeshNormalMaterial,i.normalMaterial.blending=p.NoBlending,void 0===qe&&console.error("THREE.SAOPass relies on SAOShader"),i.saoMaterial=new p.ShaderMaterial({defines:Object.assign({},qe.defines),fragmentShader:qe.fragmentShader,vertexShader:qe.vertexShader,uniforms:p.UniformsUtils.clone(qe.uniforms)}),i.saoMaterial.extensions.derivatives=!0,i.saoMaterial.defines.DEPTH_PACKING=i.supportsDepthTextureExtension?0:1,i.saoMaterial.defines.NORMAL_TEXTURE=i.supportsNormalTexture?1:0,i.saoMaterial.defines.PERSPECTIVE_CAMERA=i.camera.isPerspectiveCamera?1:0,i.saoMaterial.uniforms.tDepth.value=i.supportsDepthTextureExtension?a:i.depthRenderTarget.texture,i.saoMaterial.uniforms.tNormal.value=i.normalRenderTarget.texture,i.saoMaterial.uniforms.size.value.set(i.resolution.x,i.resolution.y),i.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(i.camera.projectionMatrixInverse),i.saoMaterial.uniforms.cameraProjectionMatrix.value=i.camera.projectionMatrix,i.saoMaterial.blending=p.NoBlending,void 0===Ke&&console.error("THREE.SAOPass relies on DepthLimitedBlurShader"),i.vBlurMaterial=new p.ShaderMaterial({uniforms:p.UniformsUtils.clone(Ke.uniforms),defines:Object.assign({},Ke.defines),vertexShader:Ke.vertexShader,fragmentShader:Ke.fragmentShader}),i.vBlurMaterial.defines.DEPTH_PACKING=i.supportsDepthTextureExtension?0:1,i.vBlurMaterial.defines.PERSPECTIVE_CAMERA=i.camera.isPerspectiveCamera?1:0,i.vBlurMaterial.uniforms.tDiffuse.value=i.saoRenderTarget.texture,i.vBlurMaterial.uniforms.tDepth.value=i.supportsDepthTextureExtension?a:i.depthRenderTarget.texture,i.vBlurMaterial.uniforms.size.value.set(i.resolution.x,i.resolution.y),i.vBlurMaterial.blending=p.NoBlending,i.hBlurMaterial=new p.ShaderMaterial({uniforms:p.UniformsUtils.clone(Ke.uniforms),defines:Object.assign({},Ke.defines),vertexShader:Ke.vertexShader,fragmentShader:Ke.fragmentShader}),i.hBlurMaterial.defines.DEPTH_PACKING=i.supportsDepthTextureExtension?0:1,i.hBlurMaterial.defines.PERSPECTIVE_CAMERA=i.camera.isPerspectiveCamera?1:0,i.hBlurMaterial.uniforms.tDiffuse.value=i.blurIntermediateRenderTarget.texture,i.hBlurMaterial.uniforms.tDepth.value=i.supportsDepthTextureExtension?a:i.depthRenderTarget.texture,i.hBlurMaterial.uniforms.size.value.set(i.resolution.x,i.resolution.y),i.hBlurMaterial.blending=p.NoBlending,void 0===Ze&&console.error("THREE.SAOPass relies on CopyShader"),i.materialCopy=new p.ShaderMaterial({uniforms:p.UniformsUtils.clone(Ze.uniforms),vertexShader:Ze.vertexShader,fragmentShader:Ze.fragmentShader,blending:p.NoBlending}),i.materialCopy.transparent=!0,i.materialCopy.depthTest=!1,i.materialCopy.depthWrite=!1,i.materialCopy.blending=p.CustomBlending,i.materialCopy.blendSrc=p.DstColorFactor,i.materialCopy.blendDst=p.ZeroFactor,i.materialCopy.blendEquation=p.AddEquation,i.materialCopy.blendSrcAlpha=p.DstAlphaFactor,i.materialCopy.blendDstAlpha=p.ZeroFactor,i.materialCopy.blendEquationAlpha=p.AddEquation,void 0===tn&&console.error("THREE.SAOPass relies on UnpackDepthRGBAShader"),i.depthCopy=new p.ShaderMaterial({uniforms:p.UniformsUtils.clone(tn.uniforms),vertexShader:tn.vertexShader,fragmentShader:tn.fragmentShader,blending:p.NoBlending}),i.fsQuad=new Ve(null),i}return(0,u.Z)(n,[{key:"render",value:function(t,e,n){if(this.renderToScreen&&(this.materialCopy.blending=p.NoBlending,this.materialCopy.uniforms.tDiffuse.value=n.texture,this.materialCopy.needsUpdate=!0,this.renderPass(t,this.materialCopy,null)),1!==this.params.output){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();var r=t.autoClear;t.autoClear=!1,t.setRenderTarget(this.depthRenderTarget),t.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;var i=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=i,this.hBlurMaterial.uniforms.depthCutoff.value=i,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(Je.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new p.Vector2(0,1)),Je.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new p.Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),t.setClearColor(0),t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(t,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(t,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(t,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(t,this.hBlurMaterial,this.saoRenderTarget,16777215,1));var a=this.materialCopy;3===this.params.output?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,a=this.depthCopy):4===this.params.output?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),0===this.params.output?a.blending=p.CustomBlending:a.blending=p.NoBlending,this.renderPass(t,a,this.renderToScreen?null:n),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=r}}},{key:"renderPass",value:function(t,e,n,r,i){t.getClearColor(this.originalClearColor);var a=t.getClearAlpha(),s=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,void 0!==r&&null!==r&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=s,t.setClearColor(this.originalClearColor),t.setClearAlpha(a)}},{key:"renderOverride",value:function(t,e,n,r,i){t.getClearColor(this.originalClearColor);var a=t.getClearAlpha(),s=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r=e.clearColor||r,i=e.clearAlpha||i,void 0!==r&&null!==r&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=s,t.setClearColor(this.originalClearColor),t.setClearAlpha(a)}},{key:"setSize",value:function(t,e){this.beautyRenderTarget.setSize(t,e),this.saoRenderTarget.setSize(t,e),this.blurIntermediateRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.depthRenderTarget.setSize(t,e),this.saoMaterial.uniforms.size.value.set(t,e),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(t,e),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(t,e),this.hBlurMaterial.needsUpdate=!0}}]),n}(Be);en.OUTPUT={Beauty:1,Default:0,SAO:2,Depth:3,Normal:4};var nn={uniforms:{tDiffuse:{value:null},resolution:{value:new p.Vector2(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:'\n\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t#define FXAA_PC 1\n\t\t#define FXAA_GLSL_100 1\n\t\t#define FXAA_QUALITY_PRESET 12\n\n\t\t#define FXAA_GREEN_AS_LUMA 1\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_PC_CONSOLE\n\t\t\t\t//\n\t\t\t\t// The console algorithm for PC is included\n\t\t\t\t// for developers targeting really low spec machines.\n\t\t\t\t// Likely better to just run FXAA_PC, and use a really low preset.\n\t\t\t\t//\n\t\t\t\t#define FXAA_PC_CONSOLE 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_120\n\t\t\t\t#define FXAA_GLSL_120 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GLSL_130\n\t\t\t\t#define FXAA_GLSL_130 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_3\n\t\t\t\t#define FXAA_HLSL_3 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_4\n\t\t\t\t#define FXAA_HLSL_4 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_HLSL_5\n\t\t\t\t#define FXAA_HLSL_5 0\n\t\t#endif\n\t\t/*==========================================================================*/\n\t\t#ifndef FXAA_GREEN_AS_LUMA\n\t\t\t\t//\n\t\t\t\t// For those using non-linear color,\n\t\t\t\t// and either not able to get luma in alpha, or not wanting to,\n\t\t\t\t// this enables FXAA to run using green as a proxy for luma.\n\t\t\t\t// So with this enabled, no need to pack luma in alpha.\n\t\t\t\t//\n\t\t\t\t// This will turn off AA on anything which lacks some amount of green.\n\t\t\t\t// Pure red and blue or combination of only R and B, will get no AA.\n\t\t\t\t//\n\t\t\t\t// Might want to lower the settings for both,\n\t\t\t\t//\t\tfxaaConsoleEdgeThresholdMin\n\t\t\t\t//\t\tfxaaQualityEdgeThresholdMin\n\t\t\t\t// In order to insure AA does not get turned off on colors\n\t\t\t\t// which contain a minor amount of green.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_GREEN_AS_LUMA 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_EARLY_EXIT\n\t\t\t\t//\n\t\t\t\t// Controls algorithm\'s early exit path.\n\t\t\t\t// On PS3 turning this ON adds 2 cycles to the shader.\n\t\t\t\t// On 360 turning this OFF adds 10ths of a millisecond to the shader.\n\t\t\t\t// Turning this off on console will result in a more blurry image.\n\t\t\t\t// So this defaults to on.\n\t\t\t\t//\n\t\t\t\t// 1 = On.\n\t\t\t\t// 0 = Off.\n\t\t\t\t//\n\t\t\t\t#define FXAA_EARLY_EXIT 1\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_DISCARD\n\t\t\t\t//\n\t\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t\t//\n\t\t\t\t// 1 = Use discard on pixels which don\'t need AA.\n\t\t\t\t//\t\t For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t\t// 0 = Return unchanged color on pixels which don\'t need AA.\n\t\t\t\t//\n\t\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t//\n\t\t\t\t// Used for GLSL 120 only.\n\t\t\t\t//\n\t\t\t\t// 1 = GL API supports fast pixel offsets\n\t\t\t\t// 0 = do not use fast pixel offsets\n\t\t\t\t//\n\t\t\t\t#ifdef GL_EXT_gpu_shader4\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_FAST_PIXEL_OFFSET\n\t\t\t\t\t\t#define FXAA_FAST_PIXEL_OFFSET 0\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t//\n\t\t\t\t// 1 = API supports gather4 on alpha channel.\n\t\t\t\t// 0 = API does not support gather4 on alpha channel.\n\t\t\t\t//\n\t\t\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_ARB_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifdef GL_NV_gpu_shader5\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 1\n\t\t\t\t#endif\n\t\t\t\t#ifndef FXAA_GATHER4_ALPHA\n\t\t\t\t\t\t#define FXAA_GATHER4_ALPHA 0\n\t\t\t\t#endif\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tFXAA QUALITY - TUNING KNOBS\n\t\t------------------------------------------------------------------------------\n\t\tNOTE the other tuning knobs are now in the shader function inputs!\n\t\t============================================================================*/\n\t\t#ifndef FXAA_QUALITY_PRESET\n\t\t\t\t//\n\t\t\t\t// Choose the quality preset.\n\t\t\t\t// This needs to be compiled into the shader as it effects code.\n\t\t\t\t// Best option to include multiple presets is to\n\t\t\t\t// in each shader define the preset, then include this file.\n\t\t\t\t//\n\t\t\t\t// OPTIONS\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n\t\t\t\t// 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n\t\t\t\t// 39\t\t\t - no dither, very expensive\n\t\t\t\t//\n\t\t\t\t// NOTES\n\t\t\t\t// -----------------------------------------------------------------------\n\t\t\t\t// 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n\t\t\t\t// 13 = about same speed as FXAA 3.9 and better than 12\n\t\t\t\t// 23 = closest to FXAA 3.9 visually and performance wise\n\t\t\t\t//\t_ = the lowest digit is directly related to performance\n\t\t\t\t// _\t= the highest digit is directly related to style\n\t\t\t\t//\n\t\t\t\t#define FXAA_QUALITY_PRESET 12\n\t\t#endif\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - PRESETS\n\n\t\t============================================================================*/\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - MEDIUM DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 10)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 3.0\n\t\t\t\t#define FXAA_QUALITY_P2 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 11)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 3.0\n\t\t\t\t#define FXAA_QUALITY_P3 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 12)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 4.0\n\t\t\t\t#define FXAA_QUALITY_P4 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 13)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 4.0\n\t\t\t\t#define FXAA_QUALITY_P5 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 14)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 4.0\n\t\t\t\t#define FXAA_QUALITY_P6 12.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 15)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 12.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - LOW DITHER PRESETS\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 20)\n\t\t\t\t#define FXAA_QUALITY_PS 3\n\t\t\t\t#define FXAA_QUALITY_P0 1.5\n\t\t\t\t#define FXAA_QUALITY_P1 2.0\n\t\t\t\t#define FXAA_QUALITY_P2 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 21)\n\t\t\t\t#define FXAA_QUALITY_PS 4\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 22)\n\t\t\t\t#define FXAA_QUALITY_PS 5\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 23)\n\t\t\t\t#define FXAA_QUALITY_PS 6\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 24)\n\t\t\t\t#define FXAA_QUALITY_PS 7\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 3.0\n\t\t\t\t#define FXAA_QUALITY_P6 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 25)\n\t\t\t\t#define FXAA_QUALITY_PS 8\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 4.0\n\t\t\t\t#define FXAA_QUALITY_P7 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 26)\n\t\t\t\t#define FXAA_QUALITY_PS 9\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 4.0\n\t\t\t\t#define FXAA_QUALITY_P8 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 27)\n\t\t\t\t#define FXAA_QUALITY_PS 10\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 4.0\n\t\t\t\t#define FXAA_QUALITY_P9 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 28)\n\t\t\t\t#define FXAA_QUALITY_PS 11\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 4.0\n\t\t\t\t#define FXAA_QUALITY_P10 8.0\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_QUALITY_PRESET == 29)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.5\n\t\t\t\t#define FXAA_QUALITY_P2 2.0\n\t\t\t\t#define FXAA_QUALITY_P3 2.0\n\t\t\t\t#define FXAA_QUALITY_P4 2.0\n\t\t\t\t#define FXAA_QUALITY_P5 2.0\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t\t FXAA QUALITY - EXTREME QUALITY\n\t\t============================================================================*/\n\t\t#if (FXAA_QUALITY_PRESET == 39)\n\t\t\t\t#define FXAA_QUALITY_PS 12\n\t\t\t\t#define FXAA_QUALITY_P0 1.0\n\t\t\t\t#define FXAA_QUALITY_P1 1.0\n\t\t\t\t#define FXAA_QUALITY_P2 1.0\n\t\t\t\t#define FXAA_QUALITY_P3 1.0\n\t\t\t\t#define FXAA_QUALITY_P4 1.0\n\t\t\t\t#define FXAA_QUALITY_P5 1.5\n\t\t\t\t#define FXAA_QUALITY_P6 2.0\n\t\t\t\t#define FXAA_QUALITY_P7 2.0\n\t\t\t\t#define FXAA_QUALITY_P8 2.0\n\t\t\t\t#define FXAA_QUALITY_P9 2.0\n\t\t\t\t#define FXAA_QUALITY_P10 4.0\n\t\t\t\t#define FXAA_QUALITY_P11 8.0\n\t\t#endif\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI PORTING\n\n\t\t============================================================================*/\n\t\t#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard discard\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 vec2\n\t\t\t\t#define FxaaFloat3 vec3\n\t\t\t\t#define FxaaFloat4 vec4\n\t\t\t\t#define FxaaHalf float\n\t\t\t\t#define FxaaHalf2 vec2\n\t\t\t\t#define FxaaHalf3 vec3\n\t\t\t\t#define FxaaHalf4 vec4\n\t\t\t\t#define FxaaInt2 ivec2\n\t\t\t\t#define FxaaSat(x) clamp(x, 0.0, 1.0)\n\t\t\t\t#define FxaaTex sampler2D\n\t\t#else\n\t\t\t\t#define FxaaBool bool\n\t\t\t\t#define FxaaDiscard clip(-1)\n\t\t\t\t#define FxaaFloat float\n\t\t\t\t#define FxaaFloat2 float2\n\t\t\t\t#define FxaaFloat3 float3\n\t\t\t\t#define FxaaFloat4 float4\n\t\t\t\t#define FxaaHalf half\n\t\t\t\t#define FxaaHalf2 half2\n\t\t\t\t#define FxaaHalf3 half3\n\t\t\t\t#define FxaaHalf4 half4\n\t\t\t\t#define FxaaSat(x) saturate(x)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n\t\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_120 == 1)\n\t\t\t\t// Requires,\n\t\t\t\t//\t#version 120\n\t\t\t\t// And at least,\n\t\t\t\t//\t#extension GL_EXT_gpu_shader4 : enable\n\t\t\t\t//\t(or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n\t\t\t\t#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n\t\t\t\t#if (FXAA_FAST_PIXEL_OFFSET == 1)\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n\t\t\t\t#else\n\t\t\t\t\t\t#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n\t\t\t\t#endif\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_GLSL_130 == 1)\n\t\t\t\t// Requires "#version 130" or better\n\t\t\t\t#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t// use #extension GL_ARB_gpu_shader5 : enable\n\t\t\t\t\t\t#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n\t\t\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n\t\t\t\t\t\t#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n\t\t\t\t\t\t#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n\t\t\t\t#endif\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_3 == 1)\n\t\t\t\t#define FxaaInt2 float2\n\t\t\t\t#define FxaaTex sampler2D\n\t\t\t\t#define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n\t\t\t\t#define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_4 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#if (FXAA_HLSL_5 == 1)\n\t\t\t\t#define FxaaInt2 int2\n\t\t\t\tstruct FxaaTex { SamplerState smpl; Texture2D tex; };\n\t\t\t\t#define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n\t\t\t\t#define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n\t\t\t\t#define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n\t\t\t\t#define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n\t\t\t\t#define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n\t\t\t\t#define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n\t\t#endif\n\n\n\t\t/*============================================================================\n\t\t\t\t\t\t\t\t\t\t\t GREEN AS LUMA OPTION SUPPORT FUNCTION\n\t\t============================================================================*/\n\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n\t\t#else\n\t\t\t\tFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n\t\t#endif\n\n\n\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t FXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\t\t#if (FXAA_PC == 1)\n\t\t/*--------------------------------------------------------------------------*/\n\t\tFxaaFloat4 FxaaPixelShader(\n\t\t\t\t//\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy} = center of pixel\n\t\t\t\tFxaaFloat2 pos,\n\t\t\t\t//\n\t\t\t\t// Used only for FXAA Console, and not used on the 360 version.\n\t\t\t\t// Use noperspective interpolation here (turn off perspective interpolation).\n\t\t\t\t// {xy_} = upper left of pixel\n\t\t\t\t// {_zw} = lower right of pixel\n\t\t\t\tFxaaFloat4 fxaaConsolePosPos,\n\t\t\t\t//\n\t\t\t\t// Input color texture.\n\t\t\t\t// {rgb_} = color in linear or perceptual color space\n\t\t\t\t// if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t//\t\t {__a} = luma in perceptual color space (not linear)\n\t\t\t\tFxaaTex tex,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 2nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -1.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegOne,\n\t\t\t\t//\n\t\t\t\t// Only used on the optimized 360 version of FXAA Console.\n\t\t\t\t// For everything but 360, just use the same input here as for "tex".\n\t\t\t\t// For 360, same texture, just alias with a 3nd sampler.\n\t\t\t\t// This sampler needs to have an exponent bias of -2.\n\t\t\t\tFxaaTex fxaaConsole360TexExpBiasNegTwo,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x_} = 1.0/screenWidthInPixels\n\t\t\t\t// {_y} = 1.0/screenHeightInPixels\n\t\t\t\tFxaaFloat2 fxaaQualityRcpFrame,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// This effects sub-pixel AA quality and inversely sharpness.\n\t\t\t\t//\t Where N ranges between,\n\t\t\t\t//\t\t N = 0.50 (default)\n\t\t\t\t//\t\t N = 0.33 (sharper)\n\t\t\t\t// {x__} = -N/screenWidthInPixels\n\t\t\t\t// {_y_} = -N/screenHeightInPixels\n\t\t\t\t// {_z_} =\tN/screenWidthInPixels\n\t\t\t\t// {__w} =\tN/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Not used on 360, but used on PS3 and PC.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} = -2.0/screenWidthInPixels\n\t\t\t\t// {_y_} = -2.0/screenHeightInPixels\n\t\t\t\t// {_z_} =\t2.0/screenWidthInPixels\n\t\t\t\t// {__w} =\t2.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsoleRcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n\t\t\t\t// This must be from a constant/uniform.\n\t\t\t\t// {x__} =\t8.0/screenWidthInPixels\n\t\t\t\t// {_y_} =\t8.0/screenHeightInPixels\n\t\t\t\t// {_z_} = -4.0/screenWidthInPixels\n\t\t\t\t// {__w} = -4.0/screenHeightInPixels\n\t\t\t\tFxaaFloat4 fxaaConsole360RcpFrameOpt2,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_SUBPIX define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Choose the amount of sub-pixel aliasing removal.\n\t\t\t\t// This can effect sharpness.\n\t\t\t\t//\t 1.00 - upper limit (softer)\n\t\t\t\t//\t 0.75 - default amount of filtering\n\t\t\t\t//\t 0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n\t\t\t\t//\t 0.25 - almost off\n\t\t\t\t//\t 0.00 - completely off\n\t\t\t\tFxaaFloat fxaaQualitySubpix,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// The minimum amount of local contrast required to apply algorithm.\n\t\t\t\t//\t 0.333 - too little (faster)\n\t\t\t\t//\t 0.250 - low quality\n\t\t\t\t//\t 0.166 - default\n\t\t\t\t//\t 0.125 - high quality\n\t\t\t\t//\t 0.063 - overkill (slower)\n\t\t\t\tFxaaFloat fxaaQualityEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Quality.\n\t\t\t\t// This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t//\t 0.0833 - upper limit (default, the start of visible unfiltered edges)\n\t\t\t\t//\t 0.0625 - high quality (faster)\n\t\t\t\t//\t 0.0312 - visible limit (slower)\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaQualityEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only three safe values here: 2 and 4 and 8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// For all other platforms can be a non-power of two.\n\t\t\t\t//\t 8.0 is sharper (default!!!)\n\t\t\t\t//\t 4.0 is softer\n\t\t\t\t//\t 2.0 is really soft (good only for vector graphics inputs)\n\t\t\t\tFxaaFloat fxaaConsoleEdgeSharpness,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// This does not effect PS3, as this needs to be compiled in.\n\t\t\t\t//\t Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n\t\t\t\t//\t Due to the PS3 being ALU bound,\n\t\t\t\t//\t there are only two safe values here: 1/4 and 1/8.\n\t\t\t\t//\t These options use the shaders ability to a free *|/ by 2|4|8.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// Other platforms can use other values.\n\t\t\t\t//\t 0.125 leaves less aliasing, but is softer (default!!!)\n\t\t\t\t//\t 0.25 leaves more aliasing, and is sharper\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThreshold,\n\t\t\t\t//\n\t\t\t\t// Only used on FXAA Console.\n\t\t\t\t// This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n\t\t\t\t// It is here now to allow easier tuning.\n\t\t\t\t// Trims the algorithm from processing darks.\n\t\t\t\t// The console setting has a different mapping than the quality setting.\n\t\t\t\t// This only applies when FXAA_EARLY_EXIT is 1.\n\t\t\t\t// This does not apply to PS3,\n\t\t\t\t// PS3 was simplified to avoid more shader instructions.\n\t\t\t\t//\t 0.06 - faster but more aliasing in darks\n\t\t\t\t//\t 0.05 - default\n\t\t\t\t//\t 0.04 - slower and less aliasing in darks\n\t\t\t\t// Special notes when using FXAA_GREEN_AS_LUMA,\n\t\t\t\t//\t Likely want to set this to zero.\n\t\t\t\t//\t As colors that are mostly not-green\n\t\t\t\t//\t will appear very dark in the green channel!\n\t\t\t\t//\t Tune by looking at mostly non-green content,\n\t\t\t\t//\t then start at zero and increase until aliasing is a problem.\n\t\t\t\tFxaaFloat fxaaConsoleEdgeThresholdMin,\n\t\t\t\t//\n\t\t\t\t// Extra constants for 360 FXAA Console only.\n\t\t\t\t// Use zeros or anything else for other platforms.\n\t\t\t\t// These must be in physical constant registers and NOT immediates.\n\t\t\t\t// Immediates will result in compiler un-optimizing.\n\t\t\t\t// {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n\t\t\t\tFxaaFloat4 fxaaConsole360ConstDir\n\t\t) {\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posM;\n\t\t\t\tposM.x = pos.x;\n\t\t\t\tposM.y = pos.y;\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 1)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n\t\t\t\t\t\t\t\tFxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\t#define lumaM luma4A.w\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#define lumaE luma4A.z\n\t\t\t\t\t\t#define lumaS luma4A.x\n\t\t\t\t\t\t#define lumaSE luma4A.y\n\t\t\t\t\t\t#define lumaNW luma4B.w\n\t\t\t\t\t\t#define lumaN luma4B.z\n\t\t\t\t\t\t#define lumaW luma4B.x\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n\t\t\t\t\t\t#if (FXAA_GREEN_AS_LUMA == 0)\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.w\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\t#define lumaM rgbyM.y\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat maxSM = max(lumaS, lumaM);\n\t\t\t\tFxaaFloat minSM = min(lumaS, lumaM);\n\t\t\t\tFxaaFloat maxESM = max(lumaE, maxSM);\n\t\t\t\tFxaaFloat minESM = min(lumaE, minSM);\n\t\t\t\tFxaaFloat maxWN = max(lumaN, lumaW);\n\t\t\t\tFxaaFloat minWN = min(lumaN, lumaW);\n\t\t\t\tFxaaFloat rangeMax = max(maxWN, maxESM);\n\t\t\t\tFxaaFloat rangeMin = min(minWN, minESM);\n\t\t\t\tFxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n\t\t\t\tFxaaFloat range = rangeMax - rangeMin;\n\t\t\t\tFxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\t\t\t\tFxaaBool earlyExit = range < rangeMaxClamped;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(earlyExit)\n\t\t\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\t\t\tFxaaDiscard;\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\t\treturn rgbyM;\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_GATHER4_ALPHA == 0)\n\t\t\t\t\t\t#if (FXAA_GLSL_100 == 1)\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tFxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\t#endif\n\t\t\t\t#else\n\t\t\t\t\t\tFxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n\t\t\t\t\t\tFxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNS = lumaN + lumaS;\n\t\t\t\tFxaaFloat lumaWE = lumaW + lumaE;\n\t\t\t\tFxaaFloat subpixRcpRange = 1.0/range;\n\t\t\t\tFxaaFloat subpixNSWE = lumaNS + lumaWE;\n\t\t\t\tFxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n\t\t\t\tFxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNESE = lumaNE + lumaSE;\n\t\t\t\tFxaaFloat lumaNWNE = lumaNW + lumaNE;\n\t\t\t\tFxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n\t\t\t\tFxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat lumaNWSW = lumaNW + lumaSW;\n\t\t\t\tFxaaFloat lumaSWSE = lumaSW + lumaSE;\n\t\t\t\tFxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n\t\t\t\tFxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n\t\t\t\tFxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n\t\t\t\tFxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n\t\t\t\tFxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n\t\t\t\tFxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n\t\t\t\tFxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n\t\t\t\tFxaaBool horzSpan = edgeHorz >= edgeVert;\n\t\t\t\tFxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!horzSpan) lumaN = lumaW;\n\t\t\t\tif(!horzSpan) lumaS = lumaE;\n\t\t\t\tif(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n\t\t\t\tFxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat gradientN = lumaN - lumaM;\n\t\t\t\tFxaaFloat gradientS = lumaS - lumaM;\n\t\t\t\tFxaaFloat lumaNN = lumaN + lumaM;\n\t\t\t\tFxaaFloat lumaSS = lumaS + lumaM;\n\t\t\t\tFxaaBool pairN = abs(gradientN) >= abs(gradientS);\n\t\t\t\tFxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n\t\t\t\tif(pairN) lengthSign = -lengthSign;\n\t\t\t\tFxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posB;\n\t\t\t\tposB.x = posM.x;\n\t\t\t\tposB.y = posM.y;\n\t\t\t\tFxaaFloat2 offNP;\n\t\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\t\t\t\tif(!horzSpan) posB.x += lengthSign * 0.5;\n\t\t\t\tif( horzSpan) posB.y += lengthSign * 0.5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat2 posN;\n\t\t\t\tposN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat2 posP;\n\t\t\t\tposP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n\t\t\t\tposP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n\t\t\t\tFxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n\t\t\t\tFxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n\t\t\t\tFxaaFloat subpixE = subpixC * subpixC;\n\t\t\t\tFxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(!pairN) lumaNN = lumaSS;\n\t\t\t\tFxaaFloat gradientScaled = gradient * 1.0/4.0;\n\t\t\t\tFxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n\t\t\t\tFxaaFloat subpixF = subpixD * subpixE;\n\t\t\t\tFxaaBool lumaMLTZero = lumaMM < 0.0;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tlumaEndN -= lumaNN * 0.5;\n\t\t\t\tlumaEndP -= lumaNN * 0.5;\n\t\t\t\tFxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\tFxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n\t\t\t\tFxaaBool doneNP = (!doneN) || (!doneP);\n\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 3)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 4)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 5)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 6)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 7)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t#if (FXAA_QUALITY_PS > 8)\n\t\t\t\tif(doneNP) {\n\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 9)\n\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 10)\n\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 11)\n\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t#if (FXAA_QUALITY_PS > 12)\n\t\t\t\t\t\t\t\t\t\t\t\tif(doneNP) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneN = abs(lumaEndN) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneP = abs(lumaEndP) >= gradientScaled;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdoneNP = (!doneN) || (!doneP);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#endif\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\t}\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat dstN = posM.x - posN.x;\n\t\t\t\tFxaaFloat dstP = posP.x - posM.x;\n\t\t\t\tif(!horzSpan) dstN = posM.y - posN.y;\n\t\t\t\tif(!horzSpan) dstP = posP.y - posM.y;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLength = (dstP + dstN);\n\t\t\t\tFxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n\t\t\t\tFxaaFloat spanLengthRcp = 1.0/spanLength;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaBool directionN = dstN < dstP;\n\t\t\t\tFxaaFloat dst = min(dstN, dstP);\n\t\t\t\tFxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n\t\t\t\tFxaaFloat subpixG = subpixF * subpixF;\n\t\t\t\tFxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n\t\t\t\tFxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n\t\t/*--------------------------------------------------------------------------*/\n\t\t\t\tFxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n\t\t\t\tFxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n\t\t\t\tif(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n\t\t\t\tif( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\t\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\t\t\treturn FxaaTexTop(tex, posM);\n\t\t\t\t#else\n\t\t\t\t\t\treturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n\t\t\t\t#endif\n\t\t}\n\t\t/*==========================================================================*/\n\t\t#endif\n\n\t\tvoid main() {\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\tvec4(0.0),\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\tvec4(0.0),\n\t\t\t\t0.75,\n\t\t\t\t0.166,\n\t\t\t\t0.0833,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\t0.0,\n\t\t\t\tvec4(0.0)\n\t\t\t);\n\n\t\t\t// TODO avoid querying texture twice for same texel\n\t\t\tgl_FragColor.a = texture2D(tDiffuse, vUv).a;\n\t\t}'},rn=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r,i){var a;(0,o.Z)(this,n),(a=e.call(this)).renderScene=r,a.camera=i,a.resolution=new p.Vector2(t.x,t.y),a.fsQuad=new Ve(null),a.fsQuad.material=a.createOutlinePostProcessMaterial();var s=new p.WebGLRenderTarget(a.resolution.x,a.resolution.y);return s.texture.format=p.RGBFormat,s.texture.minFilter=p.NearestFilter,s.texture.magFilter=p.NearestFilter,s.texture.generateMipmaps=!1,s.stencilBuffer=!1,a.normalTarget=s,a.normalOverrideMaterial=new p.MeshNormalMaterial,a}return(0,u.Z)(n,[{key:"dispose",value:function(){this.normalTarget.dispose(),this.normalTarget=null,this.fsQuad.dispose(),this.fsQuad=null}},{key:"setSize",value:function(t,e){this.normalTarget.setSize(t,e),this.resolution.set(2*t,2*e),this.fsQuad.material.uniforms.screenSize.value.set(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y)}},{key:"render",value:function(t,e,n){var r=e.depthBuffer;e.depthBuffer=!1,t.setRenderTarget(this.normalTarget);var i=this.renderScene.overrideMaterial;this.renderScene.overrideMaterial=this.normalOverrideMaterial,t.render(this.renderScene,this.camera),this.renderScene.overrideMaterial=i,this.fsQuad.material.uniforms.depthBuffer.value=n.depthTexture,this.fsQuad.material.uniforms.normalBuffer.value=this.normalTarget.texture,this.fsQuad.material.uniforms.sceneColorBuffer.value=n.texture,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.fsQuad.render(t)),e.depthBuffer=r}},{key:"vertexShader",get:function(){return"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main() {\n\t\t\t  vUv = uv;\n\t\t\t  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\t}\n\t\t\t"}},{key:"fragmentShader",get:function(){return'\n\t\t\t#include <packing>\n\t\t\t// The above include imports "perspectiveDepthToViewZ"\n\t\t\t// and other GLSL functions from ThreeJS we need for reading depth.\n\t\t\tuniform sampler2D sceneColorBuffer;\n\t\t\tuniform sampler2D depthBuffer;\n\t\t\tuniform sampler2D normalBuffer;\n\t\t\tuniform float cameraNear;\n  \t\tuniform float cameraFar;\n  \t\tuniform vec4 screenSize;\n      uniform vec3 outlineColor;\n      uniform vec4 multiplierParameters;\n      uniform int debugVisualize;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\t// Helper functions for reading from depth buffer.\n\t\t\tfloat readDepth (sampler2D depthSampler, vec2 coord) {\n\t\t\t\tfloat fragCoordZ = texture2D(depthSampler, coord).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\t\t\t}\n\t\t\tfloat getLinearDepth(vec3 pos) {\n\t\t\t\treturn -(viewMatrix * vec4(pos, 1.0)).z;\n\t\t\t}\n\n\t\t\tfloat getLinearScreenDepth(sampler2D map) {\n\t\t    \tvec2 uv = gl_FragCoord.xy * screenSize.zw;\n\t\t    \treturn readDepth(map,uv);\n\t\t\t}\n\t\t\t// Helper functions for reading normals and depth of neighboring pixels.\n\t\t\tfloat getPixelDepth(int x, int y) {\n\t\t\t\t// screenSize.zw is pixel size \n\t\t\t\t// vUv is current position\n\t\t\t\treturn readDepth(depthBuffer, vUv + screenSize.zw * vec2(x, y));\n\t\t\t}\n\t\t\tvec3 getPixelNormal(int x, int y) {\n\t\t\t\treturn texture2D(normalBuffer, vUv + screenSize.zw * vec2(x, y)).rgb;\n\t\t\t}\n\n      float saturate(float num) {\n        return clamp(num, 0.0, 1.0);\n      }\n\n\t\t\tvoid main() {\n\t\t\t\tvec4 sceneColor = texture2D(sceneColorBuffer, vUv);\n\t\t\t\tfloat depth = getPixelDepth(0, 0);\n\t\t\t\tvec3 normal = getPixelNormal(0, 0);\n\n\t\t\t\t// Get the difference between depth of neighboring pixels and current.\n\t\t\t\tfloat depthDiff = 0.0;\n\t\t  \tdepthDiff += abs(depth - getPixelDepth(1, 0));\n\t\t  \tdepthDiff += abs(depth - getPixelDepth(-1, 0));\n\t\t  \tdepthDiff += abs(depth - getPixelDepth(0, 1));\n\t\t  \tdepthDiff += abs(depth - getPixelDepth(0, -1));\n\n\t\t  \t// Get the difference between normals of neighboring pixels and current\n\t\t  \tfloat normalDiff = 0.0;\n\t\t  \tnormalDiff += distance(normal, getPixelNormal(1, 0));\n\t\t  \tnormalDiff += distance(normal, getPixelNormal(0, 1));\n\t\t  \tnormalDiff += distance(normal, getPixelNormal(0, 1));\n\t\t  \tnormalDiff += distance(normal, getPixelNormal(0, -1));\n\n        normalDiff += distance(normal, getPixelNormal(1, 1));\n        normalDiff += distance(normal, getPixelNormal(1, -1));\n        normalDiff += distance(normal, getPixelNormal(-1, 1));\n        normalDiff += distance(normal, getPixelNormal(-1, -1));\n\n        // Apply multiplier & bias to each \n        float depthBias = multiplierParameters.x;\n        float depthMultiplier = multiplierParameters.y;\n        float normalBias = multiplierParameters.z;\n        float normalMultiplier = multiplierParameters.w;\n\n        depthDiff = depthDiff * depthMultiplier;\n        depthDiff = saturate(depthDiff);\n        depthDiff = pow(depthDiff, depthBias);\n\n        normalDiff = normalDiff * normalMultiplier;\n        normalDiff = saturate(normalDiff);\n        normalDiff = pow(normalDiff, normalBias);\n\n\n\t\t  \tfloat outline = normalDiff + depthDiff;\n\t\t\t\n\t\t  \t// Combine outline with scene color.\n\t\t  \tvec4 outlineColor = vec4(outlineColor, 1.0);\n\t\t  \tgl_FragColor = vec4(mix(sceneColor, outlineColor, outline));\n\n        // For debug visualization of the different inputs to this shader.\n        if (debugVisualize == 1) {\n          gl_FragColor = sceneColor;\n        }\n        if (debugVisualize == 2) {\n          gl_FragColor = vec4(vec3(depth), 1.0);\n        }\n        if (debugVisualize == 3) {\n          gl_FragColor = vec4(normal, 1.0);\n        }\n        if (debugVisualize == 4) {\n          gl_FragColor = vec4(vec3(outline * outlineColor), 1.0);\n        }\n\t\t\t}\n\t\t\t'}},{key:"createOutlinePostProcessMaterial",value:function(){return new p.ShaderMaterial({uniforms:{debugVisualize:{value:0},sceneColorBuffer:{},depthBuffer:{},normalBuffer:{},outlineColor:{value:new p.Color(16777215)},multiplierParameters:{value:new p.Vector4(1,1,1,1)},cameraNear:{value:this.camera.near},cameraFar:{value:this.camera.far},screenSize:{value:new p.Vector4(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}}]),n}(Be),an=function(){function t(e,n){var r=this;(0,o.Z)(this,t),this.context=e,this.renderer=n,this.htmlOverlay=document.createElement("img"),this.excludedItems=new Set,this.initialized=!1,this.visibilityField="ifcjsPostproductionVisible",this.isUserControllingCamera=!1,this.isControlSleeping=!0,this.lastWheelUsed=0,this.lastResized=0,this.resizeDelay=500,this.isActive=!1,this.isVisible=!1,this.white=new p.Color(255,255,255),this.tempMaterial=new p.MeshLambertMaterial({colorWrite:!1,opacity:0,transparent:!0}),this.outlineParams={mode:{Mode:0},FXAA:!0,outlineColor:7829367,depthBias:16,depthMult:83,normalBias:5,normalMult:1},this.onControlStart=function(){return r.isUserControllingCamera=!0},this.onWake=function(){return r.isControlSleeping=!1},this.onResize=function(){r.lastResized=performance.now(),r.visible=!1,setTimeout((function(){performance.now()-r.lastResized>=r.resizeDelay&&(r.visible=!0)}),r.resizeDelay)},this.onControl=function(){r.visible=!1},this.onControlEnd=function(){r.isUserControllingCamera=!1,!r.isUserControllingCamera&&r.isControlSleeping&&(r.visible=!0)},this.onWheel=function(){r.lastWheelUsed=performance.now()},this.onSleep=function(){r.isControlSleeping=!0;var t=performance.now();setTimeout((function(){r.lastWheelUsed>t||!r.isUserControllingCamera&&r.isControlSleeping&&(r.visible=!0)}),200)},this.onChangeProjection=function(t){r.composer.passes.forEach((function(e){e.camera=t})),r.update()},this.renderTarget=this.newRenderTarget(),this.composer=new We(n,this.renderTarget),this.composer.setSize(window.innerWidth,window.innerHeight)}return(0,u.Z)(t,[{key:"active",get:function(){return this.isActive},set:function(t){this.isActive!==t&&(this.initialized||this.tryToInitialize(),this.visible=t,this.isActive=t)}},{key:"visible",get:function(){return this.isVisible},set:function(t){this.isActive&&(this.isVisible=t,t&&this.update(),this.htmlOverlay.style.visibility=t?"visible":"collapse")}},{key:"outlineColor",get:function(){return this.outlineParams.outlineColor},set:function(t){this.outlineParams.outlineColor=t,this.outlineUniforms.outlineColor.value.set(t)}},{key:"sao",get:function(){var t;return null===(t=this.saoPass)||void 0===t?void 0:t.params}},{key:"dispose",value:function(){var t,e;this.active=!1,window.removeEventListener("resize",this.onResize),this.renderTarget.dispose(),this.renderTarget=null,null===(t=this.depthTexture)||void 0===t||t.dispose(),this.depthTexture=null,null===(e=this.customOutline)||void 0===e||e.dispose(),this.customOutline=null,this.composer=null,this.excludedItems.clear(),this.excludedItems=null,this.composer=null,this.htmlOverlay.remove(),this.htmlOverlay=null,this.outlineParams=null,this.context=null,this.renderer=null,this.saoPass=null,this.outlineUniforms=null,this.scene=null}},{key:"setSize",value:function(t,e){this.composer.setSize(t,e)}},{key:"update",value:function(){var t,e,n,r=this;if(this.initialized&&this.isActive){this.hideExcludedItems(),this.context.getScene().traverse((function(t){t.userData.prevMaterial=t.material,t.material=r.tempMaterial}));var i=null===(t=this.scene)||void 0===t?void 0:t.background;(null===(e=this.scene)||void 0===e?void 0:e.background)&&i&&(this.scene.background=this.white),this.composer.render(),(null===(n=this.scene)||void 0===n?void 0:n.background)&&i&&(this.scene.background=i),this.context.getScene().traverse((function(t){t.material=t.userData.prevMaterial,delete t.userData.prevMaterial})),this.htmlOverlay.src=this.renderer.domElement.toDataURL(),this.showExcludedItems()}}},{key:"hideExcludedItems",value:function(){var t,e=(0,Y.Z)(this.excludedItems);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.userData[this.visibilityField]=n.visible,n.visible=!1}}catch(r){e.e(r)}finally{e.f()}}},{key:"showExcludedItems",value:function(){var t,e=(0,Y.Z)(this.excludedItems);try{for(e.s();!(t=e.n()).done;){var n=t.value;void 0!==n.userData[this.visibilityField]&&(n.visible=n.userData[this.visibilityField])}}catch(r){e.e(r)}finally{e.f()}}},{key:"tryToInitialize",value:function(){var t=this.context.getScene(),e=this.context.getCamera();t&&e&&(this.scene=t,this.renderer.clippingPlanes=this.context.getClippingPlanes(),this.setupEvents(),this.addBasePass(t,e),this.addSaoPass(t,e),this.addOutlinePass(t,e),this.addAntialiasPass(),this.setupHtmlOverlay(),this.initialized=!0)}},{key:"setupEvents",value:function(){var t=this.context.ifcCamera.cameraControls,e=this.context.getDomElement();t.addEventListener("control",this.onControl),t.addEventListener("controlstart",this.onControlStart),t.addEventListener("wake",this.onWake),t.addEventListener("controlend",this.onControlEnd),e.addEventListener("wheel",this.onWheel),t.addEventListener("sleep",this.onSleep),window.addEventListener("resize",this.onResize),this.context.ifcCamera.onChangeProjection.on(this.onChangeProjection)}},{key:"setupHtmlOverlay",value:function(){this.context.getContainerElement().appendChild(this.htmlOverlay),this.htmlOverlay.style.mixBlendMode="multiply",this.htmlOverlay.style.position="absolute",this.htmlOverlay.style.height="100%",this.htmlOverlay.style.userSelect="none",this.htmlOverlay.style.pointerEvents="none",this.htmlOverlay.style.top="0",this.htmlOverlay.style.left="0"}},{key:"addAntialiasPass",value:function(){this.fxaaPass=new ze(nn),this.fxaaPass.uniforms.resolution.value.set(1/this.renderer.domElement.offsetWidth*this.renderer.getPixelRatio(),1/this.renderer.domElement.offsetHeight*this.renderer.getPixelRatio()),this.composer.addPass(this.fxaaPass)}},{key:"addOutlinePass",value:function(t,e){this.customOutline=new rn(new p.Vector2(window.innerWidth,window.innerHeight),t,e),this.outlineUniforms=this.customOutline.fsQuad.material.uniforms,this.outlineUniforms.outlineColor.value.set(this.outlineParams.outlineColor),this.outlineUniforms.multiplierParameters.value.x=this.outlineParams.depthBias,this.outlineUniforms.multiplierParameters.value.y=this.outlineParams.depthMult,this.outlineUniforms.multiplierParameters.value.z=this.outlineParams.normalBias,this.outlineUniforms.multiplierParameters.value.w=this.outlineParams.normalMult,this.composer.addPass(this.customOutline)}},{key:"addSaoPass",value:function(t,e){this.saoPass=new en(t,e,!1,!0),this.composer.addPass(this.saoPass),this.saoPass.enabled=!0,this.saoPass.params.saoIntensity=.01,this.saoPass.params.saoBias=.5,this.saoPass.params.saoBlurRadius=8,this.saoPass.params.saoBlurDepthCutoff=.0015,this.saoPass.params.saoScale=30,this.saoPass.params.saoKernelRadius=30}},{key:"addBasePass",value:function(t,e){this.basePass=new je(t,e),this.composer.addPass(this.basePass)}},{key:"newRenderTarget",value:function(){return this.depthTexture=new p.DepthTexture(window.innerWidth,window.innerHeight),new p.WebGLRenderTarget(window.innerWidth,window.innerHeight,{depthTexture:this.depthTexture,depthBuffer:!0})}}]),t}(),sn=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).renderer2D=new k,r.blocked=!1,r.context=t,r.container=t.options.container,r.renderer=new p.WebGLRenderer({alpha:!0,antialias:!0}),r.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),r.setupRenderers(),r.postProduction=new an(r.context,r.renderer),r.adjustRendererSize(),r}return(0,u.Z)(n,[{key:"dispose",value:function(){var t,e;this.renderer.domElement.remove(),this.renderer.dispose(),this.postProduction.dispose(),this.postProduction=null,this.renderer=null,this.renderer2D=null,this.container=null,this.context=null,null===(t=this.tempRenderer)||void 0===t||t.dispose(),null===(e=this.tempCanvas)||void 0===e||e.remove()}},{key:"update",value:function(t){if(!this.blocked){var e=this.context.getScene(),n=this.context.getCamera();this.renderer.render(e,n),this.renderer2D.render(e,n)}}},{key:"getSize",value:function(){return new p.Vector2(this.renderer.domElement.clientWidth,this.renderer.domElement.clientHeight)}},{key:"adjustRendererSize",value:function(){var t=this.container.clientWidth,e=this.container.clientHeight;this.renderer.setSize(t,e),this.postProduction.setSize(t,e),this.renderer2D.setSize(t,e)}},{key:"newScreenshot",value:function(t,e){var n=this.getSize(),r=this.renderer.domElement.cloneNode(!0);this.tempRenderer||(this.tempRenderer=new p.WebGLRenderer({canvas:r,antialias:!0}),this.tempRenderer.localClippingEnabled=!0),e&&(this.tempRenderer.setSize(e.x,e.y),this.context.ifcCamera.updateAspect(e));var i=this.context.getScene(),a=t||this.context.getCamera();this.tempRenderer.render(i,a);var s=this.tempRenderer.domElement.toDataURL();return e&&this.context.ifcCamera.updateAspect(n),s}},{key:"setupRenderers",value:function(){this.renderer.localClippingEnabled=!0,this.container.appendChild(this.renderer.domElement),this.renderer2D.domElement.style.position="absolute",this.renderer2D.domElement.style.top="0px",this.renderer2D.domElement.style.pointerEvents="none",this.container.appendChild(this.renderer2D.domElement)}}]),n}(c),on=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).context=t,r.defaultBackgroundColor=new p.Color(11119017),r.scene=new p.Scene,r.setupScene(t.options),r.setupLights(),r}return(0,u.Z)(n,[{key:"dispose",value:function(){this.scene.children.length=0,this.scene=null}},{key:"add",value:function(t){this.scene.add(t)}},{key:"remove",value:function(t){this.scene.remove(t)}},{key:"addModel",value:function(t){this.context.items.ifcModels.push(t),this.context.items.pickableIfcModels.push(t),this.scene.add(t)}},{key:"removeModel",value:function(t){var e=this.context.items.ifcModels.indexOf(t);e>=0&&this.context.items.ifcModels.splice(e,1),(e=this.context.items.pickableIfcModels.indexOf(t))>=0&&this.context.items.pickableIfcModels.splice(e,1),t.parent&&t.removeFromParent()}},{key:"setupScene",value:function(t){this.scene.background=(null===t||void 0===t?void 0:t.backgroundColor)||this.defaultBackgroundColor}},{key:"setupLights",value:function(){var t=new p.DirectionalLight(16772863,.8);t.position.set(1,1,1),this.scene.add(t);var e=new p.DirectionalLight(16777215,.8);e.position.set(-1,.5,-1),this.scene.add(e);var n=new p.AmbientLight(16777198,.25);this.scene.add(n)}}]),n}(c);function un(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ln(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var cn,hn,fn,dn,pn,mn,vn,gn,En,In,Tn,yn={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Cn={duration:.5,overwrite:!1,delay:0},xn=1e8,An=1e-8,Fn=2*Math.PI,_n=Fn/4,Pn=0,Sn=Math.sqrt,Rn=Math.cos,On=Math.sin,wn=function(t){return"string"===typeof t},Mn=function(t){return"function"===typeof t},Nn=function(t){return"number"===typeof t},Ln=function(t){return"undefined"===typeof t},bn=function(t){return"object"===typeof t},kn=function(t){return!1!==t},Dn=function(){return"undefined"!==typeof window},Un=function(t){return Mn(t)||wn(t)},Zn="function"===typeof ArrayBuffer&&ArrayBuffer.isView||function(){},Bn=Array.isArray,Gn=/(?:-?\.?\d|\.)+/gi,Yn=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Vn=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,zn=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Hn=/[+-]=-?[.\d]+/,Xn=/[^,'"\[\]\s]+/gi,Wn=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Qn={},jn={},qn=function(t){return(jn=Fr(t,Qn))&&Pa},Kn=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},Jn=function(t,e){return!e&&console.warn(t)},$n=function(t,e){return t&&(Qn[t]=e)&&jn&&(jn[t]=e)||Qn},tr=function(){return 0},er={suppressEvents:!0,isStart:!0,kill:!1},nr={suppressEvents:!0,kill:!1},rr={suppressEvents:!0},ir={},ar=[],sr={},or={},ur={},lr=30,cr=[],hr="",fr=function(t){var e,n,r=t[0];if(bn(r)||Mn(r)||(t=[t]),!(e=(r._gsap||{}).harness)){for(n=cr.length;n--&&!cr[n].targetTest(r););e=cr[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new Gi(t[n],e)))||t.splice(n,1);return t},dr=function(t){return t._gsap||fr(ii(t))[0]._gsap},pr=function(t,e,n){return(n=t[e])&&Mn(n)?t[e]():Ln(n)&&t.getAttribute&&t.getAttribute(e)||n},mr=function(t,e){return(t=t.split(",")).forEach(e)||t},vr=function(t){return Math.round(1e5*t)/1e5||0},gr=function(t){return Math.round(1e7*t)/1e7||0},Er=function(t,e){var n=e.charAt(0),r=parseFloat(e.substr(2));return t=parseFloat(t),"+"===n?t+r:"-"===n?t-r:"*"===n?t*r:t/r},Ir=function(t,e){for(var n=e.length,r=0;t.indexOf(e[r])<0&&++r<n;);return r<n},Tr=function(){var t,e,n=ar.length,r=ar.slice(0);for(sr={},ar.length=0,t=0;t<n;t++)(e=r[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},yr=function(t,e,n,r){ar.length&&!hn&&Tr(),t.render(e,n,r||hn&&e<0&&(t._initted||t._startAt)),ar.length&&!hn&&Tr()},Cr=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(Xn).length<2?e:wn(t)?t.trim():t},xr=function(t){return t},Ar=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},Fr=function(t,e){for(var n in e)t[n]=e[n];return t},_r=function t(e,n){for(var r in n)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(e[r]=bn(n[r])?t(e[r]||(e[r]={}),n[r]):n[r]);return e},Pr=function(t,e){var n,r={};for(n in t)n in e||(r[n]=t[n]);return r},Sr=function(t){var e,n=t.parent||dn,r=t.keyframes?(e=Bn(t.keyframes),function(t,n){for(var r in n)r in t||"duration"===r&&e||"ease"===r||(t[r]=n[r])}):Ar;if(kn(t.inherit))for(;n;)r(t,n.vars.defaults),n=n.parent||n._dp;return t},Rr=function(t,e,n,r,i){void 0===n&&(n="_first"),void 0===r&&(r="_last");var a,s=t[r];if(i)for(a=e[i];s&&s[i]>a;)s=s._prev;return s?(e._next=s._next,s._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[r]=e,e._prev=s,e.parent=e._dp=t,e},Or=function(t,e,n,r){void 0===n&&(n="_first"),void 0===r&&(r="_last");var i=e._prev,a=e._next;i?i._next=a:t[n]===e&&(t[n]=a),a?a._prev=i:t[r]===e&&(t[r]=i),e._next=e._prev=e.parent=null},wr=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},Mr=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},Nr=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Lr=function(t,e,n,r){return t._startAt&&(hn?t._startAt.revert(nr):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,r))},br=function t(e){return!e||e._ts&&t(e.parent)},kr=function(t){return t._repeat?Dr(t._tTime,t=t.duration()+t._rDelay)*t:0},Dr=function(t,e){var n=Math.floor(t/=e);return t&&n===t?n-1:n},Ur=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Zr=function(t){return t._end=gr(t._start+(t._tDur/Math.abs(t._ts||t._rts||An)||0))},Br=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=gr(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Zr(t),n._dirty||Mr(n,t)),t},Gr=function(t,e){var n;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(n=Ur(t.rawTime(),e),(!e._dur||$r(0,e.totalDuration(),n)-e._tTime>An)&&e.render(n,!0)),Mr(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},Yr=function(t,e,n,r){return e.parent&&wr(e),e._start=gr((Nn(n)?n:n||t!==dn?qr(t,n,e):t._time)+e._delay),e._end=gr(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),Rr(t,e,"_first","_last",t._sort?"_start":0),Xr(e)||(t._recent=e),r||Gr(t,e),t._ts<0&&Br(t,t._tTime),t},Vr=function(t,e){return(Qn.ScrollTrigger||Kn("scrollTrigger",e))&&Qn.ScrollTrigger.create(e,t)},zr=function(t,e,n,r,i){return ji(t,e,i),t._initted?!n&&t._pt&&!hn&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&En!==Si.frame?(ar.push(t),t._lazy=[i,r],1):void 0:1},Hr=function t(e){var n=e.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||t(n))},Xr=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},Wr=function(t,e,n,r){var i=t._repeat,a=gr(e)||0,s=t._tTime/t._tDur;return s&&!r&&(t._time*=a/t._dur),t._dur=a,t._tDur=i?i<0?1e10:gr(a*(i+1)+t._rDelay*i):a,s>0&&!r&&Br(t,t._tTime=t._tDur*s),t.parent&&Zr(t),n||Mr(t.parent,t),t},Qr=function(t){return t instanceof Vi?Mr(t):Wr(t,t._dur)},jr={_start:0,endTime:tr,totalDuration:tr},qr=function t(e,n,r){var i,a,s,o=e.labels,u=e._recent||jr,l=e.duration()>=xn?u.endTime(!1):e._dur;return wn(n)&&(isNaN(n)||n in o)?(a=n.charAt(0),s="%"===n.substr(-1),i=n.indexOf("="),"<"===a||">"===a?(i>=0&&(n=n.replace(/=/,"")),("<"===a?u._start:u.endTime(u._repeat>=0))+(parseFloat(n.substr(1))||0)*(s?(i<0?u:r).totalDuration()/100:1)):i<0?(n in o||(o[n]=l),o[n]):(a=parseFloat(n.charAt(i-1)+n.substr(i+1)),s&&r&&(a=a/100*(Bn(r)?r[0]:r).totalDuration()),i>1?t(e,n.substr(0,i-1),r)+a:l+a)):null==n?l:+n},Kr=function(t,e,n){var r,i,a=Nn(e[1]),s=(a?2:1)+(t<2?0:1),o=e[s];if(a&&(o.duration=e[1]),o.parent=n,t){for(r=o,i=n;i&&!("immediateRender"in r);)r=i.vars.defaults||{},i=kn(i.vars.inherit)&&i.parent;o.immediateRender=kn(r.immediateRender),t<2?o.runBackwards=1:o.startAt=e[s-1]}return new ta(e[0],o,e[s+1])},Jr=function(t,e){return t||0===t?e(t):e},$r=function(t,e,n){return n<t?t:n>e?e:n},ti=function(t,e){return wn(t)&&(e=Wn.exec(t))?e[1]:""},ei=[].slice,ni=function(t,e){return t&&bn(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&bn(t[0]))&&!t.nodeType&&t!==pn},ri=function(t,e,n){return void 0===n&&(n=[]),t.forEach((function(t){var r;return wn(t)&&!e||ni(t,1)?(r=n).push.apply(r,ii(t)):n.push(t)}))||n},ii=function(t,e,n){return fn&&!e&&fn.selector?fn.selector(t):!wn(t)||n||!mn&&Ri()?Bn(t)?ri(t,n):ni(t)?ei.call(t,0):t?[t]:[]:ei.call((e||vn).querySelectorAll(t),0)},ai=function(t){return t=ii(t)[0]||Jn("Invalid scope")||{},function(e){var n=t.current||t.nativeElement||t;return ii(e,n.querySelectorAll?n:n===t?Jn("Invalid scope")||vn.createElement("div"):t)}},si=function(t){return t.sort((function(){return.5-Math.random()}))},oi=function(t){if(Mn(t))return t;var e=bn(t)?t:{each:t},n=ki(e.ease),r=e.from||0,i=parseFloat(e.base)||0,a={},s=r>0&&r<1,o=isNaN(r)||s,u=e.axis,l=r,c=r;return wn(r)?l=c={center:.5,edges:.5,end:1}[r]||0:!s&&o&&(l=r[0],c=r[1]),function(t,s,h){var f,d,p,m,v,g,E,I,T,y=(h||e).length,C=a[y];if(!C){if(!(T="auto"===e.grid?0:(e.grid||[1,xn])[1])){for(E=-xn;E<(E=h[T++].getBoundingClientRect().left)&&T<y;);T<y&&T--}for(C=a[y]=[],f=o?Math.min(T,y)*l-.5:r%T,d=T===xn?0:o?y*c/T-.5:r/T|0,E=0,I=xn,g=0;g<y;g++)p=g%T-f,m=d-(g/T|0),C[g]=v=u?Math.abs("y"===u?m:p):Sn(p*p+m*m),v>E&&(E=v),v<I&&(I=v);"random"===r&&si(C),C.max=E-I,C.min=I,C.v=y=(parseFloat(e.amount)||parseFloat(e.each)*(T>y?y-1:u?"y"===u?y/T:T:Math.max(T,y/T))||0)*("edges"===r?-1:1),C.b=y<0?i-y:i,C.u=ti(e.amount||e.each)||0,n=n&&y<0?Li(n):n}return y=(C[t]-C.min)/C.max||0,gr(C.b+(n?n(y):y)*C.v)+C.u}},ui=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(n){var r=gr(Math.round(parseFloat(n)/t)*t*e);return(r-r%1)/e+(Nn(n)?0:ti(n))}},li=function(t,e){var n,r,i=Bn(t);return!i&&bn(t)&&(n=i=t.radius||xn,t.values?(t=ii(t.values),(r=!Nn(t[0]))&&(n*=n)):t=ui(t.increment)),Jr(e,i?Mn(t)?function(e){return r=t(e),Math.abs(r-e)<=n?r:e}:function(e){for(var i,a,s=parseFloat(r?e.x:e),o=parseFloat(r?e.y:0),u=xn,l=0,c=t.length;c--;)(i=r?(i=t[c].x-s)*i+(a=t[c].y-o)*a:Math.abs(t[c]-s))<u&&(u=i,l=c);return l=!n||u<=n?t[l]:e,r||l===e||Nn(e)?l:l+ti(e)}:ui(t))},ci=function(t,e,n,r){return Jr(Bn(t)?!e:!0===n?!!(n=0):!r,(function(){return Bn(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*r)/r}))},hi=function(t,e,n){return Jr(n,(function(n){return t[~~e(n)]}))},fi=function(t){for(var e,n,r,i,a=0,s="";~(e=t.indexOf("random(",a));)r=t.indexOf(")",e),i="["===t.charAt(e+7),n=t.substr(e+7,r-e-7).match(i?Xn:Gn),s+=t.substr(a,e-a)+ci(i?n:+n[0],i?0:+n[1],+n[2]||1e-5),a=r+1;return s+t.substr(a,t.length-a)},di=function(t,e,n,r,i){var a=e-t,s=r-n;return Jr(i,(function(e){return n+((e-t)/a*s||0)}))},pi=function(t,e,n){var r,i,a,s=t.labels,o=xn;for(r in s)(i=s[r]-e)<0===!!n&&i&&o>(i=Math.abs(i))&&(a=r,o=i);return a},mi=function(t,e,n){var r,i,a,s=t.vars,o=s[e],u=fn,l=t._ctx;if(o)return r=s[e+"Params"],i=s.callbackScope||t,n&&ar.length&&Tr(),l&&(fn=l),a=r?o.apply(i,r):o.call(i),fn=u,a},vi=function(t){return wr(t),t.scrollTrigger&&t.scrollTrigger.kill(!!hn),t.progress()<1&&mi(t,"onInterrupt"),t},gi=[],Ei=function(t){if(t)if(t=!t.name&&t.default||t,Dn()||t.headless){var e=t.name,n=Mn(t),r=e&&!n&&t.init?function(){this._props=[]}:t,i={init:tr,render:la,add:Wi,kill:ha,modifier:ca,rawVars:0},a={targetTest:0,get:0,getSetter:aa,aliases:{},register:0};if(Ri(),t!==r){if(or[e])return;Ar(r,Ar(Pr(t,i),a)),Fr(r.prototype,Fr(i,Pr(t,a))),or[r.prop=e]=r,t.targetTest&&(cr.push(r),ir[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}$n(e,r),t.register&&t.register(Pa,r,pa)}else gi.push(t)},Ii=255,Ti={aqua:[0,Ii,Ii],lime:[0,Ii,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Ii],navy:[0,0,128],white:[Ii,Ii,Ii],olive:[128,128,0],yellow:[Ii,Ii,0],orange:[Ii,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Ii,0,0],pink:[Ii,192,203],cyan:[0,Ii,Ii],transparent:[Ii,Ii,Ii,0]},yi=function(t,e,n){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*Ii+.5|0},Ci=function(t,e,n){var r,i,a,s,o,u,l,c,h,f,d=t?Nn(t)?[t>>16,t>>8&Ii,t&Ii]:0:Ti.black;if(!d){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),Ti[t])d=Ti[t];else if("#"===t.charAt(0)){if(t.length<6&&(r=t.charAt(1),i=t.charAt(2),a=t.charAt(3),t="#"+r+r+i+i+a+a+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(d=parseInt(t.substr(1,6),16))>>16,d>>8&Ii,d&Ii,parseInt(t.substr(7),16)/255];d=[(t=parseInt(t.substr(1),16))>>16,t>>8&Ii,t&Ii]}else if("hsl"===t.substr(0,3))if(d=f=t.match(Gn),e){if(~t.indexOf("="))return d=t.match(Yn),n&&d.length<4&&(d[3]=1),d}else s=+d[0]%360/360,o=+d[1]/100,r=2*(u=+d[2]/100)-(i=u<=.5?u*(o+1):u+o-u*o),d.length>3&&(d[3]*=1),d[0]=yi(s+1/3,r,i),d[1]=yi(s,r,i),d[2]=yi(s-1/3,r,i);else d=t.match(Gn)||Ti.transparent;d=d.map(Number)}return e&&!f&&(r=d[0]/Ii,i=d[1]/Ii,a=d[2]/Ii,u=((l=Math.max(r,i,a))+(c=Math.min(r,i,a)))/2,l===c?s=o=0:(h=l-c,o=u>.5?h/(2-l-c):h/(l+c),s=l===r?(i-a)/h+(i<a?6:0):l===i?(a-r)/h+2:(r-i)/h+4,s*=60),d[0]=~~(s+.5),d[1]=~~(100*o+.5),d[2]=~~(100*u+.5)),n&&d.length<4&&(d[3]=1),d},xi=function(t){var e=[],n=[],r=-1;return t.split(Fi).forEach((function(t){var i=t.match(Vn)||[];e.push.apply(e,i),n.push(r+=i.length+1)})),e.c=n,e},Ai=function(t,e,n){var r,i,a,s,o="",u=(t+o).match(Fi),l=e?"hsla(":"rgba(",c=0;if(!u)return t;if(u=u.map((function(t){return(t=Ci(t,e,1))&&l+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),n&&(a=xi(t),(r=n.c).join(o)!==a.c.join(o)))for(s=(i=t.replace(Fi,"1").split(Vn)).length-1;c<s;c++)o+=i[c]+(~r.indexOf(c)?u.shift()||l+"0,0,0,0)":(a.length?a:u.length?u:n).shift());if(!i)for(s=(i=t.split(Fi)).length-1;c<s;c++)o+=i[c]+u[c];return o+i[s]},Fi=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in Ti)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),_i=/hsl[a]?\(/,Pi=function(t){var e,n=t.join(" ");if(Fi.lastIndex=0,Fi.test(n))return e=_i.test(n),t[1]=Ai(t[1],e),t[0]=Ai(t[0],e,xi(t[1])),!0},Si=function(){var t,e,n,r,i,a,s=Date.now,o=500,u=33,l=s(),c=l,h=1e3/240,f=h,d=[],p=function n(p){var m,v,g,E,I=s()-c,T=!0===p;if((I>o||I<0)&&(l+=I-u),((m=(g=(c+=I)-l)-f)>0||T)&&(E=++r.frame,i=g-1e3*r.time,r.time=g/=1e3,f+=m+(m>=h?4:h-m),v=1),T||(t=e(n)),v)for(a=0;a<d.length;a++)d[a](g,i,E,p)};return r={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(t){return i/(1e3/(t||60))},wake:function(){gn&&(!mn&&Dn()&&(pn=mn=window,vn=pn.document||{},Qn.gsap=Pa,(pn.gsapVersions||(pn.gsapVersions=[])).push(Pa.version),qn(jn||pn.GreenSockGlobals||!pn.gsap&&pn||{}),gi.forEach(Ei)),n="undefined"!==typeof requestAnimationFrame&&requestAnimationFrame,t&&r.sleep(),e=n||function(t){return setTimeout(t,f-1e3*r.time+1|0)},Tn=1,p(2))},sleep:function(){(n?cancelAnimationFrame:clearTimeout)(t),Tn=0,e=tr},lagSmoothing:function(t,e){o=t||1/0,u=Math.min(e||33,o)},fps:function(t){h=1e3/(t||240),f=1e3*r.time+h},add:function(t,e,n){var i=e?function(e,n,a,s){t(e,n,a,s),r.remove(i)}:t;return r.remove(t),d[n?"unshift":"push"](i),Ri(),i},remove:function(t,e){~(e=d.indexOf(t))&&d.splice(e,1)&&a>=e&&a--},_listeners:d}}(),Ri=function(){return!Tn&&Si.wake()},Oi={},wi=/^[\d.\-M][\d.\-,\s]/,Mi=/["']/g,Ni=function(t){for(var e,n,r,i={},a=t.substr(1,t.length-3).split(":"),s=a[0],o=1,u=a.length;o<u;o++)n=a[o],e=o!==u-1?n.lastIndexOf(","):n.length,r=n.substr(0,e),i[s]=isNaN(r)?r.replace(Mi,"").trim():+r,s=n.substr(e+1).trim();return i},Li=function(t){return function(e){return 1-t(1-e)}},bi=function t(e,n){for(var r,i=e._first;i;)i instanceof Vi?t(i,n):!i.vars.yoyoEase||i._yoyo&&i._repeat||i._yoyo===n||(i.timeline?t(i.timeline,n):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=n)),i=i._next},ki=function(t,e){return t&&(Mn(t)?t:Oi[t]||function(t){var e=(t+"").split("("),n=Oi[e[0]];return n&&e.length>1&&n.config?n.config.apply(null,~t.indexOf("{")?[Ni(e[1])]:function(t){var e=t.indexOf("(")+1,n=t.indexOf(")"),r=t.indexOf("(",e);return t.substring(e,~r&&r<n?t.indexOf(")",n+1):n)}(t).split(",").map(Cr)):Oi._CE&&wi.test(t)?Oi._CE("",t):n}(t))||e},Di=function(t,e,n,r){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===r&&(r=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var i,a={easeIn:e,easeOut:n,easeInOut:r};return mr(t,(function(t){for(var e in Oi[t]=Qn[t]=a,Oi[i=t.toLowerCase()]=n,a)Oi[i+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Oi[t+"."+e]=a[e]})),a},Ui=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},Zi=function t(e,n,r){var i=n>=1?n:1,a=(r||(e?.3:.45))/(n<1?n:1),s=a/Fn*(Math.asin(1/i)||0),o=function(t){return 1===t?1:i*Math.pow(2,-10*t)*On((t-s)*a)+1},u="out"===e?o:"in"===e?function(t){return 1-o(1-t)}:Ui(o);return a=Fn/a,u.config=function(n,r){return t(e,n,r)},u},Bi=function t(e,n){void 0===n&&(n=1.70158);var r=function(t){return t?--t*t*((n+1)*t+n)+1:0},i="out"===e?r:"in"===e?function(t){return 1-r(1-t)}:Ui(r);return i.config=function(n){return t(e,n)},i};mr("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var n=e<5?e+1:e;Di(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},(function(t){return 1-Math.pow(1-t,n)}),(function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2}))})),Oi.Linear.easeNone=Oi.none=Oi.Linear.easeIn,Di("Elastic",Zi("in"),Zi("out"),Zi()),function(t,e){var n=1/e,r=function(r){return r<n?t*r*r:r<.7272727272727273?t*Math.pow(r-1.5/e,2)+.75:r<.9090909090909092?t*(r-=2.25/e)*r+.9375:t*Math.pow(r-2.625/e,2)+.984375};Di("Bounce",(function(t){return 1-r(1-t)}),r)}(7.5625,2.75),Di("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),Di("Circ",(function(t){return-(Sn(1-t*t)-1)})),Di("Sine",(function(t){return 1===t?1:1-Rn(t*_n)})),Di("Back",Bi("in"),Bi("out"),Bi()),Oi.SteppedEase=Oi.steps=Qn.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,r=t+(e?0:1),i=e?1:0;return function(t){return((r*$r(0,.99999999,t)|0)+i)*n}}},Cn.ease=Oi["quad.out"],mr("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return hr+=t+","+t+"Params,"}));var Gi=function(t,e){this.id=Pn++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:pr,this.set=e?e.getSetter:aa},Yi=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Wr(this,+t.duration,1,1),this.data=t.data,fn&&(this._ctx=fn,fn.data.push(this)),Tn||Si.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,Wr(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(Ri(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Br(this,t),!n._dp||n.parent||Gr(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&Yr(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===An||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),yr(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+kr(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+kr(this),e):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?Dr(this._tTime,n)+1:1},e.timeScale=function(t,e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var n=this.parent&&this._ts?Ur(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,this.totalTime($r(-Math.abs(this._delay),this._tDur,n),!1!==e),Zr(this),Nr(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ri(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==An&&(this._tTime-=An)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&Yr(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(kn(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Ur(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=rr);var e=hn;return hn=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),hn=e,this},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(Math.abs(e._ts)||1),e=e._dp;return!this.parent&&this._sat?this._sat.globalTime(t):n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,Qr(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,Qr(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(qr(this,t),kn(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,kn(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-An))},e.eventCallback=function(t,e,n){var r=this.vars;return arguments.length>1?(e?(r[t]=e,n&&(r[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete r[t],this):r[t]},e.then=function(t){var e=this;return new Promise((function(n){var r=Mn(t)?t:xr,i=function(){var t=e.then;e.then=null,Mn(r)&&(r=r(e))&&(r.then||r===e)&&(e.then=t),n(r),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?i():e._prom=i}))},e.kill=function(){vi(this)},t}();Ar(Yi.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Vi=function(t){function e(e,n){var r;return void 0===e&&(e={}),(r=t.call(this,e)||this).labels={},r.smoothChildTiming=!!e.smoothChildTiming,r.autoRemoveChildren=!!e.autoRemoveChildren,r._sort=kn(e.sortChildren),dn&&Yr(e.parent||dn,un(r),n),e.reversed&&r.reverse(),e.paused&&r.paused(!0),e.scrollTrigger&&Vr(un(r),e.scrollTrigger),r}ln(e,t);var n=e.prototype;return n.to=function(t,e,n){return Kr(0,arguments,this),this},n.from=function(t,e,n){return Kr(1,arguments,this),this},n.fromTo=function(t,e,n,r){return Kr(2,arguments,this),this},n.set=function(t,e,n){return e.duration=0,e.parent=this,Sr(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new ta(t,e,qr(this,n),1),this},n.call=function(t,e,n){return Yr(this,ta.delayedCall(0,t,e),n)},n.staggerTo=function(t,e,n,r,i,a,s){return n.duration=e,n.stagger=n.stagger||r,n.onComplete=a,n.onCompleteParams=s,n.parent=this,new ta(t,n,qr(this,i)),this},n.staggerFrom=function(t,e,n,r,i,a,s){return n.runBackwards=1,Sr(n).immediateRender=kn(n.immediateRender),this.staggerTo(t,e,n,r,i,a,s)},n.staggerFromTo=function(t,e,n,r,i,a,s,o){return r.startAt=n,Sr(r).immediateRender=kn(r.immediateRender),this.staggerTo(t,e,r,i,a,s,o)},n.render=function(t,e,n){var r,i,a,s,o,u,l,c,h,f,d,p,m=this._time,v=this._dirty?this.totalDuration():this._tDur,g=this._dur,E=t<=0?0:gr(t),I=this._zTime<0!==t<0&&(this._initted||!g);if(this!==dn&&E>v&&t>=0&&(E=v),E!==this._tTime||n||I){if(m!==this._time&&g&&(E+=this._time-m,t+=this._time-m),r=E,h=this._start,u=!(c=this._ts),I&&(g||(m=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(d=this._yoyo,o=g+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*o+t,e,n);if(r=gr(E%o),E===v?(s=this._repeat,r=g):((s=~~(E/o))&&s===E/o&&(r=g,s--),r>g&&(r=g)),f=Dr(this._tTime,o),!m&&this._tTime&&f!==s&&this._tTime-f*o-this._dur<=0&&(f=s),d&&1&s&&(r=g-r,p=1),s!==f&&!this._lock){var T=d&&1&f,y=T===(d&&1&s);if(s<f&&(T=!T),m=T?0:E%g?g:E,this._lock=1,this.render(m||(p?0:gr(s*o)),e,!g)._lock=0,this._tTime=E,!e&&this.parent&&mi(this,"onRepeat"),this.vars.repeatRefresh&&!p&&(this.invalidate()._lock=1),m&&m!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(g=this._dur,v=this._tDur,y&&(this._lock=2,m=T?g:-1e-4,this.render(m,!0),this.vars.repeatRefresh&&!p&&this.invalidate()),this._lock=0,!this._ts&&!u)return this;bi(this,p)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(l=function(t,e,n){var r;if(n>e)for(r=t._first;r&&r._start<=n;){if("isPause"===r.data&&r._start>e)return r;r=r._next}else for(r=t._last;r&&r._start>=n;){if("isPause"===r.data&&r._start<e)return r;r=r._prev}}(this,gr(m),gr(r)),l&&(E-=r-(r=l._start))),this._tTime=E,this._time=r,this._act=!c,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,m=0),!m&&r&&!e&&!s&&(mi(this,"onStart"),this._tTime!==E))return this;if(r>=m&&t>=0)for(i=this._first;i;){if(a=i._next,(i._act||r>=i._start)&&i._ts&&l!==i){if(i.parent!==this)return this.render(t,e,n);if(i.render(i._ts>0?(r-i._start)*i._ts:(i._dirty?i.totalDuration():i._tDur)+(r-i._start)*i._ts,e,n),r!==this._time||!this._ts&&!u){l=0,a&&(E+=this._zTime=-1e-8);break}}i=a}else{i=this._last;for(var C=t<0?t:r;i;){if(a=i._prev,(i._act||C<=i._end)&&i._ts&&l!==i){if(i.parent!==this)return this.render(t,e,n);if(i.render(i._ts>0?(C-i._start)*i._ts:(i._dirty?i.totalDuration():i._tDur)+(C-i._start)*i._ts,e,n||hn&&(i._initted||i._startAt)),r!==this._time||!this._ts&&!u){l=0,a&&(E+=this._zTime=C?-1e-8:An);break}}i=a}}if(l&&!e&&(this.pause(),l.render(r>=m?0:-1e-8)._zTime=r>=m?1:-1,this._ts))return this._start=h,Zr(this),this.render(t,e,n);this._onUpdate&&!e&&mi(this,"onUpdate",!0),(E===v&&this._tTime>=this.totalDuration()||!E&&m)&&(h!==this._start&&Math.abs(c)===Math.abs(this._ts)||this._lock||((t||!g)&&(E===v&&this._ts>0||!E&&this._ts<0)&&wr(this,1),e||t<0&&!m||!E&&!m&&v||(mi(this,E===v&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(E<v&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(t,e){var n=this;if(Nn(e)||(e=qr(this,e,t)),!(t instanceof Yi)){if(Bn(t))return t.forEach((function(t){return n.add(t,e)})),this;if(wn(t))return this.addLabel(t,e);if(!Mn(t))return this;t=ta.delayedCall(0,t)}return this!==t?Yr(this,t,e):this},n.getChildren=function(t,e,n,r){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===r&&(r=-xn);for(var i=[],a=this._first;a;)a._start>=r&&(a instanceof ta?e&&i.push(a):(n&&i.push(a),t&&i.push.apply(i,a.getChildren(!0,e,n)))),a=a._next;return i},n.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},n.remove=function(t){return wn(t)?this.removeLabel(t):Mn(t)?this.killTweensOf(t):(Or(this,t),t===this._recent&&(this._recent=this._last),Mr(this))},n.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=gr(Si.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},n.addLabel=function(t,e){return this.labels[t]=qr(this,e),this},n.removeLabel=function(t){return delete this.labels[t],this},n.addPause=function(t,e,n){var r=ta.delayedCall(0,e||tr,n);return r.data="isPause",this._hasPause=1,Yr(this,r,qr(this,t))},n.removePause=function(t){var e=this._first;for(t=qr(this,t);e;)e._start===t&&"isPause"===e.data&&wr(e),e=e._next},n.killTweensOf=function(t,e,n){for(var r=this.getTweensOf(t,n),i=r.length;i--;)zi!==r[i]&&r[i].kill(t,e);return this},n.getTweensOf=function(t,e){for(var n,r=[],i=ii(t),a=this._first,s=Nn(e);a;)a instanceof ta?Ir(a._targets,i)&&(s?(!zi||a._initted&&a._ts)&&a.globalTime(0)<=e&&a.globalTime(a.totalDuration())>e:!e||a.isActive())&&r.push(a):(n=a.getTweensOf(i,e)).length&&r.push.apply(r,n),a=a._next;return r},n.tweenTo=function(t,e){e=e||{};var n,r=this,i=qr(r,t),a=e,s=a.startAt,o=a.onStart,u=a.onStartParams,l=a.immediateRender,c=ta.to(r,Ar({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:i,overwrite:"auto",duration:e.duration||Math.abs((i-(s&&"time"in s?s.time:r._time))/r.timeScale())||An,onStart:function(){if(r.pause(),!n){var t=e.duration||Math.abs((i-(s&&"time"in s?s.time:r._time))/r.timeScale());c._dur!==t&&Wr(c,t,0,1).render(c._time,!0,!0),n=1}o&&o.apply(c,u||[])}},e));return l?c.render(0):c},n.tweenFromTo=function(t,e,n){return this.tweenTo(e,Ar({startAt:{time:qr(this,t)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(t){return void 0===t&&(t=this._time),pi(this,qr(this,t))},n.previousLabel=function(t){return void 0===t&&(t=this._time),pi(this,qr(this,t),1)},n.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+An)},n.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var r,i=this._first,a=this.labels;i;)i._start>=n&&(i._start+=t,i._end+=t),i=i._next;if(e)for(r in a)a[r]>=n&&(a[r]+=t);return Mr(this)},n.invalidate=function(e){var n=this._first;for(this._lock=0;n;)n.invalidate(e),n=n._next;return t.prototype.invalidate.call(this,e)},n.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),Mr(this)},n.totalDuration=function(t){var e,n,r,i=0,a=this,s=a._last,o=xn;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-t:t));if(a._dirty){for(r=a.parent;s;)e=s._prev,s._dirty&&s.totalDuration(),(n=s._start)>o&&a._sort&&s._ts&&!a._lock?(a._lock=1,Yr(a,s,n-s._delay,1)._lock=0):o=n,n<0&&s._ts&&(i-=n,(!r&&!a._dp||r&&r.smoothChildTiming)&&(a._start+=n/a._ts,a._time-=n,a._tTime-=n),a.shiftChildren(-n,!1,-Infinity),o=0),s._end>i&&s._ts&&(i=s._end),s=e;Wr(a,a===dn&&a._time>i?a._time:i,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(t){if(dn._ts&&(yr(dn,Ur(t,dn)),En=Si.frame),Si.frame>=lr){lr+=yn.autoSleep||120;var e=dn._first;if((!e||!e._ts)&&yn.autoSleep&&Si._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Si.sleep()}}},e}(Yi);Ar(Vi.prototype,{_lock:0,_hasPause:0,_forcing:0});var zi,Hi,Xi=function(t,e,n,r,i,a,s){var o,u,l,c,h,f,d,p,m=new pa(this._pt,t,e,0,1,ua,null,i),v=0,g=0;for(m.b=n,m.e=r,n+="",(d=~(r+="").indexOf("random("))&&(r=fi(r)),a&&(a(p=[n,r],t,e),n=p[0],r=p[1]),u=n.match(zn)||[];o=zn.exec(r);)c=o[0],h=r.substring(v,o.index),l?l=(l+1)%5:"rgba("===h.substr(-5)&&(l=1),c!==u[g++]&&(f=parseFloat(u[g-1])||0,m._pt={_next:m._pt,p:h||1===g?h:",",s:f,c:"="===c.charAt(1)?Er(f,c)-f:parseFloat(c)-f,m:l&&l<4?Math.round:0},v=zn.lastIndex);return m.c=v<r.length?r.substring(v,r.length):"",m.fp=s,(Hn.test(r)||d)&&(m.e=0),this._pt=m,m},Wi=function(t,e,n,r,i,a,s,o,u,l){Mn(r)&&(r=r(i||0,t,a));var c,h=t[e],f="get"!==n?n:Mn(h)?u?t[e.indexOf("set")||!Mn(t["get"+e.substr(3)])?e:"get"+e.substr(3)](u):t[e]():h,d=Mn(h)?u?ra:na:ea;if(wn(r)&&(~r.indexOf("random(")&&(r=fi(r)),"="===r.charAt(1)&&((c=Er(f,r)+(ti(f)||0))||0===c)&&(r=c)),!l||f!==r||Hi)return isNaN(f*r)||""===r?(!h&&!(e in t)&&Kn(e,r),Xi.call(this,t,e,f,r,d,o||yn.stringFilter,u)):(c=new pa(this._pt,t,e,+f||0,r-(f||0),"boolean"===typeof h?oa:sa,0,d),u&&(c.fp=u),s&&c.modifier(s,this,t),this._pt=c)},Qi=function(t,e,n,r,i,a){var s,o,u,l;if(or[t]&&!1!==(s=new or[t]).init(i,s.rawVars?e[t]:function(t,e,n,r,i){if(Mn(t)&&(t=Ki(t,i,e,n,r)),!bn(t)||t.style&&t.nodeType||Bn(t)||Zn(t))return wn(t)?Ki(t,i,e,n,r):t;var a,s={};for(a in t)s[a]=Ki(t[a],i,e,n,r);return s}(e[t],r,i,a,n),n,r,a)&&(n._pt=o=new pa(n._pt,i,t,0,1,s.render,s,0,s.priority),n!==In))for(u=n._ptLookup[n._targets.indexOf(i)],l=s._props.length;l--;)u[s._props[l]]=o;return s},ji=function t(e,n,r){var i,a,s,o,u,l,c,h,f,d,p,m,v,g=e.vars,E=g.ease,I=g.startAt,T=g.immediateRender,y=g.lazy,C=g.onUpdate,x=g.runBackwards,A=g.yoyoEase,F=g.keyframes,_=g.autoRevert,P=e._dur,S=e._startAt,R=e._targets,O=e.parent,w=O&&"nested"===O.data?O.vars.targets:R,M="auto"===e._overwrite&&!cn,N=e.timeline;if(N&&(!F||!E)&&(E="none"),e._ease=ki(E,Cn.ease),e._yEase=A?Li(ki(!0===A?E:A,Cn.ease)):0,A&&e._yoyo&&!e._repeat&&(A=e._yEase,e._yEase=e._ease,e._ease=A),e._from=!N&&!!g.runBackwards,!N||F&&!g.stagger){if(m=(h=R[0]?dr(R[0]).harness:0)&&g[h.prop],i=Pr(g,ir),S&&(S._zTime<0&&S.progress(1),n<0&&x&&T&&!_?S.render(-1,!0):S.revert(x&&P?nr:er),S._lazy=0),I){if(wr(e._startAt=ta.set(R,Ar({data:"isStart",overwrite:!1,parent:O,immediateRender:!0,lazy:!S&&kn(y),startAt:null,delay:0,onUpdate:C&&function(){return mi(e,"onUpdate")},stagger:0},I))),e._startAt._dp=0,e._startAt._sat=e,n<0&&(hn||!T&&!_)&&e._startAt.revert(nr),T&&P&&n<=0&&r<=0)return void(n&&(e._zTime=n))}else if(x&&P&&!S)if(n&&(T=!1),s=Ar({overwrite:!1,data:"isFromStart",lazy:T&&!S&&kn(y),immediateRender:T,stagger:0,parent:O},i),m&&(s[h.prop]=m),wr(e._startAt=ta.set(R,s)),e._startAt._dp=0,e._startAt._sat=e,n<0&&(hn?e._startAt.revert(nr):e._startAt.render(-1,!0)),e._zTime=n,T){if(!n)return}else t(e._startAt,An,An);for(e._pt=e._ptCache=0,y=P&&kn(y)||y&&!P,a=0;a<R.length;a++){if(c=(u=R[a])._gsap||fr(R)[a]._gsap,e._ptLookup[a]=d={},sr[c.id]&&ar.length&&Tr(),p=w===R?a:w.indexOf(u),h&&!1!==(f=new h).init(u,m||i,e,p,w)&&(e._pt=o=new pa(e._pt,u,f.name,0,1,f.render,f,0,f.priority),f._props.forEach((function(t){d[t]=o})),f.priority&&(l=1)),!h||m)for(s in i)or[s]&&(f=Qi(s,i,e,p,u,w))?f.priority&&(l=1):d[s]=o=Wi.call(e,u,s,"get",i[s],p,w,0,g.stringFilter);e._op&&e._op[a]&&e.kill(u,e._op[a]),M&&e._pt&&(zi=e,dn.killTweensOf(u,d,e.globalTime(n)),v=!e.parent,zi=0),e._pt&&y&&(sr[c.id]=1)}l&&da(e),e._onInit&&e._onInit(e)}e._onUpdate=C,e._initted=(!e._op||e._pt)&&!v,F&&n<=0&&N.render(xn,!0,!0)},qi=function(t,e,n,r){var i,a,s=e.ease||r||"power1.inOut";if(Bn(e))a=n[t]||(n[t]=[]),e.forEach((function(t,n){return a.push({t:n/(e.length-1)*100,v:t,e:s})}));else for(i in e)a=n[i]||(n[i]=[]),"ease"===i||a.push({t:parseFloat(t),v:e[i],e:s})},Ki=function(t,e,n,r,i){return Mn(t)?t.call(e,n,r,i):wn(t)&&~t.indexOf("random(")?fi(t):t},Ji=hr+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",$i={};mr(Ji+",id,stagger,delay,duration,paused,scrollTrigger",(function(t){return $i[t]=1}));var ta=function(t){function e(e,n,r,i){var a;"number"===typeof n&&(r.duration=n,n=r,r=null);var s,o,u,l,c,h,f,d,p=(a=t.call(this,i?n:Sr(n))||this).vars,m=p.duration,v=p.delay,g=p.immediateRender,E=p.stagger,I=p.overwrite,T=p.keyframes,y=p.defaults,C=p.scrollTrigger,x=p.yoyoEase,A=n.parent||dn,F=(Bn(e)||Zn(e)?Nn(e[0]):"length"in n)?[e]:ii(e);if(a._targets=F.length?fr(F):Jn("GSAP target "+e+" not found. https://gsap.com",!yn.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=I,T||E||Un(m)||Un(v)){if(n=a.vars,(s=a.timeline=new Vi({data:"nested",defaults:y||{},targets:A&&"nested"===A.data?A.vars.targets:F})).kill(),s.parent=s._dp=un(a),s._start=0,E||Un(m)||Un(v)){if(l=F.length,f=E&&oi(E),bn(E))for(c in E)~Ji.indexOf(c)&&(d||(d={}),d[c]=E[c]);for(o=0;o<l;o++)(u=Pr(n,$i)).stagger=0,x&&(u.yoyoEase=x),d&&Fr(u,d),h=F[o],u.duration=+Ki(m,un(a),o,h,F),u.delay=(+Ki(v,un(a),o,h,F)||0)-a._delay,!E&&1===l&&u.delay&&(a._delay=v=u.delay,a._start+=v,u.delay=0),s.to(h,u,f?f(o,h,F):0),s._ease=Oi.none;s.duration()?m=v=0:a.timeline=0}else if(T){Sr(Ar(s.vars.defaults,{ease:"none"})),s._ease=ki(T.ease||n.ease||"none");var _,P,S,R=0;if(Bn(T))T.forEach((function(t){return s.to(F,t,">")})),s.duration();else{for(c in u={},T)"ease"===c||"easeEach"===c||qi(c,T[c],u,T.easeEach);for(c in u)for(_=u[c].sort((function(t,e){return t.t-e.t})),R=0,o=0;o<_.length;o++)(S={ease:(P=_[o]).e,duration:(P.t-(o?_[o-1].t:0))/100*m})[c]=P.v,s.to(F,S,R),R+=S.duration;s.duration()<m&&s.to({},{duration:m-s.duration()})}}m||a.duration(m=s.duration())}else a.timeline=0;return!0!==I||cn||(zi=un(a),dn.killTweensOf(F),zi=0),Yr(A,un(a),r),n.reversed&&a.reverse(),n.paused&&a.paused(!0),(g||!m&&!T&&a._start===gr(A._time)&&kn(g)&&br(un(a))&&"nested"!==A.data)&&(a._tTime=-1e-8,a.render(Math.max(0,-v)||0)),C&&Vr(un(a),C),a}ln(e,t);var n=e.prototype;return n.render=function(t,e,n){var r,i,a,s,o,u,l,c,h,f=this._time,d=this._tDur,p=this._dur,m=t<0,v=t>d-An&&!m?d:t<An?0:t;if(p){if(v!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m){if(r=v,c=this.timeline,this._repeat){if(s=p+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*s+t,e,n);if(r=gr(v%s),v===d?(a=this._repeat,r=p):((a=~~(v/s))&&a===gr(v/s)&&(r=p,a--),r>p&&(r=p)),(u=this._yoyo&&1&a)&&(h=this._yEase,r=p-r),o=Dr(this._tTime,s),r===f&&!n&&this._initted&&a===o)return this._tTime=v,this;a!==o&&(c&&this._yEase&&bi(c,u),this.vars.repeatRefresh&&!u&&!this._lock&&this._time!==s&&this._initted&&(this._lock=n=1,this.render(gr(s*a),!0).invalidate()._lock=0))}if(!this._initted){if(zr(this,m?t:r,n,e,v))return this._tTime=0,this;if(f!==this._time&&(!n||!this.vars.repeatRefresh||a===o))return this;if(p!==this._dur)return this.render(t,e,n)}if(this._tTime=v,this._time=r,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=l=(h||this._ease)(r/p),this._from&&(this.ratio=l=1-l),r&&!f&&!e&&!a&&(mi(this,"onStart"),this._tTime!==v))return this;for(i=this._pt;i;)i.r(l,i.d),i=i._next;c&&c.render(t<0?t:c._dur*c._ease(r/this._dur),e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(m&&Lr(this,t,0,n),mi(this,"onUpdate")),this._repeat&&a!==o&&this.vars.onRepeat&&!e&&this.parent&&mi(this,"onRepeat"),v!==this._tDur&&v||this._tTime!==v||(m&&!this._onUpdate&&Lr(this,t,0,!0),(t||!p)&&(v===this._tDur&&this._ts>0||!v&&this._ts<0)&&wr(this,1),e||m&&!f||!(v||f||u)||(mi(this,v===d?"onComplete":"onReverseComplete",!0),this._prom&&!(v<d&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,r){var i,a,s,o=t.ratio,u=e<0||!e&&(!t._start&&Hr(t)&&(t._initted||!Xr(t))||(t._ts<0||t._dp._ts<0)&&!Xr(t))?0:1,l=t._rDelay,c=0;if(l&&t._repeat&&(c=$r(0,t._tDur,e),a=Dr(c,l),t._yoyo&&1&a&&(u=1-u),a!==Dr(t._tTime,l)&&(o=1-u,t.vars.repeatRefresh&&t._initted&&t.invalidate())),u!==o||hn||r||t._zTime===An||!e&&t._zTime){if(!t._initted&&zr(t,e,r,n,c))return;for(s=t._zTime,t._zTime=e||(n?An:0),n||(n=e&&!s),t.ratio=u,t._from&&(u=1-u),t._time=0,t._tTime=c,i=t._pt;i;)i.r(u,i.d),i=i._next;e<0&&Lr(t,e,0,!0),t._onUpdate&&!n&&mi(t,"onUpdate"),c&&t._repeat&&!n&&t.parent&&mi(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===u&&(u&&wr(t,1),n||hn||(mi(t,u?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},n.targets=function(){return this._targets},n.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},n.resetTo=function(t,e,n,r,i){Tn||Si.wake(),this._ts||this.play();var a=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||ji(this,a),function(t,e,n,r,i,a,s,o){var u,l,c,h,f=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!f)for(f=t._ptCache[e]=[],c=t._ptLookup,h=t._targets.length;h--;){if((u=c[h][e])&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==e&&u.fp!==e;)u=u._next;if(!u)return Hi=1,t.vars[e]="+=0",ji(t,s),Hi=0,o?Jn(e+" not eligible for reset"):1;f.push(u)}for(h=f.length;h--;)(u=(l=f[h])._pt||l).s=!r&&0!==r||i?u.s+(r||0)+a*u.c:r,u.c=n-u.s,l.e&&(l.e=vr(n)+ti(l.e)),l.b&&(l.b=u.s+ti(l.b))}(this,t,e,n,r,this._ease(a/this._dur),a,i)?this.resetTo(t,e,n,r,1):(Br(this,0),this.parent||Rr(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(t,e){if(void 0===e&&(e="all"),!t&&(!e||"all"===e))return this._lazy=this._pt=0,this.parent?vi(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,zi&&!0!==zi.vars.overwrite)._first||vi(this),this.parent&&n!==this.timeline.totalDuration()&&Wr(this,this._dur*this.timeline._tDur/n,0,1),this}var r,i,a,s,o,u,l,c=this._targets,h=t?ii(t):c,f=this._ptLookup,d=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,r=n===e.length;r&&n--&&t[n]===e[n];);return n<0}(c,h))return"all"===e&&(this._pt=0),vi(this);for(r=this._op=this._op||[],"all"!==e&&(wn(e)&&(o={},mr(e,(function(t){return o[t]=1})),e=o),e=function(t,e){var n,r,i,a,s=t[0]?dr(t[0]).harness:0,o=s&&s.aliases;if(!o)return e;for(r in n=Fr({},e),o)if(r in n)for(i=(a=o[r].split(",")).length;i--;)n[a[i]]=n[r];return n}(c,e)),l=c.length;l--;)if(~h.indexOf(c[l]))for(o in i=f[l],"all"===e?(r[l]=e,s=i,a={}):(a=r[l]=r[l]||{},s=e),s)(u=i&&i[o])&&("kill"in u.d&&!0!==u.d.kill(o)||Or(this,u,"_pt"),delete i[o]),"all"!==a&&(a[o]=1);return this._initted&&!this._pt&&d&&vi(this),this},e.to=function(t,n){return new e(t,n,arguments[2])},e.from=function(t,e){return Kr(1,arguments)},e.delayedCall=function(t,n,r,i){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:n,onReverseComplete:n,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:i})},e.fromTo=function(t,e,n){return Kr(2,arguments)},e.set=function(t,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(t,n)},e.killTweensOf=function(t,e,n){return dn.killTweensOf(t,e,n)},e}(Yi);Ar(ta.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),mr("staggerTo,staggerFrom,staggerFromTo",(function(t){ta[t]=function(){var e=new Vi,n=ei.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}}));var ea=function(t,e,n){return t[e]=n},na=function(t,e,n){return t[e](n)},ra=function(t,e,n,r){return t[e](r.fp,n)},ia=function(t,e,n){return t.setAttribute(e,n)},aa=function(t,e){return Mn(t[e])?na:Ln(t[e])&&t.setAttribute?ia:ea},sa=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},oa=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},ua=function(t,e){var n=e._pt,r="";if(!t&&e.b)r=e.b;else if(1===t&&e.e)r=e.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+r,n=n._next;r+=e.c}e.set(e.t,e.p,r,e)},la=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},ca=function(t,e,n,r){for(var i,a=this._pt;a;)i=a._next,a.p===r&&a.modifier(t,e,n),a=i},ha=function(t){for(var e,n,r=this._pt;r;)n=r._next,r.p===t&&!r.op||r.op===t?Or(this,r,"_pt"):r.dep||(e=1),r=n;return!e},fa=function(t,e,n,r){r.mSet(t,e,r.m.call(r.tween,n,r.mt),r)},da=function(t){for(var e,n,r,i,a=t._pt;a;){for(e=a._next,n=r;n&&n.pr>a.pr;)n=n._next;(a._prev=n?n._prev:i)?a._prev._next=a:r=a,(a._next=n)?n._prev=a:i=a,a=e}t._pt=r},pa=function(){function t(t,e,n,r,i,a,s,o,u){this.t=e,this.s=r,this.c=i,this.p=n,this.r=a||sa,this.d=s||this,this.set=o||ea,this.pr=u||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=fa,this.m=t,this.mt=n,this.tween=e},t}();mr(hr+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return ir[t]=1})),Qn.TweenMax=Qn.TweenLite=ta,Qn.TimelineLite=Qn.TimelineMax=Vi,dn=new Vi({sortChildren:!1,defaults:Cn,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),yn.stringFilter=Pi;var ma=[],va={},ga=[],Ea=0,Ia=0,Ta=function(t){return(va[t]||ga).map((function(t){return t()}))},ya=function(){var t=Date.now(),e=[];t-Ea>2&&(Ta("matchMediaInit"),ma.forEach((function(t){var n,r,i,a,s=t.queries,o=t.conditions;for(r in s)(n=pn.matchMedia(s[r]).matches)&&(i=1),n!==o[r]&&(o[r]=n,a=1);a&&(t.revert(),i&&e.push(t))})),Ta("matchMediaRevert"),e.forEach((function(t){return t.onMatch(t,(function(e){return t.add(null,e)}))})),Ea=t,Ta("matchMedia"))},Ca=function(){function t(t,e){this.selector=e&&ai(e),this.data=[],this._r=[],this.isReverted=!1,this.id=Ia++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,n){Mn(t)&&(n=e,e=t,t=Mn);var r=this,i=function(){var t,i=fn,a=r.selector;return i&&i!==r&&i.data.push(r),n&&(r.selector=ai(n)),fn=r,t=e.apply(r,arguments),Mn(t)&&r._r.push(t),fn=i,r.selector=a,r.isReverted=!1,t};return r.last=i,t===Mn?i(r,(function(t){return r.add(null,t)})):t?r[t]=i:i},e.ignore=function(t){var e=fn;fn=null,t(this),fn=e},e.getTweens=function(){var e=[];return this.data.forEach((function(n){return n instanceof t?e.push.apply(e,n.getTweens()):n instanceof ta&&!(n.parent&&"nested"===n.parent.data)&&e.push(n)})),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var n=this;if(t?function(){for(var e,r=n.getTweens(),i=n.data.length;i--;)"isFlip"===(e=n.data[i]).data&&(e.revert(),e.getChildren(!0,!0,!1).forEach((function(t){return r.splice(r.indexOf(t),1)})));for(r.map((function(t){return{g:t._dur||t._delay||t._sat&&!t._sat.vars.immediateRender?t.globalTime(0):-1/0,t:t}})).sort((function(t,e){return e.g-t.g||-1/0})).forEach((function(e){return e.t.revert(t)})),i=n.data.length;i--;)(e=n.data[i])instanceof Vi?"nested"!==e.data&&(e.scrollTrigger&&e.scrollTrigger.revert(),e.kill()):!(e instanceof ta)&&e.revert&&e.revert(t);n._r.forEach((function(e){return e(t,n)})),n.isReverted=!0}():this.data.forEach((function(t){return t.kill&&t.kill()})),this.clear(),e)for(var r=ma.length;r--;)ma[r].id===this.id&&ma.splice(r,1)},e.revert=function(t){this.kill(t||{})},t}(),xa=function(){function t(t){this.contexts=[],this.scope=t,fn&&fn.data.push(this)}var e=t.prototype;return e.add=function(t,e,n){bn(t)||(t={matches:t});var r,i,a,s=new Ca(0,n||this.scope),o=s.conditions={};for(i in fn&&!s.selector&&(s.selector=fn.selector),this.contexts.push(s),e=s.add("onMatch",e),s.queries=t,t)"all"===i?a=1:(r=pn.matchMedia(t[i]))&&(ma.indexOf(s)<0&&ma.push(s),(o[i]=r.matches)&&(a=1),r.addListener?r.addListener(ya):r.addEventListener("change",ya));return a&&e(s,(function(t){return s.add(null,t)})),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach((function(e){return e.kill(t,!0)}))},t}(),Aa={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return Ei(t)}))},timeline:function(t){return new Vi(t)},getTweensOf:function(t,e){return dn.getTweensOf(t,e)},getProperty:function(t,e,n,r){wn(t)&&(t=ii(t)[0]);var i=dr(t||{}).get,a=n?xr:Cr;return"native"===n&&(n=""),t?e?a((or[e]&&or[e].get||i)(t,e,n,r)):function(e,n,r){return a((or[e]&&or[e].get||i)(t,e,n,r))}:t},quickSetter:function(t,e,n){if((t=ii(t)).length>1){var r=t.map((function(t){return Pa.quickSetter(t,e,n)})),i=r.length;return function(t){for(var e=i;e--;)r[e](t)}}t=t[0]||{};var a=or[e],s=dr(t),o=s.harness&&(s.harness.aliases||{})[e]||e,u=a?function(e){var r=new a;In._pt=0,r.init(t,n?e+n:e,In,0,[t]),r.render(1,r),In._pt&&la(1,In)}:s.set(t,o);return a?u:function(e){return u(t,o,n?e+n:e,s,1)}},quickTo:function(t,e,n){var r,i=Pa.to(t,Fr(((r={})[e]="+=0.1",r.paused=!0,r),n||{})),a=function(t,n,r){return i.resetTo(e,t,n,r)};return a.tween=i,a},isTweening:function(t){return dn.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=ki(t.ease,Cn.ease)),_r(Cn,t||{})},config:function(t){return _r(yn,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,r=t.plugins,i=t.defaults,a=t.extendTimeline;(r||"").split(",").forEach((function(t){return t&&!or[t]&&!Qn[t]&&Jn(e+" effect requires "+t+" plugin.")})),ur[e]=function(t,e,r){return n(ii(t),Ar(e||{},i),r)},a&&(Vi.prototype[e]=function(t,n,r){return this.add(ur[e](t,bn(n)?n:(r=n)&&{},this),r)})},registerEase:function(t,e){Oi[t]=ki(e)},parseEase:function(t,e){return arguments.length?ki(t,e):Oi},getById:function(t){return dn.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,r,i=new Vi(t);for(i.smoothChildTiming=kn(t.smoothChildTiming),dn.remove(i),i._dp=0,i._time=i._tTime=dn._time,n=dn._first;n;)r=n._next,!e&&!n._dur&&n instanceof ta&&n.vars.onComplete===n._targets[0]||Yr(i,n,n._start-n._delay),n=r;return Yr(dn,i,0),i},context:function(t,e){return t?new Ca(t,e):fn},matchMedia:function(t){return new xa(t)},matchMediaRefresh:function(){return ma.forEach((function(t){var e,n,r=t.conditions;for(n in r)r[n]&&(r[n]=!1,e=1);e&&t.revert()}))||ya()},addEventListener:function(t,e){var n=va[t]||(va[t]=[]);~n.indexOf(e)||n.push(e)},removeEventListener:function(t,e){var n=va[t],r=n&&n.indexOf(e);r>=0&&n.splice(r,1)},utils:{wrap:function t(e,n,r){var i=n-e;return Bn(e)?hi(e,t(0,e.length),n):Jr(r,(function(t){return(i+(t-e)%i)%i+e}))},wrapYoyo:function t(e,n,r){var i=n-e,a=2*i;return Bn(e)?hi(e,t(0,e.length-1),n):Jr(r,(function(t){return e+((t=(a+(t-e)%a)%a||0)>i?a-t:t)}))},distribute:oi,random:ci,snap:li,normalize:function(t,e,n){return di(t,e,0,1,n)},getUnit:ti,clamp:function(t,e,n){return Jr(n,(function(n){return $r(t,e,n)}))},splitColor:Ci,toArray:ii,selector:ai,mapRange:di,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||ti(n))}},interpolate:function t(e,n,r,i){var a=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!a){var s,o,u,l,c,h=wn(e),f={};if(!0===r&&(i=1)&&(r=null),h)e={p:e},n={p:n};else if(Bn(e)&&!Bn(n)){for(u=[],l=e.length,c=l-2,o=1;o<l;o++)u.push(t(e[o-1],e[o]));l--,a=function(t){t*=l;var e=Math.min(c,~~t);return u[e](t-e)},r=n}else i||(e=Fr(Bn(e)?[]:{},e));if(!u){for(s in n)Wi.call(f,e,s,"get",n[s]);a=function(t){return la(t,f)||(h?e.p:e)}}}return Jr(r,a)},shuffle:si},install:qn,effects:ur,ticker:Si,updateRoot:Vi.updateRoot,plugins:or,globalTimeline:dn,core:{PropTween:pa,globals:$n,Tween:ta,Timeline:Vi,Animation:Yi,getCache:dr,_removeLinkedListItem:Or,reverting:function(){return hn},context:function(t){return t&&fn&&(fn.data.push(t),t._ctx=fn),fn},suppressOverwrites:function(t){return cn=t}}};mr("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return Aa[t]=ta[t]})),Si.add(Vi.updateRoot),In=Aa.to({},{duration:0});var Fa=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},_a=function(t,e){return{name:t,rawVars:1,init:function(t,n,r){r._onInit=function(t){var r,i;if(wn(n)&&(r={},mr(n,(function(t){return r[t]=1})),n=r),e){for(i in r={},n)r[i]=e(n[i]);n=r}!function(t,e){var n,r,i,a=t._targets;for(n in e)for(r=a.length;r--;)(i=t._ptLookup[r][n])&&(i=i.d)&&(i._pt&&(i=Fa(i,n)),i&&i.modifier&&i.modifier(e[n],t,a[r],n))}(t,n)}}}},Pa=Aa.registerPlugin({name:"attr",init:function(t,e,n,r,i){var a,s,o;for(a in this.tween=n,e)o=t.getAttribute(a)||"",(s=this.add(t,"setAttribute",(o||0)+"",e[a],r,i,0,0,a)).op=a,s.b=o,this._props.push(a)},render:function(t,e){for(var n=e._pt;n;)hn?n.set(n.t,n.p,n.b,n):n.r(t,n.d),n=n._next}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n],0,0,0,0,0,1)}},_a("roundProps",ui),_a("modifiers"),_a("snap",li))||Aa;ta.version=Vi.version=Pa.version="3.12.5",gn=1,Dn()&&Ri();Oi.Power0,Oi.Power1,Oi.Power2,Oi.Power3,Oi.Power4,Oi.Linear,Oi.Quad,Oi.Cubic,Oi.Quart,Oi.Quint,Oi.Strong,Oi.Elastic,Oi.Back,Oi.SteppedEase,Oi.Bounce,Oi.Sine,Oi.Expo,Oi.Circ;var Sa,Ra,Oa,wa,Ma,Na,La,ba,ka={},Da=180/Math.PI,Ua=Math.PI/180,Za=Math.atan2,Ba=/([A-Z])/g,Ga=/(left|right|width|margin|padding|x)/i,Ya=/[\s,\(]\S/,Va={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},za=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Ha=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},Xa=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},Wa=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},Qa=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},ja=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},qa=function(t,e,n){return t.style[e]=n},Ka=function(t,e,n){return t.style.setProperty(e,n)},Ja=function(t,e,n){return t._gsap[e]=n},$a=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},ts=function(t,e,n,r,i){var a=t._gsap;a.scaleX=a.scaleY=n,a.renderTransform(i,a)},es=function(t,e,n,r,i){var a=t._gsap;a[e]=n,a.renderTransform(i,a)},ns="transform",rs=ns+"Origin",is=function t(e,n){var r=this,i=this.target,a=i.style,s=i._gsap;if(e in ka&&a){if(this.tfm=this.tfm||{},"transform"===e)return Va.transform.split(",").forEach((function(e){return t.call(r,e,n)}));if(~(e=Va[e]||e).indexOf(",")?e.split(",").forEach((function(t){return r.tfm[t]=Cs(i,t)})):this.tfm[e]=s.x?s[e]:Cs(i,e),e===rs&&(this.tfm.zOrigin=s.zOrigin),this.props.indexOf(ns)>=0)return;s.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(rs,n,"")),e=ns}(a||n)&&this.props.push(e,n,a[e])},as=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},ss=function(){var t,e,n=this.props,r=this.target,i=r.style,a=r._gsap;for(t=0;t<n.length;t+=3)n[t+1]?r[n[t]]=n[t+2]:n[t+2]?i[n[t]]=n[t+2]:i.removeProperty("--"===n[t].substr(0,2)?n[t]:n[t].replace(Ba,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)a[e]=this.tfm[e];a.svg&&(a.renderTransform(),r.setAttribute("data-svg-origin",this.svgo||"")),(t=La())&&t.isStart||i[ns]||(as(i),a.zOrigin&&i[rs]&&(i[rs]+=" "+a.zOrigin+"px",a.zOrigin=0,a.renderTransform()),a.uncache=1)}},os=function(t,e){var n={target:t,props:[],revert:ss,save:is};return t._gsap||Pa.core.getCache(t),e&&e.split(",").forEach((function(t){return n.save(t)})),n},us=function(t,e){var n=Ra.createElementNS?Ra.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):Ra.createElement(t);return n&&n.style?n:Ra.createElement(t)},ls=function t(e,n,r){var i=getComputedStyle(e);return i[n]||i.getPropertyValue(n.replace(Ba,"-$1").toLowerCase())||i.getPropertyValue(n)||!r&&t(e,hs(n)||n,1)||""},cs="O,Moz,ms,Ms,Webkit".split(","),hs=function(t,e,n){var r=(e||Ma).style,i=5;if(t in r&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);i--&&!(cs[i]+t in r););return i<0?null:(3===i?"ms":i>=0?cs[i]:"")+t},fs=function(){"undefined"!==typeof window&&window.document&&(Sa=window,Ra=Sa.document,Oa=Ra.documentElement,Ma=us("div")||{style:{}},us("div"),ns=hs(ns),rs=ns+"Origin",Ma.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",ba=!!hs("perspective"),La=Pa.core.reverting,wa=1)},ds=function t(e){var n,r=us("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,a=this.nextSibling,s=this.style.cssText;if(Oa.appendChild(r),r.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(o){}else this._gsapBBox&&(n=this._gsapBBox());return i&&(a?i.insertBefore(this,a):i.appendChild(this)),Oa.removeChild(r),this.style.cssText=s,n},ps=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},ms=function(t){var e;try{e=t.getBBox()}catch(n){e=ds.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===ds||(e=ds.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+ps(t,["x","cx","x1"])||0,y:+ps(t,["y","cy","y1"])||0,width:0,height:0}},vs=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!ms(t))},gs=function(t,e){if(e){var n,r=t.style;e in ka&&e!==rs&&(e=ns),r.removeProperty?("ms"!==(n=e.substr(0,2))&&"webkit"!==e.substr(0,6)||(e="-"+e),r.removeProperty("--"===n?e:e.replace(Ba,"-$1").toLowerCase())):r.removeAttribute(e)}},Es=function(t,e,n,r,i,a){var s=new pa(t._pt,e,n,0,1,a?ja:Qa);return t._pt=s,s.b=r,s.e=i,t._props.push(n),s},Is={deg:1,rad:1,turn:1},Ts={grid:1,flex:1},ys=function t(e,n,r,i){var a,s,o,u,l=parseFloat(r)||0,c=(r+"").trim().substr((l+"").length)||"px",h=Ma.style,f=Ga.test(n),d="svg"===e.tagName.toLowerCase(),p=(d?"client":"offset")+(f?"Width":"Height"),m=100,v="px"===i,g="%"===i;if(i===c||!l||Is[i]||Is[c])return l;if("px"!==c&&!v&&(l=t(e,n,r,"px")),u=e.getCTM&&vs(e),(g||"%"===c)&&(ka[n]||~n.indexOf("adius")))return a=u?e.getBBox()[f?"width":"height"]:e[p],vr(g?l/a*m:l/100*a);if(h[f?"width":"height"]=m+(v?c:i),s=~n.indexOf("adius")||"em"===i&&e.appendChild&&!d?e:e.parentNode,u&&(s=(e.ownerSVGElement||{}).parentNode),s&&s!==Ra&&s.appendChild||(s=Ra.body),(o=s._gsap)&&g&&o.width&&f&&o.time===Si.time&&!o.uncache)return vr(l/o.width*m);if(!g||"height"!==n&&"width"!==n)(g||"%"===c)&&!Ts[ls(s,"display")]&&(h.position=ls(e,"position")),s===e&&(h.position="static"),s.appendChild(Ma),a=Ma[p],s.removeChild(Ma),h.position="absolute";else{var E=e.style[n];e.style[n]=m+i,a=e[p],E?e.style[n]=E:gs(e,n)}return f&&g&&((o=dr(s)).time=Si.time,o.width=s[p]),vr(v?a*l/m:a&&l?m/a*l:0)},Cs=function(t,e,n,r){var i;return wa||fs(),e in Va&&"transform"!==e&&~(e=Va[e]).indexOf(",")&&(e=e.split(",")[0]),ka[e]&&"transform"!==e?(i=Ls(t,r),i="transformOrigin"!==e?i[e]:i.svg?i.origin:bs(ls(t,rs))+" "+i.zOrigin+"px"):(!(i=t.style[e])||"auto"===i||r||~(i+"").indexOf("calc("))&&(i=Ps[e]&&Ps[e](t,e,n)||ls(t,e)||pr(t,e)||("opacity"===e?1:0)),n&&!~(i+"").trim().indexOf(" ")?ys(t,e,i,n)+n:i},xs=function(t,e,n,r){if(!n||"none"===n){var i=hs(e,t,1),a=i&&ls(t,i,1);a&&a!==n?(e=i,n=a):"borderColor"===e&&(n=ls(t,"borderTopColor"))}var s,o,u,l,c,h,f,d,p,m,v,g=new pa(this._pt,t.style,e,0,1,ua),E=0,I=0;if(g.b=n,g.e=r,n+="","auto"===(r+="")&&(h=t.style[e],t.style[e]=r,r=ls(t,e)||r,h?t.style[e]=h:gs(t,e)),Pi(s=[n,r]),r=s[1],u=(n=s[0]).match(Vn)||[],(r.match(Vn)||[]).length){for(;o=Vn.exec(r);)f=o[0],p=r.substring(E,o.index),c?c=(c+1)%5:"rgba("!==p.substr(-5)&&"hsla("!==p.substr(-5)||(c=1),f!==(h=u[I++]||"")&&(l=parseFloat(h)||0,v=h.substr((l+"").length),"="===f.charAt(1)&&(f=Er(l,f)+v),d=parseFloat(f),m=f.substr((d+"").length),E=Vn.lastIndex-m.length,m||(m=m||yn.units[e]||v,E===r.length&&(r+=m,g.e+=m)),v!==m&&(l=ys(t,e,h,m)||0),g._pt={_next:g._pt,p:p||1===I?p:",",s:l,c:d-l,m:c&&c<4||"zIndex"===e?Math.round:0});g.c=E<r.length?r.substring(E,r.length):""}else g.r="display"===e&&"none"===r?ja:Qa;return Hn.test(r)&&(g.e=0),this._pt=g,g},As={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Fs=function(t){var e=t.split(" "),n=e[0],r=e[1]||"50%";return"top"!==n&&"bottom"!==n&&"left"!==r&&"right"!==r||(t=n,n=r,r=t),e[0]=As[n]||n,e[1]=As[r]||r,e.join(" ")},_s=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,r,i,a=e.t,s=a.style,o=e.u,u=a._gsap;if("all"===o||!0===o)s.cssText="",r=1;else for(i=(o=o.split(",")).length;--i>-1;)n=o[i],ka[n]&&(r=1,n="transformOrigin"===n?rs:ns),gs(a,n);r&&(gs(a,ns),u&&(u.svg&&a.removeAttribute("transform"),Ls(a,1),u.uncache=1,as(s)))}},Ps={clearProps:function(t,e,n,r,i){if("isFromStart"!==i.data){var a=t._pt=new pa(t._pt,e,n,0,0,_s);return a.u=r,a.pr=-10,a.tween=i,t._props.push(n),1}}},Ss=[1,0,0,1,0,0],Rs={},Os=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},ws=function(t){var e=ls(t,ns);return Os(e)?Ss:e.substr(7).match(Yn).map(vr)},Ms=function(t,e){var n,r,i,a,s=t._gsap||dr(t),o=t.style,u=ws(t);return s.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(u=[(i=t.transform.baseVal.consolidate().matrix).a,i.b,i.c,i.d,i.e,i.f]).join(",")?Ss:u:(u!==Ss||t.offsetParent||t===Oa||s.svg||(i=o.display,o.display="block",(n=t.parentNode)&&t.offsetParent||(a=1,r=t.nextElementSibling,Oa.appendChild(t)),u=ws(t),i?o.display=i:gs(t,"display"),a&&(r?n.insertBefore(t,r):n?n.appendChild(t):Oa.removeChild(t))),e&&u.length>6?[u[0],u[1],u[4],u[5],u[12],u[13]]:u)},Ns=function(t,e,n,r,i,a){var s,o,u,l=t._gsap,c=i||Ms(t,!0),h=l.xOrigin||0,f=l.yOrigin||0,d=l.xOffset||0,p=l.yOffset||0,m=c[0],v=c[1],g=c[2],E=c[3],I=c[4],T=c[5],y=e.split(" "),C=parseFloat(y[0])||0,x=parseFloat(y[1])||0;n?c!==Ss&&(o=m*E-v*g)&&(u=C*(-v/o)+x*(m/o)-(m*T-v*I)/o,C=C*(E/o)+x*(-g/o)+(g*T-E*I)/o,x=u):(C=(s=ms(t)).x+(~y[0].indexOf("%")?C/100*s.width:C),x=s.y+(~(y[1]||y[0]).indexOf("%")?x/100*s.height:x)),r||!1!==r&&l.smooth?(I=C-h,T=x-f,l.xOffset=d+(I*m+T*g)-I,l.yOffset=p+(I*v+T*E)-T):l.xOffset=l.yOffset=0,l.xOrigin=C,l.yOrigin=x,l.smooth=!!r,l.origin=e,l.originIsAbsolute=!!n,t.style[rs]="0px 0px",a&&(Es(a,l,"xOrigin",h,C),Es(a,l,"yOrigin",f,x),Es(a,l,"xOffset",d,l.xOffset),Es(a,l,"yOffset",p,l.yOffset)),t.setAttribute("data-svg-origin",C+" "+x)},Ls=function(t,e){var n=t._gsap||new Gi(t);if("x"in n&&!e&&!n.uncache)return n;var r,i,a,s,o,u,l,c,h,f,d,p,m,v,g,E,I,T,y,C,x,A,F,_,P,S,R,O,w,M,N,L,b=t.style,k=n.scaleX<0,D="px",U="deg",Z=getComputedStyle(t),B=ls(t,rs)||"0";return r=i=a=u=l=c=h=f=d=0,s=o=1,n.svg=!(!t.getCTM||!vs(t)),Z.translate&&("none"===Z.translate&&"none"===Z.scale&&"none"===Z.rotate||(b[ns]=("none"!==Z.translate?"translate3d("+(Z.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==Z.rotate?"rotate("+Z.rotate+") ":"")+("none"!==Z.scale?"scale("+Z.scale.split(" ").join(",")+") ":"")+("none"!==Z[ns]?Z[ns]:"")),b.scale=b.rotate=b.translate="none"),v=Ms(t,n.svg),n.svg&&(n.uncache?(P=t.getBBox(),B=n.xOrigin-P.x+"px "+(n.yOrigin-P.y)+"px",_=""):_=!e&&t.getAttribute("data-svg-origin"),Ns(t,_||B,!!_||n.originIsAbsolute,!1!==n.smooth,v)),p=n.xOrigin||0,m=n.yOrigin||0,v!==Ss&&(T=v[0],y=v[1],C=v[2],x=v[3],r=A=v[4],i=F=v[5],6===v.length?(s=Math.sqrt(T*T+y*y),o=Math.sqrt(x*x+C*C),u=T||y?Za(y,T)*Da:0,(h=C||x?Za(C,x)*Da+u:0)&&(o*=Math.abs(Math.cos(h*Ua))),n.svg&&(r-=p-(p*T+m*C),i-=m-(p*y+m*x))):(L=v[6],M=v[7],R=v[8],O=v[9],w=v[10],N=v[11],r=v[12],i=v[13],a=v[14],l=(g=Za(L,w))*Da,g&&(_=A*(E=Math.cos(-g))+R*(I=Math.sin(-g)),P=F*E+O*I,S=L*E+w*I,R=A*-I+R*E,O=F*-I+O*E,w=L*-I+w*E,N=M*-I+N*E,A=_,F=P,L=S),c=(g=Za(-C,w))*Da,g&&(E=Math.cos(-g),N=x*(I=Math.sin(-g))+N*E,T=_=T*E-R*I,y=P=y*E-O*I,C=S=C*E-w*I),u=(g=Za(y,T))*Da,g&&(_=T*(E=Math.cos(g))+y*(I=Math.sin(g)),P=A*E+F*I,y=y*E-T*I,F=F*E-A*I,T=_,A=P),l&&Math.abs(l)+Math.abs(u)>359.9&&(l=u=0,c=180-c),s=vr(Math.sqrt(T*T+y*y+C*C)),o=vr(Math.sqrt(F*F+L*L)),g=Za(A,F),h=Math.abs(g)>2e-4?g*Da:0,d=N?1/(N<0?-N:N):0),n.svg&&(_=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!Os(ls(t,ns)),_&&t.setAttribute("transform",_))),Math.abs(h)>90&&Math.abs(h)<270&&(k?(s*=-1,h+=u<=0?180:-180,u+=u<=0?180:-180):(o*=-1,h+=h<=0?180:-180)),e=e||n.uncache,n.x=r-((n.xPercent=r&&(!e&&n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-r)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+D,n.y=i-((n.yPercent=i&&(!e&&n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-i)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+D,n.z=a+D,n.scaleX=vr(s),n.scaleY=vr(o),n.rotation=vr(u)+U,n.rotationX=vr(l)+U,n.rotationY=vr(c)+U,n.skewX=h+U,n.skewY=f+U,n.transformPerspective=d+D,(n.zOrigin=parseFloat(B.split(" ")[2])||!e&&n.zOrigin||0)&&(b[rs]=bs(B)),n.xOffset=n.yOffset=0,n.force3D=yn.force3D,n.renderTransform=n.svg?Ys:ba?Gs:Ds,n.uncache=0,n},bs=function(t){return(t=t.split(" "))[0]+" "+t[1]},ks=function(t,e,n){var r=ti(e);return vr(parseFloat(e)+parseFloat(ys(t,"x",n+"px",r)))+r},Ds=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,Gs(t,e)},Us="0deg",Zs="0px",Bs=") ",Gs=function(t,e){var n=e||this,r=n.xPercent,i=n.yPercent,a=n.x,s=n.y,o=n.z,u=n.rotation,l=n.rotationY,c=n.rotationX,h=n.skewX,f=n.skewY,d=n.scaleX,p=n.scaleY,m=n.transformPerspective,v=n.force3D,g=n.target,E=n.zOrigin,I="",T="auto"===v&&t&&1!==t||!0===v;if(E&&(c!==Us||l!==Us)){var y,C=parseFloat(l)*Ua,x=Math.sin(C),A=Math.cos(C);C=parseFloat(c)*Ua,y=Math.cos(C),a=ks(g,a,x*y*-E),s=ks(g,s,-Math.sin(C)*-E),o=ks(g,o,A*y*-E+E)}m!==Zs&&(I+="perspective("+m+Bs),(r||i)&&(I+="translate("+r+"%, "+i+"%) "),(T||a!==Zs||s!==Zs||o!==Zs)&&(I+=o!==Zs||T?"translate3d("+a+", "+s+", "+o+") ":"translate("+a+", "+s+Bs),u!==Us&&(I+="rotate("+u+Bs),l!==Us&&(I+="rotateY("+l+Bs),c!==Us&&(I+="rotateX("+c+Bs),h===Us&&f===Us||(I+="skew("+h+", "+f+Bs),1===d&&1===p||(I+="scale("+d+", "+p+Bs),g.style[ns]=I||"translate(0, 0)"},Ys=function(t,e){var n,r,i,a,s,o=e||this,u=o.xPercent,l=o.yPercent,c=o.x,h=o.y,f=o.rotation,d=o.skewX,p=o.skewY,m=o.scaleX,v=o.scaleY,g=o.target,E=o.xOrigin,I=o.yOrigin,T=o.xOffset,y=o.yOffset,C=o.forceCSS,x=parseFloat(c),A=parseFloat(h);f=parseFloat(f),d=parseFloat(d),(p=parseFloat(p))&&(d+=p=parseFloat(p),f+=p),f||d?(f*=Ua,d*=Ua,n=Math.cos(f)*m,r=Math.sin(f)*m,i=Math.sin(f-d)*-v,a=Math.cos(f-d)*v,d&&(p*=Ua,s=Math.tan(d-p),i*=s=Math.sqrt(1+s*s),a*=s,p&&(s=Math.tan(p),n*=s=Math.sqrt(1+s*s),r*=s)),n=vr(n),r=vr(r),i=vr(i),a=vr(a)):(n=m,a=v,r=i=0),(x&&!~(c+"").indexOf("px")||A&&!~(h+"").indexOf("px"))&&(x=ys(g,"x",c,"px"),A=ys(g,"y",h,"px")),(E||I||T||y)&&(x=vr(x+E-(E*n+I*i)+T),A=vr(A+I-(E*r+I*a)+y)),(u||l)&&(s=g.getBBox(),x=vr(x+u/100*s.width),A=vr(A+l/100*s.height)),s="matrix("+n+","+r+","+i+","+a+","+x+","+A+")",g.setAttribute("transform",s),C&&(g.style[ns]=s)},Vs=function(t,e,n,r,i){var a,s,o=360,u=wn(i),l=parseFloat(i)*(u&&~i.indexOf("rad")?Da:1)-r,c=r+l+"deg";return u&&("short"===(a=i.split("_")[1])&&(l%=o)!==l%180&&(l+=l<0?o:-360),"cw"===a&&l<0?l=(l+36e9)%o-~~(l/o)*o:"ccw"===a&&l>0&&(l=(l-36e9)%o-~~(l/o)*o)),t._pt=s=new pa(t._pt,e,n,r,l,Ha),s.e=c,s.u="deg",t._props.push(n),s},zs=function(t,e){for(var n in e)t[n]=e[n];return t},Hs=function(t,e,n){var r,i,a,s,o,u,l,c=zs({},n._gsap),h=n.style;for(i in c.svg?(a=n.getAttribute("transform"),n.setAttribute("transform",""),h[ns]=e,r=Ls(n,1),gs(n,ns),n.setAttribute("transform",a)):(a=getComputedStyle(n)[ns],h[ns]=e,r=Ls(n,1),h[ns]=a),ka)(a=c[i])!==(s=r[i])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(i)<0&&(o=ti(a)!==(l=ti(s))?ys(n,i,a,l):parseFloat(a),u=parseFloat(s),t._pt=new pa(t._pt,r,i,o,u-o,za),t._pt.u=l||0,t._props.push(i));zs(r,c)};mr("padding,margin,Width,Radius",(function(t,e){var n="Top",r="Right",i="Bottom",a="Left",s=(e<3?[n,r,i,a]:[n+a,n+r,i+r,i+a]).map((function(n){return e<2?t+n:"border"+n+t}));Ps[e>1?"border"+t:t]=function(t,e,n,r,i){var a,o;if(arguments.length<4)return a=s.map((function(e){return Cs(t,e,n)})),5===(o=a.join(" ")).split(a[0]).length?a[0]:o;a=(r+"").split(" "),o={},s.forEach((function(t,e){return o[t]=a[e]=a[e]||a[(e-1)/2|0]})),t.init(e,o,i)}}));var Xs={name:"css",register:fs,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,r,i){var a,s,o,u,l,c,h,f,d,p,m,v,g,E,I,T,y=this._props,C=t.style,x=n.vars.startAt;for(h in wa||fs(),this.styles=this.styles||os(t),T=this.styles.props,this.tween=n,e)if("autoRound"!==h&&(s=e[h],!or[h]||!Qi(h,e,n,r,t,i)))if(l=typeof s,c=Ps[h],"function"===l&&(l=typeof(s=s.call(n,r,t,i))),"string"===l&&~s.indexOf("random(")&&(s=fi(s)),c)c(this,t,h,s,n)&&(I=1);else if("--"===h.substr(0,2))a=(getComputedStyle(t).getPropertyValue(h)+"").trim(),s+="",Fi.lastIndex=0,Fi.test(a)||(f=ti(a),d=ti(s)),d?f!==d&&(a=ys(t,h,a,d)+d):f&&(s+=f),this.add(C,"setProperty",a,s,r,i,0,0,h),y.push(h),T.push(h,0,C[h]);else if("undefined"!==l){if(x&&h in x?(a="function"===typeof x[h]?x[h].call(n,r,t,i):x[h],wn(a)&&~a.indexOf("random(")&&(a=fi(a)),ti(a+"")||"auto"===a||(a+=yn.units[h]||ti(Cs(t,h))||""),"="===(a+"").charAt(1)&&(a=Cs(t,h))):a=Cs(t,h),u=parseFloat(a),(p="string"===l&&"="===s.charAt(1)&&s.substr(0,2))&&(s=s.substr(2)),o=parseFloat(s),h in Va&&("autoAlpha"===h&&(1===u&&"hidden"===Cs(t,"visibility")&&o&&(u=0),T.push("visibility",0,C.visibility),Es(this,C,"visibility",u?"inherit":"hidden",o?"inherit":"hidden",!o)),"scale"!==h&&"transform"!==h&&~(h=Va[h]).indexOf(",")&&(h=h.split(",")[0])),m=h in ka)if(this.styles.save(h),v||((g=t._gsap).renderTransform&&!e.parseTransform||Ls(t,e.parseTransform),E=!1!==e.smoothOrigin&&g.smooth,(v=this._pt=new pa(this._pt,C,ns,0,1,g.renderTransform,g,0,-1)).dep=1),"scale"===h)this._pt=new pa(this._pt,g,"scaleY",g.scaleY,(p?Er(g.scaleY,p+o):o)-g.scaleY||0,za),this._pt.u=0,y.push("scaleY",h),h+="X";else{if("transformOrigin"===h){T.push(rs,0,C[rs]),s=Fs(s),g.svg?Ns(t,s,0,E,0,this):((d=parseFloat(s.split(" ")[2])||0)!==g.zOrigin&&Es(this,g,"zOrigin",g.zOrigin,d),Es(this,C,h,bs(a),bs(s)));continue}if("svgOrigin"===h){Ns(t,s,1,E,0,this);continue}if(h in Rs){Vs(this,g,h,u,p?Er(u,p+s):s);continue}if("smoothOrigin"===h){Es(this,g,"smooth",g.smooth,s);continue}if("force3D"===h){g[h]=s;continue}if("transform"===h){Hs(this,s,t);continue}}else h in C||(h=hs(h)||h);if(m||(o||0===o)&&(u||0===u)&&!Ya.test(s)&&h in C)o||(o=0),(f=(a+"").substr((u+"").length))!==(d=ti(s)||(h in yn.units?yn.units[h]:f))&&(u=ys(t,h,a,d)),this._pt=new pa(this._pt,m?g:C,h,u,(p?Er(u,p+o):o)-u,m||"px"!==d&&"zIndex"!==h||!1===e.autoRound?za:Wa),this._pt.u=d||0,f!==d&&"%"!==d&&(this._pt.b=a,this._pt.r=Xa);else if(h in C)xs.call(this,t,h,a,p?p+s:s);else if(h in t)this.add(t,h,a||t[h],p?p+s:s,r,i);else if("parseTransform"!==h){Kn(h,s);continue}m||(h in C?T.push(h,0,C[h]):T.push(h,1,a||t[h])),y.push(h)}I&&da(this)},render:function(t,e){if(e.tween._time||!La())for(var n=e._pt;n;)n.r(t,n.d),n=n._next;else e.styles.revert()},get:Cs,aliases:Va,getSetter:function(t,e,n){var r=Va[e];return r&&r.indexOf(",")<0&&(e=r),e in ka&&e!==rs&&(t._gsap.x||Cs(t,"x"))?n&&Na===n?"scale"===e?$a:Ja:(Na=n||{})&&("scale"===e?ts:es):t.style&&!Ln(t.style[e])?qa:~e.indexOf("-")?Ka:aa(t,e)},core:{_removeProperty:gs,_getMatrix:Ms}};Pa.utils.checkPrefix=hs,Pa.core.getStyleSaver=os,function(t,e,n,r){var i=mr(t+","+e+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){ka[t]=1}));mr(e,(function(t){yn.units[t]="deg",Rs[t]=1})),Va[i[13]]=t+","+e,mr("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");Va[e[1]]=i[e[0]]}))}("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY"),mr("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){yn.units[t]="px"})),Pa.registerPlugin(Xs);var Ws,Qs=Pa.registerPlugin(Xs)||Pa,js=(Qs.core.Tween,function(){function t(){(0,o.Z)(this,t),this.transformer=Qs}return(0,u.Z)(t,[{key:"dispose",value:function(){this.transformer=null}},{key:"move",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e.x,a=e.y,s=e.z;Qs.to(t,{duration:n,delay:r,x:i,y:a,z:s})}}]),t}());!function(t){t.onCameraReady="onCameraReady"}(Ws||(Ws={}));var qs=function(){function t(){(0,o.Z)(this,t),this.events=(0,V.Z)({},Ws.onCameraReady,{needsUpdate:!1,published:!1,actions:[]})}return(0,u.Z)(t,[{key:"dispose",value:function(){this.events.onCameraReady.actions.length=0,this.events=null}},{key:"subscribe",value:function(t,e){this.events[t].actions.push(e),this.events[t].needsUpdate=!0,this.update(t)}},{key:"publish",value:function(t){this.events[t].published=!0,this.update(t)}},{key:"update",value:function(t){if(this.events[t].needsUpdate&&this.events[t].published){for(var e=this.events[t].actions,n=0;n<e.length;n++)e[n]();e.length=0}}}]),t}(),Ks=function(){function t(e){(0,o.Z)(this,t),this.position=new p.Vector2,this.rawPosition=new p.Vector2,this.setupMousePositionUpdate(e)}return(0,u.Z)(t,[{key:"setupMousePositionUpdate",value:function(t){var e=this;t.onmousemove=function(n){e.rawPosition.x=n.clientX,e.rawPosition.y=n.clientY;var r=t.getBoundingClientRect();e.position.x=(n.clientX-r.left)/(r.right-r.left)*2-1,e.position.y=-(n.clientY-r.top)/(r.bottom-r.top)*2+1}}}]),t}(),Js=function(){function t(e){var n=this;if((0,o.Z)(this,t),this.stats=null,this.isThisBeingDisposed=!1,this.render=function(){n.isThisBeingDisposed||(n.stats&&n.stats.begin(),n.options.webXR||!1?n.renderForWebXR():requestAnimationFrame(n.render),n.updateAllComponents(),n.stats&&n.stats.end())},this.renderForWebXR=function(){n.getRenderer().setAnimationLoop((function(){n.getRenderer().render(n.getScene(),n.getCamera())}))},this.resize=function(){n.updateAspect()},!e.container)throw new Error("Could not get container element!");this.options=e,this.events=new qs,this.items=this.newItems(),this.scene=new on(this),this.renderer=new sn(this),this.mouse=new Ks(this.renderer.renderer.domElement),this.ifcCamera=new De(this),this.events.publish(Ws.onCameraReady),this.clippingPlanes=[],this.ifcCaster=new Ue(this),this.clock=new p.Clock(!0),this.ifcAnimator=new js,this.setupWindowRescale(),this.render()}return(0,u.Z)(t,[{key:"dispose",value:function(){var t,e,n;this.isThisBeingDisposed=!0,null===(t=this.stats)||void 0===t||t.dom.remove(),null===(e=this.options.preselectMaterial)||void 0===e||e.dispose(),null===(n=this.options.selectMaterial)||void 0===n||n.dispose(),this.options=null,this.items.components.length=0,this.items.ifcModels.forEach((function(t){t.removeFromParent(),t.geometry.boundsTree&&t.geometry.disposeBoundsTree(),t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach((function(t){return t.dispose()})):t.material.dispose()})),this.items.ifcModels.length=0,this.items.pickableIfcModels.length=0,this.items=null,this.ifcCamera.dispose(),this.ifcCamera=null,this.scene.dispose(),this.scene=null,this.renderer.dispose(),this.mouse=null,this.renderer=null,this.events.dispose(),this.events=null,this.ifcCaster.dispose(),this.ifcCaster=null,this.ifcAnimator.dispose(),this.ifcAnimator=null,this.clock=null,this.clippingPlanes.length=0,this.unsetWindowRescale()}},{key:"getScene",value:function(){return this.scene.scene}},{key:"getRenderer",value:function(){return this.renderer.renderer}},{key:"getRenderer2D",value:function(){return this.renderer.renderer2D}},{key:"getCamera",value:function(){return this.ifcCamera.activeCamera}},{key:"getIfcCamera",value:function(){return this.ifcCamera}},{key:"getDomElement",value:function(){return this.getRenderer().domElement}},{key:"getDomElement2D",value:function(){return this.getRenderer2D().domElement}},{key:"getContainerElement",value:function(){return this.options.container}},{key:"getDimensions",value:function(){var t=this.getContainerElement();return new p.Vector2(t.clientWidth,t.clientHeight)}},{key:"getClippingPlanes",value:function(){return this.clippingPlanes}},{key:"getAnimator",value:function(){return this.ifcAnimator}},{key:"getCenter",value:function(t){if(t.geometry.computeBoundingBox(),!t.geometry.index)return new p.Vector3;for(var e=t.geometry.index.array,n=t.geometry.attributes.position,r=0,i=0,a=0,s=0,o=0;o<e.length||o<20;o++)r+=n.getX(e[o]),i+=n.getY(e[o]),a+=n.getZ(e[o]),s++;return new p.Vector3(r/s+t.position.x,i/s+t.position.y,a/s+t.position.z)}},{key:"addComponent",value:function(t){this.items.components.push(t)}},{key:"addClippingPlane",value:function(t){this.clippingPlanes.push(t)}},{key:"removeClippingPlane",value:function(t){var e=this.clippingPlanes.indexOf(t);this.clippingPlanes.splice(e,1)}},{key:"castRay",value:function(t){return this.ifcCaster.castRay(t)}},{key:"castRayIfc",value:function(){return this.ifcCaster.castRayIfc()}},{key:"fitToFrame",value:function(){this.ifcCamera.navMode[r.Orbit].fitModelToFrame()}},{key:"toggleCameraControls",value:function(t){this.ifcCamera.toggleCameraControls(t)}},{key:"updateAspect",value:function(){this.ifcCamera.updateAspect(),this.renderer.adjustRendererSize()}},{key:"updateAllComponents",value:function(){var t=this.clock.getDelta();this.items.components.forEach((function(e){return e.update(t)}))}},{key:"setupWindowRescale",value:function(){window.addEventListener("resize",this.resize)}},{key:"unsetWindowRescale",value:function(){window.removeEventListener("resize",this.resize)}},{key:"newItems",value:function(){return{components:[],ifcModels:[],pickableIfcModels:[]}}}]),t}(),$s=n(67536),to=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;return(0,o.Z)(this,n),(r=e.call(this,t)).dracoLoader=null,r.ktx2Loader=null,r.meshoptDecoder=null,r.pluginCallbacks=[],r.register((function(t){return new ao(t)})),r.register((function(t){return new ho(t)})),r.register((function(t){return new fo(t)})),r.register((function(t){return new so(t)})),r.register((function(t){return new oo(t)})),r.register((function(t){return new uo(t)})),r.register((function(t){return new lo(t)})),r.register((function(t){return new co(t)})),r.register((function(t){return new ro(t)})),r.register((function(t){return new po(t)})),r}return(0,u.Z)(n,[{key:"load",value:function(t,e,n,r){var i,a=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:p.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);var s=function(e){r?r(e):console.error(e),a.manager.itemError(t),a.manager.itemEnd(t)},o=new p.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){try{a.parse(n,i,(function(n){e(n),a.manager.itemEnd(t)}),s)}catch(r){s(r)}}),n,s)}},{key:"setDRACOLoader",value:function(t){return this.dracoLoader=t,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(t){return this.ktx2Loader=t,this}},{key:"setMeshoptDecoder",value:function(t){return this.meshoptDecoder=t,this}},{key:"register",value:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}},{key:"unregister",value:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}},{key:"parse",value:function(t,e,n,r){var i,a={},s={};if("string"===typeof t)i=t;else if(p.LoaderUtils.decodeText(new Uint8Array(t,0,4))===mo){try{a[no.KHR_BINARY_GLTF]=new Eo(t)}catch(m){return void(r&&r(m))}i=a[no.KHR_BINARY_GLTF].content}else i=p.LoaderUtils.decodeText(new Uint8Array(t));var o=JSON.parse(i);if(void 0===o.asset||o.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var u=new qo(o,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(var l=0;l<this.pluginCallbacks.length;l++){var c=this.pluginCallbacks[l](u);s[c.name]=c,a[c.name]=!0}if(o.extensionsUsed)for(var h=0;h<o.extensionsUsed.length;++h){var f=o.extensionsUsed[h],d=o.extensionsRequired||[];switch(f){case no.KHR_MATERIALS_UNLIT:a[f]=new io;break;case no.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[f]=new Co;break;case no.KHR_DRACO_MESH_COMPRESSION:a[f]=new Io(o,this.dracoLoader);break;case no.KHR_TEXTURE_TRANSFORM:a[f]=new To;break;case no.KHR_MESH_QUANTIZATION:a[f]=new xo;break;default:d.indexOf(f)>=0&&void 0===s[f]&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}u.setExtensions(a),u.setPlugins(s),u.parse(n,r)}}},{key:"parseAsync",value:function(t,e){var n=this;return new Promise((function(r,i){n.parse(t,e,r,i)}))}}]),n}(p.Loader);function eo(){var t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}var no={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},ro=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return(0,u.Z)(t,[{key:"_markDefs",value:function(){for(var t=this.parser,e=this.parser.json.nodes||[],n=0,r=e.length;n<r;n++){var i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}},{key:"_loadLight",value:function(t){var e=this.parser,n="light:"+t,r=e.cache.get(n);if(r)return r;var i,a=e.json,s=((a.extensions&&a.extensions[this.name]||{}).lights||[])[t],o=new p.Color(16777215);void 0!==s.color&&o.fromArray(s.color);var u=void 0!==s.range?s.range:0;switch(s.type){case"directional":(i=new p.DirectionalLight(o)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new p.PointLight(o)).distance=u;break;case"spot":(i=new p.SpotLight(o)).distance=u,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,i.angle=s.spot.outerConeAngle,i.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return i.position.set(0,0,0),i.decay=2,void 0!==s.intensity&&(i.intensity=s.intensity),i.name=e.createUniqueName(s.name||"light_"+t),r=Promise.resolve(i),e.cache.add(n,r),r}},{key:"createNodeAttachment",value:function(t){var e=this,n=this.parser,r=n.json.nodes[t],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(t){return n._getNodeRef(e.cache,i,t)}))}}]),t}(),io=function(){function t(){(0,o.Z)(this,t),this.name=no.KHR_MATERIALS_UNLIT}return(0,u.Z)(t,[{key:"getMaterialType",value:function(){return p.MeshBasicMaterial}},{key:"extendParams",value:function(t,e,n){var r=[];t.color=new p.Color(1,1,1),t.opacity=1;var i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;t.color.fromArray(a),t.opacity=a[3]}void 0!==i.baseColorTexture&&r.push(n.assignTexture(t,"map",i.baseColorTexture))}return Promise.all(r)}}]),t}(),ao=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.KHR_MATERIALS_CLEARCOAT}return(0,u.Z)(t,[{key:"getMaterialType",value:function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?p.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];if(void 0!==a.clearcoatFactor&&(e.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&i.push(n.assignTexture(e,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(e.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&i.push(n.assignTexture(e,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(i.push(n.assignTexture(e,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var s=a.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new p.Vector2(s,s)}return Promise.all(i)}}]),t}(),so=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.KHR_MATERIALS_SHEEN}return(0,u.Z)(t,[{key:"getMaterialType",value:function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?p.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[];e.sheenColor=new p.Color(0,0,0),e.sheenRoughness=0,e.sheen=1;var a=r.extensions[this.name];return void 0!==a.sheenColorFactor&&e.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(e.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&i.push(n.assignTexture(e,"sheenColorMap",a.sheenColorTexture)),void 0!==a.sheenRoughnessTexture&&i.push(n.assignTexture(e,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}]),t}(),oo=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.KHR_MATERIALS_TRANSMISSION}return(0,u.Z)(t,[{key:"getMaterialType",value:function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?p.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(e.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(n.assignTexture(e,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}]),t}(),uo=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.KHR_MATERIALS_VOLUME}return(0,u.Z)(t,[{key:"getMaterialType",value:function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?p.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];e.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&i.push(n.assignTexture(e,"thicknessMap",a.thicknessTexture)),e.attenuationDistance=a.attenuationDistance||0;var s=a.attenuationColor||[1,1,1];return e.attenuationColor=new p.Color(s[0],s[1],s[2]),Promise.all(i)}}]),t}(),lo=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.KHR_MATERIALS_IOR}return(0,u.Z)(t,[{key:"getMaterialType",value:function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?p.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(t,e){var n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var r=n.extensions[this.name];return e.ior=void 0!==r.ior?r.ior:1.5,Promise.resolve()}}]),t}(),co=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.KHR_MATERIALS_SPECULAR}return(0,u.Z)(t,[{key:"getMaterialType",value:function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?p.MeshPhysicalMaterial:null}},{key:"extendMaterialParams",value:function(t,e){var n=this.parser,r=n.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];e.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&i.push(n.assignTexture(e,"specularIntensityMap",a.specularTexture));var s=a.specularColorFactor||[1,1,1];return e.specularColor=new p.Color(s[0],s[1],s[2]),void 0!==a.specularColorTexture&&i.push(n.assignTexture(e,"specularColorMap",a.specularColorTexture).then((function(t){t.encoding=p.sRGBEncoding}))),Promise.all(i)}}]),t}(),ho=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.KHR_TEXTURE_BASISU}return(0,u.Z)(t,[{key:"loadTexture",value:function(t){var e=this.parser,n=e.json,r=n.textures[t];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],a=n.images[i.source],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,a,s)}}]),t}(),fo=function(){function t(e){(0,o.Z)(this,t),this.parser=e,this.name=no.EXT_TEXTURE_WEBP,this.isSupported=null}return(0,u.Z)(t,[{key:"loadTexture",value:function(t){var e=this.name,n=this.parser,r=n.json,i=r.textures[t];if(!i.extensions||!i.extensions[e])return null;var a=i.extensions[e],s=r.images[a.source],o=n.textureLoader;if(s.uri){var u=n.options.manager.getHandler(s.uri);null!==u&&(o=u)}return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(t,s,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(t){var e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}]),t}(),po=function(){function t(e){(0,o.Z)(this,t),this.name=no.EXT_MESHOPT_COMPRESSION,this.parser=e}return(0,u.Z)(t,[{key:"loadBufferView",value:function(t){var e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,a.ready]).then((function(t){var e=r.byteOffset||0,n=r.byteLength||0,i=r.count,s=r.byteStride,o=new ArrayBuffer(i*s),u=new Uint8Array(t[0],e,n);return a.decodeGltfBuffer(new Uint8Array(o),i,s,u,r.mode,r.filter),o}))}return null}}]),t}(),mo="glTF",vo=1313821514,go=5130562,Eo=(0,u.Z)((function t(e){(0,o.Z)(this,t),this.name=no.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(e,0,12);if(this.header={magic:p.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==mo)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var r=this.header.length-12,i=new DataView(e,12),a=0;a<r;){var s=i.getUint32(a,!0);a+=4;var u=i.getUint32(a,!0);if(a+=4,u===vo){var l=new Uint8Array(e,12+a,s);this.content=p.LoaderUtils.decodeText(l)}else if(u===go){var c=12+a;this.body=e.slice(c,c+s)}a+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")})),Io=function(){function t(e,n){if((0,o.Z)(this,t),!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=no.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}return(0,u.Z)(t,[{key:"decodePrimitive",value:function(t,e){var n=this.json,r=this.dracoLoader,i=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,s={},o={},u={};for(var l in a){var c=Uo[l]||l.toLowerCase();s[c]=a[l]}for(var h in t.attributes){var f=Uo[h]||h.toLowerCase();if(void 0!==a[h]){var d=n.accessors[t.attributes[h]],p=Lo[d.componentType];u[f]=p,o[f]=!0===d.normalized}}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){r.decodeDracoFile(t,(function(t){for(var n in t.attributes){var r=t.attributes[n],i=o[n];void 0!==i&&(r.normalized=i)}e(t)}),s,u)}))}))}}]),t}(),To=function(){function t(){(0,o.Z)(this,t),this.name=no.KHR_TEXTURE_TRANSFORM}return(0,u.Z)(t,[{key:"extendTexture",value:function(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}]),t}(),yo=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t){var r;(0,o.Z)(this,n),(r=e.call(this)).isGLTFSpecularGlossinessMaterial=!0;var i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),l=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),c={specular:{value:(new p.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return r._extraUniforms=c,r.onBeforeCompile=function(t){for(var e in c)t.uniforms[e]=c[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",l)},Object.defineProperties((0,B.Z)(r),{specular:{get:function(){return c.specular.value},set:function(t){c.specular.value=t}},specularMap:{get:function(){return c.specularMap.value},set:function(t){c.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(t){c.glossiness.value=t}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(t){c.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete r.metalness,delete r.roughness,delete r.metalnessMap,delete r.roughnessMap,r.setValues(t),r}return(0,u.Z)(n,[{key:"copy",value:function(t){return(0,S.Z)((0,R.Z)(n.prototype),"copy",this).call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}]),n}(p.MeshStandardMaterial),Co=function(){function t(){(0,o.Z)(this,t),this.name=no.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}return(0,u.Z)(t,[{key:"getMaterialType",value:function(){return yo}},{key:"extendParams",value:function(t,e,n){var r=e.extensions[this.name];t.color=new p.Color(1,1,1),t.opacity=1;var i=[];if(Array.isArray(r.diffuseFactor)){var a=r.diffuseFactor;t.color.fromArray(a),t.opacity=a[3]}if(void 0!==r.diffuseTexture&&i.push(n.assignTexture(t,"map",r.diffuseTexture)),t.emissive=new p.Color(0,0,0),t.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,t.specular=new p.Color(1,1,1),Array.isArray(r.specularFactor)&&t.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var s=r.specularGlossinessTexture;i.push(n.assignTexture(t,"glossinessMap",s)),i.push(n.assignTexture(t,"specularMap",s))}return Promise.all(i)}},{key:"createMaterial",value:function(t){var e=new yo(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=p.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}]),t}(),xo=(0,u.Z)((function t(){(0,o.Z)(this,t),this.name=no.KHR_MESH_QUANTIZATION})),Ao=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r,i,a){return(0,o.Z)(this,n),e.call(this,t,r,i,a)}return(0,u.Z)(n,[{key:"copySampleValue_",value:function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=t*r*3+r,a=0;a!==r;a++)e[a]=n[i+a];return e}}]),n}(p.Interpolant);Ao.prototype.beforeStart_=Ao.prototype.copySampleValue_,Ao.prototype.afterEnd_=Ao.prototype.copySampleValue_,Ao.prototype.interpolate_=function(t,e,n,r){for(var i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=2*s,u=3*s,l=r-e,c=(n-e)/l,h=c*c,f=h*c,d=t*u,p=d-u,m=-2*f+3*h,v=f-h,g=1-m,E=v-h+c,I=0;I!==s;I++){var T=a[p+I+s],y=a[p+I+o]*l,C=a[d+I+s],x=a[d+I]*l;i[I]=g*T+E*y+m*C+v*x}return i};var Fo=new p.Quaternion,_o=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(){return(0,o.Z)(this,n),e.apply(this,arguments)}return(0,u.Z)(n,[{key:"interpolate_",value:function(t,e,r,i){var a=(0,S.Z)((0,R.Z)(n.prototype),"interpolate_",this).call(this,t,e,r,i);return Fo.fromArray(a).normalize().toArray(a),a}}]),n}(Ao),Po=0,So=1,Ro=2,Oo=3,wo=4,Mo=5,No=6,Lo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bo={9728:p.NearestFilter,9729:p.LinearFilter,9984:p.NearestMipmapNearestFilter,9985:p.LinearMipmapNearestFilter,9986:p.NearestMipmapLinearFilter,9987:p.LinearMipmapLinearFilter},ko={33071:p.ClampToEdgeWrapping,33648:p.MirroredRepeatWrapping,10497:p.RepeatWrapping},Do={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Uo={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Zo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Bo={CUBICSPLINE:void 0,LINEAR:p.InterpolateLinear,STEP:p.InterpolateDiscrete},Go="OPAQUE",Yo="MASK",Vo="BLEND";function zo(t,e,n){for(var r in n.extensions)void 0===t[r]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function Ho(t,e){void 0!==e.extras&&("object"===typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Xo(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){var i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(var a=0,s=i.length;a<s;a++)t.morphTargetDictionary[i[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Wo(t){var e=t.extensions&&t.extensions[no.KHR_DRACO_MESH_COMPRESSION];return e?"draco:"+e.bufferView+":"+e.indices+":"+Qo(e.attributes):t.indices+":"+Qo(t.attributes)+":"+t.mode}function Qo(t){for(var e="",n=Object.keys(t).sort(),r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function jo(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var qo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,o.Z)(this,t),this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new eo,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new p.ImageBitmapLoader(this.options.manager):this.textureLoader=new p.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new p.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return(0,u.Z)(t,[{key:"setExtensions",value:function(t){this.extensions=t}},{key:"setPlugins",value:function(t){this.plugins=t}},{key:"parse",value:function(t,e){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){var a={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};zo(i,a,r),Ho(a,r),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(a)}))).then((function(){t(a)}))})).catch(e)}},{key:"_markDefs",value:function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],r=0,i=e.length;r<i;r++)for(var a=e[r].joints,s=0,o=a.length;s<o;s++)t[a[s]].isBone=!0;for(var u=0,l=t.length;u<l;u++){var c=t[u];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}}},{key:"_addNodeRef",value:function(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}},{key:"_getNodeRef",value:function(t,e,n){var r=this;if(t.refs[e]<=1)return n;var i=n.clone();return function t(e,n){var i=r.associations.get(e);null!=i&&r.associations.set(n,i);var a,s=(0,Y.Z)(e.children.entries());try{for(s.s();!(a=s.n()).done;){var o=(0,$s.Z)(a.value,2),u=o[0];t(o[1],n.children[u])}}catch(l){s.e(l)}finally{s.f()}}(n,i),i.name+="_instance_"+t.uses[e]++,i}},{key:"_invokeOne",value:function(t){var e=Object.values(this.plugins);e.push(this);for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}return null}},{key:"_invokeAll",value:function(t){var e=Object.values(this.plugins);e.unshift(this);for(var n=[],r=0;r<e.length;r++){var i=t(e[r]);i&&n.push(i)}return n}},{key:"getDependency",value:function(t,e){var n=t+":"+e,r=this.cache.get(n);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this.loadNode(e);break;case"mesh":r=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":r=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":r=this.loadSkin(e);break;case"animation":r=this.loadAnimation(e);break;case"camera":r=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,r)}return r}},{key:"getDependencies",value:function(t){var e=this.cache.get(t);if(!e){var n=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e}},{key:"loadBuffer",value:function(t){var e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[no.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(t,i){n.load(p.LoaderUtils.resolveURL(e.uri,r.path),t,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}},{key:"loadBufferView",value:function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))}},{key:"loadAccessor",value:function(t){var e=this,n=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var i=[];return void 0!==r.bufferView?i.push(this.getDependency("bufferView",r.bufferView)):i.push(null),void 0!==r.sparse&&(i.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(i).then((function(t){var i,a,s=t[0],o=Do[r.type],u=Lo[r.componentType],l=u.BYTES_PER_ELEMENT,c=l*o,h=r.byteOffset||0,f=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;if(f&&f!==c){var m=Math.floor(h/f),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count,g=e.cache.get(v);g||(i=new u(s,m*f,r.count*f/l),g=new p.InterleavedBuffer(i,f/l),e.cache.add(v,g)),a=new p.InterleavedBufferAttribute(g,o,h%f/l,d)}else i=null===s?new u(r.count*o):new u(s,h,r.count*o),a=new p.BufferAttribute(i,o,d);if(void 0!==r.sparse){var E=Do.SCALAR,I=Lo[r.sparse.indices.componentType],T=r.sparse.indices.byteOffset||0,y=r.sparse.values.byteOffset||0,C=new I(t[1],T,r.sparse.count*E),x=new u(t[2],y,r.sparse.count*o);null!==s&&(a=new p.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(var A=0,F=C.length;A<F;A++){var _=C[A];if(a.setX(_,x[A*o]),o>=2&&a.setY(_,x[A*o+1]),o>=3&&a.setZ(_,x[A*o+2]),o>=4&&a.setW(_,x[A*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))}},{key:"loadTexture",value:function(t){var e=this.json,n=this.options,r=e.textures[t],i=e.images[r.source],a=this.textureLoader;if(i.uri){var s=n.manager.getHandler(i.uri);null!==s&&(a=s)}return this.loadTextureImage(t,i,a)}},{key:"loadTextureImage",value:function(t,e,n){var r=this,i=this.json,a=this.options,s=i.textures[t],o=(e.uri||e.bufferView)+":"+s.sampler;if(this.textureCache[o])return this.textureCache[o];var u=self.URL||self.webkitURL,l=e.uri||"",c=!1;if(void 0!==e.bufferView)l=r.getDependency("bufferView",e.bufferView).then((function(t){c=!0;var n=new Blob([t],{type:e.mimeType});return l=u.createObjectURL(n)}));else if(void 0===e.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");var h=Promise.resolve(l).then((function(t){return new Promise((function(e,r){var i=e;!0===n.isImageBitmapLoader&&(i=function(t){var n=new p.Texture(t);n.needsUpdate=!0,e(n)}),n.load(p.LoaderUtils.resolveURL(t,a.path),i,void 0,r)}))})).then((function(e){!0===c&&u.revokeObjectURL(l),e.flipY=!1,s.name&&(e.name=s.name);var n=(i.samplers||{})[s.sampler]||{};return e.magFilter=bo[n.magFilter]||p.LinearFilter,e.minFilter=bo[n.minFilter]||p.LinearMipmapLinearFilter,e.wrapS=ko[n.wrapS]||p.RepeatWrapping,e.wrapT=ko[n.wrapT]||p.RepeatWrapping,r.associations.set(e,{textures:t}),e})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",l),null}));return this.textureCache[o]=h,h}},{key:"assignTexture",value:function(t,e,n){var r=this;return this.getDependency("texture",n.index).then((function(i){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===e&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),r.extensions[no.KHR_TEXTURE_TRANSFORM]){var a=void 0!==n.extensions?n.extensions[no.KHR_TEXTURE_TRANSFORM]:void 0;if(a){var s=r.associations.get(i);i=r.extensions[no.KHR_TEXTURE_TRANSFORM].extendTexture(i,a),r.associations.set(i,s)}}return t[e]=i,i}))}},{key:"assignFinalMaterial",value:function(t){var e=t.geometry,n=t.material,r=void 0===e.attributes.tangent,i=void 0!==e.attributes.color,a=void 0===e.attributes.normal;if(t.isPoints){var s="PointsMaterial:"+n.uuid,o=this.cache.get(s);o||(o=new p.PointsMaterial,p.Material.prototype.copy.call(o,n),o.color.copy(n.color),o.map=n.map,o.sizeAttenuation=!1,this.cache.add(s,o)),n=o}else if(t.isLine){var u="LineBasicMaterial:"+n.uuid,l=this.cache.get(u);l||(l=new p.LineBasicMaterial,p.Material.prototype.copy.call(l,n),l.color.copy(n.color),this.cache.add(u,l)),n=l}if(r||i||a){var c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),r&&(c+="derivative-tangents:"),i&&(c+="vertex-colors:"),a&&(c+="flat-shading:");var h=this.cache.get(c);h||(h=n.clone(),i&&(h.vertexColors=!0),a&&(h.flatShading=!0),r&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(c,h),this.associations.set(h,this.associations.get(n))),n=h}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}},{key:"getMaterialType",value:function(){return p.MeshStandardMaterial}},{key:"loadMaterial",value:function(t){var e,n=this,r=this.json,i=this.extensions,a=r.materials[t],s={},o=a.extensions||{},u=[];if(o[no.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=i[no.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=l.getMaterialType(),u.push(l.extendParams(s,a,n))}else if(o[no.KHR_MATERIALS_UNLIT]){var c=i[no.KHR_MATERIALS_UNLIT];e=c.getMaterialType(),u.push(c.extendParams(s,a,n))}else{var h=a.pbrMetallicRoughness||{};if(s.color=new p.Color(1,1,1),s.opacity=1,Array.isArray(h.baseColorFactor)){var f=h.baseColorFactor;s.color.fromArray(f),s.opacity=f[3]}void 0!==h.baseColorTexture&&u.push(n.assignTexture(s,"map",h.baseColorTexture)),s.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,s.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(u.push(n.assignTexture(s,"metalnessMap",h.metallicRoughnessTexture)),u.push(n.assignTexture(s,"roughnessMap",h.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),u.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,s)}))))}!0===a.doubleSided&&(s.side=p.DoubleSide);var d=a.alphaMode||Go;if(d===Vo?(s.transparent=!0,s.depthWrite=!1):(s.format=p.RGBFormat,s.transparent=!1,d===Yo&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&e!==p.MeshBasicMaterial&&(u.push(n.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new p.Vector2(1,1),void 0!==a.normalTexture.scale)){var m=a.normalTexture.scale;s.normalScale.set(m,m)}return void 0!==a.occlusionTexture&&e!==p.MeshBasicMaterial&&(u.push(n.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&e!==p.MeshBasicMaterial&&(s.emissive=(new p.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&e!==p.MeshBasicMaterial&&u.push(n.assignTexture(s,"emissiveMap",a.emissiveTexture)),Promise.all(u).then((function(){var r;return r=e===yo?i[no.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new e(s),a.name&&(r.name=a.name),r.map&&(r.map.encoding=p.sRGBEncoding),r.emissiveMap&&(r.emissiveMap.encoding=p.sRGBEncoding),Ho(r,a),n.associations.set(r,{materials:t}),a.extensions&&zo(i,r,a),r}))}},{key:"createUniqueName",value:function(t){for(var e=p.PropertyBinding.sanitizeNodeName(t||""),n=e,r=1;this.nodeNamesUsed[n];++r)n=e+"_"+r;return this.nodeNamesUsed[n]=!0,n}},{key:"loadGeometries",value:function(t){var e=this,n=this.extensions,r=this.primitiveCache;function i(t){return n[no.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return Jo(n,t,e)}))}for(var a=[],s=0,o=t.length;s<o;s++){var u=t[s],l=Wo(u),c=r[l];if(c)a.push(c.promise);else{var h=void 0;h=u.extensions&&u.extensions[no.KHR_DRACO_MESH_COMPRESSION]?i(u):Jo(new p.BufferGeometry,u,e),r[l]={primitive:u,promise:h},a.push(h)}}return Promise.all(a)}},{key:"loadMesh",value:function(t){for(var e,n=this,r=this.json,i=this.extensions,a=r.meshes[t],s=a.primitives,o=[],u=0,l=s.length;u<l;u++){var c=void 0===s[u].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new p.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:p.FrontSide})),e.DefaultMaterial):this.getDependency("material",s[u].material);o.push(c)}return o.push(n.loadGeometries(s)),Promise.all(o).then((function(e){for(var r=e.slice(0,e.length-1),o=e[e.length-1],u=[],l=0,c=o.length;l<c;l++){var h=o[l],f=s[l],d=void 0,m=r[l];if(f.mode===wo||f.mode===Mo||f.mode===No||void 0===f.mode)!0!==(d=!0===a.isSkinnedMesh?new p.SkinnedMesh(h,m):new p.Mesh(h,m)).isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),f.mode===Mo?d.geometry=$o(d.geometry,p.TriangleStripDrawMode):f.mode===No&&(d.geometry=$o(d.geometry,p.TriangleFanDrawMode));else if(f.mode===So)d=new p.LineSegments(h,m);else if(f.mode===Oo)d=new p.Line(h,m);else if(f.mode===Ro)d=new p.LineLoop(h,m);else{if(f.mode!==Po)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);d=new p.Points(h,m)}Object.keys(d.geometry.morphAttributes).length>0&&Xo(d,a),d.name=n.createUniqueName(a.name||"mesh_"+t),Ho(d,a),f.extensions&&zo(i,d,f),n.assignFinalMaterial(d),u.push(d)}for(var v=0,g=u.length;v<g;v++)n.associations.set(u[v],{meshes:t,primitives:v});if(1===u.length)return u[0];var E=new p.Group;n.associations.set(E,{meshes:t});for(var I=0,T=u.length;I<T;I++)E.add(u[I]);return E}))}},{key:"loadCamera",value:function(t){var e,n=this.json.cameras[t],r=n[n.type];if(r)return"perspective"===n.type?e=new p.PerspectiveCamera(p.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(e=new p.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),Ho(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))}},{key:"loadAnimation",value:function(t){for(var e=this.json.animations[t],n=[],r=[],i=[],a=[],s=[],o=0,u=e.channels.length;o<u;o++){var l=e.channels[o],c=e.samplers[l.sampler],h=l.target,f=void 0!==h.node?h.node:h.id,d=void 0!==e.parameters?e.parameters[c.input]:c.input,m=void 0!==e.parameters?e.parameters[c.output]:c.output;n.push(this.getDependency("node",f)),r.push(this.getDependency("accessor",d)),i.push(this.getDependency("accessor",m)),a.push(c),s.push(h)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(a),Promise.all(s)]).then((function(n){for(var r=n[0],i=n[1],a=n[2],s=n[3],o=n[4],u=[],l=function(t,e){var n=r[t],l=i[t],c=a[t],h=s[t],f=o[t];if(void 0===n)return"continue";n.updateMatrix(),n.matrixAutoUpdate=!0;var d=void 0;switch(Zo[f.path]){case Zo.weights:d=p.NumberKeyframeTrack;break;case Zo.rotation:d=p.QuaternionKeyframeTrack;break;default:d=p.VectorKeyframeTrack}var m=n.name?n.name:n.uuid,v=void 0!==h.interpolation?Bo[h.interpolation]:p.InterpolateLinear,g=[];Zo[f.path]===Zo.weights?n.traverse((function(t){t.morphTargetInfluences&&g.push(t.name?t.name:t.uuid)})):g.push(m);var E=c.array;if(c.normalized){for(var I=jo(E.constructor),T=new Float32Array(E.length),y=0,C=E.length;y<C;y++)T[y]=E[y]*I;E=T}for(var x=0,A=g.length;x<A;x++){var F=new d(g[x]+"."+Zo[f.path],l.array,E,v);"CUBICSPLINE"===h.interpolation&&(F.createInterpolant=function(t){return new(this instanceof p.QuaternionKeyframeTrack?_o:Ao)(this.times,this.values,this.getValueSize()/3,t)},F.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(F)}},c=0,h=r.length;c<h;c++)l(c);var f=e.name?e.name:"animation_"+t;return new p.AnimationClip(f,void 0,u)}))}},{key:"createNodeMesh",value:function(t){var e=this.json,n=this,r=e.nodes[t];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then((function(t){var e=n._getNodeRef(n.meshCache,r.mesh,t);return void 0!==r.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,n=r.weights.length;e<n;e++)t.morphTargetInfluences[e]=r.weights[e]})),e}))}},{key:"loadNode",value:function(t){var e=this.json,n=this.extensions,r=this,i=e.nodes[t],a=i.name?r.createUniqueName(i.name):"";return function(){var e=[],n=r._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return n&&e.push(n),void 0!==i.camera&&e.push(r.getDependency("camera",i.camera).then((function(t){return r._getNodeRef(r.cameraCache,i.camera,t)}))),r._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){var s;if((s=!0===i.isBone?new p.Bone:e.length>1?new p.Group:1===e.length?e[0]:new p.Object3D)!==e[0])for(var o=0,u=e.length;o<u;o++)s.add(e[o]);if(i.name&&(s.userData.name=i.name,s.name=a),Ho(s,i),i.extensions&&zo(n,s,i),void 0!==i.matrix){var l=new p.Matrix4;l.fromArray(i.matrix),s.applyMatrix4(l)}else void 0!==i.translation&&s.position.fromArray(i.translation),void 0!==i.rotation&&s.quaternion.fromArray(i.rotation),void 0!==i.scale&&s.scale.fromArray(i.scale);return r.associations.has(s)||r.associations.set(s,{}),r.associations.get(s).nodes=t,s}))}},{key:"loadScene",value:function(t){var e=this.json,n=this.extensions,r=this.json.scenes[t],i=this,a=new p.Group;r.name&&(a.name=i.createUniqueName(r.name)),Ho(a,r),r.extensions&&zo(n,a,r);for(var s=r.nodes||[],o=[],u=0,l=s.length;u<l;u++)o.push(Ko(s[u],a,e,i));return Promise.all(o).then((function(){return i.associations=function(t){var e,n=new Map,r=(0,Y.Z)(i.associations);try{for(r.s();!(e=r.n()).done;){var a=(0,$s.Z)(e.value,2),s=a[0],o=a[1];(s instanceof p.Material||s instanceof p.Texture)&&n.set(s,o)}}catch(u){r.e(u)}finally{r.f()}return t.traverse((function(t){var e=i.associations.get(t);null!=e&&n.set(t,e)})),n}(a),a}))}}]),t}();function Ko(t,e,n,r){var i=n.nodes[t];return r.getDependency("node",t).then((function(t){return void 0===i.skin?t:r.getDependency("skin",i.skin).then((function(t){for(var n=[],i=0,a=(e=t).joints.length;i<a;i++)n.push(r.getDependency("node",e.joints[i]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(t.isMesh){for(var r=[],i=[],a=0,s=n.length;a<s;a++){var o=n[a];if(o){r.push(o);var u=new p.Matrix4;void 0!==e.inverseBindMatrices&&u.fromArray(e.inverseBindMatrices.array,16*a),i.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[a])}t.bind(new p.Skeleton(r,i),t.matrixWorld)}})),t}));var e})).then((function(t){e.add(t);var a=[];if(i.children)for(var s=i.children,o=0,u=s.length;o<u;o++){var l=s[o];a.push(Ko(l,t,n,r))}return Promise.all(a)}))}function Jo(t,e,n){var r=e.attributes,i=[];function a(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(var s in r){var o=Uo[s]||s.toLowerCase();o in t.attributes||i.push(a(r[s],o))}if(void 0!==e.indices&&!t.index){var u=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(u)}return Ho(t,e),function(t,e,n){var r=e.attributes,i=new p.Box3;if(void 0!==r.POSITION){var a=n.json.accessors[r.POSITION],s=a.min,o=a.max;if(void 0!==s&&void 0!==o){if(i.set(new p.Vector3(s[0],s[1],s[2]),new p.Vector3(o[0],o[1],o[2])),a.normalized){var u=jo(Lo[a.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}var l=e.targets;if(void 0!==l){for(var c=new p.Vector3,h=new p.Vector3,f=0,d=l.length;f<d;f++){var m=l[f];if(void 0!==m.POSITION){var v=n.json.accessors[m.POSITION],g=v.min,E=v.max;if(void 0!==g&&void 0!==E){if(h.setX(Math.max(Math.abs(g[0]),Math.abs(E[0]))),h.setY(Math.max(Math.abs(g[1]),Math.abs(E[1]))),h.setZ(Math.max(Math.abs(g[2]),Math.abs(E[2]))),v.normalized){var I=jo(Lo[v.componentType]);h.multiplyScalar(I)}c.max(h)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(c)}t.boundingBox=i;var T=new p.Sphere;i.getCenter(T.center),T.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=T}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,e,n),Promise.all(i).then((function(){return void 0!==e.targets?function(t,e,n){for(var r=!1,i=!1,a=0,s=e.length;a<s;a++){var o=e[a];if(void 0!==o.POSITION&&(r=!0),void 0!==o.NORMAL&&(i=!0),r&&i)break}if(!r&&!i)return Promise.resolve(t);for(var u=[],l=[],c=0,h=e.length;c<h;c++){var f=e[c];if(r){var d=void 0!==f.POSITION?n.getDependency("accessor",f.POSITION):t.attributes.position;u.push(d)}if(i){var p=void 0!==f.NORMAL?n.getDependency("accessor",f.NORMAL):t.attributes.normal;l.push(p)}}return Promise.all([Promise.all(u),Promise.all(l)]).then((function(e){var n=e[0],a=e[1];return r&&(t.morphAttributes.position=n),i&&(t.morphAttributes.normal=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function $o(t,e){var n=t.getIndex();if(null===n){var r=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var a=0;a<i.count;a++)r.push(a);t.setIndex(r),n=t.getIndex()}var s=n.count-2,o=[];if(e===p.TriangleFanDrawMode)for(var u=1;u<=s;u++)o.push(n.getX(0)),o.push(n.getX(u)),o.push(n.getX(u+1));else for(var l=0;l<s;l++)l%2===0?(o.push(n.getX(l)),o.push(n.getX(l+1)),o.push(n.getX(l+2))):(o.push(n.getX(l+2)),o.push(n.getX(l+1)),o.push(n.getX(l)));o.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=t.clone();return c.setIndex(o),c}var tu=function(){function t(){(0,o.Z)(this,t),this.pluginCallbacks=[],this.register((function(t){return new Ru(t)})),this.register((function(t){return new Ou(t)})),this.register((function(t){return new wu(t)})),this.register((function(t){return new Nu(t)})),this.register((function(t){return new Lu(t)})),this.register((function(t){return new Mu(t)}))}return(0,u.Z)(t,[{key:"register",value:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}},{key:"unregister",value:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}},{key:"parse",value:function(t,e,n,r){"object"===typeof n&&(console.warn("THREE.GLTFExporter: parse() expects options as the fourth argument now."),r=n);for(var i=new Su,a=[],s=0,o=this.pluginCallbacks.length;s<o;s++)a.push(this.pluginCallbacks[s](i));i.setPlugins(a),i.write(t,e,r).catch(n)}},{key:"parseAsync",value:function(t,e){var n=this;return new Promise((function(r,i){n.parse(t,r,i,e)}))}}]),t}(),eu=0,nu=1,ru=2,iu=3,au=4,su=5121,ou=5123,uu=5126,lu=5125,cu=34962,hu=34963,fu=9728,du=9729,pu=9984,mu=9985,vu=9986,gu=9987,Eu=33071,Iu=33648,Tu=10497,yu={};yu[p.NearestFilter]=fu,yu[p.NearestMipmapNearestFilter]=pu,yu[p.NearestMipmapLinearFilter]=vu,yu[p.LinearFilter]=du,yu[p.LinearMipmapNearestFilter]=mu,yu[p.LinearMipmapLinearFilter]=gu,yu[p.ClampToEdgeWrapping]=Eu,yu[p.RepeatWrapping]=Tu,yu[p.MirroredRepeatWrapping]=Iu;var Cu={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function xu(t,e){return t.length===e.length&&t.every((function(t,n){return t===e[n]}))}function Au(t){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(t).buffer;for(var e=new Uint8Array(new ArrayBuffer(t.length)),n=0,r=t.length;n<r;n++){var i=t.charCodeAt(n);e[n]=i>255?32:i}return e.buffer}function Fu(t){return 4*Math.ceil(t/4)}function _u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Fu(t.byteLength);if(n!==t.byteLength){var r=new Uint8Array(n);if(r.set(new Uint8Array(t)),0!==e)for(var i=t.byteLength;i<n;i++)r[i]=e;return r.buffer}return t}var Pu=null,Su=function(){function t(){(0,o.Z)(this,t),this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}return(0,u.Z)(t,[{key:"setPlugins",value:function(t){this.plugins=t}},{key:"write",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r){var i,s,o,u,l,c,h,f;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),t.next=5,Promise.all(this.pending);case 5:s=(i=this).buffers,o=i.json,r=i.options,u=i.extensionsUsed,l=new Blob(s,{type:"application/octet-stream"}),(c=Object.keys(u)).length>0&&(o.extensionsUsed=c),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=l.size),!0===r.binary?((h=new window.FileReader).readAsArrayBuffer(l),h.onloadend=function(){var t=_u(h.result),e=new DataView(new ArrayBuffer(8));e.setUint32(0,t.byteLength,!0),e.setUint32(4,5130562,!0);var r=_u(Au(JSON.stringify(o)),32),i=new DataView(new ArrayBuffer(8));i.setUint32(0,r.byteLength,!0),i.setUint32(4,1313821514,!0);var a=new ArrayBuffer(12),s=new DataView(a);s.setUint32(0,1179937895,!0),s.setUint32(4,2,!0);var u=12+i.byteLength+r.byteLength+e.byteLength+t.byteLength;s.setUint32(8,u,!0);var l=new Blob([a,i,r,e,t],{type:"application/octet-stream"}),c=new window.FileReader;c.readAsArrayBuffer(l),c.onloadend=function(){n(c.result)}}):o.buffers&&o.buffers.length>0?((f=new window.FileReader).readAsDataURL(l),f.onloadend=function(){var t=f.result;o.buffers[0].uri=t,n(o)}):n(o);case 15:case"end":return t.stop()}}),t,this)})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"serializeUserData",value:function(t,e){if(0!==Object.keys(t.userData).length){var n=this.options,r=this.extensionsUsed;try{var i=JSON.parse(JSON.stringify(t.userData));if(n.includeCustomExtensions&&i.gltfExtensions){for(var a in void 0===e.extensions&&(e.extensions={}),i.gltfExtensions)e.extensions[a]=i.gltfExtensions[a],r[a]=!0;delete i.gltfExtensions}Object.keys(i).length>0&&(e.extras=i)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+s.message)}}}},{key:"getUID",value:function(t){return this.uids.has(t)||this.uids.set(t,this.uid++),this.uids.get(t)}},{key:"isNormalizedNormalAttribute",value:function(t){if(this.cache.attributesNormalized.has(t))return!1;for(var e=new p.Vector3,n=0,r=t.count;n<r;n++)if(Math.abs(e.fromBufferAttribute(t,n).length()-1)>5e-4)return!1;return!0}},{key:"createNormalizedNormalAttribute",value:function(t){var e=this.cache;if(e.attributesNormalized.has(t))return e.attributesNormalized.get(t);for(var n=t.clone(),r=new p.Vector3,i=0,a=n.count;i<a;i++)r.fromBufferAttribute(n,i),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),n.setXYZ(i,r.x,r.y,r.z);return e.attributesNormalized.set(t,n),n}},{key:"applyTextureTransform",value:function(t,e){var n=!1,r={};0===e.offset.x&&0===e.offset.y||(r.offset=e.offset.toArray(),n=!0),0!==e.rotation&&(r.rotation=e.rotation,n=!0),1===e.repeat.x&&1===e.repeat.y||(r.scale=e.repeat.toArray(),n=!0),n&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}},{key:"processBuffer",value:function(t){var e=this.json,n=this.buffers;return e.buffers||(e.buffers=[{byteLength:0}]),n.push(t),0}},{key:"processBufferView",value:function(t,e,n,r,i){var a,s=this.json;s.bufferViews||(s.bufferViews=[]),a=e===su?1:e===ou?2:4;for(var o=Fu(r*t.itemSize*a),u=new DataView(new ArrayBuffer(o)),l=0,c=n;c<n+r;c++)for(var h=0;h<t.itemSize;h++){var f=void 0;t.itemSize>4?f=t.array[c*t.itemSize+h]:0===h?f=t.getX(c):1===h?f=t.getY(c):2===h?f=t.getZ(c):3===h&&(f=t.getW(c)),e===uu?u.setFloat32(l,f,!0):e===lu?u.setUint32(l,f,!0):e===ou?u.setUint16(l,f,!0):e===su&&u.setUint8(l,f),l+=a}var d={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:o};return void 0!==i&&(d.target=i),i===cu&&(d.byteStride=t.itemSize*a),this.byteOffset+=o,s.bufferViews.push(d),{id:s.bufferViews.length-1,byteLength:0}}},{key:"processBufferViewImage",value:function(t){var e=this,n=e.json;return n.bufferViews||(n.bufferViews=[]),new Promise((function(r){var i=new window.FileReader;i.readAsArrayBuffer(t),i.onloadend=function(){var t=_u(i.result),a={buffer:e.processBuffer(t),byteOffset:e.byteOffset,byteLength:t.byteLength};e.byteOffset+=t.byteLength,r(n.bufferViews.push(a)-1)}}))}},{key:"processAccessor",value:function(t,e,n,r){var i,a=this.options,s=this.json;if(t.array.constructor===Float32Array)i=uu;else if(t.array.constructor===Uint32Array)i=lu;else if(t.array.constructor===Uint16Array)i=ou;else{if(t.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");i=su}if(void 0===n&&(n=0),void 0===r&&(r=t.count),a.truncateDrawRange&&void 0!==e&&null===e.index){var o=n+r,u=e.drawRange.count===1/0?t.count:e.drawRange.start+e.drawRange.count;n=Math.max(n,e.drawRange.start),(r=Math.min(o,u)-n)<0&&(r=0)}if(0===r)return null;var l,c=function(t,e,n){for(var r={min:new Array(t.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(t.itemSize).fill(Number.NEGATIVE_INFINITY)},i=e;i<e+n;i++)for(var a=0;a<t.itemSize;a++){var s=void 0;t.itemSize>4?s=t.array[i*t.itemSize+a]:0===a?s=t.getX(i):1===a?s=t.getY(i):2===a?s=t.getZ(i):3===a&&(s=t.getW(i)),r.min[a]=Math.min(r.min[a],s),r.max[a]=Math.max(r.max[a],s)}return r}(t,n,r);void 0!==e&&(l=t===e.index?hu:cu);var h=this.processBufferView(t,i,n,r,l),f={bufferView:h.id,byteOffset:h.byteOffset,componentType:i,count:r,max:c.max,min:c.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[t.itemSize]};return!0===t.normalized&&(f.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(f)-1}},{key:"processImage",value:function(t,e,n){var r=this,i=r.cache,a=r.json,s=r.options,o=r.pending;i.images.has(t)||i.images.set(t,{});var u=i.images.get(t),l=e===p.RGBAFormat?"image/png":"image/jpeg",c=l+":flipY/"+n.toString();if(void 0!==u[c])return u[c];a.images||(a.images=[]);var h={mimeType:l};if(s.embedImages){var f=Pu=Pu||document.createElement("canvas");f.width=Math.min(t.width,s.maxTextureSize),f.height=Math.min(t.height,s.maxTextureSize);var d=f.getContext("2d");if(!0===n&&(d.translate(0,f.height),d.scale(1,-1)),"undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap)d.drawImage(t,0,0,f.width,f.height);else{e!==p.RGBAFormat&&e!==p.RGBFormat&&console.error("GLTFExporter: Only RGB and RGBA formats are supported."),(t.width>s.maxTextureSize||t.height>s.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);var m=new Uint8ClampedArray(t.height*t.width*4);if(e===p.RGBAFormat)for(var v=0;v<m.length;v+=4)m[v+0]=t.data[v+0],m[v+1]=t.data[v+1],m[v+2]=t.data[v+2],m[v+3]=t.data[v+3];else for(var g=0,E=0;g<m.length;g+=4,E+=3)m[g+0]=t.data[E+0],m[g+1]=t.data[E+1],m[g+2]=t.data[E+2],m[g+3]=255;d.putImageData(new ImageData(m,t.width,t.height),0,0)}!0===s.binary?o.push(new Promise((function(t){f.toBlob((function(e){r.processBufferViewImage(e).then((function(e){h.bufferView=e,t()}))}),l)}))):h.uri=f.toDataURL(l)}else h.uri=t.src;var I=a.images.push(h)-1;return u[c]=I,I}},{key:"processSampler",value:function(t){var e=this.json;e.samplers||(e.samplers=[]);var n={magFilter:yu[t.magFilter],minFilter:yu[t.minFilter],wrapS:yu[t.wrapS],wrapT:yu[t.wrapT]};return e.samplers.push(n)-1}},{key:"processTexture",value:function(t){var e=this.cache,n=this.json;if(e.textures.has(t))return e.textures.get(t);n.textures||(n.textures=[]);var r={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY)};t.name&&(r.name=t.name),this._invokeAll((function(e){e.writeTexture&&e.writeTexture(t,r)}));var i=n.textures.push(r)-1;return e.textures.set(t,i),i}},{key:"processMaterial",value:function(t){var e=this.cache,n=this.json;if(e.materials.has(t))return e.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);var r={pbrMetallicRoughness:{}};!0!==t.isMeshStandardMaterial&&!0!==t.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var i=t.color.toArray().concat([t.opacity]);if(xu(i,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=i),t.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=t.metalness,r.pbrMetallicRoughness.roughnessFactor=t.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),t.metalnessMap||t.roughnessMap)if(t.metalnessMap===t.roughnessMap){var a={index:this.processTexture(t.metalnessMap)};this.applyTextureTransform(a,t.metalnessMap),r.pbrMetallicRoughness.metallicRoughnessTexture=a}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(t.map){var s={index:this.processTexture(t.map)};this.applyTextureTransform(s,t.map),r.pbrMetallicRoughness.baseColorTexture=s}if(t.emissive){var o=t.emissive.clone().multiplyScalar(t.emissiveIntensity),u=Math.max(o.r,o.g,o.b);if(u>1&&(o.multiplyScalar(1/u),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),u>0&&(r.emissiveFactor=o.toArray()),t.emissiveMap){var l={index:this.processTexture(t.emissiveMap)};this.applyTextureTransform(l,t.emissiveMap),r.emissiveTexture=l}}if(t.normalMap){var c={index:this.processTexture(t.normalMap)};t.normalScale&&1!==t.normalScale.x&&(c.scale=t.normalScale.x),this.applyTextureTransform(c,t.normalMap),r.normalTexture=c}if(t.aoMap){var h={index:this.processTexture(t.aoMap),texCoord:1};1!==t.aoMapIntensity&&(h.strength=t.aoMapIntensity),this.applyTextureTransform(h,t.aoMap),r.occlusionTexture=h}t.transparent?r.alphaMode="BLEND":t.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=t.alphaTest),t.side===p.DoubleSide&&(r.doubleSided=!0),""!==t.name&&(r.name=t.name),this.serializeUserData(t,r),this._invokeAll((function(e){e.writeMaterial&&e.writeMaterial(t,r)}));var f=n.materials.push(r)-1;return e.materials.set(t,f),f}},{key:"processMesh",value:function(t){var e=this.cache,n=this.json,r=[t.geometry.uuid];if(Array.isArray(t.material))for(var i=0,a=t.material.length;i<a;i++)r.push(t.material[i].uuid);else r.push(t.material.uuid);var s=r.join(":");if(e.meshes.has(s))return e.meshes.get(s);var o,u=t.geometry;if(o=t.isLineSegments?nu:t.isLineLoop?ru:t.isLine?iu:t.isPoints?eu:t.material.wireframe?nu:au,!0!==u.isBufferGeometry)throw new Error("THREE.GLTFExporter: Geometry is not of type THREE.BufferGeometry.");var l={},c={},h=[],f=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=u.getAttribute("normal");void 0===m||this.isNormalizedNormalAttribute(m)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),u.setAttribute("normal",this.createNormalizedNormalAttribute(m)));var v=null;for(var g in u.attributes)if("morph"!==g.substr(0,5)){var E=u.attributes[g];g=d[g]||g.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(g)||(g="_"+g),e.attributes.has(this.getUID(E)))c[g]=e.attributes.get(this.getUID(E));else{v=null;var I=E.array;"JOINTS_0"!==g||I instanceof Uint16Array||I instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new p.BufferAttribute(new Uint16Array(I),E.itemSize,E.normalized));var T=this.processAccessor(v||E,u);null!==T&&(c[g]=T,e.attributes.set(this.getUID(E),T))}}if(void 0!==m&&u.setAttribute("normal",m),0===Object.keys(c).length)return null;if(void 0!==t.morphTargetInfluences&&t.morphTargetInfluences.length>0){var y=[],C=[],x={};if(void 0!==t.morphTargetDictionary)for(var A in t.morphTargetDictionary)x[t.morphTargetDictionary[A]]=A;for(var F=0;F<t.morphTargetInfluences.length;++F){var _={},P=!1;for(var S in u.morphAttributes)if("position"===S||"normal"===S){var R=u.morphAttributes[S][F],O=S.toUpperCase(),w=u.attributes[S];if(e.attributes.has(this.getUID(R)))_[O]=e.attributes.get(this.getUID(R));else{var M=R.clone();if(!u.morphTargetsRelative)for(var N=0,L=R.count;N<L;N++)M.setXYZ(N,R.getX(N)-w.getX(N),R.getY(N)-w.getY(N),R.getZ(N)-w.getZ(N));_[O]=this.processAccessor(M,u),e.attributes.set(this.getUID(w),_[O])}}else P||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),P=!0);f.push(_),y.push(t.morphTargetInfluences[F]),void 0!==t.morphTargetDictionary&&C.push(x[F])}l.weights=y,C.length>0&&(l.extras={},l.extras.targetNames=C)}var b=Array.isArray(t.material);if(b&&0===u.groups.length)return null;for(var k=b?t.material:[t.material],D=b?u.groups:[{materialIndex:0,start:void 0,count:void 0}],U=0,Z=D.length;U<Z;U++){var B={mode:o,attributes:c};if(this.serializeUserData(u,B),f.length>0&&(B.targets=f),null!==u.index){var G=this.getUID(u.index);void 0===D[U].start&&void 0===D[U].count||(G+=":"+D[U].start+":"+D[U].count),e.attributes.has(G)?B.indices=e.attributes.get(G):(B.indices=this.processAccessor(u.index,u,D[U].start,D[U].count),e.attributes.set(G,B.indices)),null===B.indices&&delete B.indices}var Y=this.processMaterial(k[D[U].materialIndex]);null!==Y&&(B.material=Y),h.push(B)}l.primitives=h,n.meshes||(n.meshes=[]),this._invokeAll((function(e){e.writeMesh&&e.writeMesh(t,l)}));var V=n.meshes.push(l)-1;return e.meshes.set(s,V),V}},{key:"processCamera",value:function(t){var e=this.json;e.cameras||(e.cameras=[]);var n=t.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*t.right,ymag:2*t.top,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:r.perspective={aspectRatio:t.aspect,yfov:p.MathUtils.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},""!==t.name&&(r.name=t.type),e.cameras.push(r)-1}},{key:"processAnimation",value:function(t,e){var n=this.json,r=this.nodeMap;n.animations||(n.animations=[]);for(var i=(t=tu.Utils.mergeMorphTargetTracks(t.clone(),e)).tracks,a=[],s=[],o=0;o<i.length;++o){var u=i[o],l=p.PropertyBinding.parseTrackName(u.name),c=p.PropertyBinding.findNode(e,l.nodeName),h=Cu[l.propertyName];if("bones"===l.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(l.objectIndex):void 0),!c||!h)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',u.name),null;var f=u.values.length/u.times.length;h===Cu.morphTargetInfluences&&(f/=c.morphTargetInfluences.length);var d=void 0;!0===u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(d="CUBICSPLINE",f/=3):d=u.getInterpolation()===p.InterpolateDiscrete?"STEP":"LINEAR",s.push({input:this.processAccessor(new p.BufferAttribute(u.times,1)),output:this.processAccessor(new p.BufferAttribute(u.values,f)),interpolation:d}),a.push({sampler:s.length-1,target:{node:r.get(c),path:h}})}return n.animations.push({name:t.name||"clip_"+n.animations.length,samplers:s,channels:a}),n.animations.length-1}},{key:"processSkin",value:function(t){var e=this.json,n=this.nodeMap,r=e.nodes[n.get(t)],i=t.skeleton;if(void 0===i)return null;var a=t.skeleton.bones[0];if(void 0===a)return null;for(var s=[],o=new Float32Array(16*i.bones.length),u=new p.Matrix4,l=0;l<i.bones.length;++l)s.push(n.get(i.bones[l])),u.copy(i.boneInverses[l]),u.multiply(t.bindMatrix).toArray(o,16*l);return void 0===e.skins&&(e.skins=[]),e.skins.push({inverseBindMatrices:this.processAccessor(new p.BufferAttribute(o,16)),joints:s,skeleton:n.get(a)}),r.skin=e.skins.length-1}},{key:"processNode",value:function(t){var e=this.json,n=this.options,r=this.nodeMap;e.nodes||(e.nodes=[]);var i={};if(n.trs){var a=t.quaternion.toArray(),s=t.position.toArray(),o=t.scale.toArray();xu(a,[0,0,0,1])||(i.rotation=a),xu(s,[0,0,0])||(i.translation=s),xu(o,[1,1,1])||(i.scale=o)}else t.matrixAutoUpdate&&t.updateMatrix(),!1===xu(t.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(i.matrix=t.matrix.elements);if(""!==t.name&&(i.name=String(t.name)),this.serializeUserData(t,i),t.isMesh||t.isLine||t.isPoints){var u=this.processMesh(t);null!==u&&(i.mesh=u)}else t.isCamera&&(i.camera=this.processCamera(t));if(t.isSkinnedMesh&&this.skins.push(t),t.children.length>0){for(var l=[],c=0,h=t.children.length;c<h;c++){var f=t.children[c];if(f.visible||!1===n.onlyVisible){var d=this.processNode(f);null!==d&&l.push(d)}}l.length>0&&(i.children=l)}this._invokeAll((function(e){e.writeNode&&e.writeNode(t,i)}));var p=e.nodes.push(i)-1;return r.set(t,p),p}},{key:"processScene",value:function(t){var e=this.json,n=this.options;e.scenes||(e.scenes=[],e.scene=0);var r={};""!==t.name&&(r.name=t.name),e.scenes.push(r);for(var i=[],a=0,s=t.children.length;a<s;a++){var o=t.children[a];if(o.visible||!1===n.onlyVisible){var u=this.processNode(o);null!==u&&i.push(u)}}i.length>0&&(r.nodes=i),this.serializeUserData(t,r)}},{key:"processObjects",value:function(t){var e=new p.Scene;e.name="AuxScene";for(var n=0;n<t.length;n++)e.children.push(t[n]);this.processScene(e)}},{key:"processInput",value:function(t){var e=this.options;t=t instanceof Array?t:[t],this._invokeAll((function(e){e.beforeParse&&e.beforeParse(t)}));for(var n=[],r=0;r<t.length;r++)t[r]instanceof p.Scene?this.processScene(t[r]):n.push(t[r]);n.length>0&&this.processObjects(n);for(var i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(var a=0;a<e.animations.length;++a)this.processAnimation(e.animations[a],t[0]);this._invokeAll((function(e){e.afterParse&&e.afterParse(t)}))}},{key:"_invokeAll",value:function(t){for(var e=0,n=this.plugins.length;e<n;e++)t(this.plugins[e])}}]),t}(),Ru=function(){function t(e){(0,o.Z)(this,t),this.writer=e,this.name="KHR_lights_punctual"}return(0,u.Z)(t,[{key:"writeNode",value:function(t,e){if(t.isLight)if(t.isDirectionalLight||t.isPointLight||t.isSpotLight){var n=this.writer,r=n.json,i=n.extensionsUsed,a={};t.name&&(a.name=t.name),a.color=t.color.toArray(),a.intensity=t.intensity,t.isDirectionalLight?a.type="directional":t.isPointLight?(a.type="point",t.distance>0&&(a.range=t.distance)):t.isSpotLight&&(a.type="spot",t.distance>0&&(a.range=t.distance),a.spot={},a.spot.innerConeAngle=(t.penumbra-1)*t.angle*-1,a.spot.outerConeAngle=t.angle),void 0!==t.decay&&2!==t.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!t.target||t.target.parent===t&&0===t.target.position.x&&0===t.target.position.y&&-1===t.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),i[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},i[this.name]=!0);var s=r.extensions[this.name].lights;s.push(a),e.extensions=e.extensions||{},e.extensions[this.name]={light:s.length-1}}else console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t)}}]),t}(),Ou=function(){function t(e){(0,o.Z)(this,t),this.writer=e,this.name="KHR_materials_unlit"}return(0,u.Z)(t,[{key:"writeMaterial",value:function(t,e){if(t.isMeshBasicMaterial){var n=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},n[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}}}]),t}(),wu=function(){function t(e){(0,o.Z)(this,t),this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}return(0,u.Z)(t,[{key:"writeMaterial",value:function(t,e){if(t.isGLTFSpecularGlossinessMaterial){var n=this.writer,r=n.extensionsUsed,i={};e.pbrMetallicRoughness.baseColorFactor&&(i.diffuseFactor=e.pbrMetallicRoughness.baseColorFactor);var a=[1,1,1];if(t.specular.toArray(a,0),i.specularFactor=a,i.glossinessFactor=t.glossiness,e.pbrMetallicRoughness.baseColorTexture&&(i.diffuseTexture=e.pbrMetallicRoughness.baseColorTexture),t.specularMap){var s={index:n.processTexture(t.specularMap)};n.applyTextureTransform(s,t.specularMap),i.specularGlossinessTexture=s}e.extensions=e.extensions||{},e.extensions[this.name]=i,r[this.name]=!0}}}]),t}(),Mu=function(){function t(e){(0,o.Z)(this,t),this.writer=e,this.name="KHR_materials_clearcoat"}return(0,u.Z)(t,[{key:"writeMaterial",value:function(t,e){if(t.isMeshPhysicalMaterial){var n=this.writer,r=n.extensionsUsed,i={};if(i.clearcoatFactor=t.clearcoat,t.clearcoatMap){var a={index:n.processTexture(t.clearcoatMap)};n.applyTextureTransform(a,t.clearcoatMap),i.clearcoatTexture=a}if(i.clearcoatRoughnessFactor=t.clearcoatRoughness,t.clearcoatRoughnessMap){var s={index:n.processTexture(t.clearcoatRoughnessMap)};n.applyTextureTransform(s,t.clearcoatRoughnessMap),i.clearcoatRoughnessTexture=s}if(t.clearcoatNormalMap){var o={index:n.processTexture(t.clearcoatNormalMap)};n.applyTextureTransform(o,t.clearcoatNormalMap),i.clearcoatNormalTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=i,r[this.name]=!0}}}]),t}(),Nu=function(){function t(e){(0,o.Z)(this,t),this.writer=e,this.name="KHR_materials_transmission"}return(0,u.Z)(t,[{key:"writeMaterial",value:function(t,e){if(t.isMeshPhysicalMaterial&&0!==t.transmission){var n=this.writer,r=n.extensionsUsed,i={};if(i.transmissionFactor=t.transmission,t.transmissionMap){var a={index:n.processTexture(t.transmissionMap)};n.applyTextureTransform(a,t.transmissionMap),i.transmissionTexture=a}e.extensions=e.extensions||{},e.extensions[this.name]=i,r[this.name]=!0}}}]),t}(),Lu=function(){function t(e){(0,o.Z)(this,t),this.writer=e,this.name="KHR_materials_volume"}return(0,u.Z)(t,[{key:"writeMaterial",value:function(t,e){if(t.isMeshPhysicalMaterial&&0!==t.transmission){var n=this.writer,r=n.extensionsUsed,i={};if(i.thicknessFactor=t.thickness,t.thicknessMap){var a={index:n.processTexture(t.thicknessMap)};n.applyTextureTransform(a,t.thicknessMap),i.thicknessTexture=a}i.attenuationDistance=t.attenuationDistance,i.attenuationColor=t.attenuationColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=i,r[this.name]=!0}}}]),t}();tu.Utils={insertKeyframe:function(t,e){var n,r=.001,i=t.getValueSize(),a=new t.TimeBufferType(t.times.length+1),s=new t.ValueBufferType(t.values.length+i),o=t.createInterpolant(new t.ValueBufferType(i));if(0===t.times.length){a[0]=e;for(var u=0;u<i;u++)s[u]=0;n=0}else if(e<t.times[0]){if(Math.abs(t.times[0]-e)<r)return 0;a[0]=e,a.set(t.times,1),s.set(o.evaluate(e),0),s.set(t.values,i),n=0}else if(e>t.times[t.times.length-1]){if(Math.abs(t.times[t.times.length-1]-e)<r)return t.times.length-1;a[a.length-1]=e,a.set(t.times,0),s.set(t.values,0),s.set(o.evaluate(e),t.values.length),n=a.length-1}else for(var l=0;l<t.times.length;l++){if(Math.abs(t.times[l]-e)<r)return l;if(t.times[l]<e&&t.times[l+1]>e){a.set(t.times.slice(0,l+1),0),a[l+1]=e,a.set(t.times.slice(l+1),l+2),s.set(t.values.slice(0,(l+1)*i),0),s.set(o.evaluate(e),(l+1)*i),s.set(t.values.slice((l+1)*i),(l+2)*i),n=l+1;break}}return t.times=a,t.values=s,n},mergeMorphTargetTracks:function(t,e){for(var n=[],r={},i=t.tracks,a=0;a<i.length;++a){var s=i[a],o=p.PropertyBinding.parseTrackName(s.name),u=p.PropertyBinding.findNode(e,o.nodeName);if("morphTargetInfluences"===o.propertyName&&void 0!==o.propertyIndex){if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(s=s.clone()).setInterpolation(p.InterpolateLinear)}var l=u.morphTargetInfluences.length,c=u.morphTargetDictionary[o.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);var h=void 0;if(void 0!==r[u.uuid]){var f=s.createInterpolant(new s.ValueBufferType(1));h=r[u.uuid];for(var d=0;d<h.times.length;d++)h.values[d*l+c]=f.evaluate(h.times[d]);for(var m=0;m<s.times.length;m++){var v=this.insertKeyframe(h,s.times[m]);h.values[v*l+c]=s.values[m]}}else{for(var g=new((h=s.clone()).ValueBufferType)(l*h.times.length),E=0;E<h.times.length;E++)g[E*l+c]=h.values[E];h.name=(o.nodeName||"")+".morphTargetInfluences",h.values=g,r[u.uuid]=h,n.push(h)}}else n.push(s)}return t.tracks=n,t}};var bu=function(){function t(){(0,o.Z)(this,t),this.list=[],this.unitsFactor={MILLI:.001,CENTI:.01,DECI:.1},this.loaderError="Loader must be defined!"}return(0,u.Z)(t,[{key:"dispose",value:function(){this.list=null,this.unitsFactor=null}},{key:"getAbsoluteElevation",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u,l,c,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.loader){t.next=2;break}throw new Error(this.loaderError);case 2:return t.next=4,this.getCurrentStoreys(e);case 4:return t.next=6,this.getUnitsFactor(e);case 6:return n=t.sent,t.next=9,this.getSiteCoords(e);case 9:return r=t.sent,t.next=12,this.getTransformHeight(e);case 12:for(i=t.sent,s=this.list[e],o={},u=0;u<s.length;u++)l=s[u],c=l.Elevation.value,h=this.getStoreyName(l),o[h]=(c+r[2])*n+i;return t.abrupt("return",o);case 17:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getCurrentStoreys",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.list[e]){t.next=4;break}return t.next=3,this.loader.ifcManager.getAllItemsOfType(e,C.IFCBUILDINGSTOREY,!0);case 3:this.list[e]=t.sent;case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getSiteCoords",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.getBuilding(e);case 3:return n=t.sent,r=n.ObjectPlacement.PlacementRelTo.RelativePlacement.Location,t.abrupt("return",r.Coordinates.map((function(t){return t.value})));case 8:return t.prev=8,t.t0=t.catch(0),t.abrupt("return",[0,0,0]);case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getBuilding",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loader.ifcManager.getAllItemsOfType(e,C.IFCBUILDING,!1);case 2:return n=t.sent,r=n[0],t.abrupt("return",this.loader.ifcManager.getItemProperties(e,r,!0));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getTransformHeight",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loader.ifcManager.ifcAPI.GetCoordinationMatrix(e);case 2:return n=t.sent,t.abrupt("return",n[13]);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getStoreyName",value:function(t){return t.Name?t.Name.value:t.LongName?t.LongName.value:t.GlobalId}},{key:"getUnitsFactor",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u,l;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loader.ifcManager.getAllItemsOfType(e,C.IFCUNITASSIGNMENT,!1);case 2:return r=t.sent,i=r[0],t.next=6,this.loader.ifcManager.getItemProperties(e,i);case 6:return s=t.sent,o=s.Units[0].value,t.next=10,this.loader.ifcManager.getItemProperties(e,o);case 10:return u=t.sent,l=null===(n=u.Prefix)||void 0===n?void 0:n.value,t.abrupt("return",this.unitsFactor[l]||1);case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),ku=function(t){(0,f.Z)(n,t);var e=(0,d.Z)(n);function n(t,r){var i;return(0,o.Z)(this,n),(i=e.call(this,t)).context=t,i.IFC=r,i.GLTFModels={},i.loader=new to,i.exporter=new tu,i.tempIfcLoader=null,i.allFloors="allFloors",i.allCategories="allCategories",i.stories=new bu,i.options={trs:!1,onlyVisible:!1,truncateDrawRange:!0,binary:!0,maxTextureSize:0},i.setupGeometryIndexDraco=function(t,e){for(var n=0,r=[],a=0;a<t.length;a++)r.push(n),n+=t[a].geometry.attributes._expressid.count;var s=t.map((function(t,e){var n=t.geometry.index;return n?new Uint32Array(n.array).map((function(t){return t+r[e]})):[]}));e.setIndex(i.flattenIndices(s))},i.flattenIndices=function(t){for(var e=[],n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)e.push(t[n][r]);return e},i}return(0,u.Z)(n,[{key:"dispose",value:function(){this.loader=null,this.exporter=null,Object.values(this.GLTFModels).forEach((function(t){t.removeFromParent(),t.children.forEach((function(t){return I(t)}))})),this.GLTFModels=null,this.stories.dispose(),this.stories=null}},{key:"load",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loader.loadAsync(e);case 2:return n=t.sent,r=n.scene,i=this.getModelID(),this.GLTFModels[i]=r,this.context.getScene().add(r),t.abrupt("return",r);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadModel",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getGltfMesh(e);case 2:return(n=t.sent).geometry.computeBoundsTree(),n.modelID=this.getModelID(),this.context.getScene().add(n),this.setupMeshAsModel(n),t.abrupt("return",n);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"exportIfcFileAsGltf",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u,l,c,h,f,d,p,m,v,g,E;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.ifcFileUrl,r=e.getProperties,i=e.categories,s=e.splitByFloors,o=e.maxJSONSize,u=e.onProgress,l=e.coordinationMatrix,t.next=3,this.setupIfcLoader(l);case 3:return c=t.sent,h=c.loader,f=c.manager,t.next=8,h.loadAsync(n,(function(t){u&&u(t.loaded,t.total,"IFC")}));case 8:return d=t.sent,p={gltf:{},json:[],id:"",coordinationMatrix:[]},t.next=12,f.getAllItemsOfType(d.modelID,C.IFCPROJECT,!0);case 12:if((m=t.sent).length){t.next=15;break}throw new Error("No IfcProject instances were found in the IFC.");case 15:if(v=m[0].GlobalId){t.next=18;break}throw new Error("The found IfcProject does not have a GUID");case 18:return p.id=v.value,t.next=21,f.ifcAPI.GetCoordinationMatrix(0);case 21:if(p.coordinationMatrix=t.sent,g={},E=[],!s){t.next=29;break}return t.next=27,this.getIDsByFloor(h);case 27:g=t.sent,E=Object.keys(g);case 29:return t.next=31,this.getModels(i,p,f,s,E,g,d,u);case 31:if(!r){t.next=34;break}return t.next=34,this.getProperties(d,o,u,p);case 34:return t.next=36,h.ifcManager.dispose();case 36:return this.tempIfcLoader=null,t.abrupt("return",p);case 38:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getProperties",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r,i){var s,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=this.IFC.properties.loader,this.IFC.properties.loader=this.tempIfcLoader,t.next=4,this.IFC.properties.serializeAllProperties(e,n,(function(t,e){r&&r(t,e,"JSON")}));case 4:o=t.sent,i.json=o.map((function(t){return new File([t],"properties.json")})),this.IFC.properties.loader=s;case 7:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i){return t.apply(this,arguments)}}()},{key:"getModels",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r,i,s,o,u,l){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=5;break}return t.next=3,this.getModelsByCategory(e,n,r,i,s,o,u,l);case 3:t.next=7;break;case 5:return t.next=7,this.getModelsWithoutCategories(n,i,s,o,u);case 7:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i,a,s,o,u){return t.apply(this,arguments)}}()},{key:"setupIfcLoader",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new Mt,this.tempIfcLoader=n,r=this.IFC.loader.ifcManager.state,i=n.ifcManager,!r.wasmPath){t.next=7;break}return t.next=7,i.setWasmPath(r.wasmPath);case 7:if(!r.worker.active){t.next=10;break}return t.next=10,i.useWebWorkers(!0,r.worker.path);case 10:if(!r.webIfcSettings){t.next=13;break}return t.next=13,i.applyWebIfcConfig(r.webIfcSettings);case 13:return t.next=15,i.parser.setupOptionalCategories(this.IFC.loader.ifcManager.parser.optionalCategories);case 15:if(!e){t.next=18;break}return t.next=18,this.overrideCoordMatrix(i,e);case 18:return t.abrupt("return",{loader:n,manager:i});case 19:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"overrideCoordMatrix",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.setupCoordinationMatrix(n);case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getModelsByCategory",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r,i,s,o,u,l){var c,f,d,p,m,v=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:f=[],d=Object.keys(e),p=(0,a.Z)().mark((function t(p){var m,g,E,I,T,y,C,x,A,F,_;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m=d[p],g=e[m],n.gltf[m]||(n.gltf[m]={}),E=0;case 4:if(!(E<g.length)){t.next=12;break}return t.next=7,r.getAllItemsOfType(0,g[E],!1);case 7:I=t.sent,f.push.apply(f,(0,h.Z)(I));case 9:E++,t.next=4;break;case 12:T={},i?s.forEach((function(t){var e=o[t];T[t]=f.filter((function(t){return e.ids.has(t)}))})):T[v.allFloors]=f,y=Object.keys(T),C=0;case 16:if(!(C<y.length)){t.next=31;break}if(x=y[C],!(A=T[x]).length){t.next=27;break}return t.next=22,v.exportModelPartToGltf(u,A,!0);case 22:F=t.sent,_=(null===(c=o[x])||void 0===c?void 0:c.height)||0,n.gltf[m][x]={file:v.glTFToFile(F,"model-part.gltf"),height:_},t.next=28;break;case 27:n.gltf[m][x]={file:null,height:0};case 28:C++,t.next=16;break;case 31:l&&l(p,null===d||void 0===d?void 0:d.length,"GLTF"),f.length=0;case 33:case"end":return t.stop()}}),t)})),m=0;case 4:if(!(m<d.length)){t.next=9;break}return t.delegateYield(p(m),"t0",6);case 6:m++,t.next=4;break;case 9:case"end":return t.stop()}}),t)})));return function(e,n,r,i,a,s,o,u){return t.apply(this,arguments)}}()},{key:"getModelsWithoutCategories",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n,r,i,s){var o,u,l,c,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.gltf[this.allCategories]={},!n){t.next=15;break}o=0;case 3:if(!(o<r.length)){t.next=13;break}return u=r[o],l=Array.from(i[u].ids),t.next=8,this.exportModelPartToGltf(s,l,!0);case 8:c=t.sent,e.gltf[this.allCategories][u]={file:this.glTFToFile(c),height:i[u].height};case 10:o++,t.next=3;break;case 13:t.next=19;break;case 15:return t.next=17,this.exportMeshToGltf(s);case 17:h=t.sent,e.gltf[this.allCategories][this.allFloors]={file:this.glTFToFile(h),height:0};case 19:case"end":return t.stop()}}),t,this)})));return function(e,n,r,i,a){return t.apply(this,arguments)}}()},{key:"exportIfcAsGltf",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e,n){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.context.items.ifcModels.find((function(t){return t.modelID===e}))){t.next=3;break}throw new Error("The specified model does not exist!");case 3:return t.abrupt("return",n?this.exportModelPartToGltf(r,n):this.exportMeshToGltf(r));case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"exportMeshToGltf",value:function(t){var e=this;return new Promise((function(n){e.exporter.parse(t,(function(t){return n(t)}),e.options)}))}},{key:"exportModelPartToGltf",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],i=[],a=[],s=new Map,o="temp-gltf-subset",u=n?this.tempIfcLoader:this.IFC.loader;if(!u)throw new Error("IFCLoader could not be found!");var l=u.ifcManager.createSubset({modelID:t.modelID,ids:e,removePrevious:!0,customID:o});if(!l.geometry.index)throw new Error("Geometry must be indexed!");var c=l.geometry.attributes.position,h=l.geometry.attributes.expressID,f=l.geometry.groups.filter((function(t){return 0!==t.count})),d=[],m=l.material,v=0;f.forEach((function(t){d.push(m[t.materialIndex]),t.materialIndex=v++}));for(var g=0,E=0;E<l.geometry.index.count;E++){var I=l.geometry.index.array[E];s.has(I)||(r.push(c.array[3*I]),r.push(c.array[3*I+1]),r.push(c.array[3*I+2]),i.push(h.getX(I)),s.set(I,g++));var T=s.get(I);a.push(T)}var y=new p.BufferGeometry,C=new p.BufferAttribute(Float32Array.from(r),3),x=new p.BufferAttribute(Uint32Array.from(i),1);y.setAttribute("position",C),y.setAttribute("expressID",x),y.setIndex(a),y.groups=f,y.computeVertexNormals(),u.ifcManager.removeSubset(t.modelID,void 0,o);var A=new p.Mesh(y,d);return this.exportMeshToGltf(A)}},{key:"glTFToFile",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"model.gltf";return new File([new Blob([t])],e)}},{key:"getIDsByFloor",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i,s,o,u,l,c,h,f,d,p,m;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ifcManager.getSpatialStructure(0);case 2:return n=t.sent,r={},i=n.children[0].children[0].children,s=i.map((function(t){return t.expressID})),this.stories.loader=e,t.next=9,this.stories.getAbsoluteElevation(0);case 9:o=t.sent,u=Object.values(o),l=0;case 12:if(!(l<s.length)){t.next=26;break}return c=i[l],h=[],this.getChildrenRecursively(c,h),f=s[l],t.next=19,e.ifcManager.getItemProperties(0,f);case 19:d=t.sent,p=this.getStoreyName(d),m=u[l],r[p]={ids:new Set(h),height:m};case 23:l++,t.next=12;break;case 26:return t.abrupt("return",r);case 27:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getStoreyName",value:function(t){return t.Name?t.Name.value:t.LongName?t.LongName.value:t.GlobalId}},{key:"getChildrenRecursively",value:function(t,e){var n=this,r=t.children.map((function(t){return t.expressID}));e.push.apply(e,(0,h.Z)(r)),t.children.forEach((function(t){t.children.length&&n.getChildrenRecursively(t,e)}))}},{key:"getModelID",value:function(){var t=this.context.items.ifcModels;if(!t.length)return 0;var e=t.map((function(t){return t.modelID}));return Math.max.apply(Math,(0,h.Z)(e))+1}},{key:"getGltfMesh",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getMeshes(e);case 2:return n=t.sent,r=this.getGeometry(n),i=this.getMaterials(n),this.cleanUpLoadedInformation(n),t.abrupt("return",new p.Mesh(r,i));case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setupMeshAsModel",value:function(t){this.IFC.loader.ifcManager.state.models[t.modelID]={mesh:t};var e=this.context.items;e.ifcModels.push(t),e.pickableIfcModels.push(t)}},{key:"cleanUpLoadedInformation",value:function(t){t.forEach((function(t){t.geometry.attributes={},t.geometry.dispose(),t.material.dispose()}))}},{key:"getMaterials",value:function(t){var e=this.context.getClippingPlanes();return t.map((function(t){var n=t.material;return new p.MeshLambertMaterial({color:n.color,transparent:1!==n.opacity,opacity:n.opacity,side:2,clippingPlanes:e})}))}},{key:"getMeshes",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.load(e);case 2:return(n=t.sent).removeFromParent(),r=0!==n.children[0].children.length,i=r?n.children[0].children:[n.children[0]],t.abrupt("return",i);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getGeometry",value:function(t){var e=!(t.length<=1)&&t[0].geometry.attributes.position.array!==t[1].geometry.attributes.position.array,n=new p.BufferGeometry;return e?(this.setupGeometryAttributesDraco(n,t),this.setupGeometryIndexDraco(t,n)):(this.setupGeometryAttributes(n,t),this.setupGeometryIndex(t,n)),this.setupGroups(t,n),n}},{key:"setupGeometryAttributes",value:function(t,e){t.setAttribute("expressID",e[0].geometry.attributes._expressid),t.setAttribute("position",e[0].geometry.attributes.position),t.setAttribute("normal",e[0].geometry.attributes.normal)}},{key:"setupGeometryAttributesDraco",value:function(t,e){for(var n=0,r=0,i=0;i<e.length;i++){var a=e[i].geometry.attributes;n+=a._expressid.array.length,r+=a.position.array.length}var s=new Uint32Array(n),o=new Float32Array(r),u=new Float32Array(r);this.fillArray(e,"_expressid",s),this.fillArray(e,"position",o),this.fillArray(e,"normal",u),t.setAttribute("expressID",new p.BufferAttribute(s,1)),t.setAttribute("position",new p.BufferAttribute(o,3)),t.setAttribute("normal",new p.BufferAttribute(u,3))}},{key:"fillArray",value:function(t,e,n){for(var r=0,i=0;i<t.length;i++){var a=t[i];n.set(a.geometry.attributes[e].array,r),r+=a.geometry.attributes[e].array.length}}},{key:"setupGeometryIndex",value:function(t,e){for(var n=t.map((function(t){var e=t.geometry.index;return e?e.array:[]})),r=[],i=0;i<n.length;i++)for(var a=0;a<n[i].length;a++)r.push(n[i][a]);e.setIndex(r)}},{key:"setupGroups",value:function(t,e){var n=t.map((function(t){var e=t.geometry.index;return e?e.count:0})),r=0,i=0;e.groups=n.map((function(t){var e={start:r,count:t,materialIndex:i};return i++,r+=t,e}))}}]),n}(c),Du=n(14490),Uu=n(42900),Zu=function(){function t(e,n){(0,o.Z)(this,t),this.shadows={},this.cameraHeight=10,this.darkness=1.2,this.opacity=1,this.resolution=512,this.amount=3.5,this.planeColor=16777215,this.shadowOffset=0,this.tempMaterial=new p.MeshBasicMaterial({visible:!1}),this.depthMaterial=new p.MeshDepthMaterial,this.context=e,this.IFC=n,this.initializeDepthMaterial()}return(0,u.Z)(t,[{key:"dispose",value:function(){var t=this;Object.keys(this.shadows).forEach((function(e){return t.deleteShadow(e)})),this.shadows=null,this.tempMaterial.dispose(),this.tempMaterial=null,this.depthMaterial.dispose(),this.depthMaterial=null,this.context=null,this.IFC=null}},{key:"renderShadow",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.context.items.ifcModels.find((function(t){return t.modelID===e}))){t.next=3;break}throw new Error("The requested model was not found.");case 3:return t.next=5,this.renderShadowOfMesh(n,"".concat(n.modelID));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"renderShadowOfMesh",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.uuid;if(this.shadows[e])throw new Error("There is already a shadow with ID ".concat(e));var n=this.getSizeAndCenter(t),r=n.size,i=n.center,a=this.context.getScene(),s=this.createShadow(e,r);this.initializeShadow(t,s,a,i),this.createPlanes(s,r),this.bakeShadow(t,s,a),this.context.renderer.postProduction.excludedItems.add(s.root)}},{key:"deleteShadow",value:function(t){var e=this.shadows[t];if(delete this.shadows[t],!e)throw new Error("No shadow with ID ".concat(t," was found."));I(e.root),I(e.blurPlane),e.rt.dispose(),e.rtBlur.dispose()}},{key:"createPlanes",value:function(t,e){var n=new p.PlaneGeometry(e.x,e.z).rotateX(Math.PI/2);this.createBasePlane(t,n),this.createBlurPlane(t,n)}},{key:"initializeShadow",value:function(t,e,n,r){this.initializeRoot(t,e,n,r),this.initializeRenderTargets(e),this.initializeCamera(e)}},{key:"bakeShadow",value:function(t,e,n){var r=null!==t.parent&&void 0!==t.parent;r||n.add(t);for(var i=n.children.filter((function(n){return n!==t&&n!==e.root})),a=i.length-1;a>=0;a--)n.remove(i[a]);var s=n.background;n.background=null,n.overrideMaterial=this.depthMaterial;var o=this.context.getRenderer();o.setRenderTarget(e.rt),o.render(n,e.camera),n.overrideMaterial=null,this.blurShadow(e,this.amount),this.blurShadow(e,.4*this.amount),o.setRenderTarget(null),n.background=s;for(var u=i.length-1;u>=0;u--)n.add(i[u]);r||t.removeFromParent()}},{key:"initializeCamera",value:function(t){t.camera.rotation.x=Math.PI/2,t.root.add(t.camera)}},{key:"initializeRenderTargets",value:function(t){t.rt.texture.generateMipmaps=!1,t.rtBlur.texture.generateMipmaps=!1}},{key:"initializeRoot",value:function(t,e,n,r){var i=this.getLowestYCoordinate(t);e.root.position.set(r.x,i-this.shadowOffset,r.z),n.add(e.root)}},{key:"createBasePlane",value:function(t,e){var n=this.createPlaneMaterial(t),r=new p.Mesh(e,n);r.renderOrder=2,t.root.add(r),r.scale.y=-1}},{key:"createBlurPlane",value:function(t,e){t.blurPlane.geometry=e,t.blurPlane.visible=!1,t.root.add(t.blurPlane)}},{key:"createPlaneMaterial",value:function(t){return new p.MeshBasicMaterial({map:t.rt.texture,opacity:this.opacity,transparent:!0,depthWrite:!1,clippingPlanes:this.context.getClippingPlanes()})}},{key:"initializeDepthMaterial",value:function(){var t=this;this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1;this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.onBeforeCompile=function(e){e.uniforms.darkness=t.depthMaterial.userData.darkness,e.fragmentShader="\n\t\t\t\t\t\tuniform float darkness;\n\t\t\t\t\t\t".concat(e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );"),"\n\t\t\t\t\t")}}},{key:"createShadow",value:function(t,e){return this.shadows[t]={root:new p.Group,rt:new p.WebGLRenderTarget(this.resolution,this.resolution),rtBlur:new p.WebGLRenderTarget(this.resolution,this.resolution),blurPlane:new p.Mesh,camera:this.createCamera(e)},this.shadows[t]}},{key:"createCamera",value:function(t){return new p.OrthographicCamera(-t.x/2,t.x/2,t.z/2,-t.z/2,0,this.cameraHeight)}},{key:"getSizeAndCenter",value:function(t){var e=t.geometry;if(e.computeBoundingBox(),e.boundingBox){var n=new p.Vector3;e.boundingBox.getSize(n),n.x*=1.5,n.z*=1.5;var r=new p.Vector3;return e.boundingBox.getCenter(r),{size:n,center:r}}throw new Error("Bounding box could not be computed for the mesh ".concat(t.uuid))}},{key:"getLowestYCoordinate",value:function(t){for(var e=t.geometry.index,n=t.geometry.attributes.position,r=Number.MAX_VALUE,i=0;i<=e.count;i++){var a=n.getY(e.array[i]);a<r&&(r=a)}return r}},{key:"blurShadow",value:function(t,e){var n=new p.ShaderMaterial(Du.P);n.depthTest=!1;var r=new p.ShaderMaterial(Uu.Z);r.depthTest=!1,t.blurPlane.visible=!0,t.blurPlane.material=n,t.blurPlane.material.uniforms.tDiffuse.value=t.rt.texture,n.uniforms.h.value=1*e/256;var i=this.context.getRenderer();i.setRenderTarget(t.rtBlur),i.render(t.blurPlane,t.camera),t.blurPlane.material=r,t.blurPlane.material.uniforms.tDiffuse.value=t.rtBlur.texture,r.uniforms.v.value=1*e/256,i.setRenderTarget(t.rt),i.render(t.blurPlane,t.camera),t.blurPlane.visible=!1}}]),t}(),Bu=function(){function t(){(0,o.Z)(this,t),this.drawings={},this.Drawing=null}return(0,u.Z)(t,[{key:"dispose",value:function(){this.drawings=null}},{key:"initializeJSDXF",value:function(t){this.Drawing=t}},{key:"newDrawing",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Meters";if(null===this.Drawing)throw new Error("You must pass the dxf-writer drawing object as parameter");this.drawings[t]=new this.Drawing,this.drawings[t].setUnits(e)}},{key:"drawNamedLayer",value:function(t,e,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"CONTINUOUS";if(e.plane){var s=e.plane.edges.edges[n];if(s){var o=s.generatorGeometry.attributes.position.array;this.draw(t,o,r,i,a)}}}},{key:"draw",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"CONTINUOUS",a=this.drawings[t];a.layers[n]||a.addLayer(n,r,i),a.setActiveLayer(n);for(var s=0;s<e.length-5;s+=6){var o=[e[s],-e[s+2]],u=[e[s+3],-e[s+5]];0===o[0]&&0===o[1]&&0===u[0]&&0===u[1]||a.drawLine(o[0],o[1],u[0],u[1])}}},{key:"drawEdges",value:function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"CONTINUOUS",a=this.drawings[t];a.layers[n]||a.addLayer(n,r,i),a.setActiveLayer(n);for(var s=0;s<e.length;s++)for(var o=e[s],u=0;u<o.length-3;u+=2){var l=[o[u],o[u+1]],c=[o[u+2],o[u+3]];a.drawPolyline([l,c])}}},{key:"exportDXF",value:function(t){var e=this.drawings[t];if(!e)throw new Error("There is no drawing with id: ".concat(t));var n=e.toDxfString();return new Blob([n],{type:"application/dxf"})}}]),t}(),Gu=function(){function t(){(0,o.Z)(this,t),this.documents={},this.errorText="The specified document does not exist."}return(0,u.Z)(t,[{key:"dispose",value:function(){this.documents=null}},{key:"setLineWidth",value:function(t,e){this.getDocument(t).drawing.setLineWidth(e)}},{key:"setColor",value:function(t,e){this.getDocument(t).drawing.setTextColor(e.r,e.g,e.b)}},{key:"setScale",value:function(t,e){this.getDocument(t).scale=e}},{key:"newDocument",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.documents[t]={drawing:e,scale:n}}},{key:"getScale",value:function(t,e,n){var r=t.max.x-t.min.x,i=t.max.z-t.min.z,a=Math.min(e,n),s=Math.max(r,i);return 0===s||0===a?1:a/s}},{key:"drawNamedLayer",value:function(t,e,n,r){if(e.plane){var i=e.plane.edges.edges[n];if(i){i.mesh.geometry.computeBoundingBox(),console.log(i);var a=(new p.Box3).setFromObject(i.mesh),s=i.generatorGeometry.attributes.position.array;this.draw(t,s,a),r&&this.addLabels(t,r,a)}}}},{key:"draw",value:function(t,e,n){for(var r=this.getDocument(t),i=this.getScale(n,210,297),a=Math.abs(n.min.x)+1,s=Math.abs(n.min.z)+1,o=0;o<e.length-5;o+=6){var u=[(e[o]+a)*i,(e[o+2]+s)*i],l=[(e[o+3]+a)*i,(e[o+5]+s)*i];0===u[0]&&0===u[1]&&0===l[0]&&0===l[1]||r.drawing.line(u[0],u[1],l[0],l[1],"S")}}},{key:"addLabels",value:function(t,e,n){var r=this.getDocument(t),i=this.getScale(n,210,297),a=Math.abs(n.min.x)+1,s=Math.abs(n.min.z)+1;e.getDimensionsLines.forEach((function(t){r.drawing.text(t.text.element.textContent,(t.center.x+a)*i,(t.center.z+s)*i)}))}},{key:"exportPDF",value:function(t,e){this.getDocument(t).drawing.save(e)}},{key:"getDocument",value:function(t){if(!this.documents[t])throw new Error(this.errorText);return this.documents[t]}}]),t}(),Yu=new p.Vector3(0,1,0),Vu=1e-16,zu=function(){var t=new p.Vector3,e=new p.Vector3,n=new p.Vector3,r=new p.Triangle;return function(i,a){for(var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=[],u=4,l=Math.pow(10,u),c=Math.cos(p.MathUtils.DEG2RAD*s),h=i.getIndex(),f=i.getAttribute("position"),d=h?h.count:f.count,m=[0,0,0],v=["a","b","c"],g=new Array(3),E={},I=0;I<d;I+=3){h?(m[0]=h.getX(I),m[1]=h.getX(I+1),m[2]=h.getX(I+2)):(m[0]=I,m[1]=I+1,m[2]=I+2);var T=r.a,y=r.b,C=r.c;if(T.fromBufferAttribute(f,m[0]),y.fromBufferAttribute(f,m[1]),C.fromBufferAttribute(f,m[2]),r.getNormal(n),g[0]="".concat(Math.round(T.x*l),",").concat(Math.round(T.y*l),",").concat(Math.round(T.z*l)),g[1]="".concat(Math.round(y.x*l),",").concat(Math.round(y.y*l),",").concat(Math.round(y.z*l)),g[2]="".concat(Math.round(C.x*l),",").concat(Math.round(C.y*l),",").concat(Math.round(C.z*l)),g[0]!==g[1]&&g[1]!==g[2]&&g[2]!==g[0])for(var x=0;x<3;x++){var A=(x+1)%3,F=g[x],_=g[A],P=r[v[x]],S=r[v[A]],R="".concat(F,"_").concat(_),O="".concat(_,"_").concat(F);if(O in E&&E[O]){var w=E[O].normal,M=n.dot(w)<=c,N=Math.sign(a.dot(n))!==Math.sign(a.dot(w));if(M||N){var L=new p.Line3;L.start.copy(P),L.end.copy(S),o.push(L)}E[O]=null}else R in E||(E[R]={index0:m[x],index1:m[A],normal:n.clone()})}}for(var b in E)if(E[b]){var k=E[b],D=k.index0,U=k.index1;t.fromBufferAttribute(f,D),e.fromBufferAttribute(f,U);var Z=new p.Line3;Z.start.copy(t),Z.end.copy(e),o.push(Z)}return o}}(),Hu=function(){var t=new p.Vector3,e=new p.Vector3,n=new p.Vector3,r=new p.Plane,i=new p.Line3,a=new p.Line3,s=new p.Line3;return function(o,u){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new p.Line3;if(u.needsUpdate&&u.needsUpdate(),u.getArea()<=Vu)return null;var c=u.points,h=u.plane;i.copy(o),i.delta(t);var f=0===h.normal.dot(t);if(!f)return null;t.cross(h.normal).normalize(),r.setFromNormalAndCoplanarPoint(t,i.start);for(var d=0,m=0;m<3;m++){var v=c[m],g=c[(m+1)%3];if(s.start.copy(v),s.end.copy(g),0===r.distanceToPoint(s.end)&&0===r.distanceToPoint(s.start)){a.copy(s),d=2;break}if(r.intersectLine(s,0===d?a.start:a.end)){if(0===(0===d?a.start:a.end).distanceTo(g))continue;if(2===++d)break}}if(2===d){if(i.delta(t).normalize(),a.delta(e).normalize(),t.dot(e)<0){var E=a.start;a.start=a.end,a.end=E}var I=i.start.dot(t),T=i.end.dot(t),y=a.start.dot(t),C=a.end.dot(t),x=T<y,A=I<C;return I!==C&&y!==T&&x===A?null:(n.subVectors(i.start,a.start),n.dot(t)>0?l.start.copy(i.start):l.start.copy(a.start),n.subVectors(i.end,a.end),n.dot(t)<0?l.end.copy(i.end):l.end.copy(a.end),l)}return null}}(),Xu=function(){var t=new p.Line3;return function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.start.copy(n),t.end.copy(n),t.start.y+=1e5,t.end.y-=1e5,e.intersectLine(t,r)}}(),Wu=function(){var t=new p.Vector3,e=new p.Vector3;return function(n,r){return t.lerpVectors(r.start,r.end,.5),Xu(n,t,e),e.y<t.y}}(),Qu=function(){var t=new p.Vector3,e=new p.Vector3(0,1,0);return function(n){return n.delta(t).normalize(),Math.abs(t.dot(e))>=.9999999999999999}}();function ju(t){return t.needsUpdate&&t.update(),Math.abs(t.plane.normal.dot(Yu))<=Vu}function qu(t,e){for(var n=t.points,r=0,i=0;i<3;i++){var a=e.start,s=e.end,o=n[i];a.distanceToSquared(o)<=Vu&&r++,s.distanceToSquared(o)<=Vu&&r++}return r>=2}var Ku=function(){var t=new p.Line3,e=new p.Vector3,n=new p.Vector3,r=new p.Vector3,i=new p.Line3,a=new G.ExtendedTriangle;return function(s,o,u){if(i.copy(o),a.copy(s),i.start.y=0,i.end.y=0,a.a.y=0,a.b.y=0,a.c.y=0,a.needsUpdate=!0,a.update(),Hu(i,a,t)){i.delta(e),n.subVectors(t.start,i.start),r.subVectors(t.end,i.start);var l=n.length()/e.length(),c=r.length()/e.length();return l=Math.min(Math.max(l,0),1),c=Math.min(Math.max(c,0),1),Math.abs(l-c)<=Vu||u.push(new Float32Array([l,c])),!0}return!1}}(),Ju=function(){var t=new p.Vector3,e=new p.Vector3,n=new p.Vector3,r=new p.Vector3;return function(i,a,s){i.needsUpdate&&i.update(),s.copy(a);var o=i.plane;if(ju(i))return!1;if(a.delta(t),0===o.normal.dot(t))return!1;if(o.intersectLine(a,e)){var u,l=s.start,c=s.end,h=!1;return l.distanceTo(e)>c.distanceTo(e)?u=l:(u=c,h=!0),n.lerpVectors(u,e,.5),Xu(i.plane,n,r),r.y<n.y?h?c.copy(e):l.copy(e):h?l.copy(e):c.copy(e),!0}return!1}}(),$u=function(){var t=new p.Line3;return function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];el(n);for(var i=[[0,1]],a=0,s=n.length;a<s;a++){var o=i[a],u=n[a];o[1]=u[0],i.push(new Float32Array([u[1],1]))}for(var l=0,c=i.length;l<c;l++){var h=e.start,f=e.end;t.start.lerpVectors(h,f,i[l][0]),t.end.lerpVectors(h,f,i[l][1]),r.push(new Float32Array([t.start.x,t.start.y,t.start.z,t.end.x,t.end.y,t.end.z]))}return r}}();function tl(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new Float32Array(6*t.length),r=0,i=0,a=t.length;i<a;i++){var s=t[i];n[r++]=s[0],n[r++]=null===e?s[1]:e,n[r++]=s[2],n[r++]=s[3],n[r++]=null===e?s[4]:e,n[r++]=s[5]}var o=new p.BufferGeometry,u=new p.BufferAttribute(n,3,!0);return o.setAttribute("position",u),o}function el(t){t.sort((function(t,e){return t[0]-e[0]}));for(var e=1;e<t.length;e++){var n=t[e],r=t[e-1];n[0]<=r[1]&&(r[1]=Math.max(r[1],n[1]),t.splice(e,1),e--)}}var nl,rl=function(){function t(e){(0,o.Z)(this,t),this.context=e,this.params={displayModel:"color",displayEdges:!1,displayProjection:!0,useBVH:!0,sortEdges:!0,amount:50,color:197379},this.projectedEdges=[]}return(0,u.Z)(t,[{key:"dispose",value:function(){this.projectedEdges.forEach((function(t){t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach((function(t){return t.dispose()})):t.material.dispose()})),this.projectedEdges=[]}},{key:"projectEdges",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=this.context.getScene(),r=new p.LineSegments(new p.BufferGeometry,new p.LineBasicMaterial({color:this.params.color})),i=this.updateEdges(n,this.params,e,r);i;)i.next().done&&(i=null);return this.projectedEdges.push(r),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"updateEdges",value:(0,a.Z)().mark((function t(e,n,r,i){var s,o,u,l,c,h,f,d,m,v,g,E,I;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(u in e.remove(i),s=[],r.updateWorldMatrix(!0,!0),(o=r.geometry.clone()).applyMatrix4(r.matrixWorld),o.attributes)"position"!==u&&o.deleteAttribute(u);return s.push(o),l=(0,H.qf)(s,!1),s.length=0,o.dispose(),void(t.next=12);case 12:return c=new G.MeshBVH(l),void(t.next=15);case 15:return h=zu(l,new p.Vector3(0,1,0),50),n.sortEdges&&h.sort((function(t,e){return Math.min(t.start.y,t.end.y)-Math.min(e.start.y,e.end.y)})),void(t.next=19);case 19:e.add(i),f=[],d=new p.Line3,m=new p.Ray,v=new p.Vector3,g=function(t,e){var r=h[t];if(Qu(r))return"continue";var i=Math.min(r.start.y,r.end.y),a=[];c.shapecast({intersectsBounds:function(t){return!n.useBVH||(t.min.y=Math.min(i,t.min.y),m.origin.copy(r.start),r.delta(m.direction).normalize(),!!t.containsPoint(m.origin)||!!m.intersectBox(t,v)&&m.origin.distanceToSquared(v)<r.distanceSq())},intersectsTriangle:function(t){if(Math.max(t.a.y,t.b.y,t.c.y)<i)return!1;if(ju(t))return!1;if(qu(t,r))return!1;if(Ju(t,r,d),Wu(t.plane,d))return!1;if(d.distance()<1e-10)return!1;if(Ku(t,r,a)&&el(a),0!==a.length){var e=(0,$s.Z)(a[a.length-1],2),n=e[0],s=e[1];return 0===n&&1===s}return!1}}),$u(r,a,f)},E=0,I=h.length;case 26:if(!(E<I)){t.next=33;break}if("continue"!==g(E,I)){t.next=30;break}return t.abrupt("continue",30);case 30:E++,t.next=26;break;case 33:i.geometry.dispose(),i.geometry=tl(f,0);case 35:case"end":return t.stop()}}),t)}))}]),t}(),il=function(){function t(){(0,o.Z)(this,t)}return(0,u.Z)(t,[{key:"getConvexHull",value:function(t){for(var e=1/0,n=-1,r=0,i=t.length;r<i;r++){var a=t[r];a.y<e&&(n=r,e=a.y)}var s=t[n];function o(t,e,n){var r=(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y);return 0===r?0:r>0?1:2}function u(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)}t[n]=t[0],t[0]=s;for(var l=1,c=(t=t.sort((function(t,e){var n=o(s,t,e);return 0===n?u(s,e)>=u(s,t)?-1:1:2===n?-1:1}))).length,h=1;h<c;h++){for(;h<c-1&&0===o(s,t[h],t[h+1]);)h++;t[l]=t[h],l++}if(l<3)return null;for(var f=[t[0],t[1],t[2]],d=3;d<l;d++){for(;2!==o(f[f.length-2],f[f.length-1],t[d]);)f.pop();f.push(t[d])}return f}},{key:"pointRayCrossesLine",value:function(t,e,n,r){var i=e.start,a=e.end,s=t.x,o=t.y,u=i.y,l=a.y;if(u===l)return!1;if(o>u&&o>l)return!1;if(o<u&&o<l)return!1;var c=i.x,h=a.x;if(s>c&&s>h)return!1;if(s<c&&s<h)return o!==u||n===r;var f=l-u,d=f*(s-c)+-(h-c)*(o-u);return Math.sign(d)!==Math.sign(f)}},{key:"pointRayCrossesSegments",value:function(t,e){for(var n=0,r=e[e.length-1],i=r.start.y>r.end.y,a=0,s=e.length;a<s;a++){var o=e[a],u=o.start.y>o.end.y;this.pointRayCrossesLine(t,o,i,u)&&n++,i=u}return n}},{key:"lineCrossesLine",value:function(t,e){function n(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}var r=t.start,i=t.end,a=e.start,s=e.end;return n(r,a,s)!==n(i,a,s)&&n(r,i,a)!==n(r,i,s)}}]),t}(),al=function(){function t(e,n){(0,o.Z)(this,t),this.toScreenSpaceMatrix=e,this.lassoSegments=n,this.boxPoints=new Array(8).fill(0).map((function(){return new p.Vector3})),this.boxLines=new Array(12).fill(0).map((function(){return new p.Line3})),this.perBoundsSegments=[],this.math=new il,this.selectModel=!1,this.useBoundsTree=!0,this.selectionMode="intersection"}return(0,u.Z)(t,[{key:"shapeCast",value:function(t,e){var n=this;if(!t.geometry.boundsTree)throw new Error("Geometry must have BVH applied!");t.geometry.boundsTree.shapecast({intersectsBounds:function(t,e,r,i){for(var a=t.min,s=t.max,o=0,u=1/0,l=-1/0,c=1/0,h=0;h<=1;h++)for(var f=0;f<=1;f++)for(var d=0;d<=1;d++){var p=n.boxPoints[o];p.x=0===h?a.x:s.x,p.y=0===f?a.y:s.y,p.z=0===d?a.z:s.z,p.w=1,p.applyMatrix4(n.toScreenSpaceMatrix),o++,p.y<u&&(u=p.y),p.y>l&&(l=p.y),p.x<c&&(c=p.x)}var m=n.perBoundsSegments[i-1]||n.lassoSegments,v=n.perBoundsSegments[i]||[];v.length=0,n.perBoundsSegments[i]=v;for(var g=0,E=m.length;g<E;g++){var I=m[g],T=I.start.x,y=I.start.y,C=I.end.x,x=I.end.y;if(!(T<c&&C<c))if(!(y>l)||!(x>l))y<u&&x<u||v.push(I)}if(0===v.length)return G.NOT_INTERSECTED;var A=n.math.getConvexHull(n.boxPoints);if(!A)return G.NOT_INTERSECTED;var F=A.map((function(t,e){var r=A[(e+1)%A.length],i=n.boxLines[e];return i.start.copy(t),i.end.copy(r),i}));if(n.math.pointRayCrossesSegments(v[0].start,F)%2===1)return G.INTERSECTED;for(var _=0,P=0,S=A.length;P<S;P++){var R=A[P],O=n.math.pointRayCrossesSegments(R,v);if(0===P&&(_=O),_!==O)return G.INTERSECTED}for(var w=0,M=F.length;w<M;w++)for(var N=F[w],L=0,b=v.length;L<b;L++)if(n.math.lineCrossesLine(N,v[L]))return G.INTERSECTED;return _%2===0?G.NOT_INTERSECTED:G.CONTAINED},intersectsTriangle:function(t,r,i,a){var s=3*r,o=s,u=s+1,l=s+2;if(i)return e.push(o,u,l),n.selectModel;var c=n.useBoundsTree?n.perBoundsSegments[a]:n.lassoSegments;if("centroid"===n.selectionMode){var h=t.a.add(t.b).add(t.c).multiplyScalar(1/3);if(h.applyMatrix4(n.toScreenSpaceMatrix),n.math.pointRayCrossesSegments(h,c)%2===1)return e.push(o,u,l),n.selectModel}else if("intersection"===n.selectionMode){for(var f=[t.a,t.b,t.c],d=0;d<3;d++){var p=f[d];if(p.applyMatrix4(n.toScreenSpaceMatrix),n.math.pointRayCrossesSegments(p,c)%2===1)return e.push(o,u,l),n.selectModel}var m=[n.boxLines[0],n.boxLines[1],n.boxLines[2]];m[0].start.copy(t.a),m[0].end.copy(t.b),m[1].start.copy(t.b),m[1].end.copy(t.c),m[2].start.copy(t.c),m[2].end.copy(t.a);for(var v=0;v<3;v++)for(var g=m[v],E=0,I=c.length;E<I;E++)if(n.math.lineCrossesLine(g,c[E]))return e.push(o,u,l),n.selectModel}return!1}})}}]),t}();!function(t){t[t.lasso=0]="lasso",t[t.box=1]="box"}(nl||(nl={}));var sl=function(){function t(e){(0,o.Z)(this,t),this.context=e,this.toolMode=nl.box,this.selectionShape=new p.Line,this.dragging=!1,this.selectionPoints=[],this.selectionShapeNeedsUpdate=!1,this.selectionNeedsUpdate=!1,this.startX=-1/0,this.startY=-1/0,this.prevX=-1/0,this.prevY=-1/0,this.tempVec0=new p.Vector2,this.tempVec1=new p.Vector2,this.tempVec2=new p.Vector2,this.toScreenSpaceMatrix=new p.Matrix4,this.lassoSegments=[],this.caster=new al(this.toScreenSpaceMatrix,this.lassoSegments),this.setupSelectionShape(),this.updateAll()}return(0,u.Z)(t,[{key:"setupSelectionShape",value:function(){this.selectionShape=new p.Line;var t=this.selectionShape.material;t.depthTest=!1,t.color.set(16750592).convertSRGBToLinear(),this.selectionShape.renderOrder=1,this.selectionShape.position.z=-.2,this.selectionShape.scale.setScalar(1),this.selectionShape.frustumCulled=!1,this.context.getCamera().add(this.selectionShape)}},{key:"onDragStarted",value:function(){this.prevX=this.context.mouse.rawPosition.x,this.prevY=this.context.mouse.rawPosition.y,this.startX=this.context.mouse.position.x,this.startY=this.context.mouse.position.y,this.selectionPoints.length=0,this.dragging=!0;var t=this.context.getCamera();if(t.parent||this.context.getScene().add(t),t instanceof p.PerspectiveCamera){var e=Math.tan(p.MathUtils.DEG2RAD*t.fov/2)*this.selectionShape.position.z;this.selectionShape.scale.set(-e*t.aspect,-e,1)}}},{key:"onDragFinished",value:function(){this.dragging=!1,this.selectionShape.visible=!1,this.selectionPoints.length&&(this.selectionNeedsUpdate=!0),this.updateAll()}},{key:"onDrag",value:function(){if(this.dragging){var t=this.context.mouse.rawPosition.x,e=this.context.mouse.rawPosition.y,n=this.context.mouse.position.x,r=this.context.mouse.position.y;if(this.toolMode===nl.box)this.selectionPoints.length=15,this.selectionPoints[0]=this.startX,this.selectionPoints[1]=this.startY,this.selectionPoints[2]=0,this.selectionPoints[3]=n,this.selectionPoints[4]=this.startY,this.selectionPoints[5]=0,this.selectionPoints[6]=n,this.selectionPoints[7]=r,this.selectionPoints[8]=0,this.selectionPoints[9]=this.startX,this.selectionPoints[10]=r,this.selectionPoints[11]=0,this.selectionPoints[12]=this.startX,this.selectionPoints[13]=this.startY,this.selectionPoints[14]=0,t===this.prevX&&e===this.prevY||(this.selectionShapeNeedsUpdate=!0),this.prevX=t,this.prevY=e,this.selectionShape.visible=!0;else if(Math.abs(t-this.prevX)>=3||Math.abs(e-this.prevY)>=3){var i=3*(this.selectionPoints.length/3-1),a=!1;if(this.selectionPoints.length>3)this.tempVec0.set(this.selectionPoints[i-3],this.selectionPoints[i-3+1]),this.tempVec1.set(this.selectionPoints[i],this.selectionPoints[i+1]),this.tempVec1.sub(this.tempVec0).normalize(),this.tempVec0.set(this.selectionPoints[i],this.selectionPoints[i+1]),this.tempVec2.set(n,r),this.tempVec2.sub(this.tempVec0).normalize(),a=this.tempVec1.dot(this.tempVec2)>.99;a?(this.selectionPoints[i]=n,this.selectionPoints[i+1]=r):this.selectionPoints.push(n,r,0),this.selectionShapeNeedsUpdate=!0,this.selectionShape.visible=!0,this.prevX=t,this.prevY=e}this.updateSelectionLasso()}}},{key:"updateSelectionLasso",value:function(){if(this.selectionShapeNeedsUpdate){if(this.toolMode===nl.lasso){var t=this.selectionPoints.length;this.selectionPoints.push(this.selectionPoints[0],this.selectionPoints[1],this.selectionPoints[2]),this.selectionShape.geometry.setAttribute("position",new p.Float32BufferAttribute(this.selectionPoints,3,!1)),this.selectionPoints.length=t}else this.selectionShape.geometry.setAttribute("position",new p.Float32BufferAttribute(this.selectionPoints,3,!1));this.selectionShapeNeedsUpdate=!1}}},{key:"updateAll",value:function(){var t=this;this.context.items.pickableIfcModels.forEach((function(e){t.update(e)})),this.selectionNeedsUpdate=!1}},{key:"update",value:function(t){this.selectionNeedsUpdate&&this.selectionPoints.length>0&&this.updateSelection(t)}},{key:"updateSelection",value:function(t){var e=this.context.getCamera();for(this.toScreenSpaceMatrix.copy(t.matrixWorld).premultiply(e.matrixWorldInverse).premultiply(e.projectionMatrix);this.lassoSegments.length<this.selectionPoints.length;)this.lassoSegments.push(new p.Line3);this.lassoSegments.length=this.selectionPoints.length;for(var n=0,r=this.selectionPoints.length;n<r;n+=3){var i=this.lassoSegments[n],a=(n+3)%r;i.start.x=this.selectionPoints[n],i.start.y=this.selectionPoints[n+1],i.end.x=this.selectionPoints[a],i.end.y=this.selectionPoints[a+1]}var s=[];this.caster.shapeCast(t,s),this.onSelected&&this.onSelected(t,s)}}]),t}(),ol=function(){function t(e){var n=this;if((0,o.Z)(this,t),this.addClippingPlane=function(){n.clipper.createPlane()},this.removeClippingPlane=function(){n.clipper.deletePlane()},this.toggleClippingPlanes=function(){n.clipper.toggle()},this.prePickIfcItem=function(){n.IFC.selector.prePickIfcItem()},this.pickIfcItem=function(){return n.IFC.selector.pickIfcItem()},this.pickIfcItemsByID=function(t,e){n.IFC.selector.pickIfcItemsByID(t,e)},!e.container)throw new Error("Could not get container element!");this.context=new Js(e),this.IFC=new Dt(this.context),this.grid=new _(this.context),this.axes=new P(this.context),this.clipper=new E(this.context,this.IFC),this.plans=new F(this.IFC,this.context,this.clipper),this.filler=new y(this.IFC,this.context),this.dimensions=new U(this.context),this.edges=new Z(this.context),this.shadowDropper=new Zu(this.context,this.IFC),this.edgesProjector=new rl(this.context),this.dxf=new Bu,this.pdf=new Gu,this.GLTF=new ku(this.context,this.IFC),this.dropbox=new Ut(this.context,this.IFC),this.selectionWindow=new sl(this.context),v.K.ifc=this.IFC,v.K.context=this.context}return(0,u.Z)(t,[{key:"openDropboxWindow",value:function(){this.dropbox.loadDropboxIfc()}},{key:"loadIfc",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],t.next=3,this.IFC.loadIfc(e,n);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addGrid",value:function(t,e,n,r){this.grid.setGrid(t,e,n,r)}},{key:"addAxes",value:function(t){this.axes.setAxes(t)}},{key:"loadIfcUrl",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(e){var n,r=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.length>1&&void 0!==r[1]&&r[1],t.next=3,this.IFC.loadIfcUrl(e,n);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setWasmPath",value:function(t){this.IFC.setWasmPath(t)}},{key:"getSpatialStructure",value:function(t){return this.IFC.getSpatialStructure(t)}},{key:"getProperties",value:function(t,e,n){return this.IFC.getProperties(t,e,n)}},{key:"getModelID",value:function(){return this.IFC.getModelID()}},{key:"getAllItemsOfType",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.IFC.getAllItemsOfType(t,e,n)}},{key:"dispose",value:function(){var t=(0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.grid.dispose(),this.grid=null,this.axes.dispose(),this.axes=null,this.context.dispose(),this.context=null,this.clipper.dispose(),this.clipper=null,this.plans.dispose(),this.plans=null,this.filler.dispose(),this.filler=null,this.dimensions.dispose(),this.dimensions=null,this.edges.dispose(),this.edges=null,this.shadowDropper.dispose(),this.shadowDropper=null,this.dxf.dispose(),this.dxf=null,this.pdf.dispose(),this.pdf=null,this.edgesProjector.dispose(),this.edgesProjector=null,this.dropbox=null,this.GLTF.dispose(),this.GLTF=null,t.next=29,this.IFC.dispose();case 29:this.IFC=null;case 30:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}()}}]);
//# sourceMappingURL=5399.bundle.js.map